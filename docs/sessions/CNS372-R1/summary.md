# AWS re:Invent 2025 无服务器架构会议总结

## 会议概述

本次会议（CNS 372）主题为"使用 AWS Lambda 构建大规模应用的无服务器模式"，由 AWS 高级解决方案架构师 Leeris Carager Yu 和 Michelle Chisman 主讲。会议针对无服务器应用从小规模发展到数百个 Lambda 函数时面临的管理挑战，提供了实用的架构模式和最佳实践。

演讲者通过电商应用案例，展示了从单一用途 Lambda 函数架构演进到微服务架构的过程，并介绍了多种优化技术。会议重点解决了三个核心痛点：如何合理组织大量 Lambda 函数、如何在函数间重用代码，以及如何在不同环境中保持一致的部署。通过 Lambda Web Adapter、API Gateway 直接集成、Lambda Layers 等技术，演讲者展示了如何在保持无服务器优势的同时，提高开发效率和系统性能。

## 详细时间线和要点

### 00:00 - 会议开场和问题定义
- **演讲者介绍**：Leeris Carager Yu 和 Michelle Chisman，AWS 高级解决方案架构师
- **核心场景**：经理要求构建电商无服务器平台，3个月后发展成数百个 Lambda 函数
- **三大痛点识别**：
  - 如何组织和管理大量 Lambda 函数
  - 如何在函数间重用代码
  - 如何保持跨环境部署一致性

### 05:00 - 单一用途 Lambda 函数架构展示
- **架构演示**：使用 Kirao IDE 展示电商应用架构
- **功能分解**：获取产品、添加购物车、移除购物车、订单处理等独立函数
- **基础设施**：API Gateway 作为前端，每个函数对应不同 DynamoDB 表
- **SAM 框架介绍**：无服务器应用模型，包含基础设施即代码和 CLI 工具

### 10:00 - 冷启动问题分析
- **性能测试**：首次调用 1.2 秒，后续调用 0.2 秒
- **冷启动解释**：初始化时间包括代码下载、运行时环境启动、执行环境准备
- **扩展性挑战**：50-200 个函数导致代码库膨胀、单一 CI/CD 管道风险

### 15:00 - 微服务原则应用
- **解决方案**：应用微服务原则和有界上下文
- **重构演示**：将购物车相关函数（添加、获取、移除）组织到 cart-service 文件夹
- **模板分离**：为每个微服务创建独立的 SAM 模板
- **组织优势**：独立开发、部署、扩展，不同团队所有权

### 25:00 - Lambda Web Adapter 模式
- **优化目标**：减少 Lambda 函数数量
- **实现方式**：使用 FastAPI 和 Mangum，将多个 HTTP 方法路由到单一函数
- **性能对比**：
  - 初始冷启动：2.8 秒（因部署包更大）
  - 后续调用：0.2 秒（无额外冷启动）
- **适用场景**：共同依赖、相似初始化需求、相同权限配置

### 35:00 - API Gateway 直接集成
- **无代码方案**：移除简单 CRUD 操作的 Lambda 函数
- **实现演示**：get-cart 函数替换为 API Gateway 直接调用 DynamoDB
- **VTL 模板**：使用 Velocity Template Language 构造请求和响应
- **性能提升**：首次调用即达到 0.2 秒，无冷启动延迟
- **成本优势**：无 Lambda 调用费用，更低延迟，更好扩展性

### 45:00 - 代码重用挑战
- **问题描述**：Michelle 接手讲解代码重用问题
- **重复代码困扰**：数据库连接逻辑在多个函数中重复实现
- **维护难题**：更新逻辑需要修改多个位置，容易出错
- **一致性需求**：认证、错误处理等需要跨函数保持一致

### 50:00 - Lambda Layers 解决方案
- **概念介绍**：共享库，可在多个 Lambda 函数间复用
- **PowerTools 示例**：展示现有的开源 Lambda Layer
- **部署方式**：通过 ARN 引用或创建自定义 ZIP 包
- **限制条件**：
  - 每个函数最多 5 个 Layer
  - 部署包大小限制（压缩 50MB，解压 250MB）
  - 影响冷启动时间
  - 版本管理复杂性

### 60:00 - Step Functions 工作流编排
- **场景扩展**：处理复杂的多步骤业务流程
- **可视化工具**：使用 Workflow Studio 在 IDE 中构建状态机
- **订单处理流程**：提交订单 → 预留库存 → 处理支付 → 完成订单
- **错误处理**：支付失败时自动回滚库存预留
- **SDK 集成**：将简单的 DynamoDB 操作替换为直接 SDK 调用

### 70:00 - 账户策略讨论
- **多账户部署**：不同环境使用独立 AWS 账户
- **最佳实践确认**：大多数与会者已采用多账户策略
- **安全隔离**：开发、测试、生产环境完全隔离

### 75:00 - 问答环节
- **API Gateway 超时**：29 秒软限制，可通过支持工单提升
- **S3 集成**：讨论 MTLS 认证需求和直接集成可能性
- **版本管理**：Layer 版本控制的复杂性和最佳实践

### 80:00 - 总结和最佳实践
- **架构演进路径**：
  - 从分散的单一函数到微服务边界上下文
  - 使用 Web Adapter 减少函数数量
  - 通过直接集成消除简单操作的代码
- **关键原则**：
  - 避免创建单体应用
  - 监控函数大小和内存使用
  - 考虑故障影响范围
  - 保持有界上下文原则