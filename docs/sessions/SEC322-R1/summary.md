# AWS re:Invent 2025 会议总结：使用可导出公共证书自动化证书管理

## 会议概述

本次会议由AWS首席安全解决方案架构师Zach Miller和安全专家Pravin Nyer主讲，重点介绍了AWS Certificate Manager (ACM)的可导出公共证书功能及其自动化管理解决方案。

传统上，ACM颁发的公共证书只能绑定到集成服务（如ALB、API Gateway、CloudFront），无法导出私钥。许多客户反馈他们需要在非集成服务上使用公共证书，例如EC2实例上的Nginx、防火墙设备、本地数据中心服务器等。为解决这一需求，AWS推出了可导出公共证书功能，允许客户导出私钥并部署到任何需要的位置。

该功能的核心优势包括：统一的证书提供商、与IAM的访问控制集成、CloudTrail和CloudWatch的可观测性支持，以及极具竞争力的定价模式（每个FQDN $15，仅在首次导出时收费，通配符证书$149）。会议还展示了一个开源自动化解决方案，通过EventBridge、Lambda、Step Functions和Systems Manager实现证书的自动续期和部署，大幅减少了手动操作和人为错误的风险。

## 详细时间线与关键要点

### 开场介绍 (0:00-3:30)
- **0:00** - 会议开始，主题：使用可导出公共证书自动化证书管理
- **0:15** - Zach Miller自我介绍：AWS首席安全SA，负责加密服务
- **0:30** - Pravin Nyer自我介绍：AWS安全专家，专注数据保护和隐私
- **1:00** - 说明会议互动形式，欢迎随时提问

### ACM服务介绍 (3:30-8:00)
- **3:30** - 介绍AWS Certificate Manager基本功能：颁发公共和私有证书
- **4:00** - 强调托管续期功能：证书到期前60天自动续期
- **4:30** - 域名验证方式：强烈推荐使用DNS验证而非邮件验证
- **5:00** - DNS验证优势：无需人工干预，避免邮件遗漏导致的服务中断
- **6:00** - 客户需求：希望在EC2、防火墙等非集成服务上使用公共证书
- **7:00** - 可导出公共证书功能发布背景和动机

### 使用场景与定价 (8:00-15:00)
- **8:00** - 使用场景：多云环境服务器、本地系统、防火墙、EKS容器等
- **9:00** - 定价模式详解：每个FQDN $15，仅在首次导出时收费
- **9:30** - 问答：多个SAN的计费方式（每个FQDN单独计费）
- **10:00** - 问答：导出后重复导出不再收费，直到下次续期
- **11:00** - 通配符证书定价：$149固定费用
- **12:00** - 问答：可导出标记必须在创建证书时设置，后续无法更改
- **13:00** - 讨论：出于安全考虑，不建议将所有证书标记为可导出
- **14:00** - 问答：证书有效期为13个月，未来将根据CAB Forum要求调整

### 证书管理挑战 (15:00-18:00)
- **15:00** - 手动证书管理的痛点：日历提醒、人工安装、容易出错
- **15:30** - 多环境部署挑战：Nginx、负载均衡器、代理等不同环境
- **16:30** - 续期间隙导致的服务中断风险
- **17:00** - 自动化需求：希望证书自动续期和部署，无需人工干预

### 解决方案架构 - 按需工作流 (18:00-28:00)
- **18:00** - 解决方案设计目标：事件驱动、自动化、安全存储私钥
- **19:00** - 两种工作流：按需证书部署和自动续期
- **20:00** - 架构图讲解：API Gateway触发Step Functions
- **21:00** - Systems Manager介绍：管理EC2实例和本地服务器的工具
- **22:00** - 基于标签的部署：通过EC2标签识别目标实例
- **23:00** - 三个Lambda函数：导出证书、处理元数据、触发部署
- **24:00** - 私钥保护：自动生成密码短语并存储在Secrets Manager
- **25:00** - DynamoDB表：记录证书部署位置的元数据
- **26:00** - Systems Manager自动化文档：在Linux/Windows上安装证书
- **27:00** - 支持自定义应用：可修改自动化文档适配Nginx、IIS等

### 安全机制 (28:00-32:00)
- **28:00** - 问答：导出前私钥在HSM中受FIPS 140-3 Level 3保护
- **28:30** - 导出时私钥使用密码短语加密
- **29:00** - 共同责任模型：导出后客户负责保护私钥
- **30:00** - ABAC（基于属性的访问控制）：EC2实例标签必须与密钥标签匹配
- **31:00** - 只有授权的EC2实例才能访问对应的密码短语
- **31:30** - 密码短语存储在与EC2实例相同的账户中

### 自动续期工作流 (32:00-36:00)
- **32:00** - EventBridge规则：监听证书续期事件
- **33:00** - 证书到期前60天自动触发续期流程
- **34:00** - Lambda函数查询DynamoDB确定部署位置
- **34:30** - 自动导出新证书并更新密码短语
- **35:00** - 在原部署位置自动安装新证书
- **35:30** - 完全自动化：无需人工干预即可完成续期和部署

### 跨账户支持 (36:00-39:00)
- **36:00** - 问答：解决方案支持跨账户部署
- **37:00** - CloudFormation模板：中央账户和目标账户分别部署
- **37:30** - IAM角色配置：允许Systems Manager跨账户执行命令
- **38:00** - 密码短语存储策略：存储在EC2实例所在账户，避免跨账户访问
- **38:30** - 跨账户架构设计考虑

### 证书发现与验证 (39:00-43:00)
- **39:00** - 问答：解决方案不支持自动发现已安装的证书
- **40:00** - 证书发现挑战：需要扫描磁盘或使用第三方工具
- **41:00** - 建议使用Venafi或Appx等合作伙伴解决方案进行证书清单管理
- **42:00** - 域名验证：通过CNAME记录或邮件验证证明域名所有权
- **42:30** - Route 53集成：自动创建验证记录

### ACME协议与路线图 (43:00-45:00)
- **43:00** - 问答：ACM目前不支持ACME协议
- **43:30** - 暗示：许多客户请求ACME支持，团队正在考虑
- **44:00** - 无法透露具体路线图，但客户反馈已被重视
- **44:30** - 跨账户Route 53验证挑战及解决方案讨论

### 开源代码与资源 (45:00-48:00)
- **45:00** - GitHub开源项目：AWS Samples中的ACM导出证书自动化
- **46:00** - 详细的README文档：包含安装、测试和使用说明
- **46:30** - 欢迎社区贡献和反馈
- **47:00** - 提供QR码扫描访问GitHub仓库
- **47:30** - 演讲者联系方式：欢迎会后交流和技术支持

### 演示准备与总结 (48:00-结束)
- **48:00** - 准备进入实际演示环节
- **48:30** - 强调解决方案的灵活性：可适配不同应用和环境
- **49:00** - 未来扩展计划：支持外部密钥库和其他云提供商
- **49:30** - 再次强调这是概念验证和示例代码，非AWS官方服务
- **50:00** - 最后问答和会议总结

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


GitHub仓库: AWS Samples - ACM Export Certificate Automation

关键技术栈: AWS Certificate Manager, Lambda, Step Functions, Systems Manager, EventBridge, Secrets Manager, DynamoDB