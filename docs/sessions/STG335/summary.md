# AWS re:Invent 2025 - S3 高性能架构与设计会议总结

## 会议概述

本次技术分享由 Amazon S3 软件开发总监 Ian McGarry 和 S3 首席产品经理 Devkumar 共同主讲，深入探讨了如何利用 S3 的架构设计实现大规模吞吐量和高性能访问。会议重点介绍了 S3 的内部工作原理、性能优化最佳实践，以及专为高性能场景设计的 S3 Express One Zone 存储类。

演讲者首先解释了为什么客户需要从对象存储中获得高吞吐量和低延迟——主要是因为 S3 提供的弹性扩展能力，使其成为数据湖、分析工作负载和机器学习训练的理想选择。目前 S3 存储超过 500 万亿个对象，每秒处理超过 2 亿个请求，支持超过 100 万个数据湖。会议详细讲解了如何通过并行化连接、合理的前缀结构设计以及使用 AWS Common Runtime (CRT) 等工具来充分利用 S3 的规模优势。第二部分重点介绍了 S3 Express One Zone，这是一个提供个位数毫秒访问时间的高性能存储类，特别适合机器学习训练、交互式查询、日志流处理和模型加载等场景。

## 详细时间轴与关键要点

### 开场与议程介绍 (0:00-1:30)
- **演讲者介绍**：Ian McGarry（S3 软件开发总监）和 Devkumar（S3 首席产品经理）
- **会议主题**：深入探讨 S3 架构、规模以及如何实现大规模吞吐量和低延迟
- **议程预告**：将涵盖 S3 工作原理和 S3 Express One Zone 高性能存储类

### S3 高吞吐量的应用场景 (1:30-3:00)
- **核心价值**：客户看重 S3 的持久性、可用性、成本，但最重要的是弹性扩展能力
- **典型工作负载**：数据湖分析、机器学习训练（可扩展到每秒数百 GB 的持续吞吐量）
- **其他应用**：日志交互式查询、Express 上的模型加载

### 高吞吐量优化核心原则 (3:00-5:30)
- **关键理念**：利用 S3 的规模优势——跨全球大量基础设施（磁盘、服务器、网络）进行广泛并行化
- **S3 规模数据**：
  - 存储超过 500 万亿个对象
  - 数百 EB 的存储容量
  - 每秒处理超过 2 亿个请求
  - 支持超过 100 万个数据湖

### S3 架构三大组件 (5:30-7:30)
- **前端 (Front End)**：路由请求、编排处理（授权、认证、事件生成、日志记录）
- **索引 (Index)**：大型分布式键值存储，将对象元数据映射到对象字节位置
- **存储子系统 (Storage Subsystem)**：管理大规模磁盘并决定数据放置位置

### 并行化上传示例 (7:30-11:00)
- **单连接限制**：每个连接一次只能有一个活动请求，通常可达到约 100 MB/s
- **500 MB 对象示例**：单连接需要 5 秒上传
- **并行化方案**：将对象分成 5 个部分，使用 5 个并行连接，上传时间降至 1 秒
- **多部分上传 (Multipart Upload) 优势**：
  - 提高吞吐量
  - 改善恢复时间（仅需重新上传失败的部分）
  - 可以任意顺序上传
  - 可在拥有全部数据前开始上传（适合流式场景）
  - 支持暂停和恢复

### 并行化下载 - 范围读取 (11:00-12:30)
- **Range Gets**：使用 5 个独立的 GET 请求跨 5 个连接下载数据
- **实现方法**：使用 List Parts API 列出对象的各个部分并映射到范围，然后使用 Range GET API 并行下载
- **相同优势**：失败时仅需重新下载失败的部分

### 多值应答 DNS (12:30-15:00)
- **理想状态**：5 个连接应连接到 5 个不同的 S3 IP 地址
- **多值应答 DNS**：DNS 查询最多返回 8 个 IP 地址
- **客户端优势**：可以跨多个 IP 并行化，快速重试而无需重新解析 DNS
- **SDK 支持**：AWS SDK Java 2.x、C++ 和 Python boto3 已内置支持

### AWS Common Runtime (CRT) (15:00-18:30)
- **推出背景**：将最佳实践内置到代码中，让客户无需频繁调整客户端
- **核心功能**：
  - 处理异步 I/O
  - 优化的 HTTP 客户端
  - 自动认证和授权
  - 自动并行化上传和下载
  - 内置重试逻辑
- **目标吞吐量配置**：简单配置即可告诉 CRT 期望的吞吐量（以 Gbps 为单位）
- **默认值**：通常设置为 10 Gbps
- **可用性**：嵌入多个客户端，包括 Mountpoint for Amazon S3、boto3 和 AWS CLI（在 TRN1、P4D、P5 实例上默认启用）

### 前缀结构的重要性 (18:30-25:00)
- **S3 前缀定义**：存储桶名称后的任何字符串
- **每前缀限制**：
  - 新建存储桶：3,500 次 PUT/秒 或 5,500 次 GET/秒
  - 10 个前缀：35,000 次 PUT/秒 或 55,000 次 GET/秒
- **自动扩展**：S3 根据前缀结构和请求负载自动分区
- **分区示例**：
  - 初始：每个前缀 5,500 GET/秒
  - 第一次分割：2 个前缀，总计 11,000 GET/秒
  - 第二次分割：4 个前缀，总计 22,000 GET/秒

### 前缀结构常见陷阱 (25:00-28:30)
- **时间戳问题**：将日期放在前缀开头会导致分区无法重用
- **错误示例**：day1/prefix1/a、day2/prefix1/a（每天需要重新分区）
- **正确示例**：prefix1/a/day1、prefix1/a/day2（分区可跨天重用）
- **扩展期间**：可能会看到 HTTP 503 错误，提示减速，但分区完成后将持续支持高 TPS

### S3 Express One Zone 介绍 (28:30-31:00)
- **性能特点**：
  - 最快的对象存储，提供个位数毫秒访问时间
  - 每个目录存储桶最多 200 万请求/秒
  - 创建存储桶时即获得 200k TPS 容量（无需预热）
- **独特功能**：
  - 可向现有对象追加数据
  - O(1) 重命名操作（恒定时间，与对象大小无关）
- **性能提升**：相比 S3 Standard 快 10 倍

### S3 Express One Zone 应用场景 (31:00-36:00)
- **机器学习训练**：
  - 需要极高吞吐量（可达 TB/秒）
  - 保持 GPU 繁忙，最大化利用率
  - 支持基础模型训练
- **交互式查询**：
  - 可观测性分析用例（日志文件查询）
  - 突发至数万至数十万 TPS
  - 需要低延迟响应
- **日志和媒体流**：
  - 持续接收新数据
  - 使用追加功能直接在对象存储中创建文件
  - 简化架构，降低成本
- **模型加载**：
  - 推理管道中数万至数十万节点同时读取模型
  - 突发访问模式
  - 需要开箱即用的高 TPS 容量

### 客户案例 - Tavily (36:00-38:00)
- **公司背景**：AI 平台公司，为代理工作流和大语言模型提供 Web 访问层
- **之前方案**：自建和管理缓存层
- **迁移到 S3 Express One Zone**：
  - 弹性扩展
  - 个位数毫秒访问时间
  - 总拥有成本降低高达 6 倍

### 架构考虑因素 (38:00-42:00)
- **单可用区特性**：
  - 数据存储在单个可用区
  - 可从不同可用区访问
  - 跨可用区访问无额外网络成本
- **目录存储桶**：
  - 与通用存储桶并存的新型存储桶
  - 创建时即扩展至 200k GET/秒 和 100k PUT/秒
  - 适合突发访问场景
  - 可请求更高容量（最高 200 万请求/秒）

### 会议总结
本次会议提供了 S3 高性能优化的全面指南，从底层架构到实际应用场景，帮助客户充分利用 S3 的规模优势实现最佳性能。关键要点包括：通过并行化连接实现高吞吐量、合理设计前缀结构以支持自动扩展、使用 AWS CRT 简化实现，以及针对极致性能需求选择 S3 Express One Zone。