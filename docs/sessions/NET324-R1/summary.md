# AWS re:Invent 2025 会议总结：使用 Amazon CloudFront 和 AWS WAF 管理机器人与人类流量

## 会议概述

本次会议由 AWS Edge 专家 Eitav Arditti 和初创企业解决方案架构师 Nick McCord 主讲，深入探讨了如何使用 Amazon CloudFront 和 AWS WAF 来区分和管理机器人与人类用户流量。会议采用 300 级别的代码深度讲解，通过构建一个宠物收养平台作为实际案例，展示了从基础 WAF 保护到高级流量路由和蜜罐部署的完整解决方案。

演讲者通过现场演示展示了如何应对恶意机器人攻击，特别是针对数据抓取和虚假请求的防护策略。他们强调了现代互联网环境中需要区分好机器人（如搜索引擎爬虫）、坏机器人（如 DDoS 攻击者）、AI 机器人和真实人类用户的重要性。整个解决方案基于 AWS 边缘服务，无需修改应用程序代码即可实现复杂的流量管理。

## 详细时间线与关键要点

### 0:00-5:00 会议开场与背景介绍
- 介绍演讲者：Eitav Arditti（AWS Edge 专家）和 Nick McCord（初创企业解决方案架构师）
- 会议定位为 300 级别代码深度讲解
- 说明会议结构：包含现场演示、架构图和代码展示
- 介绍四种流量类型：人类用户、好机器人、坏机器人、AI 机器人

### 5:00-10:00 AWS Edge 服务概述
- Amazon CloudFront：全球超过 700 个接入点（POPs）的 CDN 服务
- 介绍 CloudFront Functions 和 AWS Lambda@Edge 计算服务
- AWS WAF 作为保护层的作用
- Amazon CloudWatch 用于统一可观测性

### 10:00-15:00 请求处理流程分析
- 四个阶段：查看器请求、源请求、源响应、查看器响应
- WAF 规则在缓存命中前的评估过程
- 访问日志和实时日志的配置选项
- WAF 保护包（Web ACL）的结构和规则优先级

### 15:00-20:00 项目背景与平台介绍
- 基于 2024 年 ASPCA 报告构建宠物收养平台
- 平台功能：聚合收容所数据、提供搜索功能、处理收养申请
- 演示平台界面和机器人切换功能
- 发现问题：大量虚假收养申请攻击

### 20:00-25:00 基础架构与问题分析
- 展示基础架构：S3 存储、CloudFront 缓存、Lambda 处理、DynamoDB 存储
- 当前状态：无 WAF 保护，无法区分人类和机器人流量
- 通过 QR 码让观众体验机器人视角
- 使用 Tor Cannon 模拟复杂机器人攻击

### 25:00-30:00 第一阶段：启用 WAF 基础保护
- 实施速率限制、JA3/JA4 指纹识别、机器人控制
- 演示 WAF 规则配置：从计数模式切换到阻止模式
- 观察结果：机器人检测到阻止后增加攻击强度
- 问题：成本增加，攻击变得更难追踪

### 30:00-35:00 第二阶段：智能流量分流策略
- 从终止性操作（阻止）转向非终止性操作（计数）
- 添加自定义请求头标识机器人流量
- 使用缓存策略为机器人提供有限内容
- 演示配置过程和效果对比

### 35:00-40:00 第三阶段：源修改和蜜罐部署
- 介绍 CloudFront Functions 的源修改功能
- 实施蜜罐策略：将机器人流量路由到专用源
- 缓存破坏机制：对 1% 的机器人流量进行缓存破坏以获取洞察
- CloudFront Functions 101：JavaScript 运行环境和功能

### 40:00-45:00 高级实现与代码演示
- 展示 CloudFront Functions 代码实现
- 机器人检测逻辑和随机缓存破坏
- 源 ID 选择和预配置源管理
- 演示效果：人类看到正常内容，机器人看到蜜罐内容

### 45:00-49:00 图像渲染监控与总结
- 为静态资源添加 CloudFront Functions 监控
- 通过 console.log 收集机器人图像渲染数据
- 关联 API 请求和图像渲染的机器人行为分析
- 架构总结：流量感知、简化实现、服务协同

### 结束语
- 推荐相关 re:Invent 会议内容
- 介绍 CloudFront 和 WAF 的固定价格计划
- 呼吁为宠物慈善组织提供会议反馈