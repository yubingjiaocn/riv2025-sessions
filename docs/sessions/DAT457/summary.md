# AWS re:Invent 2025 - Web3 代理技术会议总结

## 会议概述

本次技术会议是 AWS re:Invent 2025 的一场代码实战（Code Talk）分会，主题聚焦于使用 Amazon Bedrock Agent Core 构建 Web3 智能代理。两位演讲者 Forest 和 David 通过现场编码演示，详细展示了如何利用 AWS 的代理核心服务构建一个具备记忆功能、能够访问区块链数据和市场信息的 Web3 助手。

会议采用高度互动的形式，鼓励参会者提问和深入探讨。演讲者强调这不是一个自动交易机器人，而是一个辅助用户进行 Web3 相关操作的智能助手。整个项目的代码已开源在 GitHub 仓库中，参会者可以通过扫描二维码获取完整的代码和详细的操作步骤文档。

技术架构方面，该解决方案使用了 Bedrock Agent Core Runtime 提供会话隔离和安全保障，采用 Strands Agent SDK 作为代理框架（也可替换为 LangChain 等其他框架），集成了浏览器工具用于获取区块链浏览器数据，并通过 Docker 容器化部署实现接近生产环境的演示效果。整个系统部署在欧洲（法兰克福）区域，但使用跨区域推理配置来访问美国区域的 Claude 模型。

## 详细时间线与关键要点

### **00:00 - 会议开场与议程介绍**
- 演讲者感谢参会者在周三下午参加会议，承认 re:Invent 对所有人都很疲惫
- 介绍会议形式：技术代码实战，将展示实时代码、讲解设计决策、演示系统集成
- 强调会使用 Agent Core 构建具有 Web3 特性的代理

### **02:30 - Web3 代理需求定义**
- **上下文感知能力**：代理需要访问区块链数据和市场数据（新闻、情绪、价格等）
- **记忆功能**：能够记住用户偏好、回忆之前的对话、存储用户状态（如使用的链、地址、余额等）
- **代理协作**：能够触发或调用其他专门执行特定任务的代理（如签名和广播交易、获取地址余额等）
- 明确声明：这不是一个自动交易顾问或交易执行系统，而是一个助手

### **04:00 - 代码仓库与资源分享**
- 展示 QR 码，参会者可访问 GitHub 公开仓库
- 仓库包含所有演示代码和详细的 Markdown 操作指南
- 鼓励参会者自行运行和深入研究（会议时间有限，只能覆盖部分细节）

### **05:30 - 架构概览**
- 使用 Agent Core Runtime 作为部署和运行环境
- 采用 Strands Agent SDK（可替换为其他框架如 LangChain）
- 集成可观测性日志功能
- 使用 Agent Core Browser Tool 访问区块链浏览器等数据源

### **06:45 - Agent Core Runtime 的关键特性：会话隔离**
- 每个代理会话通过 Session ID 调用时，创建独立的 microVM
- 提供隔离的计算、内存和文件系统存储
- 对 Web3 用例特别重要：处理交易历史、公钥、地址等敏感信息时，确保不同用户的会话完全分离
- 示例场景：帮助用户处理交易历史生成加密货币税务报告

### **08:00 - 开发环境设置**
- 使用 UV（新一代 Python 包管理器）初始化项目
- 安装依赖：Boto3、Bedrock Agent Core、Botocore
- 项目采用 Docker 化方式，接近生产环境部署
- 构建流程：Docker build → 推送到 ECR（Elastic Container Registry）→ Agent Core Runtime 从 ECR 拉取

### **10:30 - IAM 权限要求**
- 需要特定的 IAM 策略用于 CLI 部署
- 包括 Bedrock 和 Agent Core 相关权限
- 所有权限要求在 README 和 workshop 文件中列出

### **11:00 - 模块一：创建基础 Strands 代理（带记忆支持）**
- 运行 uv init 初始化项目
- 添加 Python 依赖
- 创建虚拟环境（venv）
- Requirements.txt 包含：Strands Agent Core、Playwright（浏览器支持）、Boto3（用于调用其他代理）

### **13:00 - 记忆系统设置**
- 记忆是 Web3 代理的核心功能
- 需要存储用户偏好：关注的币种、角色、特定链等
- 运行 create_web3_agent_memory.py 脚本创建记忆数据库
- 定义多种记忆策略供后续使用

### **14:30 - 记忆策略深度解析（Forest 讲解）**
- **短期记忆**：存储原始事件数据
- **长期记忆**：异步自动处理，从短期记忆提取事件，创建向量嵌入并存储到向量数据库
- 可配置数据保留时间（TTL），默认 7 天，最长可达 1 年
- **预构建记忆策略**：
  - 摘要生成
  - 语义搜索
  - 用户偏好存储
- 大幅降低构建向量存储系统的复杂度和时间成本

### **17:00 - 记忆集成代码**
- memory.py 文件包含 LongTermMemoryHooksProvider 类
- 构造函数接收 Memory ID
- 关键函数：
  - retrieve_user_context：检索用户上下文
  - save_conversation：保存对话
  - register_hooks：注册钩子，每次用户交互时自动触发并保存到长期记忆

### **19:00 - Strands 代理核心代码**
- 使用 asyncio 实现非阻塞交互
- 导入 Strands Agent 和 Tool
- 从 Bedrock Agent Core 导入 Memory Client
- 从自定义 memory.py 导入长期记忆钩子
- 硬编码 User ID（演示用途，生产环境应动态生成）
- 添加简单工具：get_version（用于调试，确认代理版本）

### **20:30 - 系统提示词（System Prompt）的重要性**
- 系统提示词是专门化代理的最佳位置
- 可以提供特定领域的提示、最佳实践和模式
- 示例：区块链数据分析代理的系统提示词包含数据存储和查询的最佳实践
- 可以指导代理根据不同提示选择合适的工具
- 可以赋予代理自主决定哪些信息应存储到记忆中的能力
- 演示中的系统提示词相对简单，会在会议过程中逐步扩展

### **22:00 - 代理配置细节**
- 集成记忆钩子和 Hooks Provider
- 传递 get_version 工具
- 模型配置通过环境变量提供（使用 Claude Sonnet）
- 使用跨区域推理配置

### **23:00 - 流式响应实现**
- Strands 中的 app 入口点用于代理调用
- 使用 stream_agent 和 stream_sync 实现流式响应
- 不等待完整 LLM 响应，而是实时流式返回
- 提供更好的交互体验
- 代码中包含调试语句（已注释），可用于查看工具使用和模型推理过程

### **25:00 - Docker 容器化**
- 使用 Docker 实现接近生产环境的部署
- Dockerfile 配置：
  - 基于 Python 基础镜像
  - 复制并安装 requirements.txt 中的依赖
  - 安装 OpenTelemetry distro（分离运维和应用层）
  - 设置 AWS 区域（EU-CENTRAL-1）
  - 配置跨区域推理配置（EU 区域）
  - 传递 Memory ID 作为环境变量

### **27:30 - 容器架构说明**
- **问答环节**：参会者询问容器架构
- 要求使用 ARM64 架构
- 如果在 AMD/x86 环境开发，需使用 docker buildx 进行跨平台构建
- Cloud Shell 用户会遇到架构不匹配问题

### **28:30 - ECR 仓库与镜像推送**
- 创建 ECR 仓库
- 登录 ECR
- 使用 docker buildx build 命令：
  - 指定平台（ARM64）
  - 指定目标仓库
  - 直接推送镜像

### **30:00 - IAM 执行角色创建**
- 运行 create_agent_runtime_role.py 脚本
- 创建 Agent Core 执行角色
- 包含权限：
  - InvokeModel（调用模型）
  - ECR 权限
  - 其他必要权限
- 遵循最小权限原则，随着功能增加逐步添加权限

### **32:00 - 部署代理到 Agent Core Runtime**
- 使用 deploy_agent.py Python 辅助脚本
- 调用 Boto3 Bedrock Agent Core Control 的 create_agent_runtime
- 指向 ECR 仓库（Runtime 知道从哪里拉取容器）
- 传递 IAM 策略（Web3 Agent Core 执行角色）
- 成功后返回 Agent Runtime ARN
- 将 ARN 存储为环境变量供后续使用

### **34:00 - 更新已有代理**
- 演示环境中已预部署代理，使用 update_agent.py 而非 create_agent.py
- 生产环境首次部署使用 create，后续更新使用 update

### **35:00 - 代理交互客户端**
- 使用 invoke_agent_async.py 文件
- 提供流式终端客户端与代理交互
- 读取 Agent Runtime ARN 环境变量
- 生成随机 Session ID
- 运行命令：uv run invoke_agent_async.py

### **36:30 - 首次代理交互演示**
- 代理响应："Hi David"（记住了之前对话中的用户名）
- 代理回忆起用户对加密货币相关内容感兴趣
- 展示长期记忆功能正常工作

### **37:00 - 查询记忆内容**
- 用户询问："你在 Web3 领域知道我的哪些信息？"
- 代理回答：知道用户对 Bitcoin 和 Ethereum 感兴趣

### **37:30 - 更新用户偏好**
- 用户请求："未来对话中也请包含 Solana"
- 代理确认更新投资组合关注点
- 演示记忆系统实时更新能力

### **38:00 - 问答环节：RPC 端点与网络配置**
- 参会者询问环境中使用的区块链 URL 和网络
- 演讲者澄清：展示的是另一个预部署的代理栈（Crypto AI Agent）
- 默认参数配置了 Polygon RPC，但可更新
- RPC 端点仅在直接与区块链交互时需要（如查询账户余额）
- 当前演示处于高层次，尚未直接与链交互

### **39:30 - 问答：记忆分割策略**
- 参会者询问：是否应将记忆分割为多个焦点（如投资组合焦点、用户信息等）还是统一存储让模型自行判断？
- **Forest 回答**：
  - 内置策略使用推理来决定存储内容和位置
  - 记忆按 User ID 和 Session ID 命名空间隔离和加密
  - 这与 Runtime 层的会话隔离相配合
  - 也可以使用**自定义策略**扩展默认行为
  - 自定义策略可预定义哪些类型的洞察应存储在一起
  - 对长期记忆的向量嵌入特别有帮助
  - 两种方法：开箱即用方法 vs 自定义方法

### **41:00 - 问答：自定义策略实现方式**
- 参会者追问：自定义方法是否使用自然语言指导代理？
- **Forest 回答**：
  - 可以使用自然语言
  - 也可以在设置 Memory Provider 和 Memory Hooks 时使用逻辑方式
  - 相关文档可在会后提供

### **42:00 - 问答：多用户区分**
- 参会者询问：如何区分不同客户的不同偏好？
- **Forest 回答**：
  - Dockerfile 中定义了 User ID（演示用途）
  - 生产环境应使用动态 User ID
  - 可集成身份平台（如 OAuth）
  - 每个会话首先检查 User ID
  - 记忆按 User ID 命名空间隔离
  - 每个用户拥有独立的偏好、对话历史、会话列表等

### **43:30 - 问答：记忆可查询性**
- 参会者询问：记忆是否可以被查询？
- **Forest 回答**：
  - 不确定答案，不想提供错误信息
  - 知道记忆可以被多个代理访问
  - 不确定是否可以从其他客户端直接查询
  - 承诺会后提供准确答案

### **44:00 - 过渡到下一模块**
- 演讲者询问是否还有其他问题
- 准备进入下一个版本的演示

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注：字幕在此处截断，会议内容尚未完全结束。根据前面提到的议程，后续内容应该包括集成浏览器工具、调用专门的 Crypto AI Agent 进行链上操作等更高级功能的演示。