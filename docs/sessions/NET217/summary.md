# AWS re:Invent 2025 - Amazon Route 53 Global Resolver 会议总结

## 会议概述

本次会议（NET 217）由AWS Route 53团队的产品经理Adish Bub和首席工程师Matt Enkow主讲，重点介绍了刚刚发布的Amazon Route 53 Global Resolver新服务。这是一个anycast DNS解析器，旨在解决企业在多地点、多区域环境中面临的DNS管理复杂性问题。

Global Resolver的核心价值在于为客户提供统一的DNS解析方案，支持同时解析AWS上的私有域名和互联网公共域名，同时提供DNS安全过滤、流量加密和集中式日志管理功能。该服务通过anycast IP地址实现全球分布式访问，自动优化延迟并提供区域级故障转移能力，无需客户手动维护多个地点的转发规则。会议还特别展示了Just Walk Out商店技术如何利用Global Resolver简化其在全球300多家门店的DNS基础设施管理。

该服务目前处于预览阶段，适用于拥有多个数据中心、分支机构或远程客户端的企业，特别是那些需要一致DNS解析策略、高可用性和增强安全性的场景。通过DNS视图（DNS Views）功能，客户可以为不同客户端组配置不同的解析策略，实现灵活的访问控制和安全管理。

## 详细时间线

### 开场与背景介绍
- **00:00:00** - 会议开始，主讲人Adish Bub和Matt Enkow介绍自己来自AWS Route 53团队
- **00:00:30** - 询问现场网络管理员和DNS安全从业者人数，确认目标受众
- **00:01:00** - 介绍会议议程：挑战、解决方案、使用方法、案例研究和定价信息

### 客户面临的三大挑战
- **00:02:00** - 挑战一：分离式DNS管理 - 客户需要为不同地点、数据中心、分支机构维护转发规则，在私有域名和公共域名之间进行分离DNS管理
- **00:03:00** - 挑战二：防止DNS数据泄露 - 需要阻止攻击者通过DNS协议窃取数据，满足合规和审计需求
- **00:04:00** - 挑战三：跨区域规则管理复杂 - 在多个区域和客户地点复制和维护一致的DNS规则非常繁琐，同时需要确保故障转移能力

### Amazon Route 53 Global Resolver 产品介绍
- **00:05:00** - 正式发布Global Resolver，目前处于预览阶段
- **00:05:30** - 核心功能：anycast DNS解析器，支持解析AWS私有域名和互联网公共域名
- **00:06:00** - 关键特性：流量过滤、传输加密、集中式日志记录
- **00:06:30** - 优化特性：延迟优化、自动区域故障转移、数据驻留支持
- **00:07:00** - 架构展示：多个企业数据中心、远程地点和分支机构可以指向单一anycast IP

### Global Resolver 的核心优势
- **00:08:00** - 优势一：实现分离DNS管理 - 统一解析公共域名和私有托管区域，简化规则管理
- **00:09:00** - 优势二：互联网可达但需认证 - 通过IP地址或访问令牌（access token）进行客户端认证
- **00:10:00** - 认证方式详解：静态IP认证适用于固定地点，访问令牌适用于动态IP或漫游客户端
- **00:11:00** - 优势三：DNS视图（DNS Views）灵活性 - 为不同客户端组创建不同的DNS解析视图和规则

### DNS 安全功能
- **00:12:00** - 托管域名类别 - 预配置的威胁分类（恶意软件、命令控制、垃圾邮件、钓鱼）和内容分类
- **00:13:00** - 规则自动更新，无需手动维护
- **00:14:00** - 高级DNS威胁防护 - DNS隧道检测和域名生成算法（DGA）检测
- **00:15:00** - DNS隧道：攻击者通过恶意软件建立DNS隧道窃取数据
- **00:16:00** - DGA：攻击者生成大量恶意域名以逃避检测
- **00:17:00** - 实时监控和内联检测，可自定义置信度阈值
- **00:18:00** - 隐私增强 - 支持DoH（DNS over HTTPS）和DoT（DNS over TLS）加密协议
- **00:19:00** - 集中式日志 - 可选择特定区域的S3存储桶存储所有查询日志

### 延迟优化和故障转移
- **00:20:00** - 查询自动路由到最近的可用区域
- **00:20:30** - 要求至少选择两个区域以实现自动故障转移
- **00:21:00** - 数据驻留支持 - 可为不同区域或国家创建不同的anycast IP以满足合规要求

### 适用场景
- **00:22:00** - 场景一：多地点一致DNS解析 - 适用于多数据中心、分支机构和全球分布的远程客户端
- **00:23:00** - 场景二：断开连接的站点 - 将直接访问互联网的客户端纳入统一安全策略
- **00:24:00** - 场景三：关键应用高可用性 - 需要DNS解析始终可用的关键客户端和应用

### Route 53 Resolver 更名说明
- **00:25:00** - 询问现场对Route 53 Resolver的熟悉程度
- **00:25:30** - 原Route 53 Resolver更名为Route 53 VPC Resolver
- **00:26:00** - 强调API操作不变，仅为架构区分和命名一致性
- **00:27:00** - Global Resolver vs VPC Resolver对比：
  - Global Resolver：多区域、互联网可达（需认证）
  - VPC Resolver：VPC默认解析器，通过解析器端点连接混合客户端
- **00:28:00** - 两者都支持加密，都使用DNS Firewall功能
- **00:29:00** - 使用定位：Global Resolver用于远程网络和多区域场景，VPC Resolver用于VPC内客户端

### 技术实现详解（Matt Enkow主讲）
- **00:30:00** - Matt Enkow接手，介绍如何快速上手使用Global Resolver
- **00:31:00** - CLI创建流程：
  1. 定义区域范围（至少两个AWS区域）
  2. 可选配置观测区域用于日志聚合
- **00:32:00** - 创建后获得静态anycast IP地址和DNS名称
- **00:33:00** - 创建DNS视图 - 逻辑容器，包含配置策略和客户端访问控制
- **00:34:00** - 默认无访问权限，必须配置认证方式
- **00:35:00** - 认证配置：
  - 访问源（Access Sources）：使用已知公网IP
  - 访问令牌（Access Tokens）：预共享密钥，适用于漫游客户端
- **00:36:00** - 可选配置：防火墙规则（如阻止赌博网站）和私有托管区域关联

### 最佳实践
- **00:37:00** - 分离DNS解析最佳实践 - 单个Global Resolver支持多个DNS视图
- **00:38:00** - 不同视图可配置不同规则，通过访问源或令牌映射客户端
- **00:39:00** - 可跨视图重用私有托管区域，其他资源独立配置

### 认证协议详解
- **00:40:00** - 访问令牌支持的协议：
  - DoH（DNS over HTTPS）：在URL中包含访问令牌，Windows和macOS原生支持
  - DoT（DNS over TLS）：通过EDNS0选项注入访问令牌，适用于Unbound、CoreDNS等
- **00:42:00** - 访问源支持的协议：DoH、DoT和传统Do53（UDP/TCP），适用于固定IP站点
- **00:43:00** - DNS视图可同时使用多种访问类型，每个视图可扩展至数千个令牌和源

### DNS 安全最佳实践
- **00:44:00** - 基于DNS Firewall的丰富配置经验
- **00:45:00** - 支持可信域名豁免、高级保护、故障开放/关闭模式、允许/拒绝默认策略
- **00:46:00** - 分阶段采用建议：
  - **阶段一**：日志分析，识别可信域名和潜在威胁
  - **阶段二**：创建告警规则，观察影响范围
  - **阶段三**：将告警规则转换为阻止规则
- **00:48:00** - 建议先为组织高度可信域名创建允许列表
- **00:49:00** - 高置信度威胁直接阻止，低置信度仅告警供安全团队调查
- **00:50:00** - 持续监控指标和日志，根据工作负载变化调整规则

### 故障转移和多区域弹性
- **00:51:00** - Global Resolver设计用于简化多区域DNS部署复杂性
- **00:52:00** - 返回两个IP地址，背后由独立冗余容量支持
- **00:53:00** - 建议客户端配置两个IP以实现快速重试
- **00:54:00** - 流量路由机制：
  - 首先路由到客户端附近的400多个AWS边缘站点
  - 边缘站点故障时自动切换到其他边缘站点
  - 区域故障时自动路由到次要区域
- **00:56:00** - 提供强大的灾难恢复和多区域弹性能力

### Just Walk Out 案例研究
- **00:57:00** - Just Walk Out技术介绍：Amazon开发的无收银员购物技术
- **00:58:00** - 应用场景：体育场馆、机场、会议中心（包括re:Invent商品店）
- **00:59:00** - 技术组成：摄像头、RFID、传感器融合、快速结账设备
- **01:00:00** - 规模数据：
  - 300多家门店（澳大利亚、加拿大、欧洲、美国）
  - 每天超过5.5亿次DNS请求
  - 部署在4个AWS区域
- **01:01:00** - 迁移前架构：
  - 门店内集中式DNS转发器
  - 4个区域的自定义DNS服务器软件
  - 基于固定IP的白名单
  - 条件DNS区域和过滤规则
  - 转发到Route 53 Resolver入站端点
- **01:03:00** - 存在的问题：
  - 需要提前知道门店固定IP才能快速开店
  - 维护DNS服务器软件需要大量开发工作
  - 需要持续更新IP数据和条件过滤规则
- **01:04:00** - 迁移后架构：
  - 使用访问令牌，可提前预配置
  - 加密DNS通信（DoT/DoH）
  - 令牌映射到门店特定视图（前台和后台网络）
  - 自动应用策略，无需DNS服务器软件
- **01:06:00** - 迁移收益：
  - 增强的DNS加密安全性
  - 大幅简化的网络架构
  - 支持动态IP地址
  - 显著降低运维开销
  - 可轻松扩展到更多区域

### 现场演示
- **01:07:00** - 开始现场演示，提醒这是刚发布几天的服务
- **01:08:00** - 展示预先配置的Global Resolver控制台
- **01:08:30** - 演示配置：两个区域（US East 1和US West 2）
- **01:09:00** - 展示两个DNS视图：开放访问视图和受限访问视图
- **01:09:30** - 演示被截断，但展示了控制台界面和基本配置流程

### 总结
本次会议全面介绍了Amazon Route 53 Global Resolver的功能、架构、最佳实践和实际应用案例，为企业提供了一个统一、安全、高可用的全球DNS解析解决方案。