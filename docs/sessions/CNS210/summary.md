# AWS re:Invent 2025 容器技术会议总结

## 会议概述

本次会议由AWS首席专业架构师兼容器技术负责人Nurmal Ma和Isaac Moscara共同主讲，主题为"从单体架构到微服务的演进之旅"。会议深入探讨了企业如何将传统的单体应用程序迁移到基于Kubernetes的微服务架构，并最终实现高效的多租户SaaS平台。

演讲者首先描绘了一个典型场景：一家ISV公司在自有数据中心运行成功的单体应用，开发团队从4-10人增长到400人。虽然系统运行正常，但面临手动扩展、资源闲置、部署协调复杂等问题。当市场竞争压力增大，特别是需要快速集成Gen AI等新技术时，单体架构的局限性开始显现。微服务架构通过功能隔离、独立扩展、团队自治等特性，为企业提供了更高的敏捷性和创新能力。

会议的核心内容聚焦于如何在Amazon EKS上构建安全、可扩展的多租户架构。演讲者详细介绍了从单租户集群到多租户集群的演进过程，包括命名空间隔离、网络策略、资源配额管理、EKS Auto Mode自动化节点管理、Pod Identity身份管理，以及通过OPA/Kyverno实现的策略即代码等关键技术。这些技术组合使企业能够在保证安全隔离的同时，大幅提升运营效率，降低成本，并实现租户的即时自动化部署。

## 详细时间线与关键要点

### **开场与背景介绍 (0:00 - 3:30)**
- 0:00 - 演讲者自我介绍：Nurmal Ma（AWS首席专业架构师兼容器技术负责人）和Isaac Moscara
- 0:30 - 会议主题：从单体架构到微服务的演进
- 1:00 - 受众调查：询问有多少人正在经历这一转型旅程

### **单体架构的现状与挑战 (3:30 - 8:00)**
- 3:30 - 典型场景描述：ISV公司在自有数据中心运行单体应用
- 4:00 - 团队规模从4-10人增长到400名开发人员
- 4:30 - 单体架构的问题：手动周末扩展、CPU空闲、部署协调困难
- 5:00 - 单体架构的优势：简单、不过度工程化、低运营复杂度
- 6:00 - 转折点：CTO/CEO询问"Gen AI在哪里？"
- 6:30 - 竞争压力导致无法快速集成新技术
- 7:00 - 单体架构在创新速度上的局限性

### **微服务架构的承诺 (8:00 - 12:00)**
- 8:00 - 微服务的核心价值：敏捷性、灵活性、更快创新
- 8:30 - 团队自治：选择编程语言、数据库、API
- 9:00 - 功能组件范围缩小，生产力提升
- 9:30 - 微服务通过功能隔离解决单体架构限制
- 10:00 - 独立构建和扩展的能力
- 10:30 - 团队围绕独立功能服务组织
- 11:00 - 与弹性基础设施的良好配合
- 11:30 - 微服务由API、计算和存储组成

### **Strangler Fig模式迁移策略 (12:00 - 15:00)**
- 12:00 - 介绍Strangler Fig（绞杀者无花果）模式
- 12:30 - 渐进式迁移方法：识别服务并逐步分离
- 13:00 - 保持单体应用其余部分不变
- 13:30 - 按自己的节奏随时间推进
- 14:00 - 架构演示：Web前端、身份服务、共享数据库保留在数据中心
- 14:30 - 支付、指标、计费服务迁移到AWS EC2实例

### **容器化的必要性 (15:00 - 19:00)**
- 15:00 - EC2实例管理的复杂性：数百个实例、不同配置、不同部署管道
- 15:30 - 缺乏标准化导致失控
- 16:00 - 容器解决"在我的笔记本上可以运行"的问题
- 16:30 - 容器提供一致的环境和依赖管理
- 17:00 - 容器镜像由微服务团队拥有
- 17:30 - 减少运营负担，提高测试和迭代速度
- 18:00 - 从开发环境到生产环境的一致性

### **Kubernetes编排需求 (19:00 - 23:00)**
- 19:00 - 容器数量激增：从数百个EC2实例到数千个容器
- 19:30 - 需要服务发现、负载均衡、平台能力
- 20:00 - Kubernetes用于大规模编排和管理容器
- 20:30 - 提供开箱即用的服务发现、负载均衡、自动扩展
- 21:00 - 滚动部署等功能
- 21:30 - 开源Kubernetes的复杂性：控制平面管理困难
- 22:00 - 大量无差异化的繁重工作
- 22:30 - 预告EKS Auto Mode功能

### **Amazon EKS介绍 (23:00 - 27:00)**
- 23:00 - EKS（Elastic Kubernetes Service）是托管的Kubernetes服务
- 23:30 - 专注于构建、运行和扩展工作负载
- 24:00 - 生产就绪的Kubernetes控制平面和集群
- 24:30 - 加速创新，无需担心控制平面管理
- 25:00 - 使用Karpenter等工具优化成本和性能
- 25:30 - 增强可用性、可扩展性和可靠性
- 26:00 - 采用AWS良好架构框架的最佳实践
- 26:30 - 可在任何环境中运行Kubernetes

### **EKS核心功能 (27:00 - 30:00)**
- 27:00 - 在任何环境中运行
- 27:30 - 完全托管的集群，包括自动更新
- 28:00 - Auto Mode提供自动更新
- 28:30 - 原生AWS集成：数据库服务、IAM、安全组等
- 29:00 - Kubernetes合规性
- 29:30 - 云原生计算基金会开源生态系统的优势

### **EKS Hybrid Nodes (30:00 - 33:00)**
- 30:00 - 完整架构回顾：EKS集群管理微服务
- 30:30 - 数据中心仍有资源需要保留
- 31:00 - 合规性或法规要求某些服务保留在本地
- 31:30 - EKS Hybrid Nodes功能介绍（去年re:Invent发布）
- 32:00 - 将VMware节点或本地节点连接到Amazon EKS集群
- 32:30 - 利用云端EKS优势和数据中心现有计算资源
- 33:00 - 统一的单租户微服务架构

### **单租户到多租户的挑战 (33:00 - 38:00)**
- 33:00 - 微服务架构带来的成功：开发团队加速
- 33:30 - 创新进展，竞争力提升
- 34:00 - 客户增长带来新挑战
- 34:30 - 为每个客户创建新集群的问题
- 35:00 - Isaac接手讲解多租户架构
- 35:30 - 单租户集群内运行多个微服务
- 36:00 - 客户持续增长
- 36:30 - 销售团队兴奋，但运维团队需要管理"宠物"集群
- 37:00 - 凌晨2点被叫醒管理独立集群
- 37:30 - 合规和安全团队喜欢隔离，但CFO不喜欢低效

### **多租户架构的驱动因素 (38:00 - 42:00)**
- 38:00 - 为什么现在需要多租户？
- 38:30 - 远程优先经济的兴起
- 39:00 - 消费者期望的变化：即时账户开通（如Netflix）
- 39:30 - 云服务消费习惯改变客户期望
- 40:00 - 竞争格局变化：董事会和投资者期望SaaS回报倍数
- 40:30 - 即时租户配置和即时计费的需求
- 41:00 - 云原生技术已经非常成熟
- 41:30 - 云原生不再被视为风险，而是安全选择

### **多租户控制平面与应用平面 (42:00 - 46:00)**
- 42:00 - 多租户架构图介绍
- 42:30 - 左侧：控制平面（类似Kubernetes控制平面）
- 43:00 - 入驻、身份、指标、租户配置集中管理
- 43:30 - 从管道转向自动化服务和API
- 44:00 - 右侧：应用平面
- 44:30 - 向多租户转移，但某些合规要求仍需单租户
- 45:00 - 高效使用基础设施
- 45:30 - 自动化运维，减少手动干预

### **命名空间隔离 (46:00 - 50:00)**
- 46:00 - 创建基于命名空间的隔离
- 46:30 - 减少集群数量，创建租户逻辑边界
- 47:00 - 集中运维操作
- 47:30 - 通过命名空间减少集群数量
- 48:00 - 多个租户共享同一集群
- 48:30 - 警告：Kubernetes网络默认是扁平架构
- 49:00 - Pod和命名空间在网络层面没有隔离
- 49:30 - 租户1的Pod可以访问租户2的Pod

### **网络策略与数字围栏 (50:00 - 54:00)**
- 50:00 - 未锁定的集群架构示例
- 50:30 - 基础层命名空间可以访问租户1和租户2
- 51:00 - 构建数字围栏：网络策略
- 51:30 - 网络策略示例：租户1的分析或订阅者角色Pod可以访问后端命名空间
- 52:00 - 创建数字围栏限制网络流量
- 52:30 - 创建网关或Ingress进行基于路径的路由
- 53:00 - 使用AWS CNI
- 53:30 - 为每个Pod创建ENI（弹性网络接口）

### **AWS CNI与安全组 (54:00 - 57:00)**
- 54:00 - 将安全组应用于Pod
- 54:30 - 像对待其他AWS资源一样对待Pod
- 55:00 - 使用相同的网络策略和安全组
- 55:30 - 完整的数字围栏创建完成
- 56:00 - 从开放式架构转变为门禁社区
- 56:30 - 控制租户之间的通信

### **嘈杂邻居问题 (57:00 - 62:00)**
- 57:00 - 嘈杂邻居问题介绍
- 57:30 - 多个租户在同一集群上的风险
- 58:00 - 租户1可能有失控的工作负载
- 58:30 - 消耗池1中的所有CPU
- 59:00 - 消耗所有内存，导致其他租户资源匮乏
- 59:30 - 过度配置的问题：让CFO不满
- 60:00 - 需要在过度配置和资源可用性之间取得平衡
- 60:30 - 解决方案：资源配额和限制范围

### **资源配额 (62:00 - 65:00)**
- 62:00 - 安装基于命名空间的资源配额
- 62:30 - 命名空间类比为公寓
- 63:00 - 资源配额定义公寓可以使用的所有资源
- 63:30 - 示例：8个CPU、16GB内存、最多20个Pod
- 64:00 - 简单的限制配置
- 64:30 - 命名空间级别的资源控制

### **限制范围 (65:00 - 68:00)**
- 65:00 - 限制范围介绍
- 65:30 - 公寓类比：Pod是独立房间
- 66:00 - 为独立房间设置限制范围
- 66:30 - 确保单个Pod不会耗尽机器资源
- 67:00 - 示例：最大2个CPU和内存限制
- 67:30 - 应用于容器类型

### **托管节点组的局限性 (68:00 - 72:00)**
- 68:00 - 仍需管理EC2节点
- 68:30 - 提供基础设施的需求
- 69:00 - 限制租户但租户需要更多资源怎么办
- 69:30 - 大多数客户从托管节点组开始
- 70:00 - 托管节点组在一定程度上有效
- 70:30 - 挑战：必须指定特定实例类型
- 71:00 - 随着增长仍需进行容量规划
- 71:30 - 不同类型的实例和工作负载需要更多托管节点组

### **EKS Auto Mode介绍 (72:00 - 77:00)**
- 72:00 - 从管理集群到管理租户节点组
- 72:30 - 解决方案：Auto Mode
- 73:00 - 受众调查：有多少人听说过Auto Mode
- 73:30 - 有多少人在使用Auto Mode
- 74:00 - Auto Mode允许以Kubernetes为中心管理基础设施
- 74:30 - 在底层管理节点，同时提供灵活性
- 75:00 - 基于工作负载类型自动扩展
- 75:30 - Kubernetes原生扩展
- 76:00 - 查看集群内部情况并基于指标扩展
- 76:30 - Auto Mode是EKS的内置功能

### **Auto Mode与Karpenter (77:00 - 82:00)**
- 77:00 - Auto Mode清单示例
- 77:30 - 底层使用Karpenter
- 78:00 - 受众调查：有多少人听说过Karpenter
- 78:30 - 租户1示例：两种实例类型
- 79:00 - 可以添加其他实例类型并混合匹配
- 79:30 - 租户1的特定合同：仅使用Spot实例
- 80:00 - 如果可用性存在则使用，否则不使用（合同的一部分）
- 80:30 - 限制CPU和内存数量
- 81:00 - 租户2：更大的实例（更大的合同）
- 81:30 - 不同的SLA：Spot和按需实例

### **Auto Mode自动资源配置 (82:00 - 85:00)**
- 82:00 - Auto Mode为我们配置这些资源
- 82:30 - 随着租户增长或收缩
- 83:00 - Auto Mode自动处理资源需求
- 83:30 - 可能将租户1放在自己的节点上
- 84:00 - 完全与其他租户隔离
- 84:30 - 回顾：网络、资源配额、Auto Mode

### **AWS资源访问与身份管理 (85:00 - 90:00)**
- 85:00 - 仍需访问AWS资源：S3、RDS、DynamoDB
- 85:30 - 没有服务是独立运行的
- 86:00 - 客户开始管理密钥和AWS凭证
- 86:30 - 存储为环境变量或硬编码到容器中
- 87:00 - 作为ConfigMap或Secret提供
- 87:30 - AWS密钥到处硬编码的问题
- 88:00 - 长期存在的AWS密钥
- 88:30 - 难以管理合规性和安全性
- 89:00 - 需要频繁轮换但手动操作容易忘记
- 89:30 - 密钥泄露风险：从租户1的Pod逃逸并获取密钥

### **EKS Pod Identity (90:00 - 95:00)**
- 90:00 - EKS Pod Identity介绍
- 90:30 - 为Pod本身提供AWS原生IAM策略
- 91:00 - 类似于AWS CNI应用安全组
- 91:30 - 为IAM应用相同的AWS原生构造
- 92:00 - 使用Pod Identity的重要性
- 92:30 - 继续保持职责分离（对SaaS公司和合规性很重要）
- 93:00 - 通过AWS角色和IAM策略管理Pod访问权限
- 93:30 - 不是以Kubernetes原生方式，而是通过AWS IAM
- 94:00 - 使用相同的工具和基础设施管理策略
- 94:30 - 将AWS角色和策略映射到服务账户

### **Pod Identity配置示例 (95:00 - 100:00)**
- 95:00 - 通过相同工具进行审计
- 95:30 - 通过团队高效扩展
- 96:00 - 使用已有的身份管理方式
- 96:30 - 简单的策略示例
- 97:00 - 租户1访问租户1应用存储桶
- 97:30 - Get、Put、Delete、List权限
- 98:00 - 在Kubernetes中创建服务账户
- 98:30 - 将服务账户映射到Pod
- 99:00 - Pod获得对存储桶的访问权限
- 99:30 - 部署到Kubernetes集群

### **Pod Identity的优势 (100:00 - 103:00)**
- 100:00 - 遵循相同的安全和合规策略
- 100:30 - 没有改变现有流程
- 101:00 - 无需创建AWS密钥
- 101:30 - 无需放入环境变量或Secret Manager
- 102:00 - AWS自动处理并在后台轮换密钥
- 102:30 - 确保租户1无法访问错误的存储桶

### **审计与合规性 (103:00 - 108:00)**
- 103:00 - 深入Kubernetes内部
- 103:30 - 回到控制平面和应用平面架构
- 104:00 - 首先讨论审计能力及其重要性
- 104:30 - 工作流程步骤（注意编号可能不对）
- 105:00 - DevOps工程师部署到Kubernetes
- 105:30 - 后台是API服务器
- 106:00 - 存储到etcd
- 106:30 - 调度器接收更改
- 107:00 - 在租户命名空间中创建Pod
- 107:30 - Pod可以与RDS和S3通信

### **审计需求 (108:00 - 112:00)**
- 108:00 - 合规和审计需求
- 108:30 - 了解系统内部发生的事情
- 109:00 - 需要了解：Kubernetes级别发生了什么
- 109:30 - 谁在进行这些更改
- 110:00 - 进行了哪些更改
- 110:30 - 什么在与AWS账户中的什么通信
- 111:00 - 了解命名空间内租户的活动
- 111:30 - 跨链的可审计证明

### **审计日志配置 (112:00 - 116:00)**
- 112:00 - 考虑所有正在发生的部分和变化
- 112:30 - 如何处理部署、系统访问、可审计证明
- 113:00 - Open Policy Agent (OPA)用于合规执行
- 113:30 - 审计Kubernetes的正确日志
- 114:00 - 可以通过多种方式控制
- 114:30 - 示例：记录关于Pod的任何请求
- 115:00 - 记录请求和响应
- 115:30 - 限制为需要向审计员证明的内容

### **OPA策略即代码 (116:00 - 122:00)**
- 116:00 - 证明谁在进行更改或查询系统
- 116:30 - 讨论OPA和Kyverno（今天重点是OPA）
- 117:00 - Kyverno是类似的策略系统
- 117:30 - 策略即代码
- 118:00 - 相同的工作流程：DevOps工程师提交清单
- 118:30 - 向API服务器进行更改
- 119:00 - 后台发生的事情：进入准入控制器
- 119:30 - 准入控制器验证文档或清单是否有效
- 120:00 - 来自正确的用户、正确的时间、正确的租户
- 120:30 - 通过查看OPA实现
- 121:00 - 查询OPA："这是有效的清单吗？"
- 121:30 - "由正确的人在正确的时间提交吗？"

### **OPA决策流程 (122:00 - 127:00)**
- 122:00 - 如果否，拒绝
- 122:30 - 可审计、可证明的声明性规则
- 123:00 - 可以提供给合规官员
- 123:30 - 确保做正确的事情，安全团队喜欢
- 124:00 - 如果是，遵循相同的流程
- 124:30 - 步骤4、5、6、7
- 125:00 - 回到之前相同的位置
- 125:30 - 一个额外的变化：步骤8
- 126:00 - 通过CloudTrail监控
- 126:30 - 监控API服务器发生的事情

### **完整的审计链 (127:00 - 132:00)**
- 127:00 - 记录来自哪些用户的所有更改及原因
- 127:30 - 从OPA也可以看到被拒绝的内容及原因
- 128:00 - 或批准的内容及原因
- 128:30 - OPA内部的规则集
- 129:00 - 确保清单被接受或拒绝
- 129:30 - 现在整个系统都有可证明性
- 130:00 - 合规或策略即代码的样子
- 130:30 - 受众调查：有多少人使用OPA进行策略管理
- 131:00 - 少数人使用
- 131:30 - OPA规则示例说明

### **OPA策略示例 (132:00 - 结束)**
- 132:00 - 如果Isaac提交清单
- 132:30 - 部署对象或部署清单
- 133:00 - 查看Pod，确保有标签classification PHI（隐私信息）
- 133:30 - 确保也有规则run as nonroot
- 134:00 - 策略验证安全要求
- 134:30 - 声明性规则确保合规性
- 135:00 - 会议总结与问答环节

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


关键技术要点总结：
- Strangler Fig模式用于渐进式迁移
- 命名空间隔离实现多租户
- 网络策略和AWS CNI构建数字围栏
- 资源配额和限制范围解决嘈杂邻居问题
- EKS Auto Mode和Karpenter实现自动化节点管理
- Pod Identity提供安全的AWS资源访问
- OPA/Kyverno实现策略即代码和合规审计