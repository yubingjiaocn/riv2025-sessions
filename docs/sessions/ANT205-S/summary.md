# AWS re:Invent 2025 会议总结：Apache Iceberg 在华纳音乐集团的应用

## 会议概述

本次会议由 Snowflake 媒体娱乐行业首席架构师 William Rashawn 和华纳音乐集团数据工程总监 Michael Jones 共同主讲，深入探讨了 Apache Iceberg 表格式在复杂企业环境中的实际应用。

会议重点介绍了华纳音乐集团如何利用 Apache Iceberg 解决多平台、多引擎数据环境中的互操作性挑战。作为一家拥有 75 年历史的音乐公司，华纳音乐集团面临着高度分散化、去中心化的技术架构，包括众多独立运营的唱片厂牌和子厂牌。这种复杂性导致了数据标准化困难，多个数据平台并存（Snowflake 和 Databricks 为主），以及大量历史遗留系统。

通过采用 Iceberg 作为统一的数据层，华纳音乐成功实现了跨平台数据访问，无需复制数据或进行大规模系统迁移。这种方法使得不同团队可以使用各自偏好的工具（如 BI 分析师使用 Snowflake，ML 团队使用 Databricks），同时访问相同的底层数据。最终，这一架构支持了关键业务应用（如面向艺术家的 WMG Pulse 应用和内部分析工具 Opus），实现了每月数十亿次查询的高性能数据访问，并显著降低了运营成本。

## 详细时间线与关键要点

### 开场介绍 (00:00 - 02:30)
- **00:00** - William Rashawn 介绍自己为 Snowflake 媒体娱乐行业首席架构师
- **00:30** - 介绍 Michael Jones，华纳音乐集团数据工程总监
- **01:00** - 会议议程：Iceberg 背景介绍、华纳音乐案例研究、最佳实践分享

### Apache Iceberg 技术背景 (02:30 - 08:00)
- **02:30** - Iceberg 定义：数据湖表格式，为各种查询引擎提供抽象层
- **03:30** - 核心功能：分区演进、隐藏分区、资产合规性、时间旅行、灵活性
- **04:30** - 开放设计框架的重要性：支持"可组合性"架构，允许企业使用最佳工具组合
- **05:30** - 媒体娱乐行业采用数据：过去一个季度 Iceberg 查询量增长 300%，表创建增长 400%
- **06:30** - 生态系统支持：Netflix、Apple、Amazon 是主要贡献者，GitHub 活跃度超过 Delta Lake
- **07:30** - Lakehouse 架构三层：存储层、目录层、计算层

### 架构最佳实践 (08:00 - 10:30)
- **08:00** - 三大核心考虑因素：访问（安全统一数据）、性能（并发和速度）、赋能（生产就绪数据）
- **09:00** - 最终目标：更好的查询性能、成本优化、数据集成、可扩展性、跨云环境支持
- **10:00** - 简化数据复制和 ETL 流程，消除传统复杂性

### 华纳音乐集团背景 (10:30 - 15:00)
- **10:30** - Michael Jones 开始演讲："当 Iceberg 拯救你"
- **11:00** - 华纳音乐：75 年音乐历史，代表众多知名艺术家
- **12:00** - 组织结构挑战：多个独立唱片厂牌和子厂牌，高度去中心化
- **13:00** - 技术环境：多引擎、多平台、缺乏标准化
- **14:00** - WMG Tech 作为中央企业职能部门，需要支持自主决策的各个厂牌
- **14:30** - 强调"学习和好奇"原则对于实现互操作性的重要性

### 技术挑战详解 (15:00 - 20:00)
- **15:00** - 双平台环境：Snowflake（经典 Lakehouse + BI 分析）vs Databricks（数据网格）
- **16:00** - Snowflake 上运行约 600 条数据管道，从原始数据到黄金层
- **17:00** - BI 和录音音乐分析师偏好 Snowflake 和 Tableau
- **18:00** - Databricks 上构建新的数据网格架构
- **19:00** - 核心问题：如何在多个引擎间访问大量数据，支持分散的团队

### 实际应用案例 (20:00 - 28:00)
- **20:00** - 案例 1：WMG Pulse 应用 - 面向艺术家和词曲作者的分析洞察和财务透明度应用
- **21:00** - Pulse 应用基于 Databricks 数据网格中的数据产品，但使用 Snowflake 的原始和转换数据
- **22:00** - 案例 2：BI 和营销分析师社区完全依赖 Snowflake，每月数十亿次查询
- **23:30** - 案例 3：ML 团队偏好使用 Databricks 的 MLflow，但需要访问 Snowflake 数据
- **25:00** - 案例 4：第三方集成 - 需要与 Spotify 等流媒体平台共享数百 TB 不断演进的数据
- **26:30** - 每天接收数十亿行流媒体数据
- **27:30** - 展示统一 Iceberg 数据层愿景图：中间是统一数据层，左侧是数据源，右侧是各种引擎

### WMG Opus 案例深度剖析 (28:00 - 40:00)
- **28:00** - Opus 介绍：华纳音乐最常用的内部工具，约 700 名用户
- **29:00** - 功能：查看流媒体、社交数据、排行榜、播放列表，监控艺术家表现
- **30:00** - 技术栈：React 前端 + 传统 Java Spring 后端（DV API）
- **31:00** - 问题：DV API 直接查询 Snowflake，15 个 API 及其子路由调用数十个 Snowflake 表
- **32:00** - 查询延迟可达 20 秒，但这是现有约束条件
- **33:00** - 挑战：Opus 需要使用 Databricks 数据网格中的新流媒体产品
- **34:00** - 三种解决方案评估：
  - 方案 1：将 DV API 迁移到 Databricks（不可行 - 工程资源有限，破坏性太大）
  - 方案 2：传统 Delta 集成（2023 年私有预览版性能不佳）
  - 方案 3：Uniform Iceberg（Databricks Unity Catalog 导出）
- **36:00** - 选择方案 3：使用 Uniform 将 Delta 表导出为 Iceberg 格式
- **37:00** - 实现：Snowflake 通过 REST API 指向 S3 中的 Iceberg 表
- **38:00** - 关键洞察："将 Snowflake 带到数据，而不是将数据带到 Snowflake"
- **39:00** - 成功：每月 10 亿次查询通过 Snowflake 表访问 Iceberg 数据

### 双向数据流实现 (40:00 - 48:00)
- **40:00** - 第二个挑战：数据网格需要从 Snowflake 读取数据
- **41:00** - 初始方案：联邦查询（Federated Query）
- **42:00** - 联邦查询问题：Databricks 集群等待 Snowflake 执行查询，双重计算成本，EC2 使用量激增
- **43:30** - 改进方案：联邦目录（Federated Catalog）+ Iceberg
- **44:30** - 优势：EC2 成本大幅降低，无需分派查询，Databricks 直接读取 Snowflake 发布的 Iceberg 表
- **45:30** - 实现效果：数据产品在 Databricks 中使用联邦目录读取 Snowflake 的青铜和白银层数据
- **46:30** - 结果通过 Iceberg 回传给 Snowflake（Delta 表可发布为 Iceberg）
- **47:30** - 性能影响：应用查询性能仅下降约 10%，被应用内并行化吸收

### 成功成果与业务影响 (48:00 - 52:00)
- **48:00** - 零数据复制实现不同引擎无缝互操作
- **49:00** - 业务用户完全无感知的后台切换
- **50:00** - 工程团队对结果感到兴奋："这实际上有效了！"
- **51:00** - 几年前无法想象的互操作性水平现已实现

### 扩展应用与未来方向 (52:00 - 58:00)
- **52:00** - 扩展 Iceberg 使用：从 REST API on S3 转向 Snowflake 原生 Iceberg（托管 Iceberg）
- **53:00** - Snowflake 托管 Iceberg 优势：表现为 Snowflake 原生表，但可供外部读取
- **54:00** - 应用场景：与第三方共享数据，接收合作伙伴数据
- **55:00** - 降低数据摄取的计算成本
- **56:00** - 为机器学习和 AI 打开大门，可从业务各处获取数据源
- **57:00** - 统一互操作性：Iceberg 成为数据平台间的 API

### 架构决策指南 (58:00 - 62:00)
- **58:00** - 从 Snowflake 读取数据：使用 Snowflake 托管表
- **59:00** - 向 Snowflake 写入数据：使用外部托管表（如 Opus 案例）
- **60:00** - 两种方法结合实现完整的双向互操作
- **61:00** - Iceberg 广泛支持，而 Delta Lake 在环境中原生支持有限
- **61:30** - Iceberg 成为互操作性层，统一数据网格和经典数据湖

### 当前进展与规模 (62:00 - 65:00)
- **62:00** - 不仅是营销概念，实际运行良好
- **63:00** - 工程师对此感到兴奋，主动寻找更多 Iceberg 应用场景
- **63:30** - 新动词诞生："Icebergify"（将数据转换为 Iceberg 格式）
- **64:00** - 当前进行中：本月正在将数百 TB 数据转换为 Iceberg 格式
- **64:30** - 数据规模：Snowflake 中约 3.2 PB，Databricks 中约 4 PB，总计约 7 PB 数据
- **65:00** - Iceberg 成为系统间的 API，数据层与平台和引擎无关

### 技术优势总结 (65:00 - 结束)
- **65:00** - 引擎无关的数据表示：即使是 Snowflake 托管表也是引擎无关的
- **66:00** - 无需移动数据：只需"切换开关"即可使数据可用
- **67:00** - 将计算引擎带到数据，而不是将数据带到引擎
- **68:00** - 实现真正的多平台协作友好系统