# AWS re:Invent 2025 - Amazon Aurora 创新功能总结 (DAT441)

## 会议概述

本次会议由 Aurora 高级首席工程师 Tim 主讲，重点介绍了 Amazon Aurora 在 2025 年的最新创新功能。今年的会议具有特殊意义，因为 Aurora 迎来了其诞生 10 周年。Tim 首先回顾了 Aurora 的核心架构特点：这是一个云原生关系型数据库，将高端商业数据库的速度和可用性与开源数据库的简洁性和成本效益相结合。Aurora 完全托管，与 MySQL 和 PostgreSQL 完全兼容，并且在今年新增了第三个引擎 Aurora DSQL（分布式 SQL）。

Aurora 的独特之处在于其存储架构。它采用三可用区存储，每次写入自动创建六个副本，写入的是数据库日志记录而非完整页面，存储层能够智能地将日志记录转换为数据库页面。这种架构消除了传统数据库的检查点、完整页面写入和日志归档等问题。存储可自动扩展至 256TB，支持最多 15 个只读副本，并且可以在约 30 秒内实现自动故障转移。会议还详细介绍了全球数据库、本地和全球写入转发、IO 优化配置等高级功能，以及 Aurora Serverless 的弹性扩展能力和最新的快速创建功能。

## 详细时间线与关键要点

### 开场与 Aurora 架构介绍
[00:00 - 05:30]
- Tim 介绍自己是 Aurora 高级首席工程师，今年是 Aurora 诞生 10 周年
- Aurora 是云原生关系型数据库，结合了高端商业数据库的性能和开源数据库的成本效益
- 完全托管，与 MySQL 和 PostgreSQL 完全兼容
- 新增第三个引擎：Aurora DSQL（分布式 SQL）

### Aurora 存储架构深度解析
[05:30 - 10:00]
- 三可用区架构，每次写入自动创建 6 个副本
- 写入日志记录而非数据库页面，存储层自动将日志转换为页面
- 消除了检查点、完整页面写入、双写缓冲区和日志归档
- 支持点对点修复，自动处理存储节点故障
- 支持最多 15 个只读副本，可使用不同实例类型（R8G Graviton、R7i Intel、Serverless）
- 存储自动扩展至 256TB，无需预配置

### 故障转移与高可用性
[10:00 - 12:00]
- 自动故障转移时间约 30 秒，通过 Route 53 更新 DNS 端点
- 使用高级快速驱动程序（JDBC、ODBC、Node.js 等）可将故障转移时间缩短 66%

### 全球数据库功能
[12:00 - 17:00]
- 支持跨区域异步复制，RPO 通常小于 1 秒
- 最多支持 10 个区域，每个区域最多 15 个副本
- 全球端点自动指向当前写入区域
- 故障转移操作：强制故障转移可能导致少量数据丢失
- 切换操作：最新改进将 RTO 从 5 分钟降至约 30 秒，RPO 为零
- 通过在日志流中写入特殊标记实现快速切换

### 本地和全球写入转发
[17:00 - 20:00]
- 本地写入转发：允许从只读副本转发写入请求到写入节点
- 三种一致性模式：会话级（默认）、最终一致性、全局一致性
- 全球写入转发：跨区域转发写入请求
- 需要注意不同一致性模式对延迟的影响

### 存储节点内部工作机制
[20:00 - 24:00]
- 日志记录进入传入队列（内存），然后写入热日志（磁盘）
- 点对点获取缺失的日志记录，确保顺序完整
- 日志合并（coalescing）将日志记录转换为数据库页面
- 持续备份到 S3，支持 35 天内任意时间点恢复
- IO 优化配置：更激进的批处理，提高 IO 密集型应用性能
- 新版本使用持久队列，减少延迟和抖动

### Aurora PostgreSQL 更新
[24:00 - 28:00]
- 支持 PostgreSQL 17.6（上周刚发布）
- 支持带本地磁盘的 R8GD 实例类型
- 上游性能改进：相关子查询缓存、自适应连接
- 共享计划缓存：多个进程共享查询计划，节省内存
- 大型实例和副本的读取可用性改进，启动更快
- FIPS 140-3 安全加密
- PG Vector 等扩展更新
- 支持 256TB 卷大小

### PostgreSQL 性能基准测试
[28:00 - 30:00]
- R5 24xlarge（10 年前）vs R7i 48xlarge（两代更新）：性能提升 2.1 倍
- R8G 48xlarge（Graviton）：性能提升 2.7 倍
- 仅通过实例升级即可获得超线性扩展性能

### 动态数据脱敏功能
[30:00 - 34:00]
- 新功能：Aurora PostgreSQL 动态数据脱敏
- 保护敏感数据（如账号、姓名、余额等 PII 信息）
- 使用 PG Column Mask 扩展定义脱敏策略
- 可对不同列应用不同脱敏函数（如 X 替换、四舍五入）
- 在查询重写层实现，不影响性能和索引使用
- 支持完整的 SQL 表达能力（连接、索引等）

### Aurora MySQL 更新
[34:00 - 36:00]
- 支持 MySQL 3.11 兼容性（几周前发布）
- 3.10 长期支持版本：内存中继日志缓存，binlog 复制吞吐量提升 40%
- 高级快速驱动程序支持 ODBC（MySQL）
- 256TB 卷支持
- 全球数据库次要读取器：在全球数据库问题时保持读取可用性更长时间

### Aurora Serverless 详解
[36:00 - 44:00]
- 弹性实例类型，自动扩展 CPU、内存和网络
- 以 ACU（Aurora 容量单位）计量，1 ACU = 2GB RAM 及相应的 CPU 和网络
- 按秒计费，扩展和缩减时立即调整费用
- 扩展机制：使用信用桶系统，监控 CPU、内存、网络和 IO 触发器
- 最新改进：更快的扩展响应（不到 1 秒），更大的信用桶，更快的补充速度
- 平台版本 3：性能提升高达 30%，所有新集群自动启用

### Serverless 性能测试结果
[44:00 - 48:00]
- 快速扩展测试：扩展速度更快，峰值性能持续时间延长 3.6 倍，缩减速度快 40%，ACU 小时数减少 9%
- 平台版本 3 + 快速扩展：运行时间减少 20%，ACU 小时数减少 20%（即成本降低 20%）
- 只需创建新集群即可自动获得这些改进

### 快速配置创建功能
[48:00 - 54:00]
- 预发布功能：Aurora 快速配置创建（即将推出）
- 在几秒钟内创建数据库集群
- 适用场景：CI/CD 流水线、敏捷开发、Agentic AI 应用
- 灵活配置：默认 16 ACU Serverless，可修改名称和 PostgreSQL 版本
- 创建后可修改大多数设置
- 默认安全：加密和 IAM 默认启用
- 支持几乎所有 Aurora 功能（全球数据库、Zero-ETL、备份等）

### Aurora 互联网访问网关
[54:00 - 56:00]
- 无需 VPC 即可访问数据库
- 高可用端点，兼容 PostgreSQL 协议
- 不是重量级代理，延迟影响小
- 可从任何地方访问（笔记本电脑等），无需 VPN 或 VPC
- 集成 Amazon IAM 和 AWS Shield
- 提供欺诈保护和数据安全保障
- 快速配置创建时默认启用

### Agentic AI 集成
[56:00 - 60:00]
- Aurora 作为 Agentic AI 的记忆存储
- 使用开源框架（如 Letta、LangChain）
- 三步集成：创建集群（几秒钟）、启用 PG Vector 扩展、配置框架
- MCP 服务器（模型上下文协议）：AWS 开源的数据库 MCP 服务器
- 支持自然语言查询转换为 SQL
- 理解数据库模式，适合新用户探索或提高高级用户效率

### 补丁和升级管理
[60:00 - 结束]
- 托管式升级体验：控制台显示待处理的维护操作
- OS 补丁采用滚动方式，提高可用性
- 可设置维护窗口（指定星期几）
- 通过 AWS Health 发送通知
- 可选择自动化或手动控制（如通过 Terraform）
- 集群舰队管理：可为开发、QA 和生产环境设置不同的升级时间序列
- 建议：开发环境周一升级，QA 环境周三升级，生产环境周六升级，留出足够的验证时间