# AWS re:Invent 2025 - NET336: Application Load Balancer Target Optimizer 会议总结

## 会议概述

本次会议由 AWS 网络产品经理 Ashish Kumar 主讲，重点介绍了 AWS 在一周前刚刚发布的 Elastic Load Balancing 新功能 - Target Optimizer（目标优化器）。这是 Application Load Balancer（应用负载均衡器）的一项新能力，专门用于解决低并发应用场景下的负载分配问题。

传统的负载均衡算法（如轮询或最少未完成请求）在处理计算密集型应用时存在明显不足。这些应用包括大语言模型、视频生成、图像生成等，它们的特点是每个实例只能同时处理少量请求（甚至只有1个）。在这种场景下，传统算法会导致请求被发送到已经满负荷的目标实例，造成请求失败率上升、延迟增加、资源利用率低下等问题。Target Optimizer 通过在目标实例上安装代理程序，实时追踪每个实例的处理能力，并通过控制通道与负载均衡器节点通信，确保请求只被发送到有处理能力的实例，从而显著提升成功率、降低延迟、提高资源利用率，并实现自动负载保护。

## 详细时间线

00:00 - 会议开场
- 欢迎参加 NET336 会议
- 演讲者自我介绍：Ashish Kumar，AWS 网络产品经理
- 介绍本次会议主题：Target Optimizer（一周前刚发布的功能）

00:30 - 会议议程介绍
- 问题分析
- 解决方案讨论
- Target Optimizer 功能介绍
- 工作原理说明
- 配置设置方法
- 其他相关信息

01:00 - Elastic Load Balancing 产品介绍
- AWS 负载均衡产品套件概述
- 三大主要产品：Network Load Balancer（第4层）、Application Load Balancer（第7层）、Gateway Load Balancer（内联流量检测和防火墙）
- Target Optimizer 是 Application Load Balancer 的功能

01:30 - Application Load Balancer 基础概念
- ALB 是 HTTP 负载均衡器
- 在应用后端（目标）之间分配 HTTP 请求
- 典型架构：目标组包含 EC2 实例、本地计算资源或容器
- 传统工作方式：使用预配置算法（如轮询）决定请求路由

02:30 - 低并发应用的特殊性
- 定义：计算密集型应用
- 示例：大语言模型
- 特点：每个请求需要大量计算资源
- 结果：每个部署实例只能同时处理少量请求
- 目标组特征：需要非常大的实例群，每个实例只能处理少量并发请求（100、10、5、2 甚至 1 个）

03:30 - 传统负载均衡的问题演示
- 场景：媒体生成应用（视频、文本、图像生成）
- 假设：每个目标只能处理1个请求，使用轮询算法
- 问题：文本生成任务快速完成，视频生成任务耗时长
- 结果：新请求可能被发送到忙碌的目标，而空闲目标得不到利用
- 三大负面影响：成功率下降、延迟增加（需要重试）、资源利用率低

05:00 - 最少未完成请求算法的局限性
- 该算法选择未完成请求数最少的目标
- 虽然比轮询好，但仍然不够理想
- 原因：负载均衡器由多个独立节点组成
- 节点间解耦设计，独立做路由决策
- 不同节点看到的目标组状态不同
- 结果：仍然存在相同的三个问题

06:30 - 理想解决方案的要求
- 负载均衡器应该知道哪些目标是空闲的
- 将空闲目标列表分配给不同节点，避免重复路由
- 更复杂的场景：目标可以处理多个请求（5、10、100个）
- 需要知道每个目标还能处理多少个请求
- 确保所有节点总共发送的请求不超过目标容量

08:00 - Target Optimizer 工作原理
- 在目标实例上安装 AWS 提供的代理程序
- 代理作为负载均衡器节点和应用之间的代理
- 建立控制通道交换管理流量
- 代理追踪应用正在处理的请求数
- 与配置的最大并发请求数比较
- 当应用有处理能力时，向负载均衡器节点发送信号

09:30 - 信号机制详解
- 示例：配置最大并发请求数为3
- 当应用处理3个请求时，代理等待
- 一个请求完成后（降至2个），代理向一个节点发送信号
- 另一个请求完成后（降至1个），代理向另一个节点发送信号
- 节点收到信号后知道可以向该目标发送请求

10:30 - 整体架构
- 每个目标都安装并配置代理
- 每个代理与每个负载均衡器节点建立控制通道
- 可以为每个代理配置不同的最大并发请求数
- 该数值可以基于目标的底层容量（内存、CPU等）

11:30 - Target Optimizer 的预期效果
- 高请求成功率：请求只发送到有处理能力的目标
- 错误率下降
- 高目标组利用率：目标完成请求后立即收到新请求
- 空闲时间极短，效率提升
- 可以使用更小的目标组规模

12:30 - 自动负载保护
- 当所有目标都在处理最大配置请求数时
- 负载均衡器自动拒绝新请求
- 保护目标不被过载、热点或压垮

13:00 - 结果总结
- 请求成功率提升
- 感知延迟降低（更少重试）
- 目标组利用率/效率提升
- 自动负载保护

13:30 - 配置步骤（三步流程）
- 步骤1：在目标上安装代理
  - 配置接收负载均衡器流量的端口（HTTP/HTTPS，如443）
  - 配置代理转发流量的目标端口（应用监听端口）
  - 配置控制端口（建立控制通道）
  - 指定最大并发请求数
  - 四个可选的 TLS 相关变量

15:00 - 配置步骤（续）
- 步骤2：将目标注册到新的目标组（优化目标组）
  - 创建目标组时指定控制端口（与代理配置相同）
- 步骤3：将新目标组添加到 Application Load Balancer
  - 修改现有监听器规则
  - 添加新目标组
  - 将流量从旧目标组迁移到新目标组

16:30 - 支持的目标类型
- EC2 实例
- IP 地址
- Amazon EKS 和 ECS 服务
- 对于 EKS 和 ECS：将代理作为 sidecar 容器运行

17:00 - 新增监控指标
- 活跃控制通道数
- 控制通道错误数
- 发送到优化目标组的请求数
- 被拒绝的请求数
- 控制队列长度（负载均衡器收到的信号数量）

17:30 - 相关资源
- 建议阅读发布博客
- 包含详细的分步设置过程

18:00 - 会议结束
- 感谢参会者