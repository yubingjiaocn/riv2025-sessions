1
00:00:00,270 --> 00:00:04,440
- [Mike] You are in the SAS
412, we are going to talk about

2
00:00:04,440 --> 00:00:06,990
cost-efficient, multi-tenant
knowledge bases.

3
00:00:06,990 --> 00:00:08,970
If this isn't the talk you want to be,

4
00:00:08,970 --> 00:00:10,170
you're not gonna hurt our feelings.

5
00:00:10,170 --> 00:00:12,330
You're welcome to go and find one

6
00:00:12,330 --> 00:00:13,740
that's a better fit for you.

7
00:00:13,740 --> 00:00:15,540
But my name is Mike Gillespie.

8
00:00:15,540 --> 00:00:19,800
I've been with AWS a
little over nine years,

9
00:00:19,800 --> 00:00:23,100
and I really like these
types of engagements

10
00:00:23,100 --> 00:00:25,590
where we're talking with our customers,

11
00:00:25,590 --> 00:00:28,080
learning about what
problems they're facing.

12
00:00:28,080 --> 00:00:29,550
So as a co-talk,

13
00:00:29,550 --> 00:00:32,040
this is going to be very
interactive, like this,

14
00:00:32,040 --> 00:00:34,470
these are very dull if you
guys don't participate.

15
00:00:34,470 --> 00:00:36,930
So we're leaning on you, depending on you.

16
00:00:36,930 --> 00:00:38,820
I will, when the time comes,

17
00:00:38,820 --> 00:00:40,200
I will go round and bring a mic

18
00:00:40,200 --> 00:00:42,180
so everyone can hear your questions.

19
00:00:42,180 --> 00:00:43,830
There'll be times when you stump us.

20
00:00:43,830 --> 00:00:44,663
That's fine.

21
00:00:44,663 --> 00:00:45,837
You know, we don't know everything, but-

22
00:00:45,837 --> 00:00:46,670
- [Steven] Never!

23
00:00:46,670 --> 00:00:48,087
That would never happen.
- That would never happen?

24
00:00:48,087 --> 00:00:49,170
Eh, it's happened to me.
- It happens.

25
00:00:49,170 --> 00:00:50,723
- [Mike] It won't happen to you.

26
00:00:51,570 --> 00:00:53,340
That's what happened.

27
00:00:53,340 --> 00:00:54,540
Steven, do you wanna introduce yourself?

28
00:00:54,540 --> 00:00:55,680
- [Steven] Hi, I'm Steven Warwick,

29
00:00:55,680 --> 00:01:00,120
solutions architect at AWS,
for the last 5 1/2 years.

30
00:01:00,120 --> 00:01:01,200
But definitely a builder,

31
00:01:01,200 --> 00:01:04,860
I was an engineer before
for, god, 30 years or so,

32
00:01:04,860 --> 00:01:08,520
building various things and all
across different industries.

33
00:01:08,520 --> 00:01:12,630
So enjoy very much the
SaaS-based architectures though,

34
00:01:12,630 --> 00:01:14,130
and been working with customers on that

35
00:01:14,130 --> 00:01:15,660
ever since I started with AWS.

36
00:01:15,660 --> 00:01:18,000
So that's what we're
gonna dive into today.

37
00:01:18,000 --> 00:01:20,970
- [Mike] Yeah, and we both
work with software companies,

38
00:01:20,970 --> 00:01:23,460
so we're familiar with the challenges

39
00:01:23,460 --> 00:01:25,530
that software companies face every day.

40
00:01:25,530 --> 00:01:28,920
And the origin of this came from something

41
00:01:28,920 --> 00:01:30,360
Steven was working on.

42
00:01:30,360 --> 00:01:31,890
People came to him, asked him about

43
00:01:31,890 --> 00:01:33,000
how to build knowledge bases.

44
00:01:33,000 --> 00:01:34,740
He's like, "Well, happy to help you."

45
00:01:34,740 --> 00:01:37,380
And then it came into, well,
we need to have, you know,

46
00:01:37,380 --> 00:01:39,210
different tenants and different-

47
00:01:39,210 --> 00:01:40,710
- [Steven] We need to section things out.

48
00:01:40,710 --> 00:01:41,543
Imagine that!

49
00:01:41,543 --> 00:01:42,510
We, like not how-
- Yeah, section them out.

50
00:01:42,510 --> 00:01:44,280
- [Steven] people look at the same stuff

51
00:01:44,280 --> 00:01:45,660
and get the same answers.

52
00:01:45,660 --> 00:01:49,080
- [Mike] So we'll start
off by talking about

53
00:01:49,080 --> 00:01:50,040
what are knowledge bases.

54
00:01:50,040 --> 00:01:51,600
I'm sure with AI,

55
00:01:51,600 --> 00:01:52,950
many of you are already
familiar with that,

56
00:01:52,950 --> 00:01:54,360
but we wanna set a baseline

57
00:01:54,360 --> 00:01:56,340
of what we're talking about today.

58
00:01:56,340 --> 00:01:58,260
And then some of the
challenges that you face

59
00:01:58,260 --> 00:02:01,230
running RAG type architectures
with multi-tenancy.

60
00:02:01,230 --> 00:02:03,120
And we'll focus on a few of those.

61
00:02:03,120 --> 00:02:05,550
We have a demo, which will
then go right into the code

62
00:02:05,550 --> 00:02:06,840
and we'll show you, you know,

63
00:02:06,840 --> 00:02:09,480
where in the code that these
decisions are being made,

64
00:02:09,480 --> 00:02:11,130
where the logic's happening.

65
00:02:11,130 --> 00:02:13,290
And that's where you come in.

66
00:02:13,290 --> 00:02:15,360
That's where you can ask questions,

67
00:02:15,360 --> 00:02:17,340
see how we think through these things.

68
00:02:17,340 --> 00:02:18,420
And like I said at the beginning,

69
00:02:18,420 --> 00:02:20,910
I love these co-talks and chalk
talks, because it gives you,

70
00:02:20,910 --> 00:02:21,743
as a customer,

71
00:02:21,743 --> 00:02:25,020
a window into how AWS
thinks about these problems.

72
00:02:25,020 --> 00:02:26,430
You know, we see these every day,

73
00:02:26,430 --> 00:02:27,990
working with our customers on AWS,

74
00:02:27,990 --> 00:02:29,550
and we have a certain point of view,

75
00:02:29,550 --> 00:02:31,200
and this will help you
see that and, you know,

76
00:02:31,200 --> 00:02:32,190
be able to translate that

77
00:02:32,190 --> 00:02:34,233
into something that you see every day.

78
00:02:36,150 --> 00:02:37,470
So, go ahead.
- I was gonna say,

79
00:02:37,470 --> 00:02:39,270
there's not always one
right answer either.

80
00:02:39,270 --> 00:02:41,760
Our answer is definitely one
of the ways you can do it,

81
00:02:41,760 --> 00:02:42,600
but-
- Yeah, for sure.

82
00:02:42,600 --> 00:02:44,340
- [Steven] I think we've
had lots of comments from

83
00:02:44,340 --> 00:02:46,590
even the sample coders
out in the world too.

84
00:02:46,590 --> 00:02:49,590
So that's one thing we want to get to

85
00:02:49,590 --> 00:02:51,330
is feedback from today.
- Yeah, for sure.

86
00:02:51,330 --> 00:02:52,617
- [Steven] What do you
see out in the world

87
00:02:52,617 --> 00:02:54,510
and how are you using things?

88
00:02:54,510 --> 00:02:56,010
- [Mike] Yeah, and that's part of what

89
00:02:56,010 --> 00:02:57,520
our point of view is.

90
00:02:57,520 --> 00:02:58,353
You know, this is how we see things,

91
00:02:58,353 --> 00:02:59,520
but you may approach things differently

92
00:02:59,520 --> 00:03:02,430
because you have different
problems to solve.

93
00:03:02,430 --> 00:03:04,322
So jumping right into it, you know,

94
00:03:04,322 --> 00:03:05,880
what are some of the main design decisions

95
00:03:05,880 --> 00:03:07,410
that you have to face when you're building

96
00:03:07,410 --> 00:03:09,780
multi-tenant knowledge bases?

97
00:03:09,780 --> 00:03:12,030
One is data segmentation.

98
00:03:12,030 --> 00:03:13,470
You have tenant specific search.

99
00:03:13,470 --> 00:03:15,720
You'll have one tenant
that wanna upload documents

100
00:03:15,720 --> 00:03:18,990
or other resources into your application,

101
00:03:18,990 --> 00:03:21,150
and then be able to have
a chat against those

102
00:03:21,150 --> 00:03:24,300
or be able to search against
those in a semantic way.

103
00:03:24,300 --> 00:03:26,910
But of course, the one thing you can't do,

104
00:03:26,910 --> 00:03:29,850
you have one job and that is
to not let the data spill over

105
00:03:29,850 --> 00:03:31,440
from one tenant to another.

106
00:03:31,440 --> 00:03:35,817
So what are the mechanisms that
you can use to enforce that?

107
00:03:35,817 --> 00:03:37,260
You also have a hybrid search.

108
00:03:37,260 --> 00:03:38,580
So it's not just semantics search,

109
00:03:38,580 --> 00:03:40,710
but also a keyword search.

110
00:03:40,710 --> 00:03:43,410
And then enabling that with AI.

111
00:03:43,410 --> 00:03:45,540
So how do you hook that up to a chat bot

112
00:03:45,540 --> 00:03:49,380
or be able to run AI type
queries against that,

113
00:03:49,380 --> 00:03:51,930
within the scope of that tenant.

114
00:03:51,930 --> 00:03:53,220
- [Steven] There's a little other paradigm

115
00:03:53,220 --> 00:03:54,900
that we're gonna talk about today too,

116
00:03:54,900 --> 00:03:56,580
is how do you do that easily across

117
00:03:56,580 --> 00:03:59,460
different types of vector
stores and things like that.

118
00:03:59,460 --> 00:04:00,780
We wanna make sure that,

119
00:04:00,780 --> 00:04:04,110
hey, Customer A might
want super low latency.

120
00:04:04,110 --> 00:04:06,660
Customer B not so much,
they just wanna pay less

121
00:04:06,660 --> 00:04:08,070
and they want to have bulk stuff.

122
00:04:08,070 --> 00:04:11,220
But how do we do that in just
an easy way across the board,

123
00:04:11,220 --> 00:04:13,290
so that we don't have to do
a lot of work to set that up.

124
00:04:13,290 --> 00:04:14,340
- [Mike] That way you don't have to write

125
00:04:14,340 --> 00:04:17,240
a whole new application for
each way you access your data.

126
00:04:21,450 --> 00:04:23,160
So I've talked about this
already a little bit,

127
00:04:23,160 --> 00:04:27,480
but data isolation, you know,
that is like the core tenet

128
00:04:27,480 --> 00:04:28,920
of multi-tenant application,

129
00:04:28,920 --> 00:04:30,870
is how do you enforce data isolation?

130
00:04:30,870 --> 00:04:32,610
And, you know, the philosophy I have is

131
00:04:32,610 --> 00:04:33,900
don't leave that to chance.

132
00:04:33,900 --> 00:04:35,430
You have to build the
infrastructure around it

133
00:04:35,430 --> 00:04:36,963
to enforce that that happens.

134
00:04:38,160 --> 00:04:40,230
It was Steven called
out tiered performance.

135
00:04:40,230 --> 00:04:42,390
Not all of your customers are the same.

136
00:04:42,390 --> 00:04:43,530
You may have a free tier

137
00:04:43,530 --> 00:04:45,540
where you're just trying to get customers

138
00:04:45,540 --> 00:04:47,700
a sense for what your application can do,

139
00:04:47,700 --> 00:04:50,310
but you wanna minimize
the cost or really use a

140
00:04:50,310 --> 00:04:53,220
pay for what you use model,
versus established customers

141
00:04:53,220 --> 00:04:55,470
that really value the latency.

142
00:04:55,470 --> 00:04:57,000
You know, working with software companies

143
00:04:57,000 --> 00:04:58,230
that build chat bots,

144
00:04:58,230 --> 00:05:01,310
the number one complaint
customers get is latency.

145
00:05:01,310 --> 00:05:03,000
I type in my question

146
00:05:03,000 --> 00:05:04,560
and I have to wait 30
seconds for an answer.

147
00:05:04,560 --> 00:05:05,820
That's not acceptable.

148
00:05:05,820 --> 00:05:08,490
So how do you make your
application be able to balance

149
00:05:08,490 --> 00:05:10,320
both the cost-effectiveness,

150
00:05:10,320 --> 00:05:13,233
but also meet the latency
requirements of your customers?

151
00:05:14,940 --> 00:05:19,830
And because the vector stores
that power the knowledge bases

152
00:05:19,830 --> 00:05:22,500
are some of your pricier data stores,

153
00:05:22,500 --> 00:05:23,610
how do you make sure that you have

154
00:05:23,610 --> 00:05:25,260
the right data lifecycle management?

155
00:05:25,260 --> 00:05:26,340
And there's a couple of reasons for this.

156
00:05:26,340 --> 00:05:27,690
One is certainly for cost,

157
00:05:27,690 --> 00:05:32,690
but also unstructured data
tends to age very quickly.

158
00:05:33,270 --> 00:05:34,830
You may have an updated document

159
00:05:34,830 --> 00:05:37,440
that now reflects a new version
of the state of reality.

160
00:05:37,440 --> 00:05:40,200
How do you age those out
in a way that makes sense

161
00:05:40,200 --> 00:05:42,573
for that particular tenant?

162
00:05:44,030 --> 00:05:44,946
Did I missing anything?

163
00:05:44,946 --> 00:05:46,590
- [Steven] Yeah, just
different industries,

164
00:05:46,590 --> 00:05:47,430
you'll see this a lot.

165
00:05:47,430 --> 00:05:49,560
So like the real estate industry,

166
00:05:49,560 --> 00:05:51,540
they might want to have like segments

167
00:05:51,540 --> 00:05:52,650
of their market set up,

168
00:05:52,650 --> 00:05:55,680
but that real estate cycle's
changing, you know, quickly,

169
00:05:55,680 --> 00:05:56,760
or patient records,

170
00:05:56,760 --> 00:05:58,530
if they're throwing it
in a knowledge base.

171
00:05:58,530 --> 00:06:00,777
It's like the doctor might
see someone every six months

172
00:06:00,777 --> 00:06:02,790
and they might wanna throw that in

173
00:06:02,790 --> 00:06:05,490
and then take it out maybe
for regulatory things as well.

174
00:06:05,490 --> 00:06:06,660
They wanna make sure it's only in there

175
00:06:06,660 --> 00:06:07,950
for a certain amount of time,

176
00:06:07,950 --> 00:06:11,100
but also allows them to
shrink the amount of usage

177
00:06:11,100 --> 00:06:12,000
that they have to use,

178
00:06:12,000 --> 00:06:13,950
and only do it when they need to do it.

179
00:06:16,680 --> 00:06:18,660
- [Mike] So looking at tiered performance,

180
00:06:18,660 --> 00:06:20,970
the underlying vector store
that powers your database

181
00:06:20,970 --> 00:06:22,440
makes a big difference.

182
00:06:22,440 --> 00:06:25,350
Comparing three of these
options, and there are many more,

183
00:06:25,350 --> 00:06:28,560
but looking at OpenSearch is
a very popular vector store

184
00:06:28,560 --> 00:06:30,510
for the customers that I work with.

185
00:06:30,510 --> 00:06:32,430
It's very low latency.

186
00:06:32,430 --> 00:06:35,760
It allows you to do hybrid
search and you can have

187
00:06:35,760 --> 00:06:39,270
the provision cost to meet your demand.

188
00:06:39,270 --> 00:06:41,790
Compare that to pgVector,
which has the advantage of,

189
00:06:41,790 --> 00:06:43,920
it's also low latency,

190
00:06:43,920 --> 00:06:45,810
but it's also integrated
with your structured data.

191
00:06:45,810 --> 00:06:47,220
So if you have hybrid queries

192
00:06:47,220 --> 00:06:48,810
that query against structured data

193
00:06:48,810 --> 00:06:53,010
and your unstructured data,
you can do that in one spot.

194
00:06:53,010 --> 00:06:55,350
And then, you know, last year
at re:Invent we announced

195
00:06:55,350 --> 00:06:58,740
the S3 vector bucket, which
allows you to run vector queries

196
00:06:58,740 --> 00:06:59,763
against data stored in S3.

197
00:06:59,763 --> 00:07:03,570
It's really cool because you
only pay for what you use,

198
00:07:03,570 --> 00:07:06,180
you pay per query, and for
the data that's being stored.

199
00:07:06,180 --> 00:07:07,860
You don't have that provisioned cost

200
00:07:07,860 --> 00:07:09,813
that you would in OpenSearch.

201
00:07:10,920 --> 00:07:12,870
However, that does come at the cost of

202
00:07:12,870 --> 00:07:14,460
higher latency per query.

203
00:07:14,460 --> 00:07:17,730
So, you know, the case
that I mentioned before

204
00:07:17,730 --> 00:07:20,130
where you have a free tier,
you may want to have that

205
00:07:20,130 --> 00:07:23,400
on the vector bucket so
that you're only paying for

206
00:07:23,400 --> 00:07:25,140
that evaluation use case

207
00:07:25,140 --> 00:07:27,960
that your customers are
just kicking the tires.

208
00:07:27,960 --> 00:07:30,810
Whereas your more
established customers may,

209
00:07:30,810 --> 00:07:33,000
you may want to have latency.

210
00:07:33,000 --> 00:07:34,740
But as Steven mentioned,
we don't wanna write

211
00:07:34,740 --> 00:07:37,080
three different applications more or less

212
00:07:37,080 --> 00:07:38,490
to interface with our vector store.

213
00:07:38,490 --> 00:07:40,950
How do we abstract that out so that we get

214
00:07:40,950 --> 00:07:45,950
the simplicity of one
way to access our data,

215
00:07:45,960 --> 00:07:48,760
but the flexibility to drive
the backend how we want it.

216
00:07:51,300 --> 00:07:53,490
Another challenge with the
lifecycle management, you know,

217
00:07:53,490 --> 00:07:55,953
how do we define rules for data retention?

218
00:07:57,210 --> 00:07:59,220
How do we ensure that you're
running against the most

219
00:07:59,220 --> 00:08:00,840
up to date and accurate information?

220
00:08:00,840 --> 00:08:03,360
I know working at Amazon
we have an, you know,

221
00:08:03,360 --> 00:08:06,870
internal wiki, which is
usually out of date, you know,

222
00:08:06,870 --> 00:08:08,610
shortly after you published to it, right?

223
00:08:08,610 --> 00:08:10,860
- Yeah, pretty much.
- So, how do we make sure

224
00:08:10,860 --> 00:08:13,410
that the data that's in
there is actually up to date,

225
00:08:13,410 --> 00:08:15,333
and age out the data appropriately?

226
00:08:19,140 --> 00:08:22,770
And the tenant tiering that
we talk about is, you know,

227
00:08:22,770 --> 00:08:24,420
how do you have different
rules based on the tenant?

228
00:08:24,420 --> 00:08:27,030
You know, as Steven mentioned,
you may have a real estate

229
00:08:27,030 --> 00:08:31,760
with a very high churn rate
of the data in your documents

230
00:08:31,760 --> 00:08:34,800
in your vector store, versus
ones that may have, you know,

231
00:08:34,800 --> 00:08:39,720
much longer, and be able to
configure that, per each tenant.

232
00:08:39,720 --> 00:08:41,040
- [Steven] Yeah, it could be file sizes,

233
00:08:41,040 --> 00:08:44,220
it could be file types,
that kind of stuff as well.

234
00:08:44,220 --> 00:08:45,930
- [Mike] So given that challenge,

235
00:08:45,930 --> 00:08:48,720
so the architecture that
we're demonstrating today,

236
00:08:48,720 --> 00:08:49,980
and again, as Steven said,

237
00:08:49,980 --> 00:08:52,200
this is not the only way
to do it, but, you know,

238
00:08:52,200 --> 00:08:57,200
we found this to be a very
effective way to abstract out

239
00:08:57,960 --> 00:09:01,710
what that vector store is, so
that we can simplify our code

240
00:09:01,710 --> 00:09:03,540
but also give that
flexibility on the backend.

241
00:09:03,540 --> 00:09:06,300
So walking through it, you
have the user interface,

242
00:09:06,300 --> 00:09:08,970
it's secured with Cognito,
and that's important

243
00:09:08,970 --> 00:09:11,520
because that Cognito stores which tenant

244
00:09:11,520 --> 00:09:12,960
that user belongs to.

245
00:09:12,960 --> 00:09:16,470
So that will be part of the JWT
token that gets sent through

246
00:09:16,470 --> 00:09:19,230
so that the backend
can then make decisions

247
00:09:19,230 --> 00:09:21,540
based on which tenant they belong to.

248
00:09:21,540 --> 00:09:23,700
That gets sent to the Lambda function,

249
00:09:23,700 --> 00:09:27,783
which uses Bedrock to do
the inference on the LLM,

250
00:09:28,950 --> 00:09:32,850
and then uses the Bedrock
knowledge bases to interface with

251
00:09:32,850 --> 00:09:34,980
the vector store on the backend,

252
00:09:34,980 --> 00:09:39,380
whether it be in
OpenSearch, S3, et cetera.

253
00:09:41,370 --> 00:09:43,170
Anything else?
- Yeah, I think that's like

254
00:09:43,170 --> 00:09:45,150
one of the key things
we're gonna show is like,

255
00:09:45,150 --> 00:09:47,460
how we're using the custom stores

256
00:09:47,460 --> 00:09:49,290
and the custom data types and stuff,

257
00:09:49,290 --> 00:09:51,780
so that you can do this in other ways

258
00:09:51,780 --> 00:09:54,540
where you're storing your
files in different areas of S3

259
00:09:54,540 --> 00:09:55,373
or something like that.

260
00:09:55,373 --> 00:09:58,350
And you can use metadata files
and things to pull it in.

261
00:09:58,350 --> 00:10:02,100
But it's an ingestion pattern
that is kind of like a fire

262
00:10:02,100 --> 00:10:03,450
and do a batch pull in.

263
00:10:03,450 --> 00:10:05,520
So we're gonna dive into
a little bit today of,

264
00:10:05,520 --> 00:10:08,010
how you can do that in a
little bit more bespoke manner.

265
00:10:08,010 --> 00:10:09,420
And we'll go through a
little bit of the code

266
00:10:09,420 --> 00:10:11,490
of what that looks like
and the main key points.

267
00:10:11,490 --> 00:10:12,323
We only have so much time,

268
00:10:12,323 --> 00:10:14,940
so we're not gonna go through
all the code that's there,

269
00:10:14,940 --> 00:10:17,280
but we wanna make sure
that you understand, hey,

270
00:10:17,280 --> 00:10:18,660
these are the points you need to make,

271
00:10:18,660 --> 00:10:23,660
or to build into the system to
derive like individual files

272
00:10:23,910 --> 00:10:27,270
that you can pull into these
stores, for tenants, for users,

273
00:10:27,270 --> 00:10:29,880
whatever way you want to
break it down as well.

274
00:10:29,880 --> 00:10:31,330
- [Mike] So I'll switch over.

275
00:10:34,680 --> 00:10:36,420
- [Steven] Right, and
remember, this is interactive.

276
00:10:36,420 --> 00:10:39,333
If anybody's got questions
and things, feel free.

277
00:10:40,200 --> 00:10:41,033
Let's see if it's coming up.

278
00:10:41,033 --> 00:10:42,330
So we're gonna do a little bit of a demo,

279
00:10:42,330 --> 00:10:46,230
just to kind of show you
and see what is possible.

280
00:10:46,230 --> 00:10:48,570
Again, this is just kind of a tech demo

281
00:10:48,570 --> 00:10:50,160
to show you what's out there.

282
00:10:50,160 --> 00:10:54,030
So the first screen that
you're seeing here is Tenant A.

283
00:10:54,030 --> 00:10:55,080
So I've logged in

284
00:10:55,080 --> 00:10:57,630
and I've got a bunch of files
in here that I've added.

285
00:10:57,630 --> 00:11:00,210
I'm trying to pre-populate
this because we all know that

286
00:11:00,210 --> 00:11:02,160
the demo gods don't love us very much

287
00:11:02,160 --> 00:11:04,080
and we want to make sure that it runs.

288
00:11:04,080 --> 00:11:07,290
So what you'll see here is
I've got a few files in here

289
00:11:07,290 --> 00:11:09,963
for Tenant A, which is an S3 vector store.

290
00:11:11,280 --> 00:11:13,620
You'll notice there's a few
files that have been timed out

291
00:11:13,620 --> 00:11:16,020
and then some other files
have an expiration date.

292
00:11:16,020 --> 00:11:18,217
So those are the ones that
I've gone in and said,

293
00:11:18,217 --> 00:11:21,120
"This file particular to me,

294
00:11:21,120 --> 00:11:23,670
I want to go and add
to the knowledge base."

295
00:11:23,670 --> 00:11:25,650
So it's gonna say that
you've got so much capacity.

296
00:11:25,650 --> 00:11:27,690
Again, when you're building these systems,

297
00:11:27,690 --> 00:11:28,740
it's probably baked in.

298
00:11:28,740 --> 00:11:30,570
You won't be showing
these screens to the users

299
00:11:30,570 --> 00:11:31,620
and things like that.

300
00:11:33,286 --> 00:11:34,119
Of course it's gonna,

301
00:11:34,119 --> 00:11:37,290
demo gods are gonna hit me in
the face for this one, but.

302
00:11:37,290 --> 00:11:39,570
So imagine that gets ingested.

303
00:11:39,570 --> 00:11:43,380
So now I'm Tenant A, I
am a user in the system,

304
00:11:43,380 --> 00:11:45,420
I've got my indexed files in there

305
00:11:45,420 --> 00:11:47,340
and then I can go and chat with that,

306
00:11:47,340 --> 00:11:49,200
those particular files.

307
00:11:49,200 --> 00:11:52,440
So I've already done a chat
before because, of course,

308
00:11:52,440 --> 00:11:54,330
again, the demo gods.

309
00:11:54,330 --> 00:11:57,150
I'm only seeing and
interacting with the files

310
00:11:57,150 --> 00:11:58,410
that I have ingested.

311
00:11:58,410 --> 00:12:01,830
And this could be per tenant
based or per user base.

312
00:12:01,830 --> 00:12:04,173
So I've ingested these S3 files.

313
00:12:05,070 --> 00:12:06,360
And I asked some questions on it.

314
00:12:06,360 --> 00:12:09,330
Now I'm gonna switch
over quickly to Tenant C.

315
00:12:09,330 --> 00:12:12,480
Just to kind of show you like
Tenant C's on OpenSearch.

316
00:12:12,480 --> 00:12:15,180
They've got a lot more files
they're allowed to ingest,

317
00:12:15,180 --> 00:12:16,440
a lot more file usage.

318
00:12:16,440 --> 00:12:19,620
They can do a higher query
rate, things like that.

319
00:12:19,620 --> 00:12:21,317
And you'll see that I've indexed again,

320
00:12:21,317 --> 00:12:24,510
but they've got a way
longer expiration period

321
00:12:24,510 --> 00:12:26,010
that they can have as well.

322
00:12:26,010 --> 00:12:30,390
So while they're going through,
they can do another chat

323
00:12:30,390 --> 00:12:34,920
and they're gonna be chatting
again against their own files

324
00:12:34,920 --> 00:12:37,293
per tenant, per user in this case.

325
00:12:38,940 --> 00:12:42,030
So when I go into a chat
in here, you'll see the,

326
00:12:42,030 --> 00:12:42,863
I've got my index files

327
00:12:42,863 --> 00:12:45,660
and I can go and ask it a question like,

328
00:12:45,660 --> 00:12:47,823
what programming language.

329
00:12:48,720 --> 00:12:50,460
This is, let's see if
we can actually get it,

330
00:12:50,460 --> 00:12:53,040
if I can spell, you're using.

331
00:12:53,040 --> 00:12:54,783
I can't spell at all.

332
00:12:58,133 --> 00:12:59,820
- [Mike] It's like horseshoes, right?

333
00:12:59,820 --> 00:13:01,650
Just-
- Yeah.

334
00:13:01,650 --> 00:13:03,810
Let's see, now I think my network

335
00:13:03,810 --> 00:13:05,220
is failing like crazy in here.

336
00:13:05,220 --> 00:13:06,810
So we're gonna pretend
that that came back.

337
00:13:06,810 --> 00:13:09,690
That's why I had the
other chat pre-populated.

338
00:13:09,690 --> 00:13:11,370
So what we want to do
though is just give you

339
00:13:11,370 --> 00:13:13,620
an overall view of like
what's possible, right?

340
00:13:13,620 --> 00:13:15,900
So if you break it down you
can break these files down.

341
00:13:15,900 --> 00:13:18,780
But we want to get into some
of what the code looks like

342
00:13:18,780 --> 00:13:20,670
and how we make this happen.

343
00:13:20,670 --> 00:13:22,050
So I'm gonna switch over

344
00:13:22,050 --> 00:13:24,930
to our friendly neighborhood
Kiro system over here.

345
00:13:24,930 --> 00:13:26,640
- [Mike] Might wanna zoom in on that.

346
00:13:26,640 --> 00:13:27,473
- [Steven] Yeah, we're gonna-

347
00:13:27,473 --> 00:13:28,530
- [Mike] For our friends in the back.

348
00:13:28,530 --> 00:13:30,420
- [Steven] For the
people with the eyesight

349
00:13:30,420 --> 00:13:32,610
that we were just talking about up here.

350
00:13:32,610 --> 00:13:33,710
We're getting to that.

351
00:13:34,860 --> 00:13:37,680
What prescription, I
think I need a new one.

352
00:13:37,680 --> 00:13:40,770
Okay, so in here, this is my main stack,

353
00:13:40,770 --> 00:13:42,690
and what I'm doing is I'm creating

354
00:13:42,690 --> 00:13:44,310
a couple of the knowledge bases here.

355
00:13:44,310 --> 00:13:45,810
And you'll see that I've got ones

356
00:13:45,810 --> 00:13:48,120
where I might wanna set
it up or I might not.

357
00:13:48,120 --> 00:13:49,740
But I wanna show you this because-

358
00:13:49,740 --> 00:13:50,573
- [Mike] Just pausing one second.

359
00:13:50,573 --> 00:13:52,200
When you say main stack,
what do you mean by that?

360
00:13:52,200 --> 00:13:53,033
- [Steven] That's right.

361
00:13:53,033 --> 00:13:57,180
This is the CDK application
that is going to build out

362
00:13:57,180 --> 00:14:00,060
the infrastructure inside of AWS for us.

363
00:14:00,060 --> 00:14:03,300
And this part of the
stack is the primary stack

364
00:14:03,300 --> 00:14:05,400
that runs first and is building out.

365
00:14:05,400 --> 00:14:07,200
I'm calling out to a bunch of other things

366
00:14:07,200 --> 00:14:09,600
to build out the knowledge bases

367
00:14:09,600 --> 00:14:12,180
and do the connectivity
between everything.

368
00:14:12,180 --> 00:14:14,460
So I want to call this one out

369
00:14:14,460 --> 00:14:16,170
because we're gonna jump into this

370
00:14:16,170 --> 00:14:19,950
knowledge base class as
well in a second tier.

371
00:14:19,950 --> 00:14:21,570
But you'll notice that
there's a couple of them.

372
00:14:21,570 --> 00:14:24,210
There is the OpenSearch one,

373
00:14:24,210 --> 00:14:27,600
and that there's a Postgres
knowledge based one.

374
00:14:27,600 --> 00:14:31,560
Now I note that we said S3 vector as well.

375
00:14:31,560 --> 00:14:35,610
That, the CDK constructs and
cloud formation constructs

376
00:14:35,610 --> 00:14:38,970
for S3 vector are still
in the mix, I should say,

377
00:14:38,970 --> 00:14:41,310
or like kind of being turned on.

378
00:14:41,310 --> 00:14:44,220
So that is built off in a different stack

379
00:14:44,220 --> 00:14:47,040
because I have to use the APIs
directly for those right now.

380
00:14:47,040 --> 00:14:49,950
So there's custom resources
to build that out.

381
00:14:49,950 --> 00:14:51,960
But for the end result

382
00:14:51,960 --> 00:14:54,030
you're still going
through a knowledge base

383
00:14:54,030 --> 00:14:57,270
for the querying, which we'll
get into in a second here.

384
00:14:57,270 --> 00:14:58,520
So I'm going to go over-

385
00:14:58,520 --> 00:14:59,940
- [Mike] So the key takeaway there is

386
00:14:59,940 --> 00:15:01,200
that you're building infrastructure

387
00:15:01,200 --> 00:15:02,640
to have the knowledge base,

388
00:15:02,640 --> 00:15:05,073
and it's connected to
the backend vector store.

389
00:15:06,690 --> 00:15:07,953
- [Steven] Yes, exactly.

390
00:15:08,820 --> 00:15:11,070
So this is that knowledge base stack

391
00:15:11,070 --> 00:15:12,393
that I was talking about.

392
00:15:13,418 --> 00:15:14,400
And I'm gonna zoom in here.

393
00:15:14,400 --> 00:15:17,280
So we've got a bunch of stuff at the top

394
00:15:17,280 --> 00:15:18,600
that's setting up a few things,

395
00:15:18,600 --> 00:15:21,360
just sanitizing names, things like that.

396
00:15:21,360 --> 00:15:23,310
But one of the key things
we want to do first

397
00:15:23,310 --> 00:15:25,770
is set up the knowledge base,

398
00:15:25,770 --> 00:15:28,770
and I'm just going to
copy some things in here

399
00:15:28,770 --> 00:15:31,740
to save time of me typing,

400
00:15:31,740 --> 00:15:35,130
'cause nobody wants to
see me just type away.

401
00:15:35,130 --> 00:15:37,650
So we've got our knowledge
base, we've got the, you know,

402
00:15:37,650 --> 00:15:40,470
we're setting up the name
and things like that.

403
00:15:40,470 --> 00:15:42,450
Now the next most important thing

404
00:15:42,450 --> 00:15:44,670
is the knowledge base configuration.

405
00:15:44,670 --> 00:15:47,640
So I'm gonna copy that in here.

406
00:15:47,640 --> 00:15:51,210
And you'll see what I'm
setting up is the vector type.

407
00:15:51,210 --> 00:15:54,900
You can set up these embedding
models and things like that,

408
00:15:54,900 --> 00:15:56,640
whatever you want, across.

409
00:15:56,640 --> 00:15:59,580
This is going to, you could
pass these in as variables again

410
00:15:59,580 --> 00:16:02,160
for the particular knowledge
base that you're using.

411
00:16:02,160 --> 00:16:04,080
I've set them kind of across the board

412
00:16:04,080 --> 00:16:06,730
for the knowledge bases that
I'm gonna be setting up.

413
00:16:08,370 --> 00:16:11,550
And then we want to do
the storage configuration.

414
00:16:11,550 --> 00:16:16,550
So in this instance, this
is where I'm passing in,

415
00:16:16,890 --> 00:16:17,850
I'm creating these,

416
00:16:17,850 --> 00:16:20,400
this knowledge base storage configuration

417
00:16:20,400 --> 00:16:23,490
and I'm passing in my
OpenSearch for my Aurora stuff.

418
00:16:23,490 --> 00:16:24,750
So if we jump into there,

419
00:16:24,750 --> 00:16:28,800
you'll see that for RDS I'm
setting it up a specific way.

420
00:16:28,800 --> 00:16:29,700
So I'm saying, you know,

421
00:16:29,700 --> 00:16:32,253
I've got my embeddings
and chunkings for RDS.

422
00:16:33,300 --> 00:16:36,060
And if it's Aurora,

423
00:16:36,060 --> 00:16:38,040
then we're gonna be
setting up a different way.

424
00:16:38,040 --> 00:16:41,224
And then for OpenSearch we have to use,

425
00:16:41,224 --> 00:16:44,850
I'm setting up with OpenSearch
serverless, and again,

426
00:16:44,850 --> 00:16:46,560
I'm going into each individual one

427
00:16:46,560 --> 00:16:49,680
and I'm setting up the
individual vector stores.

428
00:16:49,680 --> 00:16:53,190
But once we get to the actual
query and things like that,

429
00:16:53,190 --> 00:16:54,510
I don't have to worry about that.

430
00:16:54,510 --> 00:16:56,790
I can just say this is
the one that I'm going to

431
00:16:56,790 --> 00:16:59,370
and it's all set, each one is set up,

432
00:16:59,370 --> 00:17:02,130
and I can just point it
to that and it can go.

433
00:17:02,130 --> 00:17:03,720
- [Mike] So that was a lot to cover.

434
00:17:03,720 --> 00:17:04,560
- [Steven] Yeah.

435
00:17:04,560 --> 00:17:06,720
- [Mike] Really wanna open
up to questions or comments,

436
00:17:06,720 --> 00:17:08,610
or like if, was there points,

437
00:17:08,610 --> 00:17:12,327
like why did you make that
decision or what, you know,

438
00:17:14,460 --> 00:17:15,293
why did we do that?

439
00:17:15,293 --> 00:17:17,520
And if no one ask questions,
then I'm gonna ask questions

440
00:17:17,520 --> 00:17:19,290
and I'm probably not gonna
ask the same question you are.

441
00:17:19,290 --> 00:17:21,420
So any questions, raise your hand,

442
00:17:21,420 --> 00:17:24,270
and I may have to step to the side to see.

443
00:17:24,270 --> 00:17:26,610
- [Steven] And while he's
going to find out, there's,

444
00:17:26,610 --> 00:17:28,020
the next thing that we need to set up.

445
00:17:28,020 --> 00:17:30,330
We've got the knowledge
base configuration,

446
00:17:30,330 --> 00:17:32,220
but we do need the data source, right?

447
00:17:32,220 --> 00:17:34,710
We need to tell it where
the data is coming from.

448
00:17:34,710 --> 00:17:38,973
So I am going to set up
a data source in my code,

449
00:17:39,900 --> 00:17:41,610
unless there's a question-
- I have one question,

450
00:17:41,610 --> 00:17:46,320
is related to the different vector stores.

451
00:17:46,320 --> 00:17:48,270
What is the pros and cons for each one?

452
00:17:49,140 --> 00:17:50,430
- [Steven] Sorry, I can't see.

453
00:17:50,430 --> 00:17:51,635
- [Mike] Did you hear the question?

454
00:17:51,635 --> 00:17:52,468
- I did not hear the question.
- The question is,

455
00:17:52,468 --> 00:17:53,430
"What are the different pros and cons

456
00:17:53,430 --> 00:17:56,460
for the vector stores
that you had set up?"

457
00:17:56,460 --> 00:17:58,470
- [Steven] So the pros and cons,

458
00:17:58,470 --> 00:18:00,450
I think Mike went over a
little bit there, right?

459
00:18:00,450 --> 00:18:03,630
But it's typically what
I've seen with customers is

460
00:18:03,630 --> 00:18:07,770
the price to latency ratios
that they're seeing in there.

461
00:18:07,770 --> 00:18:11,739
So if it's a customer like, you know,

462
00:18:11,739 --> 00:18:12,840
you might have a free tier, right,

463
00:18:12,840 --> 00:18:15,300
where you really don't wanna
spend a lot of money on that.

464
00:18:15,300 --> 00:18:17,130
That's just the kind of,

465
00:18:17,130 --> 00:18:19,800
the way to pull the customer
in to see what you're doing.

466
00:18:19,800 --> 00:18:23,130
So you might use an S3 vector store there

467
00:18:23,130 --> 00:18:25,680
because the latency on every question

468
00:18:25,680 --> 00:18:28,770
might be a little longer, depending.

469
00:18:28,770 --> 00:18:30,840
This is bang for your buck.

470
00:18:30,840 --> 00:18:31,980
You're gonna have to go in there

471
00:18:31,980 --> 00:18:32,820
a little bit with yourself,

472
00:18:32,820 --> 00:18:34,320
depending on the file types you're using

473
00:18:34,320 --> 00:18:35,153
and things like that.

474
00:18:35,153 --> 00:18:39,210
So it's kind of on YouTube,

475
00:18:39,210 --> 00:18:41,490
do a little bit of research
to figure that out.

476
00:18:41,490 --> 00:18:45,390
But we have seen, you know, also there's,

477
00:18:45,390 --> 00:18:47,640
if you're using Postgres already,

478
00:18:47,640 --> 00:18:49,080
and you're using OpenSearch,

479
00:18:49,080 --> 00:18:51,363
you might just want to go those routes.

480
00:18:52,620 --> 00:18:53,453
- [Mike] To add onto that,

481
00:18:53,453 --> 00:18:55,170
I mean that's typically
what I've seen is like

482
00:18:55,170 --> 00:18:57,510
we are familiar with Postgres,
we know how to run it,

483
00:18:57,510 --> 00:18:58,410
we know how to operate it

484
00:18:58,410 --> 00:19:00,960
and we need a low latency vector store.

485
00:19:00,960 --> 00:19:04,410
It's a good fit for, versus
OpenSearch, you know,

486
00:19:04,410 --> 00:19:06,450
we have many customers that run OpenSearch

487
00:19:06,450 --> 00:19:08,100
for other purposes.

488
00:19:08,100 --> 00:19:11,370
It's just a natural fit to
put their vector in Postgres.

489
00:19:11,370 --> 00:19:13,470
But, you know, there's
many others, you know.

490
00:19:13,470 --> 00:19:15,003
Pinecone would be an example.

491
00:19:16,440 --> 00:19:19,020
So there's probably a whole
talk just on, you know,

492
00:19:19,020 --> 00:19:20,280
pick your vector store.

493
00:19:20,280 --> 00:19:23,130
But, you know, really the point here is,

494
00:19:23,130 --> 00:19:24,480
one size does not fit all.

495
00:19:24,480 --> 00:19:27,270
Like you'll likely want
to have multiple options

496
00:19:27,270 --> 00:19:28,290
with different dimensions,

497
00:19:28,290 --> 00:19:31,140
and the kind of the
extreme with latency being

498
00:19:31,140 --> 00:19:34,200
S3 versus OpenSearch, or one other.

499
00:19:34,200 --> 00:19:35,820
Does that help or?

500
00:19:35,820 --> 00:19:36,653
Yeah.

501
00:19:36,653 --> 00:19:37,620
I'll be right back.

502
00:19:37,620 --> 00:19:40,680
Unless you can yell and
I'll repeat the question.

503
00:19:40,680 --> 00:19:41,550
I'll come back.

504
00:19:41,550 --> 00:19:43,103
- [Steven] You can jump back there.

505
00:19:49,100 --> 00:19:50,220
- [Mike] There you go.

506
00:19:50,220 --> 00:19:51,053
- [Audience Member] I was curious.

507
00:19:51,053 --> 00:19:52,560
So right now we have a knowledge base

508
00:19:52,560 --> 00:19:55,140
with fairly small tabular data

509
00:19:55,140 --> 00:19:59,580
that's loaded in S3 and
using OpenSearch for that.

510
00:19:59,580 --> 00:20:02,790
I was wondering if for small tables

511
00:20:02,790 --> 00:20:07,790
it will be worth it moving
to the Postgres vector,

512
00:20:07,920 --> 00:20:09,543
since it's tabular data.

513
00:20:10,560 --> 00:20:14,430
And will there be any accuracy
implications for the agent

514
00:20:14,430 --> 00:20:16,203
that uses that knowledge base?

515
00:20:17,760 --> 00:20:18,697
- [Steven] That's gonna
be a tough question

516
00:20:18,697 --> 00:20:19,890
for me to answer.

517
00:20:19,890 --> 00:20:23,430
There's, if you look,
there are some samples

518
00:20:23,430 --> 00:20:25,710
out in the AWS samples, GitHub repo,

519
00:20:25,710 --> 00:20:28,590
that kind of on the, they let you run

520
00:20:28,590 --> 00:20:31,950
your own kind of performance
testing on this kind of stuff.

521
00:20:31,950 --> 00:20:34,140
What we found is it really depends on

522
00:20:34,140 --> 00:20:36,690
the type of data that you
have and the size of data.

523
00:20:36,690 --> 00:20:38,820
And to your point of like,

524
00:20:38,820 --> 00:20:40,710
how many columns there might be in there,

525
00:20:40,710 --> 00:20:43,980
different types of things
that has to chunk out.

526
00:20:43,980 --> 00:20:46,620
And there's quite a
vast difference between

527
00:20:46,620 --> 00:20:48,330
the embeddings that you're using,

528
00:20:48,330 --> 00:20:50,250
the chunking size that you're using.

529
00:20:50,250 --> 00:20:53,250
So it's really difficult,
without looking at your data

530
00:20:53,250 --> 00:20:55,080
and doing some performance-testing first,

531
00:20:55,080 --> 00:20:57,090
to really figure that out.

532
00:20:57,090 --> 00:20:59,640
That's why we kind of usually
go back to the customer

533
00:20:59,640 --> 00:21:02,310
and say like, "Let's do a
couple of demo runs of this."

534
00:21:02,310 --> 00:21:04,560
And use some of the samples
that we have out there

535
00:21:04,560 --> 00:21:06,450
on your data to figure that out.

536
00:21:06,450 --> 00:21:08,820
- [Mike] Yeah, and I'll
stress that the embedding

537
00:21:08,820 --> 00:21:11,550
and the chunking have a much bigger impact

538
00:21:11,550 --> 00:21:15,390
on the quality of the search
than necessarily what the

539
00:21:15,390 --> 00:21:16,833
engine running the math is.

540
00:21:18,150 --> 00:21:19,467
- [Audience Member] Thank you.

541
00:21:19,467 --> 00:21:21,210
- [Steven] All right, while he's jumping

542
00:21:21,210 --> 00:21:23,921
to another question, I'm gonna
add in the data source here.

543
00:21:23,921 --> 00:21:26,640
'Cause I think this is
one of the key things

544
00:21:26,640 --> 00:21:31,230
when you're creating the data
source for the knowledge base.

545
00:21:31,230 --> 00:21:33,900
We're setting the data source
configuration to be custom,

546
00:21:33,900 --> 00:21:36,030
and this is one of the
key points in here is

547
00:21:36,030 --> 00:21:38,340
this allows us to actually say,

548
00:21:38,340 --> 00:21:41,370
instead of going to the
data, like to have an S3

549
00:21:41,370 --> 00:21:44,850
and just pulling everything
in when the files are there,

550
00:21:44,850 --> 00:21:47,640
we want to do this very bespoke
and we want to do it custom.

551
00:21:47,640 --> 00:21:51,600
So that's, we're setting it
up to be exactly like that.

552
00:21:51,600 --> 00:21:54,090
And you'll see once we
get into the ingest part,

553
00:21:54,090 --> 00:21:56,100
so I'm gonna just copy
the rest of this in here

554
00:21:56,100 --> 00:21:58,200
just so you see what it looks like.

555
00:21:58,200 --> 00:22:01,320
So I've set up my data source
now, I've got the custom.

556
00:22:01,320 --> 00:22:03,210
And we're going through
stages here, right?

557
00:22:03,210 --> 00:22:05,310
Set up the data source,
set up the knowledge base.

558
00:22:05,310 --> 00:22:08,250
We're gonna get into the
ingest next and the query,

559
00:22:08,250 --> 00:22:11,070
and then what it looks
like when we time out data

560
00:22:11,070 --> 00:22:12,243
and cleaning that up.

561
00:22:13,200 --> 00:22:14,033
But, sorry, Mike,

562
00:22:14,033 --> 00:22:14,998
was there another question?
- Did you still have

563
00:22:14,998 --> 00:22:16,581
a question on that?

564
00:22:18,930 --> 00:22:22,110
- [Audience Member] If we need
to inject the caching layer

565
00:22:22,110 --> 00:22:24,993
on the previous
architecture, how it can fit?

566
00:22:26,670 --> 00:22:29,040
- Sorry, I didn't quite hear.
- How would we put

567
00:22:29,040 --> 00:22:32,220
a caching layer on top
of that previous layer,

568
00:22:32,220 --> 00:22:33,573
on top of the vector store?

569
00:22:35,160 --> 00:22:36,600
- [Steven] That's a very good question,

570
00:22:36,600 --> 00:22:37,800
not one that I've thought of.

571
00:22:37,800 --> 00:22:41,520
I mean you, depends on if
you're using like CloudFront

572
00:22:41,520 --> 00:22:43,800
as a fronting mechanism
or something like that,

573
00:22:43,800 --> 00:22:47,313
you could try to do some
caching of the results in there.

574
00:22:48,600 --> 00:22:49,433
Hmm.

575
00:22:49,433 --> 00:22:51,420
I'm sure you could
probably use ElastiCache

576
00:22:51,420 --> 00:22:53,220
and some other tooling
in there if you wanted.

577
00:22:53,220 --> 00:22:57,360
But I don't have a bespoke
answer for that from here.

578
00:22:57,360 --> 00:23:01,173
And the caching wasn't
part of this system per se.

579
00:23:04,530 --> 00:23:05,910
Another question.
- One more.

580
00:23:05,910 --> 00:23:06,860
Then we'll move on.

581
00:23:09,840 --> 00:23:11,460
- [Audience Member] What are
some advantages you've seen

582
00:23:11,460 --> 00:23:15,930
to adding the knowledge
base layer, versus, uh-

583
00:23:15,930 --> 00:23:18,180
- [Steven] Going directly
to the individual?

584
00:23:18,180 --> 00:23:21,090
Yeah, actually, so-
- We'll cover that stuff-

585
00:23:21,090 --> 00:23:23,142
- [Steven] Yeah, we're
gonna kind of go into that

586
00:23:23,142 --> 00:23:25,380
and kind show why we
might want to do this.

587
00:23:25,380 --> 00:23:29,790
So ingest and querying
are part of those things.

588
00:23:29,790 --> 00:23:33,690
So I'm gonna go to the
ingest section here.

589
00:23:33,690 --> 00:23:37,530
So this is a Python file
that's gonna be doing

590
00:23:37,530 --> 00:23:39,690
my ingestion of my documents.

591
00:23:39,690 --> 00:23:41,670
So this is when I clicked
a couple of those files

592
00:23:41,670 --> 00:23:44,820
and I said, "Hey, run the
ingestion for just these files."

593
00:23:44,820 --> 00:23:47,640
They're sitting in S3 so
my users uploaded them.

594
00:23:47,640 --> 00:23:51,150
I don't want them to be in
my vector store at all times.

595
00:23:51,150 --> 00:23:53,670
I just want to do it at particular times.

596
00:23:53,670 --> 00:23:57,030
So you'll see in here that
I'm running through the files

597
00:23:57,030 --> 00:23:59,670
and I'm gonna set up a document structure.

598
00:23:59,670 --> 00:24:01,500
And this is one of the key things

599
00:24:01,500 --> 00:24:04,380
that we're gonna go through here is,

600
00:24:04,380 --> 00:24:08,966
we're gonna set up a content type and-

601
00:24:08,966 --> 00:24:10,680
- Can you zoom?
- Oh yeah.

602
00:24:10,680 --> 00:24:12,180
Hey, thanks from the audience.

603
00:24:13,350 --> 00:24:15,390
So we've got a document
and we've got a content,

604
00:24:15,390 --> 00:24:17,880
and again the data source type is custom

605
00:24:17,880 --> 00:24:20,070
and we're giving it a file identifier

606
00:24:20,070 --> 00:24:22,950
and the location of the file,
and we're saying it's S3.

607
00:24:22,950 --> 00:24:24,270
So that's, we're setting it up saying

608
00:24:24,270 --> 00:24:25,920
we know where the file is,

609
00:24:25,920 --> 00:24:29,040
but next we're gonna
add in some extra stuff,

610
00:24:29,040 --> 00:24:32,400
which is arguably the most important thing

611
00:24:32,400 --> 00:24:35,550
is the metadata for these
files that we're passing in.

612
00:24:35,550 --> 00:24:37,440
So if you're doing this
in a bespoke manner,

613
00:24:37,440 --> 00:24:39,960
you're gonna have to
do this for OpenSearch

614
00:24:39,960 --> 00:24:42,120
differently for S3 Vector, different post,

615
00:24:42,120 --> 00:24:44,100
whichever, you know,
name your vector store.

616
00:24:44,100 --> 00:24:46,560
You're gonna have to figure
out how it's doing these

617
00:24:46,560 --> 00:24:49,953
filtering mechanisms, and do
it for, or do it through those.

618
00:24:50,850 --> 00:24:53,130
So like if you're using OpenSearch,

619
00:24:53,130 --> 00:24:54,720
you're also on the query side,

620
00:24:54,720 --> 00:24:56,730
you're gonna have to figure
out how do I do that query?

621
00:24:56,730 --> 00:24:59,850
Or if it's pgVector, I have
to write the SQL query, right,

622
00:24:59,850 --> 00:25:01,980
to do this with the filtering in place.

623
00:25:01,980 --> 00:25:03,240
So I'm gonna add this in here

624
00:25:03,240 --> 00:25:05,540
so we all know exactly
what I'm talking about.

625
00:25:06,780 --> 00:25:09,570
So I'm adding in metadata, and again,

626
00:25:09,570 --> 00:25:13,680
you could do this with S3 if
you want to do bulk ingestion.

627
00:25:13,680 --> 00:25:16,470
There is the ability to put
metadata files in there.

628
00:25:16,470 --> 00:25:19,470
But what this is allowing me
to do is to check those files

629
00:25:19,470 --> 00:25:21,510
and individually pull them in.

630
00:25:21,510 --> 00:25:25,737
And then also what I'm doing
here is setting the metadata,

631
00:25:25,737 --> 00:25:29,130
the user ID, and
specifically the tenant ID,

632
00:25:29,130 --> 00:25:30,720
so that when I'm doing the querying,

633
00:25:30,720 --> 00:25:33,570
I can come back and do the
exact same thing in reverse,

634
00:25:33,570 --> 00:25:36,007
I guess, is set the tenant and say,

635
00:25:36,007 --> 00:25:38,670
"Hey, I want a query for that tenant."

636
00:25:38,670 --> 00:25:42,450
There's one thing that I
am not showing in here is

637
00:25:42,450 --> 00:25:44,460
I'm also adding these,

638
00:25:44,460 --> 00:25:47,340
like I add them into the knowledge base

639
00:25:47,340 --> 00:25:48,780
into the vector stores,

640
00:25:48,780 --> 00:25:52,230
but I'm also adding a record
into a Dynamo database.

641
00:25:52,230 --> 00:25:55,590
And in that database I'm setting
a time till I have a TTL,

642
00:25:55,590 --> 00:25:57,660
which is, I think,
arguably one of the most

643
00:25:57,660 --> 00:25:59,610
underrated things that
people just don't use

644
00:25:59,610 --> 00:26:01,230
for some reason.

645
00:26:01,230 --> 00:26:05,010
It's awesome, you can do
TTL or events and triggers

646
00:26:05,010 --> 00:26:06,870
from other systems in AWS,

647
00:26:06,870 --> 00:26:10,740
but the per record way of
doing it in Dynamo and it's,

648
00:26:10,740 --> 00:26:14,610
I arguably say, very
cost-effective to do this.

649
00:26:14,610 --> 00:26:18,750
That's what lets me set up
that expiry date in the files

650
00:26:18,750 --> 00:26:19,920
that I showed in the demo, right?

651
00:26:19,920 --> 00:26:21,930
There's a, you know, it's
an eight minute window,

652
00:26:21,930 --> 00:26:24,600
or eight day window or
a day window, 24 hours,

653
00:26:24,600 --> 00:26:25,680
whatever it is.

654
00:26:25,680 --> 00:26:28,260
So I've now gone through the ingest,

655
00:26:28,260 --> 00:26:30,450
I've set up the metadata
to be able to know

656
00:26:30,450 --> 00:26:31,680
that I can filter on those.

657
00:26:31,680 --> 00:26:34,830
And this metadata is in the vector stores,

658
00:26:34,830 --> 00:26:36,030
tied to the vector stores.

659
00:26:36,030 --> 00:26:39,417
This isn't in Dynamo,
a lot of this record-

660
00:26:39,417 --> 00:26:40,410
- [Mike] Add some color to that.

661
00:26:40,410 --> 00:26:41,460
I mean the key is that,

662
00:26:41,460 --> 00:26:43,560
regardless of what vector
store you're using,

663
00:26:43,560 --> 00:26:45,060
it's using this structure, right?

664
00:26:45,060 --> 00:26:45,893
- [Steven] Yes.

665
00:26:45,893 --> 00:26:47,340
- [Mike] That way you don't have to know

666
00:26:47,340 --> 00:26:49,590
that it's a specific index in OpenSearch.

667
00:26:49,590 --> 00:26:50,820
- [Steven] I don't have to duplicate this,

668
00:26:50,820 --> 00:26:52,800
this code is like one set of code,

669
00:26:52,800 --> 00:26:56,130
one set of queries that I
have to do across the board

670
00:26:56,130 --> 00:26:57,990
for whatever vector stores

671
00:26:57,990 --> 00:27:00,240
that the Bedrock knowledge base supports.

672
00:27:00,240 --> 00:27:01,560
- [Mike] So to answer the
question that came up,

673
00:27:01,560 --> 00:27:03,150
like why wouldn't you just talk directly

674
00:27:03,150 --> 00:27:03,983
to the vector stores?

675
00:27:03,983 --> 00:27:06,060
Well this gives you an abstraction layer

676
00:27:06,060 --> 00:27:08,340
that allows you to work
at the metadata level

677
00:27:08,340 --> 00:27:10,770
that would then push that
into the vector store,

678
00:27:10,770 --> 00:27:14,163
regardless of, you know,
how that's being stored.

679
00:27:15,900 --> 00:27:17,340
- All right, so now-
- We have a question

680
00:27:17,340 --> 00:27:20,100
over here, I'm keeping an eye on time.

681
00:27:20,100 --> 00:27:21,600
We're plenty good on time, so.

682
00:27:28,080 --> 00:27:29,610
- [Steven] I feel like I
should be standing too,

683
00:27:29,610 --> 00:27:31,360
but then I'm typing really odd and.

684
00:27:32,310 --> 00:27:34,050
- [Audience Member] My
question would be like,

685
00:27:34,050 --> 00:27:36,900
how would the system
react to nested metadata?

686
00:27:36,900 --> 00:27:40,110
So for example, let's say we have a book,

687
00:27:40,110 --> 00:27:42,930
a book has like multiple authors, so,

688
00:27:42,930 --> 00:27:45,000
and authors would have like names.

689
00:27:45,000 --> 00:27:47,100
And these names could be like,

690
00:27:47,100 --> 00:27:49,020
in Japan you would have like names

691
00:27:49,020 --> 00:27:51,180
in the Japanese characters.

692
00:27:51,180 --> 00:27:53,580
- Yeah.
- In U.K. or U.S.

693
00:27:53,580 --> 00:27:54,630
it'd be in English characters.

694
00:27:54,630 --> 00:27:58,950
So how would you design your
metadata for Bedrock, or like,

695
00:27:58,950 --> 00:28:01,830
you know, for more efficiently?

696
00:28:01,830 --> 00:28:03,540
- [Steven] I'm not sure if that would,

697
00:28:03,540 --> 00:28:05,280
so I think I understand
your question of like

698
00:28:05,280 --> 00:28:07,470
Unicode characters or
other type of characters,

699
00:28:07,470 --> 00:28:09,423
if they're in there or not.

700
00:28:10,620 --> 00:28:13,530
In this form, I'm not sure

701
00:28:13,530 --> 00:28:14,880
if that would really come into play,

702
00:28:14,880 --> 00:28:18,330
because in this form
I'm saying a tenant ID,

703
00:28:18,330 --> 00:28:20,700
and I'm filtering by a tenant and a user,

704
00:28:20,700 --> 00:28:22,320
not specifically the content.

705
00:28:22,320 --> 00:28:25,800
The content gets ingested as, you know,

706
00:28:25,800 --> 00:28:27,870
whatever vector store is ingesting.

707
00:28:27,870 --> 00:28:30,150
So it's using that embedding
model to break it apart.

708
00:28:30,150 --> 00:28:32,790
So I think it would, the
question would be going back

709
00:28:32,790 --> 00:28:33,660
to that embedding model

710
00:28:33,660 --> 00:28:35,560
and making sure that it supports that.

711
00:28:36,641 --> 00:28:38,340
So.
- In this case,

712
00:28:38,340 --> 00:28:43,340
in this schema, can you have
a list be, or an object type

713
00:28:43,380 --> 00:28:44,493
as part of the schema?

714
00:28:47,280 --> 00:28:48,540
- [Steven] I'm not sure,
I'd have to figure,

715
00:28:48,540 --> 00:28:50,580
go back and answer that.
- That's a research,

716
00:28:50,580 --> 00:28:52,770
I think that's how I would
start looking for it.

717
00:28:52,770 --> 00:28:56,160
But I don't have the answer
off the top of my head.

718
00:28:56,160 --> 00:28:58,200
- [Steven] There's not
a definitive, there is,

719
00:28:58,200 --> 00:28:59,280
in the querying side,

720
00:28:59,280 --> 00:29:01,980
you can do and all kind of things, right?

721
00:29:01,980 --> 00:29:05,040
So we're gonna get into that
a little bit in the next step.

722
00:29:05,040 --> 00:29:08,550
Inserting the metadata
as an individual key,

723
00:29:08,550 --> 00:29:10,350
as far as I'm aware, but I haven't.

724
00:29:10,350 --> 00:29:11,940
- [Mike] I mean you certainly
could have author one,

725
00:29:11,940 --> 00:29:13,830
author two, author three, but you'd be,

726
00:29:13,830 --> 00:29:17,280
you'd have a finite list
of authors for your book.

727
00:29:17,280 --> 00:29:18,113
So.

728
00:29:18,113 --> 00:29:19,710
- [Steven] I'd have to,
yeah, if that's a question,

729
00:29:19,710 --> 00:29:21,150
I'd have to get back to someone on

730
00:29:21,150 --> 00:29:24,873
if the metadata supports array
fields and things like that.

731
00:29:26,640 --> 00:29:28,410
Okay, so we've gone through,

732
00:29:28,410 --> 00:29:29,910
we've set up our knowledge bases,

733
00:29:29,910 --> 00:29:31,820
indexed files into the knowledge base.

734
00:29:31,820 --> 00:29:33,180
So the next thing obviously is,

735
00:29:33,180 --> 00:29:34,650
I want to ask it some questions.

736
00:29:34,650 --> 00:29:39,000
So we want to go into the
querying of the knowledge base.

737
00:29:39,000 --> 00:29:41,910
So what I'm going to do first is,

738
00:29:41,910 --> 00:29:44,070
you'll see here we want
to set up a filter,

739
00:29:44,070 --> 00:29:46,563
and I'm gonna zoom in 'cause we know,

740
00:29:46,563 --> 00:29:49,203
just like everybody else, I can't see.

741
00:29:50,970 --> 00:29:55,473
So in here we're gonna set
up a filter expression.

742
00:29:57,660 --> 00:30:00,480
And this is where we're
going to be pulling in

743
00:30:00,480 --> 00:30:02,730
the exact same stuff in the opposite.

744
00:30:02,730 --> 00:30:06,750
So I'm gonna, for the
lack of being able to type

745
00:30:06,750 --> 00:30:08,733
really quickly on the fly.

746
00:30:10,080 --> 00:30:11,220
Oh, wrong, wrong one.

747
00:30:11,220 --> 00:30:13,710
Let's copy the right set of stuff, Steve.

748
00:30:13,710 --> 00:30:15,063
That definitely helps.

749
00:30:16,080 --> 00:30:16,913
One sec.

750
00:30:19,410 --> 00:30:24,410
All right, so when we're
doing a query, so up above we,

751
00:30:25,680 --> 00:30:28,077
this is another Lambda
call that is coming in.

752
00:30:28,077 --> 00:30:29,700
We, from the chat session, right,

753
00:30:29,700 --> 00:30:32,430
it called in through the JWT token.

754
00:30:32,430 --> 00:30:35,160
I would be able to get
my tenant ID, my user ID,

755
00:30:35,160 --> 00:30:36,360
other information like that.

756
00:30:36,360 --> 00:30:39,150
So I've pulled it out
up above in this code.

757
00:30:39,150 --> 00:30:40,890
And the key thing to look at here though

758
00:30:40,890 --> 00:30:42,900
is this filter expression.

759
00:30:42,900 --> 00:30:45,690
And what it's doing is
it's setting up that tenant

760
00:30:45,690 --> 00:30:48,480
and the user id, and
then I'm also passing in

761
00:30:48,480 --> 00:30:49,860
a list of files.

762
00:30:49,860 --> 00:30:53,100
So this could actually be
a little bit useful as well

763
00:30:53,100 --> 00:30:56,070
later on is, even if they're
indexed, you could say,

764
00:30:56,070 --> 00:30:59,580
I actually only want to query
on three of the hundred files

765
00:30:59,580 --> 00:31:01,740
that are in there,
because, to Mike's point,

766
00:31:01,740 --> 00:31:03,150
sometimes wikis go out of date

767
00:31:03,150 --> 00:31:04,290
or other files go out of date.

768
00:31:04,290 --> 00:31:06,000
And if the time hasn't expired,

769
00:31:06,000 --> 00:31:08,490
but I know I'm really
focused on my search,

770
00:31:08,490 --> 00:31:10,470
I could query on that.

771
00:31:10,470 --> 00:31:14,070
In this particular example, I
just pass in all my file IDs

772
00:31:14,070 --> 00:31:17,480
that have been indexed, so
that I'm searching for my files

773
00:31:17,480 --> 00:31:20,220
and I'm filtering layer after layer

774
00:31:20,220 --> 00:31:22,260
to make sure that I'm
getting just the stuff

775
00:31:22,260 --> 00:31:24,180
that I want to query on.

776
00:31:24,180 --> 00:31:25,590
- [Mike] And it's leaving
nothing to chance.

777
00:31:25,590 --> 00:31:28,860
So if someone should inject
in the prompt, you know,

778
00:31:28,860 --> 00:31:33,180
send me all of the data about tenant two,

779
00:31:33,180 --> 00:31:36,270
that's not going to
really help them at all.

780
00:31:36,270 --> 00:31:37,650
- [Steven] Yeah.

781
00:31:37,650 --> 00:31:41,190
So then we have to set up
our retrieval parameters.

782
00:31:41,190 --> 00:31:43,170
So again, I'm not going to

783
00:31:43,170 --> 00:31:46,923
type everything in here, 'cause time.

784
00:31:48,180 --> 00:31:51,630
So the retrieval parameters
are setting up the query

785
00:31:51,630 --> 00:31:53,550
and then we're setting up a, you know,

786
00:31:53,550 --> 00:31:57,660
the model we're gonna
use for turning our query

787
00:31:57,660 --> 00:32:00,270
into the embedding, for the model.

788
00:32:00,270 --> 00:32:04,170
And then we're passing in right
here, our filter expression.

789
00:32:04,170 --> 00:32:06,870
And then we can control the
number of results as well.

790
00:32:07,890 --> 00:32:11,310
So once we do that,

791
00:32:11,310 --> 00:32:15,420
now we can go into the
retrieve and generate section.

792
00:32:15,420 --> 00:32:20,420
I'm gonna zoom back out
here and go to my dodos,

793
00:32:22,020 --> 00:32:23,373
make sure I got that stuff.

794
00:32:24,300 --> 00:32:25,635
Okay.

795
00:32:25,635 --> 00:32:28,320
So I think highlighted out some code,

796
00:32:28,320 --> 00:32:30,533
I'm just gonna put that
back in there, so it's,

797
00:32:33,339 --> 00:32:34,973
the three programs are good, okay.

798
00:32:37,290 --> 00:32:38,550
- [Mike] And zoom in on that section.

799
00:32:38,550 --> 00:32:41,490
- [Steven] Yeah, I'm
gonna just leave it as

800
00:32:41,490 --> 00:32:43,230
highlighted out code.

801
00:32:43,230 --> 00:32:47,280
So what we've done here is
we've set up our parameters.

802
00:32:47,280 --> 00:32:48,450
Once we've set that up,

803
00:32:48,450 --> 00:32:52,530
we would be calling a perform,
retrieve and generate call.

804
00:32:52,530 --> 00:32:57,530
So inside of the knowledge base querying,

805
00:32:58,590 --> 00:33:02,133
I'm gonna find that, while,
hey, where it'd go, sorry.

806
00:33:03,750 --> 00:33:05,553
I'm bouncing around because I,

807
00:33:07,170 --> 00:33:09,690
so from the Bedrock agent runtime,

808
00:33:09,690 --> 00:33:11,190
we're gonna call the
retrieve and generate,

809
00:33:11,190 --> 00:33:13,440
and we're passing in
those retrieval results.

810
00:33:13,440 --> 00:33:16,050
So this is where, again,
back to the point of like

811
00:33:16,050 --> 00:33:18,024
why would you use Bedrock knowledge bases?

812
00:33:18,024 --> 00:33:23,024
I set that up as a query
for Bedrock knowledge bases.

813
00:33:23,220 --> 00:33:26,760
I didn't have to really
understand what's going on

814
00:33:26,760 --> 00:33:30,180
underneath the hood, what
vector store that I'm going to.

815
00:33:30,180 --> 00:33:32,010
I'm doing this, I could do this across

816
00:33:32,010 --> 00:33:34,950
every single vector store that
Bedrock knowledge bases has,

817
00:33:34,950 --> 00:33:37,320
and I don't have to
change this model at all.

818
00:33:37,320 --> 00:33:38,913
So if you wanted to have,

819
00:33:38,913 --> 00:33:41,227
like if another customer
came to you and said,

820
00:33:41,227 --> 00:33:42,810
"Hey, I've got a bespoke use case

821
00:33:42,810 --> 00:33:45,690
where I want to use a different
type of vector store."

822
00:33:45,690 --> 00:33:47,760
Maybe there's government
regulatory, whatever it is,

823
00:33:47,760 --> 00:33:48,660
you don't have to worry about it.

824
00:33:48,660 --> 00:33:51,630
You can just spin that up as
part of your infrastructure

825
00:33:51,630 --> 00:33:53,580
and then just point the code to it,

826
00:33:53,580 --> 00:33:55,310
and you should be good to go.

827
00:33:55,310 --> 00:33:56,340
- [Mike] So it gives you a nice

828
00:33:56,340 --> 00:33:59,010
clean separation of concerns.
- Yeah.

829
00:33:59,010 --> 00:34:00,480
- [Mike] Vector store with the query.

830
00:34:00,480 --> 00:34:05,220
As far as the chunking,
where's the chunking happening,

831
00:34:05,220 --> 00:34:06,820
and where do you configure that?

832
00:34:08,610 --> 00:34:10,920
- [Steven] It's part of the
knowledge base configuration.

833
00:34:10,920 --> 00:34:12,420
So when we're setting
up the knowledge base,

834
00:34:12,420 --> 00:34:16,560
we're setting up the data
source and we're gonna set up

835
00:34:16,560 --> 00:34:19,410
some of the chunking
strategies inside of there.

836
00:34:19,410 --> 00:34:22,263
But also when we go back to the indexing,

837
00:34:23,100 --> 00:34:27,480
we've set up some of it in here.

838
00:34:27,480 --> 00:34:29,180
- [Mike] I sprung that on him, so.

839
00:34:32,580 --> 00:34:34,080
- [Steven] When we're
setting it up though,

840
00:34:34,080 --> 00:34:36,330
we're setting up individual data sources

841
00:34:36,330 --> 00:34:40,590
and data vector source as a
specific chunking strategy

842
00:34:40,590 --> 00:34:41,423
and things like that.

843
00:34:41,423 --> 00:34:43,080
And then in the query side,

844
00:34:43,080 --> 00:34:46,920
we are doing the same
thing with the query.

845
00:34:46,920 --> 00:34:50,520
So you're setting up the
model that you're gonna use,

846
00:34:50,520 --> 00:34:51,810
the foundational model,

847
00:34:51,810 --> 00:34:54,030
and some of the options
that you have there.

848
00:34:54,030 --> 00:34:55,350
It's not really the chunking there,

849
00:34:55,350 --> 00:34:56,820
you're just basically picking the model

850
00:34:56,820 --> 00:34:59,340
to be able to do the embeddings, but.

851
00:34:59,340 --> 00:35:00,933
- [Mike] Any other questions?

852
00:35:03,300 --> 00:35:04,133
There we go.

853
00:35:07,775 --> 00:35:08,608
- [Steven] After the question

854
00:35:08,608 --> 00:35:10,990
we go on to the last little
bit, is just the cleanup part.

855
00:35:12,565 --> 00:35:14,880
- [Audience Member] I have a question.

856
00:35:14,880 --> 00:35:19,880
Maybe it does it automatically
but, if tenant two,

857
00:35:19,920 --> 00:35:24,360
for example, is chatting with
their own index of documents

858
00:35:24,360 --> 00:35:27,840
and whatsoever, and I update
one of those documents,

859
00:35:27,840 --> 00:35:32,840
but how does the tenant know
that the document is updated

860
00:35:33,900 --> 00:35:36,933
and the embedding is regenerated again,

861
00:35:38,717 --> 00:35:42,120
but I don't want to lose the
context of the chat basically.

862
00:35:42,120 --> 00:35:44,073
So the document is updated,

863
00:35:45,570 --> 00:35:48,780
the embedding should be
regenerated, but the context

864
00:35:48,780 --> 00:35:50,960
be lost, right.
- Yeah, you,

865
00:35:50,960 --> 00:35:52,440
if I get your question right is like,

866
00:35:52,440 --> 00:35:54,630
if I'm continuing on a
chat and I wanna search

867
00:35:54,630 --> 00:35:56,010
more and more things,

868
00:35:56,010 --> 00:35:58,590
you just have to keep passing the context

869
00:35:58,590 --> 00:36:00,300
in of the previous stuff.

870
00:36:00,300 --> 00:36:02,310
- Yeah.
- So you do start getting

871
00:36:02,310 --> 00:36:05,100
a longer and longer context
window that happens there.

872
00:36:05,100 --> 00:36:07,950
And I don't have a good answer for you

873
00:36:07,950 --> 00:36:11,700
on seeing if we can slim that down at all.

874
00:36:11,700 --> 00:36:13,320
I think you'll see like even in Kiro,

875
00:36:13,320 --> 00:36:15,270
and some of the newer systems
out there, they start,

876
00:36:15,270 --> 00:36:17,520
they'll hit a limit and then
they'll summarize for you

877
00:36:17,520 --> 00:36:20,790
and try to push that
off to something else.

878
00:36:20,790 --> 00:36:22,350
So those are kind of the patterns

879
00:36:22,350 --> 00:36:24,960
that have come into play these days.

880
00:36:24,960 --> 00:36:27,750
Until someone smarter than I comes up with

881
00:36:27,750 --> 00:36:29,670
a better pattern for that.

882
00:36:29,670 --> 00:36:33,093
- Okay, thanks.
- Other questions?

883
00:36:35,323 --> 00:36:36,156
- [Steven] All right.

884
00:36:36,156 --> 00:36:38,910
The last little bit of
this is just the cleanup.

885
00:36:38,910 --> 00:36:42,480
So we've gone through again
the stages, we've ingested,

886
00:36:42,480 --> 00:36:43,620
we've queried.

887
00:36:43,620 --> 00:36:48,620
Now, as we mentioned, we've
got a TTL system, right?

888
00:36:48,690 --> 00:36:51,120
So whenever the TTL triggers,

889
00:36:51,120 --> 00:36:52,500
we've gotta go back and make sure,

890
00:36:52,500 --> 00:36:54,480
because we're a custom store,

891
00:36:54,480 --> 00:36:56,820
there's nothing going on
that specifically tells us

892
00:36:56,820 --> 00:36:58,500
to clean up all that information.

893
00:36:58,500 --> 00:37:00,330
So we've actually gotta go in

894
00:37:00,330 --> 00:37:03,360
and extract out the file information

895
00:37:03,360 --> 00:37:06,210
and everything like that
from the TTL trigger.

896
00:37:06,210 --> 00:37:07,720
So in the Dynamo database

897
00:37:08,580 --> 00:37:10,440
basically there's a
couple of things in there.

898
00:37:10,440 --> 00:37:13,410
It's the file ID, the
data source that it's in,

899
00:37:13,410 --> 00:37:15,180
the knowledge base that it's in

900
00:37:15,180 --> 00:37:17,820
and we're gonna use that information

901
00:37:17,820 --> 00:37:19,830
and we're going to extract it out

902
00:37:19,830 --> 00:37:23,430
and delete those records
from the knowledge base.

903
00:37:23,430 --> 00:37:26,010
And again, in this particular spot

904
00:37:26,010 --> 00:37:29,640
we don't really have to care
what knowledge base it is,

905
00:37:29,640 --> 00:37:30,930
we're just giving it a command

906
00:37:30,930 --> 00:37:33,000
and it figures out what that needs to be

907
00:37:33,000 --> 00:37:34,770
and goes off and deletes it.

908
00:37:34,770 --> 00:37:39,770
So I am going to grab
that chunk of code here,

909
00:37:43,170 --> 00:37:45,960
and it's a rather large chunk of code

910
00:37:45,960 --> 00:37:48,153
so I'm not gonna type it in here.

911
00:37:50,100 --> 00:37:50,933
Sorry, one second.

912
00:37:50,933 --> 00:37:51,930
- [Mike] While you're doing that, I mean,

913
00:37:51,930 --> 00:37:53,700
when Steven showed this to me,

914
00:37:53,700 --> 00:37:55,770
I thought this was one
of the more clever parts

915
00:37:55,770 --> 00:37:56,850
of the solution because,

916
00:37:56,850 --> 00:37:59,771
the time to live is a
really important problem

917
00:37:59,771 --> 00:38:01,710
and you can't just have a single rule

918
00:38:01,710 --> 00:38:04,260
for all of your documents.

919
00:38:04,260 --> 00:38:05,280
Like how do you manage that?

920
00:38:05,280 --> 00:38:09,150
So, you know, keeping a
record of that index in Dynamo

921
00:38:09,150 --> 00:38:10,860
and then using the Dynamo DB stream

922
00:38:10,860 --> 00:38:12,930
to essentially trigger that action,

923
00:38:12,930 --> 00:38:14,160
gives you a lot of flexibility,

924
00:38:14,160 --> 00:38:16,590
'cause you can use the built-in
time to live within Dynamo

925
00:38:16,590 --> 00:38:19,200
or you could delete the record manually

926
00:38:19,200 --> 00:38:20,940
if there's like a right to forget,

927
00:38:20,940 --> 00:38:23,580
or if you're trying to expire
a document, like you said,

928
00:38:23,580 --> 00:38:25,230
you just delete the record in Dynamo

929
00:38:25,230 --> 00:38:26,940
and it will just flow
through the whole system.

930
00:38:26,940 --> 00:38:29,820
- [Steven] Yeah, so I
was a little off there.

931
00:38:29,820 --> 00:38:32,070
It's not a super large chunk of code.

932
00:38:32,070 --> 00:38:35,400
But this is definitely, as I mentioned,

933
00:38:35,400 --> 00:38:37,740
all I have to keep track
of in the Dynamo database

934
00:38:37,740 --> 00:38:39,930
is the knowledge base it's coming from,

935
00:38:39,930 --> 00:38:41,550
the data source it's coming from,

936
00:38:41,550 --> 00:38:44,250
and the file ID that I wanna remove.

937
00:38:44,250 --> 00:38:46,740
Technically I could probably
put some extra parameters

938
00:38:46,740 --> 00:38:48,750
in here if I want to be
very bespoke about like

939
00:38:48,750 --> 00:38:50,370
the tenant ID and things like that,

940
00:38:50,370 --> 00:38:51,300
and make sure we're going through.

941
00:38:51,300 --> 00:38:53,760
But for deleting from a knowledge base

942
00:38:53,760 --> 00:38:55,260
really just needs the file ID,

943
00:38:55,260 --> 00:38:57,300
from wherever the data source was.

944
00:38:57,300 --> 00:39:00,540
So I'm passing in that file
ID and then it's going off

945
00:39:00,540 --> 00:39:02,310
and deleting it out of
whatever knowledge base.

946
00:39:02,310 --> 00:39:05,550
So it handles the create and
the query and things like that.

947
00:39:05,550 --> 00:39:08,520
That said, it's just deleting
out of the vector store,

948
00:39:08,520 --> 00:39:11,040
it's not deleting out of
the storage underlying.

949
00:39:11,040 --> 00:39:13,413
So these are separated off systems

950
00:39:13,413 --> 00:39:14,820
that we're dealing with too.

951
00:39:14,820 --> 00:39:17,310
So I've still got files
sitting there in S3

952
00:39:17,310 --> 00:39:20,850
that I could re-ingest
later if I really needed to.

953
00:39:20,850 --> 00:39:25,850
But I'm just not taking out all the use

954
00:39:26,463 --> 00:39:28,380
of those particular
knowledge stores, or sorry,

955
00:39:28,380 --> 00:39:30,123
vector stores as well.

956
00:39:31,650 --> 00:39:33,180
So that kind of ties it up

957
00:39:33,180 --> 00:39:34,830
where we've gone through all the stages,

958
00:39:34,830 --> 00:39:36,300
we cleaned up the data,

959
00:39:36,300 --> 00:39:39,060
and now the users are hopefully happy

960
00:39:39,060 --> 00:39:42,690
because they've got a better
utilization of their system.

961
00:39:42,690 --> 00:39:45,600
Hopefully their costs are
going down a little bit.

962
00:39:45,600 --> 00:39:48,000
But I would love to
hear from everybody too,

963
00:39:48,000 --> 00:39:50,550
like what vector stores
is everybody else using,

964
00:39:50,550 --> 00:39:54,870
or did we kind of peg it with
the Postgres, OpenSearch?

965
00:39:54,870 --> 00:39:58,050
Has anybody started using S3 Vector yet?

966
00:39:58,050 --> 00:39:59,613
So one person.
- Couple here.

967
00:40:00,630 --> 00:40:03,300
- [Steven] Has anybody
found it useful and good

968
00:40:03,300 --> 00:40:04,530
compared to others?

969
00:40:04,530 --> 00:40:05,700
Yeah?

970
00:40:05,700 --> 00:40:07,322
Okay.

971
00:40:07,322 --> 00:40:09,210
I think the, when the cloud formation

972
00:40:09,210 --> 00:40:10,530
kind of catches up on that,

973
00:40:10,530 --> 00:40:12,297
we're hoping that people
will start really kicking in

974
00:40:12,297 --> 00:40:13,560
and using those things.

975
00:40:13,560 --> 00:40:16,073
- [Mike] Any other vector
stores that you're using?

976
00:40:21,810 --> 00:40:23,349
- [Audience Member] Well
I had more of a question,

977
00:40:23,349 --> 00:40:24,270
basically.
- Yeah, go.

978
00:40:24,270 --> 00:40:25,290
- [Audience Member] We use
OpenSearch Serverless and

979
00:40:27,005 --> 00:40:28,860
one of the major issues
that we are basically having

980
00:40:28,860 --> 00:40:31,590
is that in the listing of the documents

981
00:40:31,590 --> 00:40:35,430
within the data source, if
we use open server list,

982
00:40:35,430 --> 00:40:38,460
what's happening is
that the API that we use

983
00:40:38,460 --> 00:40:41,010
from internal services
to query the database,

984
00:40:41,010 --> 00:40:43,560
that kind of times out if you have like

985
00:40:43,560 --> 00:40:46,560
even greater than like 10
documents or something.

986
00:40:46,560 --> 00:40:48,360
So is there like a workaround we can use

987
00:40:48,360 --> 00:40:51,690
to kind of pre-filter the
knowledge base so that, you know,

988
00:40:51,690 --> 00:40:54,210
we retrieve results in, you know,

989
00:40:54,210 --> 00:40:55,563
less than 10 seconds or so?

990
00:40:57,630 --> 00:40:58,590
- [Mike] You can hold on to that.

991
00:40:58,590 --> 00:41:00,150
I have some follow-up questions for you.

992
00:41:00,150 --> 00:41:02,430
What type of metadata do
you have on the documents?

993
00:41:02,430 --> 00:41:05,700
- [Audience Member] So it's
basically like file ID mainly,

994
00:41:05,700 --> 00:41:08,570
and then, you know, we
have the agent ID in there

995
00:41:08,570 --> 00:41:09,990
to kind of know,

996
00:41:09,990 --> 00:41:12,600
like this is the file
that we need to query.

997
00:41:12,600 --> 00:41:13,500
- Yep.
- Get the results

998
00:41:13,500 --> 00:41:16,320
and that works perfectly.

999
00:41:16,320 --> 00:41:17,910
The major issue that we are having is like

1000
00:41:17,910 --> 00:41:20,130
when we have the user
interface for the customer

1001
00:41:20,130 --> 00:41:21,930
to see the file that they've ingested

1002
00:41:21,930 --> 00:41:24,810
into the knowledge space,
that's where it times out.

1003
00:41:24,810 --> 00:41:27,390
Because the pagination is like,

1004
00:41:27,390 --> 00:41:30,600
it happens very weirdly,
like it's super slow.

1005
00:41:30,600 --> 00:41:32,880
So is there like a
workaround that we can use

1006
00:41:32,880 --> 00:41:34,560
to when we are, you know,

1007
00:41:34,560 --> 00:41:35,850
listing the knowledge base documents,

1008
00:41:35,850 --> 00:41:37,800
is there like a metadata that we can pass

1009
00:41:37,800 --> 00:41:41,970
to kind of pre-filter the
documents, so that's maybe faster?

1010
00:41:41,970 --> 00:41:44,580
- [Steven] Yeah so, it
sounds a little bit more like

1011
00:41:44,580 --> 00:41:46,860
OpenSearch specific type of question.

1012
00:41:46,860 --> 00:41:48,920
- Exactly, yeah.
- I would love to get you

1013
00:41:48,920 --> 00:41:50,820
set with an OpenSearch specialist,

1014
00:41:50,820 --> 00:41:52,623
if you haven't talked to one so far.

1015
00:41:53,880 --> 00:41:55,920
- But see, in your demo-
- It sounds like though,

1016
00:41:55,920 --> 00:41:58,590
I mean if you went behind
like a Bedrock knowledge base

1017
00:41:58,590 --> 00:41:59,640
and you used something like this,

1018
00:41:59,640 --> 00:42:04,470
then you could maybe get the
users to try to track down,

1019
00:42:04,470 --> 00:42:07,320
or have like different
sets of files that are,

1020
00:42:07,320 --> 00:42:09,840
or documents that they're looking at.

1021
00:42:09,840 --> 00:42:12,060
I think one thing that we've noticed is,

1022
00:42:12,060 --> 00:42:14,550
knowledge bases can get really big,

1023
00:42:14,550 --> 00:42:17,910
and the stuff that individual
people wanna look at

1024
00:42:17,910 --> 00:42:21,180
is like maybe 10% of the overall.

1025
00:42:21,180 --> 00:42:24,300
So you could segment it
down to by department,

1026
00:42:24,300 --> 00:42:25,740
or by something like that, right?

1027
00:42:25,740 --> 00:42:27,720
So putting in some of that metadata

1028
00:42:27,720 --> 00:42:29,910
so you could filter it down that way

1029
00:42:29,910 --> 00:42:32,940
before you start to do
the retrieve and generate,

1030
00:42:32,940 --> 00:42:34,500
might help you out on that.

1031
00:42:34,500 --> 00:42:35,910
- [Audience Member] So
a follow up on that.

1032
00:42:35,910 --> 00:42:39,300
So let's say since it's
a multi-gen system,

1033
00:42:39,300 --> 00:42:41,190
and I think there's like
an upper limit or quota

1034
00:42:41,190 --> 00:42:43,560
for like the number of
knowledge bases that we can have

1035
00:42:43,560 --> 00:42:46,320
in a single account versus
the number of data sources.

1036
00:42:46,320 --> 00:42:48,420
So how we kind of tackle that, I guess.

1037
00:42:48,420 --> 00:42:49,980
So we run into a bottleneck eventually

1038
00:42:49,980 --> 00:42:51,560
in terms of scaling, right?

1039
00:42:51,560 --> 00:42:53,520
That's the main issue, I guess.

1040
00:42:53,520 --> 00:42:56,820
- [Mike] And it, how Steven
addressed that in his demo is,

1041
00:42:56,820 --> 00:42:59,640
he kept that record of files in Dynamo.

1042
00:42:59,640 --> 00:43:00,473
- Right?
- So if you're just

1043
00:43:00,473 --> 00:43:02,340
listing the files, it's
not actually hitting

1044
00:43:02,340 --> 00:43:04,871
the knowledge base or OpenSearch.

1045
00:43:04,871 --> 00:43:05,704
- Right.
- Just hitting

1046
00:43:05,704 --> 00:43:06,870
Dynamo instead.

1047
00:43:06,870 --> 00:43:09,360
And then the tenant ID,

1048
00:43:09,360 --> 00:43:10,920
you don't have a
knowledge base for tenant,

1049
00:43:10,920 --> 00:43:14,823
you do the segmentation
using the metadata on the-

1050
00:43:15,780 --> 00:43:17,490
- [Audience Member] Yeah so
maybe like, I think, I guess,

1051
00:43:17,490 --> 00:43:20,100
moving to a Dynamo DB base
like file information,

1052
00:43:20,100 --> 00:43:21,813
or something that could help us, I guess.

1053
00:43:21,813 --> 00:43:23,250
- [Steven] Yeah if you're just tracking

1054
00:43:23,250 --> 00:43:24,900
peer file information stuff,

1055
00:43:24,900 --> 00:43:27,180
I would say OpenSearch is maybe not,

1056
00:43:27,180 --> 00:43:30,333
like OpenSearch is really good
at what it does, but it's,

1057
00:43:31,650 --> 00:43:35,100
if you're just querying
out flat based information,

1058
00:43:35,100 --> 00:43:37,260
Dynamo's probably gonna
be a good spot to put in,

1059
00:43:37,260 --> 00:43:38,550
and it'll alleviate some of the load

1060
00:43:38,550 --> 00:43:40,800
on your OpenSearch as well,
so you don't have to like

1061
00:43:40,800 --> 00:43:42,540
increase the size of your cluster at all.

1062
00:43:42,540 --> 00:43:45,090
- [Audience Member] All
right, thank you so much.

1063
00:43:45,090 --> 00:43:45,923
- [Mike] Good question.

1064
00:43:45,923 --> 00:43:46,790
I'll be right over.

1065
00:43:59,340 --> 00:44:02,610
- [Audience Member] So in
term of Vector DB, a year ago,

1066
00:44:02,610 --> 00:44:07,610
before starting using KB,
we were using MongoDB Atlas.

1067
00:44:09,030 --> 00:44:11,820
Find out that the LM wasn't
very good to do a text

1068
00:44:11,820 --> 00:44:14,460
to a Mongo query, so we have a few issues.

1069
00:44:14,460 --> 00:44:17,370
And so since now we are using OpenSearch

1070
00:44:17,370 --> 00:44:19,710
and not Alphabet Postgre.

1071
00:44:19,710 --> 00:44:22,890
But we still have a footprint
on Mongo and so I'm,

1072
00:44:22,890 --> 00:44:26,490
but we're doing like normal
rack without KB anything.

1073
00:44:26,490 --> 00:44:31,490
So I'm wondering if we
could use KB with Mongo

1074
00:44:31,800 --> 00:44:32,633
at some point.

1075
00:44:33,870 --> 00:44:35,610
- [Steven] I, we just checked this too,

1076
00:44:35,610 --> 00:44:37,890
I don't know if Mongo is on the list.

1077
00:44:37,890 --> 00:44:39,473
I'd have to get back to you.

1078
00:44:39,473 --> 00:44:43,980
I'm not sure if Mongo's on the
Bedrock knowledge base list

1079
00:44:43,980 --> 00:44:47,700
of Vector store or support.

1080
00:44:47,700 --> 00:44:51,630
But if it was, then it would
be, yes, you could do that.

1081
00:44:51,630 --> 00:44:52,560
And it would just generate

1082
00:44:52,560 --> 00:44:54,240
the queries and everything for you.

1083
00:44:54,240 --> 00:44:55,470
- [Mike] I told 'em they'd stump us.

1084
00:44:55,470 --> 00:44:56,847
- [Steven] Yeah, I know.

1085
00:44:56,847 --> 00:44:59,130
And it's funny, I was just
looking over these things,

1086
00:44:59,130 --> 00:45:01,280
like I know someone's
gonna ask about that.

1087
00:45:09,600 --> 00:45:11,250
- [Audience Member] We've
been interested in using

1088
00:45:11,250 --> 00:45:15,540
Neptune Analytics just for
general like knowledge graph,

1089
00:45:15,540 --> 00:45:18,210
but also some, a little
bit of vector storage,

1090
00:45:18,210 --> 00:45:20,190
'cause I think there's that feature

1091
00:45:20,190 --> 00:45:22,110
within Neptune Analytics.

1092
00:45:22,110 --> 00:45:25,290
How have you found the integration
between knowledge bases

1093
00:45:25,290 --> 00:45:26,640
with other vector stores?

1094
00:45:26,640 --> 00:45:28,650
Like is there a little more customization

1095
00:45:28,650 --> 00:45:31,353
that needs to be done for Neptune?

1096
00:45:34,320 --> 00:45:36,680
- [Steven] I haven't seen too many.

1097
00:45:36,680 --> 00:45:41,250
Like I know, like Neptune
Vectors is, or is,

1098
00:45:41,250 --> 00:45:42,330
I wouldn't say new.

1099
00:45:42,330 --> 00:45:43,470
It's been around for a little bit.

1100
00:45:43,470 --> 00:45:45,060
- Newish, yeah.
- But, yeah, newish.

1101
00:45:45,060 --> 00:45:48,120
So I haven't personally come across

1102
00:45:48,120 --> 00:45:51,390
too many that are mixing
those together, so.

1103
00:45:51,390 --> 00:45:55,200
But I mean, when you're
setting up the data sources

1104
00:45:55,200 --> 00:45:57,480
to the knowledge base through Bedrock,

1105
00:45:57,480 --> 00:45:59,760
it's pretty much the
same configuration stuff

1106
00:45:59,760 --> 00:46:01,590
that you would do for like

1107
00:46:01,590 --> 00:46:03,990
whatever vector store
that you're gonna go to.

1108
00:46:03,990 --> 00:46:06,180
You have a lot of the knobs and dials

1109
00:46:06,180 --> 00:46:07,013
that you're gonna tweak.

1110
00:46:07,013 --> 00:46:11,370
So I would say, if you're
tweaking through without it,

1111
00:46:11,370 --> 00:46:13,920
then you're probably gonna
be doing the same thing

1112
00:46:13,920 --> 00:46:14,970
through the knowledge base.

1113
00:46:14,970 --> 00:46:18,630
You're just saving the switching
between the knowledge bases

1114
00:46:18,630 --> 00:46:21,180
and having to rewrite
queries and things like that.

1115
00:46:22,440 --> 00:46:24,570
It'd be interesting question
to the knowledge base team

1116
00:46:24,570 --> 00:46:27,720
to see how they're doing the
performance enhancing, right?

1117
00:46:27,720 --> 00:46:29,640
'Cause they're gonna be
doing the queries for you

1118
00:46:29,640 --> 00:46:31,203
into the knowledge store.

1119
00:46:32,070 --> 00:46:33,870
So it'd be very interesting to see like

1120
00:46:33,870 --> 00:46:36,960
if you're finding that you're
having performance issues

1121
00:46:36,960 --> 00:46:38,370
or anything like that.

1122
00:46:38,370 --> 00:46:40,470
I'd love to get like
that team in front of it

1123
00:46:40,470 --> 00:46:42,660
and see how they are doing those queries

1124
00:46:42,660 --> 00:46:45,480
and like what data
specifically you're using.

1125
00:46:45,480 --> 00:46:49,983
So maybe bump into me after
this and we can figure that out.

1126
00:46:51,780 --> 00:46:52,780
- [Mike] Any others?

1127
00:46:56,220 --> 00:46:58,020
- [Steven] All good, yeah?

1128
00:46:58,020 --> 00:47:01,350
- [Mike] I think if there
are no more questions,

1129
00:47:01,350 --> 00:47:02,400
we've solved everything.

1130
00:47:02,400 --> 00:47:05,190
We've solved every problem,
so that's good to hear.

1131
00:47:05,190 --> 00:47:06,540
Really appreciate you taking the time.

1132
00:47:06,540 --> 00:47:09,750
Make sure to put the feedback in the app

1133
00:47:09,750 --> 00:47:12,690
and I think we're
probably between everyone

1134
00:47:12,690 --> 00:47:13,523
and lunch as well,

1135
00:47:13,523 --> 00:47:15,120
so letting out a couple of minutes early

1136
00:47:15,120 --> 00:47:15,953
is not the end of the world.

1137
00:47:15,953 --> 00:47:17,463
So thanks everyone for attending.

