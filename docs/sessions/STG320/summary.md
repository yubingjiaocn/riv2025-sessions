# AWS re:Invent 2025 EBS GP3 优化会议总结

## 会议概述

本次会议由AWS弹性块存储(EBS)团队的首席软件工程师Dutch Meyer和首席产品经理Sapna Gupta主讲,重点介绍如何充分利用GP3卷的性能和成本优化策略。

GP3是AWS EBS服务中使用最广泛的卷类型,被设计为适用于最广泛工作负载的默认选择。会议深入探讨了GP3的核心优势——解耦的性能和容量配置,这使得用户可以独立调整IOPS、吞吐量和存储容量,而不像GP2那样将性能与容量绑定在一起。演讲者详细解释了EBS如何通过分片技术将多样化的客户需求转化为统一的服务体验,以及如何通过监控延迟直方图、使用队列深度控制性能等方法来优化存储系统。

会议还介绍了最新的GP3性能提升(容量提升4倍至64TB,IOPS提升5倍至80,000),以及如何使用弹性卷(Elastic Volumes)功能动态调整卷配置。通过VMware Carbon Black的实际案例,展示了从GP2迁移到GP3后实现20%存储成本节省和50个EC2实例减少的显著效果。演讲强调了存储优化不是追求最大性能,而是在IOPS、吞吐量、容量和延迟之间找到适合工作负载的平衡点。

## 详细时间线与关键要点

### 开场介绍 (00:00 - 02:30)
- **00:00** - Dutch Meyer介绍自己是AWS EBS的首席软件工程师,Sapna Gupta是首席产品经理
- **00:45** - 说明GP3是EBS服务中最常见的卷类型,被设计为适用最广泛工作负载的通用选择
- **01:30** - 概述会议议程:Dutch讲解IO路径、存储基础、耦合vs解耦存储、性能监控;Sapna讲解卷演进和成本优化

### 存储优化理念 (02:30 - 05:00)
- **02:30** - 强调优化的系统不是运行最快的系统,而是在IOPS、吞吐量、容量和延迟之间达到平衡的系统
- **03:15** - 介绍GP3的性能范围:从1GB到64TB,IOPS从基准到80,000,吞吐量最高1,000 MB/s
- **04:00** - 宣布最近的性能提升:容量提升4倍,IOPS提升5倍

### 分片技术与解耦存储 (05:00 - 10:00)
- **05:00** - 解释EBS如何通过分片技术将大范围的GP3特性转化为较小的分片特性集
- **06:30** - 阐述解耦存储的核心概念:GP3允许独立购买性能和容量,而GP2将两者绑定
- **08:00** - 说明EBS如何将同质化的物理硬件舰队转化为解耦的存储服务
- **09:00** - 强调客户精确指定所需IOPS可以帮助AWS更好地进行舰队配置,降低整体成本

### 性能提升策略 (10:00 - 12:00)
- **10:00** - 解释为什么不通过简单增加分片数量来提升性能,而是提升每个分片的性能
- **11:00** - 说明增加分片会增加硬件故障影响的概率,因此选择提升分片性能本身

### GP2 vs GP3对比 (12:00 - 14:00)
- **12:00** - 对比GP2的耦合性能(容量和性能绑定)与GP3的解耦性能
- **13:00** - 强调GP3的成本优势:可以根据工作负载独立扩展IOPS或容量
- **13:30** - 说明不同工作负载策略:事务处理需要更多IOPS,大吞吐量需要更大块大小

### 延迟性能 (14:00 - 17:00)
- **14:00** - 介绍GP3的延迟特性:单位数毫秒级,99%合规性
- **15:00** - 对比IO2的亚毫秒级延迟和更严格的一致性(800微秒以上IO操作发生率比GP3低10倍)
- **16:00** - 强调延迟体验在整个GP3范围内保持一致,无论IOPS或吞吐量如何

### 队列深度与性能关系 (17:00 - 22:00)
- **17:00** - 介绍核心公式:延迟 = 队列深度 / IOPS(基本排队理论)
- **18:00** - 举例说明:当定时任务同时触发时,队列深度增加,IOPS上升,延迟保持恒定直到达到IOPS上限
- **19:00** - 建议将定时任务错开启动时间,避免整点IOPS峰值
- **20:00** - 强调客户可以通过控制队列深度来控制延迟
- **21:00** - 介绍新的CloudWatch指标(2024年10月发布)用于监控节流、吞吐量和延迟
- **21:30** - 提供经验法则:16K块大小时,每1000 IOPS需要1个队列深度,对应1毫秒延迟

### 延迟监控 (22:00 - 27:00)
- **22:00** - 介绍监控工具:CloudWatch指标、NVMe CLI
- **22:30** - 详细讲解延迟直方图的使用方法
- **23:00** - 展示实际延迟直方图示例,解释如何读取:X轴为延迟(微秒),Y轴为IO操作数量
- **24:00** - 说明如何分析直方图:查看峰值位置、偏斜方向、曲线宽度(性能变异性)
- **25:00** - 解释IO2卷的直方图会向左偏移(更快)且更窄(更一致)
- **26:00** - 说明性能问题通常表现为高延迟段出现新的峰值

### SSD物理特性与延迟异常值 (27:00 - 32:00)
- **27:00** - 介绍NVMe CLI工具和CloudWatch直方图指标
- **27:30** - 深入讲解SSD物理结构:存储单元可能损坏,需要重新映射
- **28:30** - 说明当SSD检测到坏单元时,需要移动数据,导致10-100微秒的延迟事件
- **29:30** - 强调这是所有存储系统的固有特性,无法避免
- **30:00** - 解释EBS如何通过监控和路由数据到其他服务器来处理这些异常,而不是直接传递给客户

### 高延迟响应策略 (32:00 - 36:00)
- **32:00** - 讨论当复制对等节点响应慢(500微秒无响应)时的处理策略
- **33:00** - 说明重试通常不是正确答案,因为EBS是延迟敏感型产品
- **34:00** - 介绍读写对冲(hedging)技术:主动向对等节点发起并行请求,采用最快返回的结果
- **35:00** - 强调没有通用答案,需要根据工作负载特性选择策略
- **35:30** - 介绍AWS故障注入服务(FIS)的EBS延迟事件注入功能,用于测试系统对延迟异常的响应

### Dutch总结 (36:00 - 38:00)
- **36:00** - 总结要点:耦合vs解耦扩展、使用队列深度控制延迟、使用直方图监控延迟
- **37:00** - 强调使用故障注入服务测试系统对高延迟的响应
- **37:30** - 说明如何通过这些技术在底层介质之上构建产品体验,并在Prime Day等高峰期保持SLA

### Sapna接手:卷演进 (38:00 - 42:00)
- **38:00** - Sapna介绍将讲解如何演进卷以优化价格和性能
- **38:30** - 说明两种方法:从高性能开始逐步降低,或从基准性能开始逐步提升
- **39:30** - 重申GP3的广泛范围:1GB-64TB,最高80,000 IOPS,1,000 MB/s吞吐量
- **40:30** - 说明GP3的高限制减少了条带化(striping)的复杂性需求
- **41:00** - 强调可以短期提升性能(几天或几个月),然后降回,只为实际使用付费

### 弹性卷(Elastic Volumes) (42:00 - 46:00)
- **42:00** - 介绍弹性卷(EV)功能:动态增加容量、IOPS和吞吐量
- **42:30** - 说明三种操作:更改卷类型(GP2到GP3或GP3到IO2)、调整性能、调整容量
- **43:00** - 警告:容量只能增加不能减少
- **43:30** - 介绍最佳实践步骤:1)创建快照 2)请求修改 3)监控进度 4)扩展文件系统
- **44:30** - 强调扩展文件系统的重要性:确保EC2实例识别新的容量大小
- **45:00** - 展示修改方法:AWS CLI、PowerShell脚本、控制台
- **45:30** - 说明如何在控制台监控修改状态:"optimizing"表示正在过渡到新限制

### 后台修改过程 (46:00 - 48:00)
- **46:00** - 解释后台发生的事情:EBS每天处理数十万修改请求
- **47:00** - 说明EBS会检查原服务器(服务器A)是否有足够容量支持新性能
- **47:30** - 如果没有,会将卷迁移到新服务器(服务器B),对客户透明无感知

### 弹性卷的限制 (48:00 - 50:00)
- **48:00** - 列举三个主要限制:1)容量单向调整(只能增加) 2)两次修改之间有6小时等待时间 3)某些旧EC2实例可能需要重启或运行OS命令
- **49:00** - 解释6小时等待时间是为了确保卷完整性和一致性能

### 客户案例:VMware Carbon Black (50:00 - 56:00)
- **50:00** - 介绍VMware Carbon Black:网络安全领域领导者,专注端点检测和下一代防病毒
- **50:30** - 说明其规模:每秒处理数百万请求,延迟至关重要
- **51:00** - 展示架构:使用EBS作为高速卷,通过EKS集群处理、排序和压缩数百万记录
- **52:00** - 描述挑战:使用GP2时,为获得3,000 IOPS需要支付额外960GB存储,或使用突发性能但会被节流
- **53:00** - 说明节流导致集群不必要地扩展EC2节点
- **53:30** - 解决方案:迁移到GP3,获得保证的3,000 IOPS而无需为未使用的存储付费
- **54:00** - 成果:存储成本直接节省20%,EC2实例减少50个,每月总计节省25,000美元
- **55:00** - 展示图表:迁移到GP3后EC2实例数量明显下降
- **55:30** - 客户引言总结迁移带来的一致性能和成本节省

### 会议结束 (56:00)
- **56:00** - 会议内容在此处截断(字幕未完整)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


关键要点总结:
- GP3通过解耦性能和容量提供灵活的成本优化
- 延迟 = 队列深度 / IOPS 是存储性能的核心公式
- 使用延迟直方图是监控存储性能的最佳方法
- 弹性卷允许动态调整配置,但容量只能增加不能减少
- 实际案例显示GP3可带来20-25%的成本节省