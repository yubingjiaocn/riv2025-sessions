# DEV 415: 使用A2A和MCP构建可扩展的自编排AI工作流

## 会议概述

本次会议是AWS re:Invent 2025的400级技术分享，由AWS开发者倡导者Gunnar Grosch和AWS无服务器英雄、Momento生态系统工程师Allen Helton共同主讲。会议重点介绍了如何使用Agent-to-Agent协议(A2A)和模型上下文协议(MCP)构建自主的多智能体系统，通过编排而非集中控制来实现可扩展的AI工作流。

演讲者通过Swift Ship物流公司的实际案例，展示了从单一智能体到多智能体协作的完整架构演进。会议强调了在非确定性的生成式AI环境中实现确定性协调的重要性，并详细阐述了智能体循环(Agent Loop)的四个核心阶段：组合(Compose)、查询(Query)、执行(Execute)和继续循环决策。整个系统基于AWS Lambda、Bedrock AgentCore和Momento构建，实现了微服务架构模式在AI智能体领域的应用。

## 详细时间线与关键要点

### 0:00-5:00 会议开场与背景介绍
- 介绍演讲者和会议主题：使用A2A和MCP构建可扩展的自编排AI工作流
- 强调这是400级会议，假设听众具备AWS基础知识
- 概述会议内容：自编排系统设计、A2A协议、MCP、AgentCore和Lambda的应用

### 5:00-10:00 生成式AI的挑战与解决方案
- 分析生成式AI不遵循线性剧本的特性，每次调用可能产生不同路径
- 对比编排(Orchestration)与编排(Choreography)的优劣
- 强调"没有规则的自主就是混乱"，需要在非确定性范式中实现确定性协调
- 介绍多智能体协作的必要性和挑战

### 10:00-15:00 第一个演示：单智能体基线
- 展示Swift Ship物流公司的最后一公里配送场景
- 演示司机报告配送失败后，系统自动重新安排配送的简单工作流
- 强调这是"最无聊"但基础的智能体工作流示例
- 为后续多智能体协作建立理解基础

### 15:00-25:00 技术基础架构详解
- **A2A协议**：智能体通过发布智能体卡片实现相互发现和协作，每个智能体通过Lambda函数URL暴露HTTP端点
- **MCP(模型上下文协议)**：为智能体提供标准化的工具、上下文和数据访问方式，确保所有交互遵循模式
- **核心服务**：Lambda(弹性和隔离)、Bedrock AgentCore(内存和可观测性)、Momento(快速协调层和轻量级状态)

### 25:00-35:00 智能体类型与模型选择
- 区分聊天机器人、工具增强智能体和自主智能体的差异
- 介绍自主智能体的架构：API Gateway → Lambda → DynamoDB → EventBridge → 智能体
- 详解监督者(Supervisor)和工作者(Worker)智能体的不同需求：
  - 监督者：需要全局推理、依赖解析、多步规划能力，使用Nova Pro、Sonnet等高推理能力模型
  - 工作者：需要快速、便宜、确定性执行，使用Nova Canvas、Haiku等轻量级模型

### 35:00-45:00 智能体循环(Agent Loop)详解
- **组合阶段(Compose)**：通过MCP工具加载类型化上下文，从AgentCore内存重建任务状态，使用RISEN框架构建系统提示
- **查询阶段(Query)**：调用Bedrock模型获取结构化输出，根据智能体类型选择合适的模型
- **执行阶段(Execute)**：将模型输出转换为实际系统操作，支持本地更新或A2A智能体调用
- **循环决策**：判断工作流是否完成，决定是否继续下一次迭代

### 45:00-50:00 多智能体协作演示
- 展示包裹严重损坏的复杂场景处理
- 演示分诊智能体如何协调支付智能体、仓库智能体和订单智能体
- 展示实时智能体协作过程，虽然演示中出现数据重置问题，但体现了智能体的非确定性特征
- 介绍基于域的智能体设计：避免"单体智能体"，每个智能体专注特定领域

### 50:00-56:00 代码实现与总结
- 展示智能体卡片、系统提示、工具定义的具体代码实现
- 演示A2A客户端如何实现智能体间通信
- 强调关键设计原则：
  - 智能体驱动系统而非工作流
  - A2A实现运行时发现和协作
  - MCP确保上下文可靠性
  - 确定性设计防止系统混乱
- 提供GitHub代码库供参会者实验和贡献