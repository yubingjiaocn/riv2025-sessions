# AWS re:Invent 2025 - 使用 ElastiCache 构建视频采样和搜索应用

## 会议概述

本次技术会议由 AWS ElastiCache 团队的两位首席工程师 Ela 和 Kevin 主讲，重点介绍了如何使用 ElastiCache 的 Valkey 引擎进行向量相似性搜索（VSS）。会议通过构建一个完整的视频采样和搜索应用来演示 Valkey 的向量搜索能力，该应用能够处理视频帧的去重、多模态分析，并支持文本和图像的语义搜索。

演讲者详细解释了 Valkey 向量搜索的工作原理，包括其在哈希映射和 JSON 文档上的操作方式，以及同步 API 的优势。会议还涵盖了扩展策略，说明了如何通过增加分片来提高数据存储和摄取速率，通过增加副本来提高查询吞吐量。整个演示展示了从视频上传、帧提取、嵌入生成到最终搜索的完整工作流程。

## 详细时间线与关键要点

### 0:00-5:00 - 向量相似性搜索基础
- Ela 介绍 Valkey 向量相似性搜索（VSS）的工作原理
- VSS 支持哈希映射和 JSON 文档两种数据类型
- 索引定义和模式配置的重要性
- 同步 API 的优势：支持"读取自己的写入"操作

### 5:00-10:00 - Valkey 扩展架构
- 摄取过程：通过增加分片提高数据存储和摄取速率
- 搜索过程：需要扇出到所有分片，不会因分片增加而提高吞吐量
- 扩展策略：增加副本提高查询吞吐量，升级实例类型提高性能
- 专用工作线程的高效核心利用

### 10:00-15:00 - 应用架构概述
- 视频采样和搜索应用的整体架构
- 摄取管道：视频上传、帧提取、嵌入生成
- 查询功能：支持文本和图像搜索
- 使用基础模型（Amazon Titan）生成嵌入向量

### 15:00-25:00 - 去重和多模态分析
- 去重流程：通过相似性检测避免重复帧处理
- 多模态分析：分类、标签化、摘要生成
- 嵌入生成：结合文本和图像信息
- JSON 对象存储：包含文本字段和向量数据

### 25:00-35:00 - 演示环境和代码实现
- Kevin 展示完整的 Web 应用界面
- ElastiCache 集群配置：3 个分片，每个 3 个副本，共 9 个节点
- 使用 R7GX large 实例类型
- 清理现有数据和索引准备演示

### 35:00-45:00 - 嵌入生成 Lambda 函数
- 使用 Boto3 客户端连接 Amazon Bedrock
- 支持文本和多模态嵌入模型
- Amazon Titan V2 文本嵌入和多模态嵌入模型
- 返回 1024 维向量嵌入

### 45:00-55:00 - 向量存储和索引创建
- 使用 Valkey Glide 客户端连接集群
- JSON 文档存储和向量索引创建
- HNSW 算法配置：1024 维，余弦相似度
- 支持文本和多模态两种嵌入字段

### 55:00-59:30 - 搜索功能实现和问答
- FT.SEARCH 命令实现语义搜索
- K 近邻搜索和结果过滤
- 多模态搜索演示：支持文本和图像查询
- 成本效率和缓存策略的讨论
- AWS Solutions Library 中的相关解决方案介绍