# AWS re:Invent 2025 会议总结：揭秘加密证明技术

## 会议概述

本次会议由 AWS EC2 团队的首席工程师 Alex Graph 和高级解决方案架构师 Sudia 主讲，主题聚焦于如何在 AWS 上实现加密证明（Cryptographic Attestation）以验证执行环境的安全性。

会议以一个实际场景开篇：假设你是一家 AI 公司，投入大量资源训练了一个 AI 模型。客户希望使用你的模型处理数据，但他们的数据高度敏感，不愿意发送给你。同时，你也不希望将昂贵的模型权重暴露给客户。这就是机密计算（Confidential Computing）要解决的核心问题。

机密计算的本质是创建一个隔离的执行环境，确保数据在处理过程中不会泄露给任何未授权方——包括 AWS 运维人员、账户操作员，甚至是运行该环境的其他实体。AWS 通过 Nitro 系统实现了这一目标，并提供了明确定义的 API，确保不包含任何访问客户数据的路径。

演讲者介绍了机密计算的两个维度：第一维度是确保 AWS 运维人员无法访问客户数据（这在所有 EC2 实例上默认启用）；第二维度是应用程序层面的隔离，防止自己的运维人员或其他实体访问敏感工作负载。AWS 甚至将"不提供 EC2 实例操作员访问权限"写入了服务条款，并通过 NCC Group 等外部机构验证了 Nitro 系统的安全设计。

## 详细时间线与关键要点

### 00:00:00 - 会议开场与问题场景
- Alex Graph 介绍自己是 EC2 组织的首席工程师
- 提出核心场景：AI 公司如何在保护模型 IP 的同时，让客户在自己的环境中使用模型
- 引入机密计算作为解决方案

### 00:03:30 - 机密计算基础概念
- 机密计算的核心：通过"盾牌"隔离执行环境，确保敏感数据不泄露
- 定义清晰的通信接口，防止数据泄露
- AWS Nitro 系统遵循相同模型，API 设计不包含客户数据访问路径

### 00:05:45 - 机密计算的两个维度
- **维度一**：AWS 运维人员无法访问客户数据（Nitro 系统默认提供）
- **维度二**：应用程序隔离，防止账户操作员或其他实体访问
- 提及 AWS 发布的 Nitro 系统白皮书和 NCC Group 的外部安全评估

### 00:08:20 - 加密证明的必要性
- 仅声称"无法访问"不够，需要可验证的证明机制
- 数据有三种状态：传输中、静态存储、使用中（处理时）
- 需要共享密钥来加密数据，但如何安全地将密钥注入执行环境？

### 00:11:00 - 可证明镜像的构建流程
- 从描述文件生成镜像，再启动执行环境
- 关键点：生成镜像时同时生成加密哈希值
- Nitro 系统在运行时重新生成哈希值，提供证明文档
- 通过比较哈希值验证运行环境与构建镜像一致

### 00:14:15 - AWS KMS 集成
- KMS（密钥管理服务）允许定义基于证明的访问策略
- 只有当执行环境的哈希值与预期镜像匹配时，才能访问密钥
- 实现了代码公开、数据私密的模型

### 00:17:30 - EC2 Instance Attestation 介绍
- 2024 年新推出的功能，将机密计算集成到 EC2 生态系统
- 支持从描述文件（类似 Dockerfile）生成可证明的 AMI
- 使用 Nitro TPM（可信平台模块）生成证明文档

### 00:20:45 - 统一内核镜像（UKI）技术
- UKI 将内核、initrd 和命令行打包成单一二进制文件
- UEFI 启动时测量 UKI 内容到 PCR4
- 内核命令行包含根文件系统哈希值
- 通过单一 PCR 值即可验证整个系统内容

### 00:24:00 - Nitro TPM 证明文档
- 证明文档由 AWS 密钥签名，证明运行在 Nitro 系统上
- 通过 PCR 值和 AWS 签名验证两个维度的安全性
- 默认模板不包含操作员访问权限

### 00:27:20 - EC2 Instance Attestation 的优势
- 支持所有 EC2 功能：弹性网络适配器、实例存储、加速器（如 Trainium）等
- 支持自动扩展组等高级功能
- 提供 Amazon Linux 2023 和 NixOS 的示例描述文件
- 适合需要整体迁移应用的场景

### 00:30:15 - Nitro Enclaves 介绍
- 更早推出的功能，用于更复杂的隔离场景
- 将应用分为可信和不可信两部分
- 在 EC2 实例内创建独立的微型虚拟机
- 仅通过 VSOC 通道通信，确保所有通信都经过审查

### 00:33:40 - Nitro Enclaves 构建流程
- 从容器镜像生成 EIF（Enclave Image File）
- Nitro 虚拟机监控程序对镜像内容进行哈希
- 生成 PCR0 值代表整个 enclave 内容
- 同样通过 AWS 签名和 PCR 值验证两个维度

### 00:36:50 - Nitro Enclaves 的限制与优势
- 仅支持 CPU、内存和 VSOC，不支持 GPU
- 功能限制简化了安全审计
- 所有外部通信（包括 KMS 访问）都通过 VSOC
- 适合需要隔离特定敏感操作的场景

### 00:39:00 - 实际应用演示开始（Sudia 主讲）
- 演示场景：LLM 模型所有者与消费者的多方协作
- 模型所有者担心模型权重泄露
- 模型消费者担心发送的敏感提示词和上下文数据泄露

### 00:42:30 - 演示架构说明
- 在 EC2 实例上部署 LLM 模型服务器
- 前端 UI 与后端模型服务器运行在同一实例（简化演示）
- 实际生产环境可将各组件分离到独立的证明环境

### 00:45:15 - 模型加密与发布流程演示
- 使用信封加密（Envelope Encryption）加密 LLM 模型权重
- 以 Mistral 7B 模型为例（约 4GB GGUF 格式）
- 使用 KMS 生成数据密钥，用数据密钥加密模型
- 发布加密的模型文件和加密的数据密钥到 S3

### 00:48:00 - 证明文档详解
- 展示 Nitro TPM 生成的证明文档结构
- 重要字段：nonce（防重放）、PCR 值（PCR4、PCR7、PCR12）
- 证书链验证：从叶证书到根证书
- 验证签名确保文档由真实 Nitro 环境生成

### 00:51:30 - KMS 密钥策略配置
- 在 KMS 密钥策略中添加基于证明的条件
- 只有当 EC2 实例提供匹配的 PCR 值时才能解密
- 将模型权重"密封"到特定的执行环境测量值
- 实现了只有可信环境才能访问模型的目标

### 00:54:00 - 完整工作流程总结
- 模型所有者：加密并密封模型到特定 PCR 值
- 模型消费者：在自己的账户中启动可证明的 EC2 实例
- 实例启动时生成证明文档，证明其身份
- 使用证明文档从 KMS 解密数据密钥，再解密模型
- 敏感数据始终留在消费者账户内，模型权重受保护

### 00:56:45 - 实际应用场景扩展
- 可应用于 RAG（检索增强生成）组件保护
- 提示词匿名化/假名化组件
- 任何需要多方协作但各方都有敏感数据的场景
- 所有示例代码和构建工具已开源

### 00:58:30 - 会议总结与资源
- 提供 QR 码链接到文档和示例代码
- 鼓励参会者尝试构建可证明的 AMI
- 强调 EC2 Instance Attestation 和 Nitro Enclaves 的不同适用场景
- EC2 Instance Attestation 适合整体应用迁移
- Nitro Enclaves 适合隔离特定敏感操作