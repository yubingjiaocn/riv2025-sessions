# AWS re:Invent 2025 - SEC 218 会议总结

## 会议概述

本次会议主题为"AWS KMS 如何通过多年演进赢得客户信任"，由 AWS 高级产品经理 Kevin Lee 和安全合规专家 Samuel Weimoth 主讲。会议深入探讨了 AWS Key Management Service (KMS) 从 2014 年推出至今的发展历程，以及如何通过不断创新来满足客户对加密密钥控制的不同需求。

演讲者首先回顾了 KMS 诞生的背景：十年前云计算刚兴起时，金融、政府、医疗等受监管行业在迁移到云端时面临合规挑战。当时 AWS 服务提供加密功能，但密钥管理由服务自身控制，客户无法掌控。KMS 的设计遵循三大核心原则：安全性、持久性和可用性，并以透明度作为基础。如今 KMS 每小时处理超过 300 亿次加密请求，提供五个九的 SLA，并通过 FIPS 140-3 Level 3 认证。

会议重点讨论了"控制"与"拥有"加密密钥的区别。AWS 提供了多种选择：原生 KMS、导入密钥功能、Custom Key Store（基于 CloudHSM）以及 External Key Store (XKS)。每种方案都有其适用场景和权衡。演讲者特别强调，虽然某些客户出于合规要求选择物理控制密钥，但这往往会牺牲可扩展性、可用性和运维便利性。会议后半部分聚焦数字主权用例，解释了如何通过加密和授权控制相结合来满足数据驻留、操作员访问限制等主权要求，并介绍了欧洲主权云分区。

## 详细时间线

### 开场介绍（开始）
- **演讲者介绍**：Kevin Lee（AWS 高级产品经理，7 年工作经验）和 Samuel Weimoth（安全合规专家，来自英国，同时在英国皇家信号部队网络部队预备役服役）
- **观众互动**：询问首次参加 re:Invent 的人数（很多），以及参加超过 7 次的资深参与者

### KMS 历史背景
- **十年前的云计算状态**：受监管行业（金融、政府、医疗）开始迁移到云端，面临合规和加密密钥管理挑战
- **当时的问题**：AWS 服务（如 S3、EBS）提供加密，但密钥由服务自身管理，客户无法控制
- **设计挑战**：传统 HSM 方案不适合云环境（每个服务团队运营 HSM 不现实，认证授权机制不同，需要特殊接口如 PKCS11）

### KMS 设计原则
- **三大核心原则**：
  1. 安全性 - 最高优先级，保护客户敏感数据
  2. 持久性 - 通过多重冗余防范自然灾害
  3. 可用性 - 确保关键工作负载始终可用
- **透明度基础**：通过教育、第三方独立审计、遵循 FIPS 140-3 标准来赢得信任

### KMS 发布与现状
- **2014 年 11 月发布**：与 S3、EBS、RDS 等服务集成，Jeff Barr 撰写博客文章
- **当前规模**：
  - 每小时处理超过 300 亿次加密请求
  - 提供五个九 (99.999%) 的 SLA
  - 与众多 AWS 服务透明集成
  - 支持 SaaS 产品（Salesforce、Atlassian）的 BYOK（自带密钥）
  - 通过 FIPS 140-3 认证，提供公开文档

### KMS 架构概览
- **区域级架构**：区分控制平面和数据平面
- **请求处理流程**：DNS 负载均衡 → 跨可用区分发 → 前端主机处理认证授权 → 后端 HSM 执行加密操作

### 密钥控制选项演进

#### 导入密钥功能（Import Key）
- **客户需求**：希望自行管理密钥，在自己控制的 HSM 中生成密钥
- **工作原理**：从 KMS 下载包装密钥 → 在自有 HSM 中包装密钥 → 上传到 KMS → KMS 解包并安全使用
- **客户动机**：组织已有专门的密钥管理团队和流程，将云视为另一个部署位置
- **挑战**：
  - 密钥轮换成为噩梦（需要解密所有数据并用新密钥重新加密）
  - 管理数百上千个密钥的运维负担
- **适用场景**：
  - 非对称密钥用例（代码签名、证书签名）
  - 需要自行控制密钥持久性

#### Custom Key Store（基于 CloudHSM）
- **推出时间**：导入密钥功能两年后
- **客户需求**：不仅管理密钥，还要管理整个 HSM
- **工作原理**：密钥托管在 CloudHSM 实例中，KMS 将请求转发到 CloudHSM
- **客户顾虑**：
  - 多租户"吵闹邻居"问题
  - 担心 KMS 意外泄露或混淆不同客户的密钥
- **挑战**：
  - 可扩展性和可用性问题
  - 需要自行管理容量、基础设施、网络
  - 额外成本开销
  - 适合低吞吐量工作负载，高吞吐量场景会成为瓶颈
- **适用场景**：初始迁移阶段的"提升并迁移"，无需重构应用

### KMS HSM 深度解析
- **自研硬件**：AWS 拥有从硬件固件到应用代码的完整技术栈
- **FIPS 认证**：2023 年 5 月达到 FIPS 140-3 Level 3
- **独特设计**：
  - 无租户概念，无状态机器
  - 不在 HSM 中永久存储客户密钥
  - 类似数学函数的黑盒，输入输出行为预定义
  - 每秒处理数百万请求，跨数千个 HSM 集群
- **密钥处理流程**：
  - 密钥始终以加密格式存在
  - 仅在使用时将加密密钥发送到 HSM 内存
  - 在内存中解密 → 执行操作 → 快速清除并删除
  - 每个密文都嵌入密钥 ID，确保完整性和防止未授权使用

### HSM 安全机制
- **操作模式**：
  - 服务客户请求时处于操作模式
  - 零操作员访问，无法更新软件
  - 密钥仅存在于内存中
  - 无 SSH、无私有 API、无调试机制
  - 仅经过认证的 KMS 前端系统可发起请求
- **非操作模式**：
  - 重启或首次初始化时进入
  - 整个软件栈运行在内存中，无持久化磁盘
  - 断电或重启时软件和密钥从内存清除
  - 仅此时操作员可上传新版本软件
  - 需要严格代码审查和多方批准流程（法定人数监督）
- **FIPS 验证**：每次软件修改都提交 FIPS 评估验证
- **SOC 控制**：如 SOC 1 控制 414 - 固件始终处于验证状态或验证过程中
- **透明度**：鼓励查看 AWS Artifact 中的独立报告

### External Key Store (XKS)
- **工作原理**：在 KMS 和本地 HSM 之间引入代理，所有加密操作在本地 HSM 中执行
- **AWS 立场**：认为 KMS 是最安全、最持久、最高可用的密钥保护方案
- **客户误解**：
  - 密文可移植性（认为可以在 AWS 外部解密数据）- 实际上无法从 AWS 服务下载原始加密数据
  - 能够"拔出"密钥阻止访问 - 实际上导入密钥功能已可实现
- **挑战**：
  - 与 Custom Key Store 相同的可扩展性和可用性问题
  - 引入单点故障（代理或本地 HSM 故障导致整个工作负载中断）
  - 每个请求需通过互联网调用本地 HSM，引入延迟和不稳定性
- **适用场景**：演讲者坦率建议"理想情况下永远不要使用"，仅在面对不合理需求时作为妥协方案
- **架构示例**：KMS 右侧绿框内的 VPC、代理实例、与本地 HSM 的连接均由客户管理

### 密钥控制总结
- **演进历程**：从简单的加密密钥需求，到不同客户对"控制"的不同理解
- **AWS 策略**：提供选择，但重要的是理解每种选择的优势和挑战
- **关键信息**：加密密钥是数据保护策略的重要部分，但需整体考虑安全性（IAM 策略、资源策略、SCP、RCP、职责分离等）

### 数字主权用例（Samuel Weimoth 主讲）

#### 数字主权定义
- **四大关注领域**：
  1. **国家/地区驻留**：数据存储和处理位置，是否涉及第三方
  2. **操作员访问限制**：谁能进入数据中心，谁能访问数据
  3. **弹性和生存能力**：超越自然灾害，应对网络战等场景（如乌克兰将公共部门工作负载迁移到 AWS）
  4. **独立性和透明度**：无依赖 US-EAST-1，技术栈真正独立，仅特定国家公民/居民可操作
- **复杂性**：因国家、行业而异，同一国家可能有多部法律处理不同主权方面

#### 三类控制措施
1. 技术措施：
   - 使用 KMS
   - 资源策略保护密钥
   - IAM 策略控制 KMS API 访问
   - 基于角色的访问控制、备份、日志记录
2. 组织措施：
   - 加密算法策略
   - 数据保留期限
   - 标准操作程序文档
   - 员工招聘和审查程序
   - 背景调查和安全许可
3. 合同措施：
   - 服务级别协议（SLA）
   - 服务条款（观众互动：无人完整阅读过）
   - 最终用户许可协议
   - 第三方供应商评估
   - 独立审计

#### 数据主权与加密
- **位置控制**：数据存储和处理在特定区域（如法兰克福）
- **合同承诺**：数据处理附录规定数据留在指定区域
- **KMS 区域性**：密钥在区域内创建，高可用和高弹性，不会传输到区域外
- **多区域密钥**：即使是多区域密钥，明文密钥也不会在 KMS HSM 外部可用
- **加密三要素**：明文、密文、密钥 - 需要其中两个才能解出第三个
- **关键保护**：即使恶意行为者获得密文，无法从 KMS 提取密钥，因此无法获得明文

#### 威胁建模示例 1：外部未授权第三方
- **威胁行为者**：任何未授权第三方（可能是不希望其读取数据的政府实体、竞争对手等）
- **前提条件**：访问加密密钥
- **威胁**：能否解密数据？可能导致加密数据机密性降低
- **假设**：未授权方可访问加密数据（通过合法程序或窃取/拦截）
- **缓解措施**：使用 KMS - 无法提取密钥，即使 AWS 员工也无法为第三方提取密钥
- **Cloud Act 参考**：IDC 独立报告指出，即使通过合法程序将加密数据转交执法机构，也无需交出解密密钥，客户保持对数据的控制权
- **核心原则**：加密数据只是噪音，在合理时间内无法用当前技术还原为明文

#### 威胁建模示例 2：内部恶意行为者或进程
- **威胁场景**：
  - 使用不同国家的托管服务公司（数据和密钥管理法律不同）
  - 雇佣内部或外部开发人员编写代码
  - 恶意代码通过静态分析扫描漏洞进入代码库
  - 在 EC2 实例、Lambda 函数或容器中运行
- **威胁行为者**：拥有访问密钥策略的人员或进程
- **攻击示例**：勒索软件攻击 - 恶意代码注入 Lambda/EC2，更改密钥，解密后用 AWS 外部密钥重新加密
- **前提条件**：
  - 必须拥有 AWS 凭证（SigV4 签名请求：访问密钥、秘密密钥、会话密钥）
  - 必须拥有具有 KMS 服务加密调用权限的角色
- **重要提示**：强调熟悉 SigV4 签名的重要性，建议使用 Boto3 调试模式了解密钥使用方式

### 会议结束
- 字幕在威胁建模第二个示例的缓解措施部分中断

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注：本总结基于会议字幕转录，涵盖了 KMS 演进历史、架构设计、不同密钥控制选项、安全机制以及数字主权用例的威胁建模方法。