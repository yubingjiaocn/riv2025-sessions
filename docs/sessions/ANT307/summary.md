# AWS re:Invent 2025 - ANT 307: 大规模运营和扩展托管Apache Kafka和Flink

## 会议概述

本次会议由AWS的Ashish Palekar和Sai Maddali主讲，重点介绍了在AWS上大规模运营Apache Kafka和Flink服务的经验和最佳实践。Ashish负责Kafka、Flink和Firehose服务的客户沟通、服务构建和运营，而Sai则领导Amazon MSK、Apache Flink托管服务和Amazon Data Firehose的产品团队。

会议深入探讨了流数据处理的重要性，特别是在AI工作负载日益增长的背景下，如何实现实时数据价值挖掘、持续智能分析和更新鲜的上下文数据获取。演讲者分享了AWS在运营这些服务超过五年的丰富经验，以及从大量客户工作负载中获得的深刻洞察。

## 详细时间线与关键要点

### 0:00-5:00 - 开场介绍和流数据价值
- 会议开场，介绍演讲者背景和服务范围
- 阐述流数据处理的四大价值：实时数据价值挖掘、实时决策支持、持续智能获取、AI工作负载的上下文数据需求
- AWS在Kafka和Flink服务方面的五年运营经验介绍
- 现场调研：大部分与会者运营Kafka服务，少数使用Flink

### 5:00-15:00 - Kafka大规模运营基础
- 客户案例：Nexthink从本地迁移到MSK，处理能力从200MB/s扩展到5GB/s，日处理万亿级事件
- MSK服务谱系介绍：从标准代理（更多控制）到Express代理（性能和弹性平衡）再到Serverless（完全自动化）
- 存储管理挑战：扩容耗时、无法缩容、客户监控不足导致的容量问题
- Express代理的存储优势：无存储配置、虚拟无限容量、按集群而非代理配置、按使用付费

### 15:00-25:00 - 故障处理和恢复机制
- 三代理集群故障场景分析：生产者流量、消费者流量、复制流量和分区计算需求
- 代理故障时的流量重新分配和恢复过程复杂性
- 标准Kafka故障恢复的非确定性：依赖存储吞吐量、容量和网络性能
- Express代理通过资源分离实现90%更快的故障恢复，显著提高系统弹性

### 25:00-35:00 - 水平扩展和分区重平衡
- 传统Kafka水平扩展的挑战：分区重平衡耗时、需要预留带宽、持续监控基础设施
- 实验对比：标准代理vs Express代理的扩展性能
- 标准代理：3个代理扩展到6个代理需要175分钟，期间吞吐量显著下降
- Express代理：相同扩展仅需10分钟，几乎无吞吐量影响
- 智能重平衡功能：180倍更快的重平衡速度、自动分区放置、零点击自动化热管理

### 35:00-45:00 - 弹性架构重新设计
- 标准Kafka的"按需分配"模式局限性：只有在系统过载后才发现问题
- Express代理的安全限流机制：在计算、内存和网络层面实施动态限流保护
- 存储故障生存能力和客户端对限流行为的响应机制
- 无维护窗口补丁、分区级公平性保护、级联故障隔离设计
- Kafka监控要点：每代理分区数、集群总分区数、连接数、CPU/磁盘/内存/吞吐量使用率

### 45:00-53:20 - Flink大规模处理和总结
- Flink的四大优势：实时处理、动态数据集处理、有状态计算、可编程性
- 车队监控系统案例：从简单节点监控扩展到复杂的多维度异常检测
- 运营模式转变：从静态数据的动态查询转向动态数据的静态查询
- 关键概念：事件时间、窗口、分区、精确一次处理保证
- AWS托管Flink服务的蓝绿部署、温池技术和智能故障检测系统
- 固定单元(KPU)概念和作业可用性监控的重要性
- 最佳实践：定时器和水印管理、状态卫生、避免数据倾斜、序列化优化
- 关键监控维度：应用健康状态、检查点、延迟、吞吐量