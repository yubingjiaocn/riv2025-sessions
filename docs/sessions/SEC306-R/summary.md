# AWS re:Invent 2025 - 最大化 EC2 性能表现

## 会议概述

本次技术分享会由 AWS EC2 团队的专家解决方案架构师 Toby Buckley 和 Annapurna Labs 首席工程师 Geoff Blake 主讲，主题为"最大化 EC2 性能表现"。会议采用代码演示形式，重点介绍了性能工程的系统性方法，而非传统的深度优化技术。

演讲者强调了性能工程中"先广后深"的理念，即在深入特定代码优化之前，应首先从系统全局角度分析性能瓶颈。他们介绍了 AWS 新发布的开源工具 APerf v1.0，该工具能够收集数百项系统级统计数据，帮助开发者快速识别性能优化机会。通过两个实际案例演示 - Groovy 应用优化和 MongoDB 性能调优，展现了如何在不修改核心业务逻辑的情况下，通过系统级调优实现显著的性能提升。

## 详细时间线与关键要点

### 00:00-05:00 开场介绍与背景设定
- Toby Buckley 介绍自己作为 EC2 性能专家解决方案架构师的角色
- Geoff Blake 介绍 Annapurna Labs 在 Graviton 实例优化方面的工作
- 说明本次分享为代码演示格式，重点关注高层次性能工程而非底层优化
- 介绍将要演示的工具：APerf、Groovy 应用案例、MongoDB 优化案例

### 05:00-15:00 性能工程基础理论
- 性能工程定义：在系统中寻找效率提升和性价比优化机会
- 性能工程面临的挑战：
  - 抽象层泄漏问题 - 需要深入了解底层实现
  - 瓶颈可能隐藏其他问题 - 解决一个瓶颈可能暴露更严重的问题
  - 搜索空间爆炸 - 优化选项过多导致路径选择困难
- 传统性能工程流程：定义测量标准 → 测量 → 理解 → 调优 → 循环
- 现实中的挑战：工具繁多、路径曲折、直觉可能误导

### 15:00-20:00 APerf 工具介绍
- APerf 是 AWS 开发的开源性能分析工具，刚发布 v1.0 版本
- 采用"先广后深"的分析方法，优先进行系统全局分析
- 工具特点：
  - 收集数百项系统级统计数据
  - 自包含二进制文件，易于部署
  - 低开销运行（CPU 使用率低于 5%）
  - 生成静态网页报告
  - 支持容器化部署，包括 Kubernetes 特权容器

### 20:00-35:00 Groovy 应用性能优化演示
- 演示环境：三节点集群，使用 wrk2 负载生成器，M7g 和 M8g 实例
- 应用背景：使用面向切面编程（AOP）的 Groovy Web 应用
- 性能目标：P99 延迟保持在 100ms 以下，吞吐量从 4000 RPS 提升到 10000+ RPS
- 初始性能分析：
  - CPU 利用率 60-75%
  - 火焰图显示超过 100 层深的函数调用栈
  - IPC（每周期指令数）低于 1，表明 CPU 效率不高
- JVM 优化措施：
  - 关闭分层编译
  - 调整代码缓存大小
  - 启用透明大页面
  - 结果：吞吐量提升 20% 至 4750 RPS

### 35:00-45:00 硬件升级与代码重构对比
- M8g 实例测试：
  - 相同优化配置下达到 7000 RPS
  - 成本仅增加 10%，性价比提升 60%
  - IPC 提升 38%，分支预测错误减少 50%
- 代码重构方案（移除 AOP）：
  - 在 M7g 上达到 11000 RPS
  - 性能提升近 3 倍
  - 权衡：代码可维护性降低，但性能显著提升

### 45:00-52:00 MongoDB 性能优化案例
- 测试环境：M7g vs M7gd 实例，运行 MongoDB 8.0
- 初始性能：M7g + EBS 存储仅达到 4000 RPS
- APerf 分析结果：
  - CPU 利用率接近 100%
  - IO 等待时间占 65-80%
  - 明显的存储 I/O 瓶颈
- 优化方案：切换到 M7gd（本地 NVMe 存储）
- 结果：性能提升 3 倍至 12000 RPS，IO 等待时间降至接近零

### 52:00-52:42 总结与行动建议
- 性能工程不仅仅是算法优化，更多是发现系统中的优化机会
- 优化机会可能存在于实例选择、存储配置、网络设置等各个层面
- 使用 APerf 等工具进行全局分析，避免盲目深入特定代码优化
- 鼓励参会者填写反馈调查，提供改进建议