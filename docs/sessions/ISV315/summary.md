# AWS re:Invent 2025 会议总结：GenAI 驱动的多租户安全分析与修复

## 会议概述

本次会议由 AWS 高级解决方案架构师 Ashwin Wasan 和首席解决方案架构师 Sahil Tapar 主讲，重点介绍了如何利用生成式 AI 技术为多租户工作负载构建上下文感知的安全运营监控解决方案。演讲者展示了一个完整的原型系统，该系统整合了 AWS 原生安全服务（Security Hub、GuardDuty、Inspector）、Neptune 图数据库、OpenSearch 以及 Amazon Bedrock 的 Agent Core 和 Strands 框架。

该解决方案旨在解决安全运营中心（SOC）分析师面临的"告警疲劳"问题。在多租户环境中，安全告警数量可能高达数千条，传统方法需要分析师手动筛选和分析。通过引入 GenAI 驱动的聊天机器人"Security Assist"，分析师可以使用自然语言查询安全态势，系统会自动分析租户上下文、资源关系图谱和安全发现，提供可操作的优先级建议和修复指导。

演讲分为四个部分：多租户安全监控的关键需求、解决方案架构设计、实时演示以及详细的代码实现讲解。演讲者特别强调了提示工程、Agent Core 的可观测性功能以及如何通过 MCP（Model Context Protocol）服务器扩展代理能力等实践经验。

## 详细时间线

00:00:00 - 会议开场与演讲者介绍
- Ashwin Wasan（AWS 高级解决方案架构师）和 Sahil Tapar（AWS 首席解决方案架构师）欢迎与会者
- 介绍会议主题：GenAI 驱动的上下文安全分析与修复

00:01:30 - 会议议程概览
- 第一部分：多租户环境安全运营监控的关键需求
- 第二部分：解决方案架构演示
- 第三部分：原型系统演示
- 第四部分：代码详解（重点关注 Strands 和 Agent Core）
- 最后：问答环节

00:03:00 - 多租户安全解决方案的关键需求
- **需求一**：大规模数据摄取能力 - 需要处理来自多个租户的数百万条安全遥测事件
- **需求二**：租户上下文感知 - 每个安全事件需要在特定租户的安全态势和合规要求下进行分析
- **需求三**：资源关系映射 - 理解单个租户内部以及跨租户的资源互联关系，判断安全问题的传播范围

00:05:00 - 解决方案架构详解
- **数据平面设计**：三个租户环境，每个租户部署 Security Hub、GuardDuty 和 Inspector
- **数据管道**：利用 OCSF（Open Cybersecurity Schema Framework）将安全遥测数据从 Security Hub 传输到 Security Lake 和 OpenSearch
- **图数据库**：使用 Neptune 存储资源关系图谱

00:07:00 - Neptune 图数据库的作用
- 通过 AWS Config Aggregator 收集多租户账户的资源信息和关系
- 后端数据管道将资源转换为图结构：资源成为节点（vertices），资源关系成为边（edges）
- 示例：EC2 实例作为节点，其与 VPC、安全组的关系作为边
- 使用 Gremlin 查询批量插入数据到 Neptune

00:09:30 - 安全分析师工作流程
- 分析师登录"Security Assist"聊天机器人
- 可以查询特定租户的严重安全风险、优先级排序等
- 查询请求发送到 Agent Core 运行时

00:10:30 - Agent Core 架构介绍
- 询问现场观众使用 Agent Core 的情况
- Agent Core 的优势：处理繁重的底层工作、易于部署到生产环境、内置可观测性和内存管理
- **工具配置**：
  - 后端工具：查询 OpenSearch 中的 OCSF 数据
  - 租户信息工具：提供租户元数据
  - 修复建议工具：提供安全问题的修复方案
- **Agent Memory**：支持上下文对话，记住之前的讨论内容

00:13:00 - 原型应用演示开始
- 单页面轻量级 React 应用，后端使用 API Gateway 和 Lambda
- 五个功能模块展示

00:14:00 - 演示：告警疲劳问题
- 三个租户总共产生超过 4000 条安全发现
- 第一层过滤：按租户筛选（例如生产租户 Data Plane 1 有 900+ 条告警）
- 第二层过滤：按严重程度分类（Critical、High、Medium）

00:15:30 - 演示：资源聚合视图
- 选择"High"级别告警后，显示被标记的资源列表
- 点击特定 EC2 实例，显示该资源的 5 条安全发现

00:16:30 - 演示：资源关系图谱
- 第三个模块展示来自 Neptune 的资源关系图
- 显示 EC2 实例与其他资源的连接关系（安全组、IAM 角色等）
- 突出显示具有提升权限的关联资源

00:17:30 - 演示：安全发现详情
- 第四个模块显示来自 OpenSearch 的具体安全发现摘要

00:18:00 - 演示：GenAI 聊天机器人界面
- 使用自然语言查询："列出所有租户"
- 注意：使用 HTTP 协议，30 秒超时限制（建议生产环境使用 WebSocket）

00:19:00 - 演示：上下文安全查询
- 查询："多租户系统的安全态势如何？有什么需要立即关注的吗？"
- 系统响应：
  - 总体 61 个关键发现
  - 按租户分解（Data Plane 1: 29 个 Critical，233 个 High）
  - 突出显示需要立即关注的资源：互联网暴露的安全组、无限制的互联网访问等

00:21:00 - 演示：特定威胁查询
- 查询："我的租户是否容易受到 DDoS 攻击？"
- 系统响应：Data Plane 1 有开放到互联网的安全组，存在未启用 AWS Shield 保护的公开 EC2 实例
- 强调价值：快速提供可操作的修复建议

00:23:00 - 代码实现详解开始
- 讨论性能优化：响应时间有时快有时慢的原因
- 优化方法：
  - 系统提示词优化：明确指定代理的任务
  - Few-shot prompting：提供示例
  - 角色提示：指导代理关注特定安全问题（如公开暴露的安全组和 S3 存储桶）

00:25:00 - Agent Core 部署配置
- 主部署文件展示
- Handler 作为入口点
- 角色和权限配置：代理需要访问 OpenSearch 和租户数据源
- autoCreateECR：自动创建 ECR 镜像，部署到 AWS 托管账户的 Fargate 环境

00:27:00 - VPC 配置
- 配置 VPC 以避免流量通过互联网
- 在 OpenSearch 所在 VPC 中创建 ENI（弹性网络接口）
- 代理通过 ENI 与 OpenSearch 通信

00:28:30 - Agent 对象创建
- 模型选择：保持灵活性，支持任何模型
- 使用 Strands Agent 框架（但不限于此框架）
- 工具列表配置

00:29:30 - MCP 服务器集成示例
- 扩展功能：添加成本和使用报告分析
- 使用 AWS Labs 的 Billing MCP 工具
- 依赖注入方式：self.build_service.get_mcp_tool()
- MCP 工具自动解包所有可用功能供代理使用

00:31:00 - 可观测性功能
- Agent Core 内置可观测性
- 显示不同交互路径的延迟
- 提供日志跟踪信息用于性能优化

00:32:00 - Agent Sandbox 测试
- 部署后的测试环境
- 实时查询示例："储蓄计划是否有助于优化租户 2 的成本？"

00:33:30 - 多代理架构讨论
- 当前方案：单个代理配置多个工具
- 其他模式：
  - 专门化代理
  - Gateway 模式：跟踪所有可用工具，让 LLM 选择合适的工具
  - 将现有 Lambda 函数转换为 MCP 服务器

00:35:00 - 演示：成本优化查询响应
- 代理请求澄清：确认具体指哪个 AWS 账户
- 展示代理的推理能力：需要明确租户信息后才能提供建议

00:36:30 - Trace 分析
- 展示最近部署的 VPC Demo Agent 的追踪信息
- 详细的调用链路和耗时分析
- 用于识别性能瓶颈和优化机会

00:38:00 - 配置管理
- 所有配置集中管理，易于修改
- 内存配置：使用单一内存跨所有会话（演示目的）
- 内存策略：扁平结构，按用户 ID 跟踪所有会话
- 环境变量：Billing MCP 服务器、OpenSearch 设置
- 模型灵活性：支持切换不同模型以适应特定用例

00:40:00 - 解决方案演进方向
- 当前阶段：威胁检测
- 未来演进：威胁修复
- 多代理架构设想：
  - 第一个代理：识别安全问题（如开放的安全组）
  - 第二个代理：具有受限权限，根据最佳实践自动修复特定租户的安全问题

00:42:00 - 问答环节

00:42:30 - 问题 1：是否使用推理和行动模式？
- 回答：是的，使用了推理和行动（Reasoning and Acting）模式

00:43:00 - 问题 2：Neptune 图数据库如何更新？
- 回答：通过后端管道更新，非代理操作
- AWS Config Aggregator 持续读取信息
- 后端管道每 15 分钟运行一次
- 使用 Gremlin 查询将数据插入 Neptune
- 不是实时更新，但 15 分钟的延迟可接受
- 后端管道代码在 Git 仓库中可查看

00:44:00 - 问题 3：错误消息和端口开放信息来源？
- 澄清：询问的是安全发现（开放端口）而非系统错误
- 回答：来自初始架构中配置的 Security Hub、GuardDuty 和 Inspector
- 这些服务监控特定 AWS 账户并标记发现
- 发现经过 OCSF 格式处理后进入 OpenSearch

00:45:00 - 会议结束
- 演讲者感谢所有与会者
- 会议圆满结束