# AWS re:Invent 2025 DSQL 开发者实战会议总结

## 会议概述

本次会议是一场关于 Amazon DSQL（分布式 SQL 数据库）的开发者实战演示，由 AWS DSQL 团队的工程师 Marc 和数据库工程师 Raluca 主讲。会议采用"烘焙秀"的形式，通过构建一个简单的银行转账应用来展示 DSQL 的核心功能和开发实践。

DSQL 是 AWS 在去年 re:Invent 大会上预览发布、今年正式上线的分布式 Postgres 实现。它结合了关系数据库的强大功能（如 JOIN 操作、复杂查询）与 DynamoDB 的水平扩展能力和 Lambda 的无服务器特性。DSQL 基于四大核心支柱：几乎无限的扩展能力、高可用性、零基础设施管理和易用性。

## 详细时间线与关键要点

### 00:00-05:00 开场介绍与 DSQL 概述
- Marc 和 Raluca 介绍会议目标：构建银行转账应用演示 DSQL 功能
- DSQL 定位：分布式 Postgres 实现，融合关系数据库、水平扩展和无服务器特性
- 四大核心支柱：无限扩展、高可用、零基础设施管理、易用性
- 现场演示快速创建 DSQL 集群（约 10 秒完成）

### 05:00-10:00 集群创建与连接方式
- 展示 DSQL 控制台界面，强调无需复杂配置选择
- 两种连接方式：Web 查询编辑器（支持 WebSocket 直连）和 CloudShell 集成
- 介绍项目结构：CDK 文件夹（基础设施代码）和 Lambda 文件夹（应用代码）
- 演示基础 Lambda 函数和 CDK 部署配置

### 10:00-15:00 身份验证机制详解
- DSQL 采用类似 S3 预签名 URL 的身份验证机制
- 通过 AWS SDK 生成短期有效的认证令牌替代传统密码
- 演示命令行连接过程和环境变量配置
- 展示 Lambda 函数中的数据库连接池配置

### 15:00-20:00 IAM 角色映射与权限管理
- 创建数据库角色并映射到 IAM 角色
- 利用 Postgres 原生权限系统进行细粒度访问控制
- 演示 aws_commons.create_role 函数建立 IAM 到数据库角色的映射
- 解答 VPC 端点、资源策略等安全相关问题

### 20:00-25:00 事务处理基础
- Raluca 详细解释 ACID 事务特性
- 强调事务的原子性：所有操作要么全部成功要么全部失败
- 演示错误的转账实现方式，说明事务边界的重要性
- 介绍 DSQL 的强快照隔离级别，提供强一致性保证

### 25:00-30:00 并发控制机制
- 详细解释乐观并发控制（OCC）vs 悲观并发控制
- DSQL 采用无锁设计，支持更高事务吞吐量
- 当多个事务冲突时，首先提交的事务获胜，其他事务需要重试
- 应用需要实现重试逻辑处理序列化错误（错误代码 40001）

### 30:00-35:00 重试机制实现
- 演示在 Lambda 函数中实现事务重试循环
- 强调在重试循环内获取新连接的重要性
- 添加遥测数据跟踪重试次数和执行时间
- 处理连接池管理避免连接泄漏

### 35:00-40:00 性能优化与索引管理
- 创建事务日志表记录所有操作
- 使用 UUID 作为主键实现最佳数据分布
- 演示 CREATE INDEX ASYNC 语法进行在线索引构建
- 异步索引构建无需锁表，不影响生产性能

### 40:00-45:00 大规模负载测试
- 插入百万账户数据进行压力测试
- 演示从 1,000 TPS 扩展到 10,000 TPS 的过程
- 通过增加账户数量减少热点写入键，降低冲突率
- 展示系统自动扩展能力，无需手动配置实例或连接数

### 45:00-50:00 定价模型与成本分析
- 介绍 DPU（分布式处理单元）计费模式
- 类似 DynamoDB 的按使用付费：读取、写入、存储、计算
- 演示实时成本计算工具，10,000 TPS 负载仅花费约 $2
- 强调按需付费的成本效益，负载停止后计费立即停止

### 50:00-54:00 总结与问答
- 回顾 DSQL 的核心优势：自动扩展、强一致性、零运维
- 讨论外键、分区等功能的路线图规划
- 最后的观众问答环节
- 提醒填写会议反馈调查