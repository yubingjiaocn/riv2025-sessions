# AWS re:Invent 2025 会议总结：大规模网络运维自动化 (NET323)

## 会议概述

本次会议主题为"大规模网络运维及自动化"(NET323)，由AWS高级网络专家解决方案架构师Pablo Sanchez和高级解决方案架构师Claudius Gero主讲。会议采用代码实战(Code Talk)形式，重点展示如何通过自动化、测试和策略驱动部署来解决大规模网络运维中的三大挑战：无法扩展的手动流程、造成安全风险的不一致部署，以及验证滞后问题。

演讲者通过实际编码演示，展示了如何利用AWS Organizations、VPC IPAM、AWS Cloud WAN和AWS Step Functions等服务构建自动化网络架构。核心理念是将开发团队已广泛采用的最佳实践应用到网络运维中，使网络团队能够在保持安全性和合规性的同时实现敏捷性。会议强调了通过服务控制策略(SCP)实现权限管控、通过策略即代码(Policy as Code)管理全球网络，以及通过事件驱动自动化实现零接触网络配置的重要性。

## 详细时间线与关键要点

### **开场与挑战介绍 (00:00 - 03:30)**
- **00:00** - 会议开始，介绍NET323主题：大规模网络运维自动化
- **00:30** - 提出网络运维的三大核心挑战：手动流程无法扩展、部署不一致导致安全风险、验证发生过晚
- **01:15** - 演讲者自我介绍：Pablo Sanchez(高级网络专家SA)和Claudius Gero(高级SA)
- **02:00** - 说明会议形式为Code Talk，将以实际编码为主，减少理论讲解
- **02:45** - 介绍会议议程：扩展挑战、最佳实践、用例说明、编码演示、总结要点

### **规模化挑战分析 (03:30 - 06:00)**
- **03:30** - 描绘典型场景：公司从小规模VPC开始，随着增长面临指数级扩展
- **04:15** - 指出网络团队规模相对较小，但需管理大量资源，成为瓶颈
- **05:00** - 应用团队为追求敏捷性可能绕过控制，导致配置漂移
- **05:30** - 总结三大问题：一致性和治理问题、手动配置瓶颈、变更管理复杂性

### **解决方案最佳实践 (06:00 - 09:00)**
- **06:00** - Claudius介绍第一个最佳实践：采用多账户环境和护栏机制
- **06:45** - 强调通过权限控制而非仅网络阻断来管理安全
- **07:15** - 第二个最佳实践：使用AWS托管网络服务构建全球网络
- **07:45** - 第三个最佳实践：使用无服务器服务实现自动化，减轻网络工程师负担
- **08:30** - 介绍核心服务：AWS Organizations、AWS Cloud WAN、AWS Step Functions

### **用例架构说明 (09:00 - 11:30)**
- **09:00** - Pablo介绍演示用例的四个需求：IPAM控制IP地址、流量分段、流量检查、低运维开销
- **09:45** - 展示已构建的基础架构：Organizations结构(管理账户、网络账户、Spoke账户)
- **10:30** - 说明VPC IPAM配置：根池10/8，按区域和环境分配子池
- **11:00** - 介绍AWS Cloud WAN初始配置：混合段、开发段、生产段，以及服务插入功能

### **需求1：IPAM作为唯一IP分配源 (11:30 - 20:00)**
- **11:30** - 开始第一个需求的编码演示
- **12:00** - Pablo使用Kiro IDE和Terraform模块创建不合规VPC(使用172网段)
- **13:15** - 成功创建不合规VPC，证明默认情况下可以绕过IPAM
- **14:00** - 开始创建服务控制策略(SCP)阻止非IPAM池的VPC创建
- **15:30** - SCP策略内容：拒绝创建VPC和关联次要CIDR块，除非使用指定的IPAM池
- **17:00** - 应用SCP后尝试创建相同VPC，操作被拒绝
- **18:00** - 观众提问：如何将特定IP段分配给特定账户？回答：通过账户工厂和Control Tower实现
- **19:00** - 创建合规VPC配置，使用IPAM池和/24网络掩码，支持双栈(IPv4/IPv6)

### **需求2：构建易于管理的全球网络 (20:00 - 30:00)**
- **20:00** - 介绍第二个需求：路由域间检查、出口检查、跨区域检查、附件自动化
- **21:00** - Claudius解释Cloud WAN的"send-to"和"send-via"概念
- **22:00** - "send-to"定义流量最终目的地，"send-via"定义中间检查点
- **23:00** - Pablo开始编写Cloud WAN策略文档，使用Terraform动态块
- **24:30** - 创建边缘覆盖(edge override)定义跨区域检查策略
- **25:30** - 定义检查规则：dev到hybrid、pro到dev、dev到hybrid的双向检查
- **27:00** - 观众提问：为何使用Terraform而非CloudFormation？回答：个人偏好，两者都支持
- **28:00** - 创建附件策略：基于标签自动关联到正确的路由域
- **29:00** - Claudius介绍新功能：Cloud WAN高级路由(支持路由过滤、汇总、BGP属性)

### **Cloud WAN策略部署 (30:00 - 35:00)**
- **30:00** - 在AWS Network Manager控制台查看策略版本(版本15)
- **30:45** - 展示"live"和"new"两个别名用于策略管理
- **31:30** - 策略开始部署，包括附件策略和服务插入路由
- **32:30** - 观众提问：账户级权限能否绕过SCP？回答：不能，SCP始终优先
- **33:30** - 展示已创建的三个检查VPC，附加到网络功能组
- **34:30** - 策略部署完成，自动应用附件策略和创建静态路由

### **需求3：基于OU强制路由域 (35:00 - 45:00)**
- **35:00** - Pablo指出问题：如果用户标记错误的域标签，可能连接到错误的段
- **36:00** - 解决方案：创建SCP阻止Spoke账户创建"domain"标签
- **37:00** - 只允许网络账户创建domain标签，确保正确的段关联
- **38:00** - 创建事件驱动自动化：Network Manager事件→EventBridge→Step Functions
- **39:00** - Step Functions工作流逻辑：等待VPC附件创建→获取OU信息→从网络账户创建标签
- **40:30** - 观众提问：如何动态创建账户时分配IP段？回答：使用Control Tower账户工厂
- **42:00** - 创建SCP策略：拒绝创建带domain键的VPC附件，拒绝修改domain标签
- **43:30** - 开始构建自动化：EventBridge规则捕获VPC附件创建事件
- **44:30** - 配置事件过滤：仅捕获VPC附件创建事件，发送到Step Functions

### **Step Functions自动化演示 (45:00 - 50:00)**
- **45:00** - 在控制台查看Step Functions状态机可视化界面
- **45:45** - 观众提问：能否在应用前测试Cloud WAN策略连通性？回答：目前需要先部署，可用Reachability Analyzer测试
- **47:00** - 说明可以快速回滚到之前的策略版本
- **48:00** - 介绍Cloud WAN MCP工具帮助快速检查路由
- **49:00** - 完成SCP和自动化配置的取消注释和部署

### **完整演示与验证 (50:00 - 结束)**
- **50:00** - 准备创建完整的VPC并验证自动化流程
- **50:30** - 展示EventBridge规则配置：捕获Network Manager事件，过滤VPC附件
- **51:00** - Step Functions工作流包含：等待、获取OU信息、创建标签等步骤
- **51:30** - 强调所有资源都可通过CloudFormation或CDK创建
- **52:00** - 观众提问：能否不使用IPAM池而硬编码IP范围？回答：可以但IPAM提供更多监控和控制能力
- **53:00** - 总结演示：通过SCP、IPAM、Cloud WAN和Step Functions实现零接触网络自动化

### **关键技术要点总结**
- **服务控制策略(SCP)**：在组织级别强制执行网络合规性，优先级高于账户权限
- **VPC IPAM**：集中管理IP地址分配，提供可见性和预警功能
- **AWS Cloud WAN策略即代码**：使用JSON定义全球网络拓扑、分段和检查规则
- **事件驱动自动化**：通过EventBridge和Step Functions实现零接触配置
- **基础设施即代码**：使用Terraform/CloudFormation实现可重复、可审计的部署