# AWS re:Invent 2025 技术会议总结

## 会议概述

本次会议重点介绍了墨西哥领先的人力资源管理公司 Groupot International 使用 AWS Transform for .NET 服务进行应用现代化转型的实践案例。Groupot International 成立于1991年,专注于人力资源管理、工资处理和考勤控制解决方案,截至2024年覆盖了墨西哥68%的制造业员工,服务超过1200家客户和440万员工。

该公司面临的核心挑战是其运行在 Windows 平台上超过10年的遗留代码系统,在高峰期(如周五晚上)面临严重的性能和扩展性问题。工程负责人 Armando Valenzuela 分享了他们如何利用 AWS Transform 服务,在短短两周内将 .NET Framework 4.6 应用迁移到 .NET 8,并最终部署到 Lambda 无服务器架构的完整历程。这次转型不仅解决了技术债务问题,还实现了超过40%的基础设施成本节省,显著提升了系统的可扩展性和开发者体验。

会议还深入介绍了 AWS Transform 服务的最新功能,包括本周发布的多代理(multi-agent)能力,允许开发者更灵活地驱动现代化进程。演示环节展示了如何在 Visual Studio IDE 中使用 AWS Toolkit 和 Amazon Q 进行代码转换和优化。

## 详细时间线与关键要点

### **开场介绍 (0:00-2:30)**
- 会议主题:Groupot International 使用 AWS Transform for .NET 的转型案例
- 会议级别:300级(深度技术内容)
- 议程包括:公司介绍、挑战分析、转型路径、架构深度解析、服务演示和经验教训

### **Groupot International 公司背景 (2:30-4:00)**
- 成立于1991年的墨西哥领先人力资源管理公司
- 总部位于蒂华纳(Tijuana)
- 2024年覆盖墨西哥68%的制造业员工
- 服务超过1200家客户和440万员工
- 制造业员工通常按周或每15天领取工资

### **业务挑战与痛点 (4:00-7:30)**
- **场景描述**:440万用户在周五晚上同时访问应用,导致系统压力巨大
- 运行在超过10年的遗留 Windows 代码上
- 运行在 Elastic Beanstalk 上的应用扩展性不足
- 技术债务的主要来源是架构选择,而非代码版本
- 公司使命:改善生活体验,包括客户、员工和开发者

### **现代化三大支柱 (7:30-9:00)**
1. 以客户为中心:满足可扩展性和性能需求
2. 成本效益:降低运营成本,简化现代化和维护工作
3. 零停机要求:在不中断工资处理操作或违反客户SLA的情况下迁移关键生产工作负载

### **应用场景说明 (9:00-12:00)**
- **墨西哥特殊要求**:每张工资单必须通知墨西哥税务管理局(类似美国IRS)
- **工作流程**:
  - 工资管理员通过 HR 管理套件(本地 Sistema TES 或云端 Revolution)发送工资数据
  - 数据通过工资盖章服务(Payroll Stamping Service)处理
  - 员工通过自助服务应用下载工资单
- **关键服务**:XML/PDF 引擎,每天处理约200万请求,高峰期达400万请求
- 这是基础设施中使用最频繁的端点

### **原有架构概述 (12:00-14:00)**
- 基于 Elastic Beanstalk 的容器化应用
- 运行在两个可用区和多个区域
- Beanstalk 运行良好,但扩展速度不如 Lambda
- 实例增加速度无法满足突发需求

### **转型准备阶段 (14:00-18:00)**
- **第一步:分析项目**,选择最适合迁移的候选项目
- **第二步:整理遗留项目**
  - 原有70个 NuGet 包依赖(公共和私有)
  - 移除了23个不需要的包
  - 代码总量超过135,000行
- **第三步:准备单元测试**,用于前后对比验证

### **AWS Transform 转型过程 (18:00-22:00)**
- **自动迁移**:从 .NET Framework 4.6 迁移到 .NET 8
- Transform 帮助验证大部分代码和包更新
- 需要手动修复少量代码(使用 Amazon Q 辅助)
- 能够快速进行本地和功能测试
- 构建独立的 Web 应用进行测试

### **重构与解耦 (22:00-25:00)**
- 进行多轮重构
- 将包迁移到核心工件(artifact)
- 解耦应用和服务,避免创建"分布式单体"
- 通过 CDK 和 CodePipeline 实现自动化构建
- 参考了 MAM402 会议关于避免共享单体的建议

### **迁移时间线 (25:00-28:00)**
- **4月**:启动项目
- **前两周**:完成代码转换和手动修复
- 解耦服务耗时较长
- 同时将遗留 NuGet 服务器替换为 CodeArtifact
- 集成 CDK 和 CodePipeline

### **中间阶段:Fargate 测试 (28:00-30:00)**
- 没有直接从 Elastic Beanstalk 跳到 Lambda
- 先在 ECS Fargate 上测试微服务
- Fargate 表现良好,但不符合公司运营模式
- 公司倾向使用 Lambda,因此移除容器化
- 改用 ZIP 模型而非 Docker 镜像

### **监控与可观测性 (30:00-31:00)**
- 添加 X-Ray 追踪
- 集成 CloudWatch 指标
- 在运行的应用内部获取指标
- 强调:迁移后运营环境完全不同,需要密切监控行为

### **最终架构 (31:00-33:00)**
- **简化架构**:Lambda 函数(Document Generator)
- 使用相同的 S3 存储桶
- 拥有独立的 RDS 数据库(成功解耦数据库)
- 与工资盖章服务良好集成
- 自助服务应用(Revolution)无需更改端点

### **转型收益 (33:00-38:00)**
1. 快速交付:
   - 节省约70%的人力时间
   - 为团队节省约2个月的手动代码测试和验证时间
  
2. 战略性重构:
   - 团队专注于价值驱动的重构,而非繁琐的手动工作
   - 有时间思考更广泛的架构,而非仅仅应急响应
   - 为未来迁移解耦了单体应用

3. 成本节省:
   - 使用基于 Graviton 的 Lambda,基础设施成本降低超过40%
   - AWS 墨西哥架构团队建议直接使用 Graviton
   - 使用 Amazon Q 生成 Python 脚本进行 A/B 测试验证
   - 消除了 Windows 许可成本

4. 弹性扩展:
   - 平均每天处理130万份工资文档
   - Lambda 无扩展问题
   - 无需手动扩展干预
   - 高峰期响应时间约0.5秒,优于低负载时的旧系统

### **经验教训 (38:00-43:00)**
1. 利用生产环境对比:
   - 如果有运行中的遗留应用,可以对比新旧版本
   - 在生产环境中同时运行两个版本
   - 使用 Python 脚本逐像素、逐文本对比 PDF 输出
   - 通过金丝雀发布逐步切换到新版本

2. 现代化不仅是代码迁移:
   - 不要期望使用 Transform 后第二天就完成
   - 迁移到 Lambda 需要注意:
     - 冷启动问题
     - 预配置并发
     - SnapStart 功能
     - 包大小优化
   - 单体应用中的单例和连接在生产环境中运行良好
   - Lambda 需要注意连接池、内存设置和与其他服务的连接
   - 如果开发者说 Beanstalk 比 Lambda 快,很可能是冷启动问题

3. 自动化验证:
   - 实现完全自动化验证(Python 脚本)
   - 使用 JMeter 进行关键基准测试

### **AWS Transform 服务介绍 (43:00-50:00)**
- **现代化原因**:
  - 性能改进
  - 成本优化
  - 可扩展性提升
  - 更好的可管理性
 
- **服务特点**:
  - 将单体应用转换为微服务容器
  - 可部署到 EC2 Linux 或 ECS Fargate
  - 可进一步迁移到无服务器架构(如 Groupot 案例)
  - 跨平台 .NET 移植困难且缓慢,Transform 简化了这一过程

### **最新功能发布 (50:00-52:00)**
- **本周发布**:AWS Transform 下一代版本
- **多代理能力**:允许开发者驱动现代化过程
- 可以指导转型过程,而非完全依赖代理设计
- 如果只想移植代码到新架构而不改变架构,现在可以实现
- 相比过去有巨大改进

### **转型流程 (52:00-56:00)**
1. 分析代码库:索引和处理代码
2. 检测不兼容性:清理代码,移除不必要的依赖
3. 设计现代化计划:基于源代码和项目设计计划
4. 人工验证:人类参与验证现代化计划
5. 移植代码:应用代码修改
6. 部署:直接部署到 ECS Fargate 或 EC2 Linux

### **服务优势 (56:00-58:00)**
- 缩短项目时间
- 降低许可成本
- 提高 .NET 移植质量
- 不仅是代码移植,还包括代码质量和安全性改进

### **两种使用体验 (58:00-60:00)**
1. IDE 体验:
   - 需要安装 AWS Toolkit
   - 适合开发者逐个应用现代化
  
2. Web 控制台体验:
   - 适合 DevOps 团队批量现代化
   - 连接源代码仓库(Azure DevOps、GitHub、GitLab、Bitbucket)

### **支持的转换类型 (60:00-63:00)**
- **.NET Framework 转换**:
  - ASP.NET MVC Razor 界面
  - Web Forms 转 Blazer
  - 跨平台 .NET 8 和 .NET 10
  - Windows Forms 和 WPF 桌面项目
 
- **大规模现代化**:可以选择多个项目或整个代码库

- **MVC Razor**:转换到 ASP.NET Core

- **Web Forms 转 Blazer**:新功能

### **代码仓库连接 (63:00-64:00)**
- 支持 GitHub、GitLab、Bitbucket、Azure Repos
- 支持 Amazon S3(如果不想连接源代码仓库)
- 可以提供自定义 NuGet 包(内部开发或第三方)

### **控制台体验 (64:00-65:00)**
- 完整的代理和聊天控制台支持
- 可以与代理交互
- 能够将现代化工作引导到特定架构或编码方式

### **Amazon Q 集成 (65:00-66:00)**
- Groupot 在最后阶段使用了 Amazon Q
- **推荐流程**:
  1. 先使用 AWS Transform 将代码移植到 .NET 8/10
  2. 再使用 Amazon Q 改进代码、修复问题或移植到 Lambda

### **SQL Server 转换 (66:00-68:00)**
- 支持数据库转换,包括 SQL Server
- 管理代码中的数据库依赖
- **转换前**:Windows 全栈(应用 + SQL Server + Windows Server VM)
- **转换后**:跨平台 .NET 应用 + Aurora PostgreSQL + ECS/EC2 Linux

### **实时演示 (68:00-85:00)**
- **演示者**:Thiago Gonçalves,AWS 解决方案架构师,拥有20年应用开发和现代化经验

- **演示步骤**:
  1. 在 Visual Studio 中安装 AWS Toolkit with Amazon Q 扩展
  2. 启用 AWS Transform(可选择仅 Transform 或 Amazon Q Developer 订阅)
  3. 打开 .NET Framework 4.7 解决方案
  4. 右键点击解决方案,选择"Port solution with AWS Transform"
  5. 选择目标版本(.NET 8,即将支持 .NET 10)
  6. 应用必须处于可构建状态
  7. AWS Transform 打包源代码并发送到 AWS 沙箱账户
  8. 转换在 AWS 账户中进行,不在本地计算机
  9. 小型解决方案约需15-20分钟

- **转换结果**:
  - 显示转换摘要
  - 列出新增文件(如 appsettings.json 替代 web.config)
  - 显示已删除/重命名的文件(如 global.asax)
  - 显示代码更改(如命名空间替换)
  - 可下载完整变更摘要

- **需要注意的问题**:
  - 示例中 Entity Framework 未能自动转换为 Entity Framework Core
  - 需要手动更改
  - 报告提供所有更改的概览

- **应用更改**:
  - 选择并应用所有更改
  - 重新加载解决方案
  - 项目文件显示现在是 .NET 8
  - 所有必需的新文件已添加

### **Amazon Q Chat 演示 (85:00-结束)**
- **用途**:处理 AWS Transform 无法自动完成的手动更改
- AWS Transform 的目标是使应用在 .NET 8 上可用
- 如果需要更多交互和代码优化,使用 Amazon Q Chat
- **示例**:要求 Amazon Q 将 Entity Framework 替换为 Entity Framework Core
- Amazon Q 可以:
  - 访问源代码
  - 理解解决方案
  - 读取文件
  - 执行复杂的代码替换和重构

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


总结:本次会议展示了一个完整的企业级 .NET 应用现代化案例,从遗留的 Windows 单体应用成功转型为运行在 AWS Lambda 上的云原生微服务架构,实现了显著的性能提升和成本节省。AWS Transform 服务结合 Amazon Q 的强大能力,大幅缩短了现代化周期,为企业数字化转型提供了可行的技术路径。