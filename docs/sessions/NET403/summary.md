# AWS re:Invent 2025 - NET 403: 大规模混合连接深入探讨 Direct Connect

## 会议概述

本次会议是关于 AWS Direct Connect 的深入技术讲座,由 AWS 全球网络解决方案架构技术负责人 Steve Seymour 和 Direct Connect 产品经理 Josh Dean 共同主讲。两位讲师都来自英国,幽默地解决了"router"发音的问题。

会议从一个看似简单的问题开始:"Direct Connect 能有多难?" 表面上看,它只涉及 VLANs、802.1Q、BGP、AS 号码和路由器配置。然而,随着讲解的深入,揭示了 Direct Connect 实际上是一个复杂的系统,涉及物理基础设施、逻辑配置和云端集成等多个层面。

讲师们强调 Direct Connect 已经成为 AWS re:Invent 大会网络基础设施的关键组成部分,所有使用会场 Wi-Fi 访问 AWS 服务的参会者实际上都在使用 Direct Connect。会议内容涵盖了从物理连接建立、故障排查、到虚拟接口配置和路由优化的完整流程,为与会者提供了实用的技术指导和最佳实践建议。

## 详细时间线

### 开场介绍 (00:00 - 05:30)
- **00:00** - 会议开始,欢迎参会者参加 NET 403 会议:大规模混合连接 - Direct Connect 深入探讨
- **01:15** - Steve Seymour 提出核心问题:"Direct Connect 能有多难?不就是 VLANs 吗?"
- **02:30** - 介绍讲师背景:Steve Seymour(AWS 全球网络解决方案架构技术负责人)和 Josh Dean(Direct Connect 产品经理)
- **03:00** - 幽默讨论英式英语中"router"的发音问题
- **04:00** - 询问现场有多少人使用过 Direct Connect
- **04:30** - 分享 Direct Connect 历史:2014 年首次在 re:Invent 使用,2015 年为整个活动网络提供支持,至今仍是会议基础设施的关键部分

### 会议内容框架 (05:30 - 07:00)
- **05:30** - 概述会议议程:物理基础设施、逻辑基础设施、BGP 配置和云端基础设施
- **06:15** - 定义 Direct Connect:客户基础设施与 AWS 基础设施之间的物理连接
- **06:45** - 说明 Direct Connect 的演进:从单区域单 VPC 连接发展到支持多区域、多 VPC、Transit Gateway 和 Cloud WAN

### 物理连接 - 位置选择 (07:00 - 10:30)
- **07:00** - 强调"位置、位置、位置"的重要性
- **07:30** - 介绍如何在 AWS 网站上查找 Direct Connect 位置列表
- **08:00** - 说明位置表格包含的信息:关联区域、可用功能和支持的带宽(1G、10G、100G、400G)
- **08:45** - 建议根据现有基础设施位置选择 Direct Connect 位置
- **09:15** - 演示在控制台创建连接的步骤:命名、选择位置、选择带宽
- **09:45** - 介绍 MACsec 选项:必须在创建连接时启用,之后无法更改
- **10:15** - 说明配额限制:每个区域每个位置默认 10 个连接

### 物理连接 - Meet Me Room 和交叉连接 (10:30 - 18:00)
- **10:30** - 展示 Equinix TY2 的 Meet Me Room 照片,说明这是一个整洁的光纤配线间
- **11:00** - 解释 LOA-CFA(授权书-连接设施分配)文档的作用
- **11:30** - LOA-CFA 包含的信息:端口位置、连接器类型(通常是 LC)、单模光纤、不同带宽的标准
- **12:00** - 强调客户通常无法直接访问 Meet Me Room,需要通过托管服务提供商安排交叉连接
- **12:45** - 说明建立连接涉及的多方:AWS、客户、托管服务提供商,可能还包括电信运营商和最后一英里提供商
- **13:30** - 最佳实践建议:绘制简单的连接图,标注所有组件、所有者、端口 ID、电路编号和支持联系方式
- **14:30** - 详细说明通过合作伙伴建立端到端连接的场景
- **15:30** - 解释实际连接过程:从数据中心到 POP 点的最后一英里、通过光纤网络到托管设施、Meet Me Room 的交叉连接
- **16:45** - 介绍在托管设施内部署设备的简化场景:机架通常预先布线到 Meet Me Room
- **17:30** - 澄清"交叉连接"的含义:就是一根光纤连接两个端口

### 连接验证和故障排查 (18:00 - 24:00)
- **18:00** - 说明连接成功后,AWS 控制台中端口状态从"down"变为"available",路由器上链路也会启动
- **18:30** - 介绍 CloudWatch 监控指标:连接状态(1=up,其他=down)
- **19:00** - 重点说明光功率电平监控:接收(RX)光功率电平
- **19:30** - 良好的光功率范围:负 12 dBm 或更好;超过负 12 dBm 可能导致连接问题
- **20:15** - 建议检查 CloudWatch 指标来诊断连接问题,可能是脏光纤导致信号衰减
- **21:00** - 解释"roll the fiber"(翻转光纤)的含义:交换发送和接收光纤
- **21:45** - 展示 SFP 模块和 LC 连接器,说明 TX(发送)和 RX(接收)端口
- **22:30** - 图解正常连接:TX 连接到对端 RX,反之亦然
- **23:00** - 说明 Meet Me Room 中光纤交叉的标准做法,以及多次交叉可能导致的问题
- **23:45** - 解释"putting a loop on it"(加环回)的故障排查方法:在 Meet Me Room 将光纤环回以测试连接段

### 专用连接、托管连接和 LAG (24:00 - 28:00)
- **24:00** - 定义专用连接(Dedicated Connection):分配给客户的专用端口,完全控制带宽和配置
- **24:45** - 专用连接支持多个虚拟接口(VLANs 和 BGP 会话)
- **25:15** - 介绍托管连接(Hosted Connection):合作伙伴拥有与 AWS 的互连,为客户分配较小带宽
- **26:00** - 说明托管连接限制:每个托管连接只能有一个虚拟接口
- **26:30** - 合作伙伴不能超额订阅端口,必须随着客户需求扩展容量
- **27:00** - 介绍 LAG(链路聚合组):将多个物理连接组合成一个逻辑连接
- **27:30** - LAG 示例:4 个 10G 连接组合成 40G 容量,使用流哈希分配流量
- **27:50** - 配置最小接口数量:例如要求至少 20G 可用,低于此值则关闭 LAG

### MACsec 加密 (28:00 - 30:00)
- **28:00** - 介绍 MACsec:在端口级别启用,必须在创建连接时选择
- **28:30** - MACsec 在两个第 2 层设备之间加密流量
- **29:00** - 适用场景:托管设施内或通过支持第 2 层透传的运营商连接
- **29:20** - 密钥管理:客户生成密钥,存储在 AWS Secrets Manager 中,可以轮换
- **29:40** - 三种加密模式:
  - **No Encrypt**(不加密):用于初始设置
  - **Should Encrypt**(应该加密):尝试加密,失败时仍保持连接
  - **Must Encrypt**(必须加密):加密失败则连接不会建立

### 虚拟接口概述 (30:00 - 33:00)
- **30:00** - Josh Dean 接手讲解虚拟接口部分
- **30:15** - 定义虚拟接口:VLAN + BGP 会话
- **30:30** - 三种主要类型:
  - **Public VIF**(公共虚拟接口):连接到公共 AWS 端点(如 S3)
  - **Private VIF**(私有虚拟接口):连接到 VPC
  - **Transit VIF**(传输虚拟接口):连接到 Transit Gateway 和 Cloud WAN
- **31:15** - 介绍托管虚拟接口(Hosted VIF):由另一个账户的连接拥有,附加到您的 VPC

### 公共虚拟接口 (33:00 - 34:00)
- **33:00** - 公共虚拟接口连接到任何区域的公共 AWS 服务
- **33:20** - 使用公共 IP 地址进行 BGP 对等
- **33:40** - 可以限定范围(稍后详细说明)
- **33:50** - 本质上是客户专属的 AWS 公共端连接

### 私有虚拟接口的演进 (34:00 - 37:00)
- **34:00** - 回顾 2017 年之前:Direct Connect 是区域性服务
- **34:30** - 旧架构:连接和 VPC 必须在同一区域,每个虚拟接口一个 VPC
- **35:00** - 引入 Direct Connect Gateway(2017 年后):
  - 允许从任何位置的私有虚拟接口连接到全球任何区域的 VPC
  - 将多个私有虚拟接口汇聚到一个 Direct Connect Gateway
- **36:00** - Transit Gateway 和 Cloud WAN 时代:
  - 引入 Transit 虚拟接口
  - 区域性连接到 Transit Gateway 和 Cloud WAN
  - 然后连接到不同区域的 VPC
- **36:40** - 重要限制:不能在同一个 Direct Connect Gateway 上混合使用 VGW 和 TGW,也不能混合 Private VIF 和 Transit VIF

### Site Link 功能 (37:00 - 38:00)
- **37:00** - 介绍 Site Link:私有或传输虚拟接口的设置
- **37:20** - 功能:允许流量从一个 Direct Connect 位置通过 AWS 骨干网传输到另一个位置
- **37:40** - 演示动画 GIF:点击按钮即可启用,路由立即出现在另一侧
- **37:55** - 优势:可以按需使用,不需要一直保持启用

### 虚拟接口监控 (38:00 - 39:30)
- **38:00** - CloudWatch 指标:每秒比特数(入站/出站)、每秒数据包数
- **38:30** - 介绍 CloudWatch Network Synthetic Monitor:
  - 发送真实流量(ICMP 或 TCP)
  - 在子网中配置端点,在本地配置端点
  - 返回往返时间和丢包指标
- **39:00** - 网络健康指标(Network Health Indicator):
  - 查看从子网到 Direct Connect 端点的所有内部指标
  - 快速判断问题是在 AWS 侧还是客户侧

### 虚拟接口故障排查 (39:30 - 41:30)
- **39:30** - 第 1 层:物理连接必须正常(参考 Steve 的讲解)
- **40:00** - 第 2 层检查:
  - 确保两侧 VLAN 标签匹配
  - 合作伙伴和提供商常用封装技术(如 Q-in-Q)
  - 面向 AWS 的端口必须剥离封装,只保留虚拟接口的 VLAN
- **40:45** - 第 3 层 BGP 问题:
  - 如果 BGP 日志显示卡在"Idle"或"Connect Active"状态,可能是网络连接问题
  - 如果进入"OpenSent"或"OpenConfirm"状态,可能是 BGP 参数配置问题

### 路由配置 - 限制和配额 (41:30 - 43:30)
- **41:30** - 强调路由限制的重要性
- **42:00** - 关键配额:
  - 每个连接的虚拟接口数量
  - 每个连接的传输虚拟接口数量
  - **每个虚拟接口的路由数量**(最重要)
  - **每个 Direct Connect Gateway 的路由数量**(最重要)
- **42:30** - 警告:超过路由限制可能导致网络或 Direct Connect 中断
- **43:00** - 建议:充分了解路由,使用汇总,保持路由数量可控

### 路由过滤和汇总技术 (43:30 - 46:00)
- **43:30** - 演示路由过滤配置示例:
  - 使用前缀列表过滤特定的 /24 网络
  - 将路由映射应用到 BGP 对等,只向 AWS 发送特定路由
- **44:30** - 演示路由汇总配置:
  - 使用 aggregate-address 命令
  - 抑制具体的 /24 路由,只发送汇总的 /16 路由
- **45:15** - 演示默认路由注入:
  - 使用 default-originate 命令向 AWS 发送默认路由
  - 然后使用 VPC 路由表和 TGW 路由表精确控制流量

### BGP 路由选择 - 主动/被动配置 (46:00 - 会议结束)
- **46:00** - 介绍 BGP 路由选择记忆口诀:"We Love Oranges AS Oranges Mean Pure Refreshment"
  - Weight(权重)
  - Local Preference(本地优先级)
  - Originate(起源)
  - AS Path(AS 路径)
  - Origin Type(起源类型)
  - MED(多出口鉴别器)
  - Paths(路径)
  - Router ID(路由器 ID)
- **46:30** - Josh 幽默评论:不理解为什么有两个"Oranges",但从未使用 Origin 或 Origin Type 来决定路由
- **46:45** - 会议内容在此处字幕截断

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意: 本摘要基于提供的字幕文本,字幕在讲解 BGP 路由选择部分时中断,因此完整会议内容可能还包括更多关于主动/被动配置、故障转移策略和最佳实践的内容。