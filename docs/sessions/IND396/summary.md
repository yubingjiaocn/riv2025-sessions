# AWS re:Invent 2025 技术分享会总结

## 会议概述

本次分享会由 Another Axiom 公司的服务工程师 Morgan 主讲,主题是将热门 VR 游戏后端迁移到 AWS 的完整历程。Another Axiom 是一家领先的 VR 游戏工作室,专注于社交、沉浸式世界和创新交互系统。他们的旗舰产品包括 Gorilla Tag(Meta Quest 商店最受欢迎的游戏,拥有 1700 万终身独立玩家,峰值并发用户达 10 万)和 Orion Drift(大型多人科幻社交体育游戏,峰值并发数万用户)。

演讲详细介绍了 Another Axiom 从第三方平台即服务产品迁移到自建 AWS 后端平台 Mothership 的技术决策过程。Morgan 分享了 VR 市场的独特挑战,包括极端的季节性波动(冬季假期与夏季低谷期可能相差一个数量级的并发用户)和病毒式传播带来的不可预测的流量激增。最终,通过采用 AWS Graviton 处理器和优化架构,团队实现了 60% 的计算成本节省和 30% 的总体云支出降低,同时保持了零停机时间的平稳迁移。

演讲强调了持续集成/持续部署(CI/CD)管道和完善测试基础设施的重要性,这是 Mothership 平台稳定性的核心保障。Morgan 还分享了与 AWS 客户团队合作、利用专家资源进行成本优化的宝贵经验,以及在架构演进过程中不断重新审视技术假设的重要性。

## 详细时间线

0:00 - 开场介绍
- Morgan 自我介绍,担任 Another Axiom 的服务工程师
- 介绍 Mothership 平台(Another Axiom 的后端即服务平台)
- 概述演讲内容:公司背景、迁移前状态、AWS 架构、负载测试、成本优化、Graviton 迁移

1:30 - Another Axiom 公司介绍
- 公司定位:领先的 VR 游戏工作室,专注社交和沉浸式体验
- 旗舰游戏:Gorilla Tag 和 Orion Drift
- Gorilla Tag:Meta Quest 商店最受欢迎游戏,1700 万终身独立玩家,峰值 10 万并发用户
- Orion Drift:数万并发用户的大型多人游戏

3:00 - VR 市场的独特挑战
- 季节性:冬季假期与夏季低谷期并发用户可能相差一个数量级
- 病毒式传播:创作者社区活动可能导致大规模不可预测的流量激增
- 基础设施必须能够应对突然的曲棍球棒式增长

4:30 - 迁移前的状态
- 最初使用第三方平台即服务产品
- Gorilla Tag 由单个开发者启动,使用现成解决方案
- 随着游戏增长,快速超出现成解决方案的能力
- 作为小客户,获得支持和功能请求的能力有限
- 需要自行构建 Meta Quest 生态系统集成,增加开发和安全负担

6:00 - 迁移的最后推动力
- 在一次大型创作者社区活动中,尽管提前警告合作伙伴,系统仍然崩溃
- 决定迁移到内部解决方案以掌控支持能力

7:00 - 游戏后端平台核心功能
- 身份认证:验证玩家身份和游戏所有权
- 内容审核:处理玩家举报,制裁不良行为,实时语音 AI 审核
- 分析:测量玩家游戏内行为,优化用户体验
- 用户存储:保存玩家数据(装备、分数等),跨设备同步
- 游戏配置:远程托管配置,无需客户端补丁即可调整
- 商务和 IAP:应用内购买系统

9:00 - Mothership 平台架构
- 三大支柱:后端服务应用、开发者仪表板、游戏 SDK
- 垂直(Vertical)概念:网络隔离的 Mothership 堆栈克隆
- 小型游戏共享垂直以节省成本,大型游戏使用专用垂直
- 技术栈:Node.js 应用托管在 ECS,配合存储服务
- 单体架构但按微服务方式部署:按功能区域分片计算和数据库

11:30 - 架构设计理念
- 开发团队规模小(1-3 人),依赖托管服务保持开发速度
- 单体应用优势:进程内通信,合约在代码中更易理解
- 所有节点访问所有分片数据库
- 简化运维和值班工作

13:00 - CI/CD 管道
- 完全持续集成和持续部署
- 基于主干的 GitOps:PR 合并到 main 触发 GitHub Action
- 构建 Docker 镜像推送到 ECR,启动 Code Pipeline
- 保持变更小型化、隔离化,易于回滚
- Code Pipeline 串行化变更,一次一个垂直
- 支持暂停管道进行风险变更验证

15:00 - 部署策略
- 使用 Code Deploy 蓝绿部署和金丝雀策略
- 新版本启动新任务集,运行集成测试(通过 Step Functions)
- 逐步路由流量到新应用
- CloudWatch 告警监控关键可靠性指标
- 金丝雀过程中任何告警触发则停止、回滚并通知团队

17:00 - 集成测试套件
- 使用 Python Locust 框架(传统上用于负载测试)
- 易于建模真实用户工作流
- 独特之处:驱动与游戏相同的 SDK(C++ SDK 的 Python 投影)
- 可针对游戏使用的每个已知 SDK 版本运行测试
- 在变更推出前验证与客户 SDK 版本的兼容性

19:00 - 负载测试
- 开发一年后进行全面负载测试
- 目标:每个垂直 10 万并发用户(当时 Gorilla Tag 的历史峰值)
- 基于真实用户流量模式但加速,使用更大载荷
- 主要瓶颈:数据库连接开销(应用端 IO 密集,数据库端 CPU 密集)
- 当时尚未使用 RDS Proxy

21:00 - 负载测试优化
- 曲棍球棒式扩展时大量数据库连接导致性能下降循环
- 解决方案:使用大型多核实例,跨核心分片
- 优势:更强大的 CPU,更慢的实例配置速度让数据库跟上
- 预配置大型数据库实例保持预热状态

23:00 - 初始成本状况
- 仲夏(VR 游戏全年最低点)运行成本
- 纯计算支出:每天约 1000 美元

24:00 - 成本优化开始(6 月)
- 启动全面云支出理解和削减工作
- 移除阻止使用 RDS Proxy 的组件
- 将 RDS Proxy 重新引入基础设施
- 缩减预热的大型实例,几乎完全转向 Aurora Serverless 计算
- 降低 Aurora Serverless 最小配置

26:00 - 探索 Graviton
- Cost Explorer 显示切换到 Graviton 可节省 4-6% 成本
- 数字看起来不显著(听说过更大节省案例)
- 联系 AWS 客户团队,专家预测 20-30% 节省
- 决定值得探索

28:00 - Graviton 迁移前的顾虑
- 团队对 ARM 架构缺乏经验
- 担心原生 Node 包(包括传递依赖)可能不支持 ARM
- 不确定对 CI 工具和监控的影响
- 担心同时进行太多成本削减措施
- 不同成本估算结果不一致,不确定投入是否值得

30:00 - Graviton 迁移实际过程
- 比预期简单得多
- 在安排会议期间,已完成个人电脑上的概念验证
- 当天结束时基本准备好投产
- Node 应用迁移到 ARM 相当简单
- ARM 足够流行,大多数常见 npm 包开箱即用
- Docker Buildx 使跨架构镜像构建变得简单

32:00 - 本地验证
- 约一小时完成本地跨架构构建(大部分时间用于研究)
- 使用 QEMU 运行本地 Docker Compose 跨架构堆栈
- 验证启动、运行本地测试,一切正常
- 依靠 Mothership 的广泛 CI 工具和测试覆盖

34:00 - 生产迁移步骤
1. 在 Code Pipeline 中禁用两个转换:staging 到第一个生产垂直,第一个生产垂直到 Gorilla Tag
2. 在个人桌面构建多架构镜像,推送到 ECR(自定义测试标签)
3. 手动创建针对 ARM 处理器的任务修订,部署到 staging ECS 集群
4. 验证应用启动和健康检查

36:00 - 正式部署流程
- 合并 GitHub 更改:更新构建器 action 生成多架构构建
- 更新任务定义使用更小的 ARM 实例
- 通过正常 CI 流程推出
- Staging 环境:新 ARM 实例启动,运行集成测试,执行金丝雀流量路由
- 次日:确认 staging 指标良好后,启用到第一个生产垂直的转换
- 第一个生产垂直(用于测试和孵化):任务成功启动,集成测试通过
- 启用最终转换,开始向游戏团队垂直推出
- 零停机时间,玩家零感知影响

39:00 - Graviton 迁移成果
- 从每天约 1000 美元降至约 250 美元
- 约 60% 的计算成本节省
- 总体云支出减少约 30%
- 纯按需使用定价(无计算节省计划、无 Spot 实例)

41:00 - 额外收益
- 从大型多核实例降至 2 vCPU 实例(因不再依赖数据库代理)
- 实例本身更便宜
- 更细粒度扩展,分配的 vCPU 减少约 25%
- ARM 架构本身可能带来性能提升
- 大型实例在自动扩展边界附近会出现抖动,小实例扩展更稳定

43:00 - 经验教训
1. 随着变化更新假设:因未重新审视数据库连接工作方式,长期运行不必要的昂贵计算配置
2. 某些听起来很大的变更实际很小:更换处理器架构听起来巨大,实际上很简单
3. 超越博客和营销材料,动手验证工作量
4. Cost Explorer 往往严重低估节省
5. 与客户团队合作寻找专家:引入 Graviton、RDS、ElastiCache 等服务专家,找到低效之处

46:00 - 最重要的经验
- 对 CI/CD 和测试基础设施的任何投资都会带来巨大回报
- 获得工程领导层完全支持进行大量工具投资
- 现在对代码部署有极大信心:工作状态、不会破坏游戏客户端、始终知道什么在哪里以及如何到达
- 这是 Mothership 稳定性的秘密武器

48:00 - 未来方向
- Orion Drift 和所有未来游戏 100% 使用 Mothership
- Gorilla Tag 使用 Mothership 处理关键工作负载(身份认证、分析),仍有少数遗留部分在迁移
- 探索不同托管模型,包括更多多租户垂直以实现低成本快速原型开发
- 探索新平台、新机会、新服务
- 与游戏团队合作持续演进平台

50:00 - 结束与行动号召
- 邀请观众试玩游戏(提供 Meta 产品详情页链接)
- 开放问答环节