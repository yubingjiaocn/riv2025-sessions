# AWS re:Invent 2025 EBS 性能优化会议总结

## 会议概述

本次会议由 AWS EBS 团队的高级首席工程师 Mark Olsen 和产品管理负责人 Jody 主讲,重点介绍了如何最大化 Amazon EBS 卷的性能表现。两位讲师通过虚构的医疗设备公司 Any Health 的案例,展示了从基础设施规划到生产环境故障排查的完整流程。

会议强调了在应用部署前进行充分测试和规划的重要性,包括选择合适的卷类型(GP3 vs IO2 Block Express)、理解性能指标、以及利用新推出的监控功能。讲师们还深入讲解了数据库工作负载的特殊考虑因素,如原子写入单元和双写保护,以及如何通过正确配置获得 30-35% 的性能提升。此外,会议介绍了 AWS Fault Injection Service (FIS) 等工具,帮助客户在受控环境下测试应用的弹性和故障恢复能力。

## 详细时间线

### 开场介绍 (0:00-3:30)
- **0:00** - Mark Olsen 自我介绍,高级首席工程师,负责 EBS 团队的代码编写和值班工作
- **1:45** - Jody 介绍自己负责 EBS、AWS Backup、Data Sync 和 Transfer Family 的产品管理
- **2:30** - 介绍会议目标:帮助客户在规划阶段做出更好的选择,并提供监控和故障排查技巧

### 场景设定与产品组合 (3:30-7:00)
- **3:30** - 引入虚构公司 Any Health(医疗设备制造和医疗软件公司)
- **4:15** - 强调医疗行业对数据持久性和合规性的高要求
- **5:00** - 快速回顾 AWS 存储产品组合:块存储(EBS)、对象存储(S3)、文件存储(FSx/EFS)
- **6:00** - 介绍 AWS Backup 的合规功能和 Data Sync 在 AI 工作负载中的应用

### EBS 卷类型与性能特性 (7:00-12:30)
- **7:00** - 解释 EBS 卷的基本特性:持久化网络附加存储,独立于 EC2 实例
- **8:00** - 重点介绍两种 SSD 卷类型:GP3 和 IO2 Block Express
- **9:00** - 宣布 GP3 的重大升级:IOPS 从 16K 提升到 80K,吞吐量翻倍至 2000 MB/s,最大卷大小从 16TB 增至 64TB
- **10:30** - 更新延迟指标:IO2 平均延迟低于 500 微秒,异常 IO 比 GP3 少 10 倍
- **11:30** - 介绍数据服务功能:快速水合(PRVI)和基于时间的快照复制

### 性能定义与一致性 (12:30-17:00)
- **12:30** - GP3 设计目标:99% 的时间内单位数毫秒延迟
- **13:00** - IO2 设计目标:99.9% 的时间内亚毫秒级延迟
- **14:00** - 使用火车通勤类比解释性能一致性差异
- **15:30** - GP3:每 100 天迟到一次;IO2:每 1000 天迟到一次
- **16:30** - 建议:不确定时从 GP3 开始,使用弹性卷功能按需调整

### 测试策略 (17:00-24:00)
- **17:00** - 强调测试的重要性:越接近应用层越好
- **18:00** - FIO 测试:验证最大性能限制,类比在空赛道上测试汽车
- **19:30** - TPCC 基准测试:模拟 OLTP 数据库的典型模式(订单录入、支付、交付)
- **21:00** - 负载测试:测试真实应用在高流量下的表现,发现瓶颈和重试风暴
- **22:30** - AWS Fault Injection Service (FIS):在受控混乱下测试弹性和故障恢复

### FIS 新功能 (24:00-28:00)
- **24:00** - 2024 年 9 月推出的 EBS FIS 延迟注入功能
- **25:00** - 可模拟降级的 IO 性能,测试 CloudWatch 告警和超时处理
- **26:00** - 提供预定义模板和自定义选项
- **27:00** - 可配置参数:IO 百分比、延迟量(IO2 最小 1ms,其他卷 10ms,最大 60 秒)、持续时间、读写分离

### 数据库工作负载配置 (28:00-35:00)
- **28:00** - Mark 接手讲解 OLTP 数据库配置
- **29:00** - 选择 MariaDB 作为患者信息数据库,使用 M 系列实例(4:1 内存 CPU 比)和 Graviton 4
- **30:30** - 存储配置:写前日志(WAL)使用 IO2(低延迟),数据卷使用 GP3(高吞吐量)
- **32:00** - 深入讲解 IO 栈:多个队列层、扇区分配单元、最大传输大小
- **34:00** - 解释数据库双写保护机制,防止部分写入(torn write)

### 原子写入优化 (35:00-38:00)
- **35:00** - Nitro 实例上 EBS 和本地存储支持更大的原子单元
- **36:00** - EBS 在所有当前 Nitro 实例上的最大原子大小为 16KB
- **37:00** - 通过正确的文件系统配置(ext4 对齐、Direct IO、big_alloc)可禁用双写保护
- **37:30** - RDS 已启用此优化,获得 30-35% 的性能提升

### 生产故障排查演示 (38:00-48:00)
- **38:00** - Mark 收到数据库积压告警,开始故障排查
- **39:00** - 使用 CloudWatch Application Insights 定位问题实例
- **40:00** - 检查实例状态检查指标:区分 AWS 基础设施问题和应用问题
- **41:30** - 系统状态检查失败:可通过停止/启动实例或启用 EC2 自动恢复解决
- **42:30** - EBS 附加状态检查:可故障转移到副本或从备份创建新卷
- **44:00** - 查看新推出的平均吞吐量和平均 IOPS 指标
- **45:30** - 发现数据卷吞吐量先下降后激增,然后在告警时刻骤降

### 突发性能分析 (48:00-53:00)
- **48:00** - 识别 M8G 4xlarge 实例具有突发能力
- **49:00** - 实例基准性能:20,000 IOPS,可突发至 40,000 IOPS(每天约半小时)
- **50:00** - 吞吐量突发余额耗尽导致性能下降至基准 625 MB/s
- **51:00** - 介绍新推出的突发余额状态检查指标,可集成到自动扩展组
- **52:00** - 建议升级到 M8G 8xlarge(无突发限制,双倍基准性能)

### 实例类型选择工具 (53:00-56:00)
- **53:00** - 介绍 describe-instance-types API 获取实例详细信息
- **54:00** - 演示使用 AWS CLI 和 jq 过滤实例类型
- **55:00** - 查找吞吐量大于 1200 MB/s 的实例类型
- **55:30** - 最终选择 M8G 8xlarge,考虑留有余量可选择 12xlarge

### 会议结束
- **56:00** - 会议结束