# Apache Iceberg V3 及未来发展技术会议总结

## 会议概述

本次AWS re:Invent 2025技术会议由AWS产品经理Ron Ortloff和首席软件工程师Yuri Zarubin主讲，重点介绍Apache Iceberg V3规范的新特性及V4未来发展方向。会议属于开源技术专题，主要聚焦于Iceberg规范本身的技术创新，而非AWS服务的具体实现。

演讲者详细阐述了Iceberg V3的三大核心特性：变体数据类型(Variant Data Type)、删除向量(Deletion Vectors)和行血缘(Row Lineage)，这些特性在客户使用案例中表现出最高的关注度和实用价值。此外，会议还涵盖了V3规范中的其他重要功能，包括核心基础设施改进和新增数据类型支持，最后展望了Apache Iceberg V4社区提案的发展趋势。

## 详细时间线与关键要点

### 0:00-5:00 会议开场与项目历史回顾
- 介绍演讲者和会议主题：Apache Iceberg V3新特性
- Apache Iceberg项目发展历程：
  - 2017年：Netflix启动项目
  - 2018年：成为Apache孵化项目
  - 2020年：成为Apache顶级项目
  - 2021年：V2规范发布，引入merge-on-read功能
  - 2025年5月：V3规范正式批准

### 5:00-10:00 规范与发布流程说明
- Apache软件基金会项目的规范(Specifications)与发布(Releases)区别
- 规范是合约文档，需要PMC投票批准
- 发布是规范的具体实现，从1.7到1.10版本逐步实现V3特性
- 强调V3规范尚未在任何发布版本中100%实现

### 10:00-20:00 变体数据类型(Variant Data Type)详解
- Iceberg数据类型分类：原始类型、结构化类型、半结构化类型(变体)
- V2版本处理半结构化数据的痛点：
  - 强制转换为结构化数据
  - 物化额外列
  - 使用字符串存储(性能最差)
- 变体数据类型使用场景：
  - IoT工作负载：事件驱动模型，模式最好在读取时应用
  - 数据管道：落地数据到变体类型，避免预处理转换
  - 实时分析：需要立即查询落地数据

### 20:00-25:00 变体数据类型的分片(Shredding)机制
- 分片过程演示：将变体字段自动分解为隐藏的子列
- 性能优势：相比结构化类型快4倍，相比字符串快10倍以上
- 支持列式存储、统计信息和谓词下推优化

### 25:00-35:00 删除向量(Deletion Vectors)特性
- 写入模式对比：
  - Copy-on-write：重写整个数据文件
  - Merge-on-read：写入删除文件，读取时合并
- V2中的删除类型：等值删除和位置删除
- V3删除向量改进：
  - 替代V2位置删除
  - 使用位图格式存储在Puffin文件中
  - 每个快照只允许一个删除文件
- 应用场景：GDPR合规、数据清理、增量数据管道

### 35:00-42:00 行血缘(Row Lineage)功能
- 变更跟踪功能，默认启用无法关闭
- 自动添加隐藏列：行ID和序列号
- 使用场景：
  - 增量处理：基于序列号识别变更
  - 事件生命周期跟踪：订单状态变更追踪
  - 缓慢变化维度：支持类型2维度
  - 调试和合规：追踪数据修改历史
- 相比V2变更日志的优势：无需额外计算成本，自动维护

### 42:00-46:00 V3其他核心功能
- 核心基础设施改进：
  - 默认值：存储在元数据中，读取时替换
  - 表加密密钥：支持KMS集成和密钥轮换
  - 多参数转换：支持多列分区和排序
- 新增数据类型：
  - 纳秒时间戳：支持高频时间工作负载
  - 地理类型：地理和几何数据类型，遵循OGC标准
  - 未知类型：模式演进时的空值占位符

### 46:00-49:00 Apache Iceberg V4展望
- V4提案重点关注性能优化而非功能扩展
- 主要提案包括：
  - 改进列统计：优化大量列场景的内存使用
  - 自适应元数据树：合并清单列表和清单层，提升小写入性能
  - 相对路径：支持表复制到不同存储位置
- 社区参与呼吁：鼓励用户试用V3功能并参与社区贡献