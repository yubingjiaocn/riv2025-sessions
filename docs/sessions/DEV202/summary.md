# AWS re:Invent 2025 会议总结：从指标到管理 - EKS 上的实用可观测性

## 会议概述

本次会议由 Dale Orers（59 公司软件工程师）和 Emil Labinsky（AWS DevOps 工程师）共同主讲，两位演讲者均为 AWS 社区建设者。会议主题聚焦于在 Amazon EKS（Elastic Kubernetes Service）环境中实现实用的可观测性解决方案。

演讲者首先阐述了可观测性的核心概念，强调其本质是从应用程序中提取可操作的洞察，以评估和改进应用程序的性能、健康状况和行为。可观测性被定义为一个持续循环的过程，包括检测、调查、修复和评估四个关键阶段。会议深入探讨了可观测性的四大信号：指标（Metrics）、追踪（Traces）、日志（Logs）和性能分析（Profiles），并详细介绍了如何使用 AWS 托管服务 Amazon Managed Service for Prometheus (AMP) 和 Amazon Managed Grafana (AMG) 来实现容器化工作负载的全面监控。最后通过实际演示展示了如何在 EKS 集群上配置这些服务，包括创建 Prometheus 抓取器、配置工作空间、设置数据源以及创建可视化仪表板。

## 详细时间线

### 开场与议程介绍
[00:00:00 - 00:01:30]
- 会议开始，Dale Orers 和 Emil Labinsky 介绍自己
- 展示会议议程：自我介绍、可观测性概念、应用程序可观测性实现、AWS 服务介绍（AMP 和 AMG）、实际演示

### 可观测性基础概念
[00:01:30 - 00:03:45]
- 定义可观测性：从应用程序中提取可操作洞察的能力
- 强调可观测性关注应用程序的性能、行为和健康状况
- 介绍可观测性的持续循环：检测（Detect）→ 调查（Investigate）→ 修复（Remediate）→ 评估（Assess）

[00:03:45 - 00:05:00]
- 可观测性的重要性：
  - 深入了解应用程序健康状况
  - 更好地排查问题
  - 提供卓越的客户体验
  - 控制成本

### 可观测性信号详解
[00:05:00 - 00:07:15]
- 四大可观测性信号：
  - **指标（Metrics）**：我是否有问题？
  - **追踪（Traces）**：问题在哪里？
  - **日志（Logs）**：是什么导致了问题？
  - **性能分析（Profiles）**：代码如何运行？

[00:07:15 - 00:08:30]
- 实际应用场景示例：
  - 指标：为什么我的应用程序比上周慢 25%？
  - 追踪：此服务的依赖关系是什么？
  - 日志：为什么更新后数据库无法启动？
  - 性能分析：代码中是否存在内存泄漏？
- 这些信号共同帮助实现 SLO 和 SLA 合规目标

### Amazon Managed Service for Prometheus (AMP)
[00:08:30 - 00:10:45]
- AMP 介绍：
  - 完全托管的无服务器 Prometheus 兼容监控服务
  - 基于开源 Prometheus
  - 提供高可用性，多可用区设计
  - 使用 Prometheus 数据模型和 PromQL 查询语言
  - 无缝监控容器化工作负载

[00:10:45 - 00:12:30]
- 架构说明：
  - 使用 Prometheus SDK 对应用程序代码进行插桩
  - 将指标暴露给运行在 Kubernetes 集群上的 Prometheus 服务器
  - 使用 OpenTelemetry 或 AWS Distro for OpenTelemetry 收集器聚合指标
  - 通过远程写入操作将指标发送到 AMP

[00:12:30 - 00:13:45]
- 收集器详细配置：
  - 使用接收器（Receiver）和导出器（Exporter）
  - 演示两条管道：追踪管道导出到 AWS X-Ray，指标管道导出到 AMP

[00:13:45 - 00:15:00]
- AMP 最佳实践：
  - 使用 PrivateLink 和 IAM 确保指标安全传输
  - 通过增加抓取间隔和调整 relabel 配置过滤器降低成本
  - 设置适当的数据保留期
  - 运行多个容器确保管道高可用性
  - 使用一致的标识符实现数据关联

### Amazon Managed Grafana (AMG)
[00:15:00 - 00:16:30]
- AMG 介绍：
  - AWS 完全托管的 Grafana 服务
  - 广泛使用的开源分析可视化平台
  - 用于创建可视化、告警、指标和追踪

[00:16:30 - 00:18:00]
- AMG 架构集成：
  - 在现有设置基础上工作
  - 应用程序通过 OpenTelemetry 抓取数据并发送到 AMP
  - AMG 配置为从 AMP 读取数据并展示给用户
  - 可以推送到多个服务：OpenSearch、CloudWatch Logs、X-Ray

[00:18:00 - 00:19:00]
- AMG 最佳实践：
  - 确保仪表板清晰且有用
  - 每个仪表板讲述一个清晰的故事
  - 回答特定问题，保持透明和具体

### 实际演示
[00:19:00 - 00:21:30]
- 演示 EKS 集群可视化
- 展示已配置的资源和可观测性选项卡
- Prometheus 指标部分：
  - 添加抓取器（Scraper）
  - 创建工作空间
  - 配置 YAML 文件，包括抓取间隔、relabel 配置、标签映射和过滤

[00:21:30 - 00:23:00]
- AMP 工作空间配置：
  - 展示已创建的抓取器和工作空间
  - 工作空间是用于写入和查询收集数据的集合
  - 设置保留期（从成本管理角度很重要）

[00:23:00 - 00:25:30]
- IAM 角色配置：
  - 创建 IAM 角色以允许服务间通信
  - 验证角色权限
  - 参考 AWS 详细文档进行配置
  - 部署 Prometheus 代理到集群

[00:25:30 - 00:27:00]
- Grafana 配置：
  - 展示 AMG 作为完全托管服务的简单配置
  - 配置数据源（AMP）
  - 创建工作空间
  - 登录 Grafana 并设置数据源连接

[00:27:00 - 00:29:00]
- 数据源连接配置：
  - 指向 AMP 获取数据
  - 设置身份验证（默认使用 SigV4 授权）
  - 使用 IAM 角色提供足够的权限

[00:29:00 - 00:32:00]
- 创建可视化仪表板：
  - 查看部署标签（命名空间、镜像、选择器）
  - 演示编辑和过滤可视化
  - 展示如何清理和测试查询
  - 过滤历史数据以减少负担
  - 添加自定义和特定标签

### 总结
[00:32:00 - 00:33:30]
- 总结要点：
  - 可以仅使用 AWS 完全托管服务（AMP 和 AMG）轻松创建可观测性解决方案
  - 这些服务像 Lambda 一样完全由 AWS 管理
  - 团队可以专注于可观测性本身，关注 SLO、SLA 和 SLI
  - 最终目标是确保客户满意，交付高质量产品

[00:33:30 - 00:34:00]
- 会议结束，演讲者提供 LinkedIn 联系方式（QR 码）
- 邀请观众提问和交流