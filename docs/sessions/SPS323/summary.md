# AWS re:Invent 2025 会议总结：事件驱动架构与 EventBridge 安全

## 会议概述

本次技术分享由 AWS 专业服务团队的 Sergio Bilbao（高级云基础架构架构师）和 Igor Das Dulfo（DevOps 架构师）主讲，重点探讨了基于 Amazon EventBridge 的事件驱动架构的安全最佳实践。

演讲者通过一个虚构的电商公司 Novelware.com 的案例，展示了从同步架构迁移到异步事件驱动架构的完整过程，以及在此过程中遇到的典型安全问题和解决方案。会议强调了事件驱动架构的核心优势，包括松耦合、可扩展性、异步处理、事件溯源和灵活性。演讲者特别指出，异步架构更接近人类的工作方式，能够显著提升系统性能和用户体验。

通过三个版本的迭代演示，讲师详细说明了如何逐步加强 EventBridge 的安全防护：从最初完全开放的配置，到限制组织内部访问，再到精细化的角色和事件内容验证。此外，还介绍了使用 Schema Registry 确保消息完整性，以及利用 AWS Config 进行持续合规性监控的方法。整个会议强调了"纵深防御"的安全理念，即使在单账户环境中也应该实施多层安全控制。

## 详细时间线与关键要点

### **开场与背景介绍 (00:00 - 05:30)**
- **00:00** - 会议开始，演讲者询问现场观众使用 EventBridge 和事件驱动架构的情况，发现使用率不高
- **01:20** - Sergio Bilbao 自我介绍，AWS 专业服务高级云基础架构架构师
- **01:35** - Igor Das Dulfo 自我介绍，AWS 意大利专业服务 DevOps 架构师
- **02:00** - 介绍会议议程：异步架构优势、虚构公司案例研究、安全建议和最佳实践

### **异步架构的优势 (05:30 - 10:00)**
- **05:30** - 引用 Werner Vogels 的观点：异步更符合人类的工作方式
- **06:15** - 松耦合（Loose Coupling）：解耦系统不同模块，提供未来扩展的灵活性
- **06:45** - 可扩展性（Scalability）：无需管理服务器或自动扩展组，自动应对流量峰值
- **07:20** - 异步处理（Asynchronous Processing）：改善用户体验，用户无需等待长时间操作完成
- **08:00** - 事件溯源（Event Sourcing）：基于事件驱动，无需轮询远程系统状态
- **08:40** - 灵活性（Flexibility）：模块化更新，无需同步更新所有 API 版本

### **案例介绍：Novelware.com (10:00 - 15:00)**
- **10:00** - 介绍虚构公司 Novelware.com，一家销售奢侈品的电商平台
- **10:45** - 公司面临的挑战：业务增长导致流量峰值无法处理，影响收入
- **11:30** - 决定从同步架构迁移到基于 EventBridge 的异步架构
- **12:15** - 展示目标架构：API Gateway → EventBridge → 多个消费者（支付、通知、仓库管理等）

### **技术实现与代码结构 (15:00 - 20:00)**
- **15:00** - Igor 介绍项目使用 Terraform（基础设施即代码）和 Python（Lambda 函数）
- **15:45** - 项目模块化结构：EventBridge 核心、生产者（API Gateway + Lambda）、消费者（SQS + Lambda）
- **16:30** - 包含监控仪表板和 AWS Config 自定义规则
- **17:20** - 代码组织：模块（可重用组件）和部署（特定配置）分离
- **18:00** - 演示辅助脚本：合法流量生成器正在运行

### **第一个安全问题：外部访问控制 (20:00 - 28:00)**
- **20:00** - 版本 1.0 问题：业务团队发现 EventBridge 中出现异常消息
- **21:00** - 监控仪表板显示：到达 EventBridge 的消息数量远超 Lambda 调用次数
- **22:00** - 介绍多账户策略（Multi-Account Strategy）的重要性和最佳实践
- **23:30** - 发现问题：资源策略使用通配符（*），允许任何人向 EventBridge 发送事件
- **24:00** - 观众指出问题：野卡（wildcard）配置
- **24:30** - 解决方案 v2.0：添加条件限制，仅允许组织内账户访问
- **25:30** - 应用新策略，演示外部恶意生产者开始失败
- **27:00** - 强调这是 90% 客户环境中的常见配置错误

### **第二个安全问题：内部访问控制 (28:00 - 38:00)**
- **28:00** - 版本 2.0 问题：业务团队再次报告异常消息
- **28:45** - 分析发现：仍有超出预期的消息数量
- **29:30** - 根本原因：另一个团队复制了配置，向同一 EventBridge 发送不同领域的事件
- **30:30** - 检查 EventBridge 规则：使用空事件模式（{}），匹配所有事件
- **31:30** - Igor 说明空模式的合理用途：审计和存储所有事件用于分析
- **32:00** - 解决方案 v3.0：
  - 将资源策略从通配符改为特定 IAM 角色
  - 添加事件源（event source）条件验证
  - 更新规则的事件模式，仅匹配特定源和详细类型
- **35:00** - 应用更新，演示恶意内部生产者开始失败
- **36:30** - 观众提问：是否应该使用自定义 EventBus 而非默认总线

### **最佳实践：自定义 EventBus (38:00 - 42:00)**
- **38:00** - 建议：对于严格安全要求，使用自定义 EventBus 而非默认总线
- **38:45** - 默认总线适用场景：非敏感信息的日志记录等
- **39:30** - 自定义总线优势：
  - 更好的隔离性
  - 更容易管理事件和规则
  - 降低变更影响范围（爆炸半径）
  - 支持按领域/应用分离
- **41:00** - Igor 补充：多个应用共享默认总线会增加管理复杂度和风险

### **消息完整性：Schema Registry (42:00 - 52:00)**
- **42:00** - 第三个问题：消息格式不一致导致大量消息被丢弃
- **43:00** - 介绍 Schema Registry 的作用：确保生产者和消费者之间的契约
- **44:00** - 展示 AWS Event Schema Registry，包含 AWS 服务的标准事件模式
- **45:00** - 演示自动发现功能：EventBridge 可以基于实际事件自动生成 Schema
- **46:30** - 展示三种事件类型：订单取消、订单创建、订单更新
- **47:30** - 代码绑定（Code Bindings）：可下载多种编程语言的类型定义
- **48:30** - Schema 验证示例：total_amount 字段定义为 double 类型，自动验证数据类型
- **49:30** - 版本控制支持：允许 API 演进同时保持向后兼容
- **51:00** - 强调 Schema Registry 对于团队协作和应用演进的重要性

### **持续合规性监控：AWS Config (52:00 - 62:00)**
- **52:00** - 问题场景：DevOps 过程中开发人员可能意外修改安全配置
- **53:00** - 介绍两种监控需求：检测异常、追踪策略变更
- **54:00** - AWS Config 介绍：记录所有资源的创建、更新、删除
- **55:00** - 展示配置项（Configuration Item）：EventBridge 的完整配置历史
- **56:00** - 演示故意恢复不安全的策略版本（v1.0）以触发检测
- **57:00** - AWS 托管规则：预定义的合规性检查规则
- **58:00** - 自定义规则：使用 Lambda 实现复杂的策略验证逻辑
- **59:00** - 展示 Python 代码：验证策略必须包含 IAM 角色（非通配符）和事件源条件
- **60:00** - Config 显示资源为"不合规"状态
- **60:45** - 应用正确的策略版本
- **61:30** - 说明 Config 是异步的，通常需要 2-5 分钟更新合规状态

### **安全最佳实践总结 (62:00 - 结束)**
- **62:00** - 强调即使在单账户环境中也应使用资源策略
- **62:30** - 纵深防御（Defense in Depth）：多层安全控制，即使一层被突破仍有其他保护
- **63:00** - 等待 Config 更新合规状态（演示时间限制）
- **63:45** - 总结常见问题：90% 的客户在初期都会遇到类似的安全配置错误
- **64:30** - 强调审计的重要性：不仅要实施安全措施，还要持续监控配置变更
- **65:00** - 会议结束，关键要点回顾：
  - 从外部访问控制到内部精细化权限
  - 使用 Schema Registry 确保消息完整性
  - 通过 AWS Config 实现持续合规性监控
  - 采用自定义 EventBus 和纵深防御策略