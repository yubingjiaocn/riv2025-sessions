1
00:00:00,698 --> 00:00:01,419
Hello everyone.

2
00:00:02,379 --> 00:00:03,559
Thanks for joining today.

3
00:00:03,818 --> 00:00:06,259
Um, and I hope you're all enjoying the reinvent

4
00:00:06,259 --> 00:00:06,919
sessions.

5
00:00:07,379 --> 00:00:09,538
Um, today, we're gonna have a session on,

6
00:00:09,819 --> 00:00:12,019
um, multi-agent collaboration with

7
00:00:12,019 --> 00:00:12,669
Amazon,

8
00:00:13,050 --> 00:00:15,300
uh, Bedrock Agent Corp for advanced security

9
00:00:15,300 --> 00:00:16,179
operations. OK.

10
00:00:16,620 --> 00:00:18,739
How many of you here from security

11
00:00:18,739 --> 00:00:21,019
operations or security, uh, that

12
00:00:21,019 --> 00:00:21,978
reports to the CISO team?

13
00:00:22,269 --> 00:00:22,940
Anybody here?

14
00:00:25,629 --> 00:00:27,809
OK. So how many of you are

15
00:00:27,809 --> 00:00:28,458
developers here?

16
00:00:30,719 --> 00:00:31,519
OK, good.

17
00:00:32,548 --> 00:00:34,588
How many of you guys used uh Agent

18
00:00:34,588 --> 00:00:35,258
Core so far?

19
00:00:36,939 --> 00:00:39,179
And it's good. Uh, it's a quite good time. OK.

20
00:00:39,969 --> 00:00:42,009
Now, um, this session is mostly focused

21
00:00:42,009 --> 00:00:44,240
on, uh, how to leverage, uh, Agent

22
00:00:44,240 --> 00:00:46,329
Core, uh, to run the security operations

23
00:00:46,329 --> 00:00:47,770
using multi-agents, OK?

24
00:00:48,500 --> 00:00:50,658
Now, uh, I'm, my name is Venkata. I'm

25
00:00:50,658 --> 00:00:52,179
a senior solutions architect. I'm

26
00:00:52,500 --> 00:00:54,289
with AWS a little over 6 years,

27
00:00:54,740 --> 00:00:56,929
and I'm based out of New Jersey, and, uh, I'm

28
00:00:56,929 --> 00:00:59,020
also a specialist in, uh, AML and as

29
00:00:59,020 --> 00:01:00,069
well as resiliency.

30
00:01:00,500 --> 00:01:02,560
Today I was joined by my colleague Eric.

31
00:01:03,658 --> 00:01:05,808
Hi, I'm Eric Hortzen. I'm a solutions architect

32
00:01:05,808 --> 00:01:07,948
based out of Atlanta and a

33
00:01:07,948 --> 00:01:09,099
specialist in,

34
00:01:09,418 --> 00:01:11,900
uh, machine learning and agentic

35
00:01:11,900 --> 00:01:12,459
solutions,

36
00:01:12,870 --> 00:01:15,099
and I'm gonna be walking

37
00:01:15,099 --> 00:01:16,180
through the code demo today,

38
00:01:16,459 --> 00:01:17,620
yeah. So we're gonna,

39
00:01:17,909 --> 00:01:18,730
today, we're gonna present,

40
00:01:19,028 --> 00:01:19,620
uh,

41
00:01:19,989 --> 00:01:22,540
what is the challenge that we are trying to solve in the security

42
00:01:22,540 --> 00:01:23,430
operations, OK?

43
00:01:23,790 --> 00:01:25,849
And how we are going to leverorage Agent Core

44
00:01:25,849 --> 00:01:27,948
and a little overview on, uh, Agent Core,

45
00:01:28,219 --> 00:01:29,359
uh, Bedrock Agent Corps.

46
00:01:29,870 --> 00:01:31,909
And then we're gonna talk about the solution that we want

47
00:01:31,909 --> 00:01:33,230
to, uh, deploy,

48
00:01:33,588 --> 00:01:35,739
and we want to, uh, run the security

49
00:01:35,739 --> 00:01:37,250
operations. And

50
00:01:37,629 --> 00:01:39,629
we're gonna followed by a core talk, uh,

51
00:01:39,668 --> 00:01:41,709
which, uh, Eric is gonna walk through you through

52
00:01:41,709 --> 00:01:42,269
the code.

53
00:01:42,739 --> 00:01:44,790
And we want to make it more interactive, so feel free

54
00:01:44,790 --> 00:01:47,028
to ask me, uh, any questions, and we'll be happy to

55
00:01:47,028 --> 00:01:47,859
address that, OK?

56
00:01:48,159 --> 00:01:50,549
And there will be a demo after the core doc as well, OK?

57
00:01:52,588 --> 00:01:54,870
Now, uh, some of you are coming from the security

58
00:01:54,870 --> 00:01:57,510
background and some of you coming from the, uh, developers's

59
00:01:57,510 --> 00:01:59,069
background, uh, when you raised hands,

60
00:01:59,510 --> 00:02:01,709
uh, as a solution architect, I worked with

61
00:02:01,709 --> 00:02:03,939
day to day with multiple customers, um,

62
00:02:04,230 --> 00:02:06,338
across the organization and then

63
00:02:06,338 --> 00:02:07,739
sort of my organization as well.

64
00:02:08,219 --> 00:02:10,288
So when we, uh, work with the customers,

65
00:02:10,588 --> 00:02:12,129
uh, I mainly,

66
00:02:12,389 --> 00:02:14,429
uh, ask the question with the customers, what are the

67
00:02:14,429 --> 00:02:15,008
things that

68
00:02:15,308 --> 00:02:17,508
they focus on, and they always

69
00:02:17,508 --> 00:02:19,508
tell me two things. One, a strategic, and

70
00:02:19,508 --> 00:02:21,149
they always look for the operationals.

71
00:02:21,710 --> 00:02:23,800
When it comes to operational specifically for

72
00:02:23,800 --> 00:02:25,308
security, um,

73
00:02:25,679 --> 00:02:27,960
when I interact with the security team, they always say that

74
00:02:27,960 --> 00:02:29,969
we always work on the repeat 2 task.

75
00:02:30,479 --> 00:02:32,520
So, when I did a deep dive on that, what

76
00:02:32,520 --> 00:02:34,778
do you mean by repeated 2 tasks, they're gonna talk about,

77
00:02:34,919 --> 00:02:36,969
we do get a lot of alerts from different security

78
00:02:36,969 --> 00:02:37,899
services that we use,

79
00:02:38,159 --> 00:02:40,439
OK. And we spend a lot of time

80
00:02:40,439 --> 00:02:42,460
on reviewing those or investigating

81
00:02:42,460 --> 00:02:43,770
those security alerts,

82
00:02:44,058 --> 00:02:46,139
and they work on the remediations and

83
00:02:46,139 --> 00:02:48,460
they're gonna summarize it and they're gonna send an

84
00:02:48,460 --> 00:02:50,639
email to the entire leadership of the

85
00:02:51,319 --> 00:02:52,419
organization that they report.

86
00:02:52,939 --> 00:02:55,058
So those are the repetitive tasks, uh,

87
00:02:55,099 --> 00:02:55,679
and

88
00:02:55,979 --> 00:02:56,599
it is

89
00:02:57,219 --> 00:02:59,258
based on the, not a specific use case

90
00:02:59,258 --> 00:03:01,368
or a specific environment, it's every

91
00:03:01,368 --> 00:03:02,538
organization that I have this insight.

92
00:03:03,439 --> 00:03:05,788
Now, most of the time, they, uh,

93
00:03:05,800 --> 00:03:07,800
they spent on the manual work. So they have to do

94
00:03:07,800 --> 00:03:08,719
the investigation,

95
00:03:09,118 --> 00:03:11,118
they have to remediate it, and then they have to send

96
00:03:11,118 --> 00:03:11,659
the report.

97
00:03:12,558 --> 00:03:14,969
And that becomes a complex, uh, and

98
00:03:14,969 --> 00:03:16,229
operational burden, OK?

99
00:03:16,520 --> 00:03:18,520
And these teams are more focused on the operational

100
00:03:18,520 --> 00:03:21,038
rather than on the strategic initiatives, OK?

101
00:03:21,360 --> 00:03:23,399
If it is a task is repetitive, we want to

102
00:03:23,399 --> 00:03:24,219
automate it

103
00:03:24,520 --> 00:03:26,599
and we want to leverage the agents here, and that's why

104
00:03:26,599 --> 00:03:27,599
we want to leverage,

105
00:03:28,038 --> 00:03:30,399
uh, agent, multi-agents in

106
00:03:30,399 --> 00:03:31,960
security operations today, OK.

107
00:03:32,819 --> 00:03:34,618
Now, how do we do that? OK.

108
00:03:35,179 --> 00:03:37,278
Now, If you

109
00:03:37,278 --> 00:03:39,278
look at it, we have 3 steps

110
00:03:39,278 --> 00:03:41,479
that we follow when we get an alert from the other

111
00:03:41,479 --> 00:03:43,219
security team. So can anybody tell here?

112
00:03:44,110 --> 00:03:46,139
So when you get on a security alert, what exactly

113
00:03:46,139 --> 00:03:48,300
do you guys do? Can you describe in three steps

114
00:03:48,300 --> 00:03:48,849
anybody in the room?

115
00:03:53,038 --> 00:03:53,860
We start with

116
00:03:54,838 --> 00:03:56,159
investigation, OK?

117
00:03:56,520 --> 00:03:58,349
We start with the investigation, OK?

118
00:03:58,758 --> 00:04:00,360
What is the alert is about,

119
00:04:00,639 --> 00:04:02,189
how it is impacting, OK?

120
00:04:02,520 --> 00:04:04,558
And then we'll go to the second step where we want

121
00:04:04,558 --> 00:04:06,240
to do a remediation, OK?

122
00:04:06,679 --> 00:04:09,038
There are two steps of remediation. The first one is

123
00:04:09,038 --> 00:04:11,439
we want to tactical, which we want to fix it immediately

124
00:04:11,439 --> 00:04:13,610
so that it won't impact the entire environment.

125
00:04:14,118 --> 00:04:16,238
The second step is we want to fix it for long

126
00:04:16,238 --> 00:04:17,309
term as well, OK?

127
00:04:17,639 --> 00:04:19,720
If that, we should not see that alert again and

128
00:04:19,720 --> 00:04:20,559
again, right?

129
00:04:20,959 --> 00:04:23,139
So there are two steps that we follow. That's the second step.

130
00:04:23,557 --> 00:04:24,778
The 3rd 1 is

131
00:04:25,079 --> 00:04:26,048
we want to do a,

132
00:04:26,319 --> 00:04:27,538
uh, we call it as RCA,

133
00:04:27,838 --> 00:04:30,079
but we, we want to do an entire end to end report

134
00:04:30,269 --> 00:04:32,358
when the alert came and what did we do and

135
00:04:32,358 --> 00:04:33,759
how did we fix it, OK?

136
00:04:34,238 --> 00:04:36,238
So those are the common 3 steps that we see in a

137
00:04:36,238 --> 00:04:38,177
workflow for security operations, right?

138
00:04:38,798 --> 00:04:40,918
Now, if you look at those 3

139
00:04:40,918 --> 00:04:43,199
steps, and they are repetitive, for

140
00:04:43,199 --> 00:04:45,238
any alert, it's a repetitive process

141
00:04:45,238 --> 00:04:46,759
actually. There's no change, OK?

142
00:04:47,199 --> 00:04:49,519
Primarily, we're gonna leverage those 3 steps

143
00:04:49,838 --> 00:04:51,939
to build 3 different agents

144
00:04:52,230 --> 00:04:54,629
to work for us to do this work, OK?

145
00:04:54,858 --> 00:04:56,629
The security operations work, OK.

146
00:04:57,079 --> 00:04:58,858
Now, for that, we're gonna leverage

147
00:04:59,278 --> 00:05:01,379
Amazon Bedrock agent core, OK?

148
00:05:02,488 --> 00:05:04,649
Platform is fully managed, uh, which

149
00:05:04,649 --> 00:05:06,149
gives you flexibility to build,

150
00:05:06,528 --> 00:05:07,149
deploy,

151
00:05:07,488 --> 00:05:09,759
and run the multi-agents, uh,

152
00:05:09,769 --> 00:05:11,209
in a secure way, OK.

153
00:05:11,730 --> 00:05:13,809
Now, within the agent core, you have the

154
00:05:13,809 --> 00:05:14,439
runtime where

155
00:05:15,369 --> 00:05:17,470
you can build the agents using

156
00:05:18,009 --> 00:05:19,988
multiple models and as well as,

157
00:05:20,329 --> 00:05:22,600
uh, different frameworks like lang chain, Lang fuse,

158
00:05:22,678 --> 00:05:25,160
and QAI, OK? That's the agent frameworks

159
00:05:25,160 --> 00:05:26,048
that you can bring in and

160
00:05:26,470 --> 00:05:28,889
We also have AWS strands, SDK,

161
00:05:29,149 --> 00:05:30,470
this agents framework

162
00:05:30,750 --> 00:05:32,709
that you can use to build the agents, OK?

163
00:05:33,470 --> 00:05:34,009
Now,

164
00:05:34,790 --> 00:05:36,790
as an agent, that's the runtime that we're gonna build

165
00:05:36,790 --> 00:05:38,988
it and we're gonna run that agent in the runtime

166
00:05:38,988 --> 00:05:40,750
itself, OK? Um, agent code.

167
00:05:41,309 --> 00:05:43,470
Now, similar to the humans,

168
00:05:43,619 --> 00:05:46,189
agents also requires certain memory capabilities,

169
00:05:46,350 --> 00:05:48,149
certain access to the internal systems.

170
00:05:48,488 --> 00:05:50,338
To analyze the events, OK.

171
00:05:50,769 --> 00:05:52,869
For that, we have agent core gateway,

172
00:05:52,889 --> 00:05:54,920
which will help you to connect to the different tools like

173
00:05:54,920 --> 00:05:57,088
humans. When we get an alert, we'll

174
00:05:57,088 --> 00:05:59,129
connect to some CMDB database to identify

175
00:05:59,129 --> 00:06:01,399
the details, what, what kind of server it is,

176
00:06:01,649 --> 00:06:02,750
and how is it impacting,

177
00:06:03,129 --> 00:06:04,548
and when should I patch that server,

178
00:06:04,939 --> 00:06:07,509
and what is the patching schedule. Everything resides in a CMDB,

179
00:06:07,649 --> 00:06:09,730
OK? So as a human, I'll just log

180
00:06:09,730 --> 00:06:11,889
into the CMDB and identify that. Similarly, agent

181
00:06:11,889 --> 00:06:13,428
needs to have similar capabilities.

182
00:06:13,910 --> 00:06:16,269
To log into the CMDB, identify the details,

183
00:06:16,399 --> 00:06:18,519
and create an, uh, impact analysis report.

184
00:06:18,639 --> 00:06:20,209
So based on the alert, OK?

185
00:06:20,559 --> 00:06:22,579
So, we need to use the same capabilities to the agent

186
00:06:22,579 --> 00:06:24,600
to uh to work uh as

187
00:06:24,600 --> 00:06:25,278
a human,

188
00:06:25,720 --> 00:06:28,079
uh, for, for this workflow, OK?

189
00:06:28,480 --> 00:06:30,178
Similarly, we have, um,

190
00:06:31,189 --> 00:06:33,189
Agent core browser, which will

191
00:06:33,189 --> 00:06:35,269
give you an interactions with the browser interactions. OK,

192
00:06:35,329 --> 00:06:36,858
right now we're not using it, but

193
00:06:37,309 --> 00:06:39,389
uh we also have agent core identity.

194
00:06:39,750 --> 00:06:41,569
In order to connect to the internal systems,

195
00:06:41,949 --> 00:06:44,069
you have a username and password. Similarly, you

196
00:06:44,069 --> 00:06:46,250
want to control when the agent is trying to

197
00:06:46,660 --> 00:06:49,069
gather the details from internal systems. Uh,

198
00:06:49,230 --> 00:06:51,269
we need to provide some kind of authentication mechanism, an

199
00:06:51,269 --> 00:06:52,369
authorization mechanism

200
00:06:52,709 --> 00:06:54,809
so that we can control what agent can see

201
00:06:54,809 --> 00:06:56,189
and what agent can use,

202
00:06:56,509 --> 00:06:58,738
OK? Uh, at the end, we

203
00:06:58,738 --> 00:07:00,369
want to make sure that

204
00:07:00,939 --> 00:07:03,059
what are the actions that are performed by agent, we

205
00:07:03,059 --> 00:07:04,980
want to log it and we want to track it.

206
00:07:05,338 --> 00:07:07,379
That's where agent core observability comes into the picture.

207
00:07:08,019 --> 00:07:10,160
So combining all these components

208
00:07:10,379 --> 00:07:12,100
becomes an agent core platform

209
00:07:12,420 --> 00:07:14,459
which will provide end to end, a single

210
00:07:14,459 --> 00:07:16,319
platform that you can build the agents,

211
00:07:16,778 --> 00:07:18,980
deploy the agents, and run the agents

212
00:07:18,980 --> 00:07:20,899
at scale and securely, OK?

213
00:07:21,298 --> 00:07:23,358
That's where we're gonna elaborate, uh, today

214
00:07:23,540 --> 00:07:25,500
to build, uh, our solution.

215
00:07:26,588 --> 00:07:28,738
Well, Um,

216
00:07:29,019 --> 00:07:31,048
this is the architecture that we are trying to

217
00:07:31,059 --> 00:07:32,399
build today, OK,

218
00:07:32,858 --> 00:07:34,858
uh, to deploy the agents, uh, in

219
00:07:34,858 --> 00:07:37,059
our environment to take care of the security

220
00:07:37,059 --> 00:07:38,220
operations, OK?

221
00:07:38,778 --> 00:07:40,439
This year, if you see on the left side,

222
00:07:41,178 --> 00:07:43,399
um, you have Amazon inspector

223
00:07:43,500 --> 00:07:45,500
and Amazon guard duty. Both are our security

224
00:07:45,500 --> 00:07:47,619
services, which monitor our AWS

225
00:07:47,619 --> 00:07:48,559
services on the network,

226
00:07:49,178 --> 00:07:51,608
and they publish the alerts based on the anomalies

227
00:07:51,608 --> 00:07:53,980
detected in the environment. They're gonna publish the alerts

228
00:07:53,980 --> 00:07:54,899
to the event bridge.

229
00:07:55,379 --> 00:07:57,500
Uh, and then a lambda pick up that

230
00:07:57,500 --> 00:07:59,540
uh event and pass it to the agent

231
00:07:59,540 --> 00:08:00,439
core runtime where

232
00:08:00,899 --> 00:08:02,899
you see an orchestration agent

233
00:08:03,019 --> 00:08:05,100
that is running in the runtime, agent core

234
00:08:05,100 --> 00:08:06,129
runtime, OK?

235
00:08:06,660 --> 00:08:08,699
The orchestration agent is

236
00:08:08,699 --> 00:08:09,298
gonna

237
00:08:09,619 --> 00:08:10,459
send that alert.

238
00:08:11,699 --> 00:08:12,889
To do the investigation.

239
00:08:14,459 --> 00:08:16,509
Remediation and send a report.

240
00:08:16,769 --> 00:08:19,369
It is gonna send that request to 3 different agents

241
00:08:19,369 --> 00:08:19,879
to run

242
00:08:20,209 --> 00:08:21,079
within the runtime,

243
00:08:21,488 --> 00:08:23,569
and those special agents are going to

244
00:08:23,569 --> 00:08:25,428
work with your internal tools

245
00:08:25,750 --> 00:08:27,428
like connecting to your CMDB

246
00:08:27,769 --> 00:08:29,579
connecting to your, uh,

247
00:08:30,329 --> 00:08:31,028
playbooks

248
00:08:31,290 --> 00:08:32,269
to remediate the issue,

249
00:08:32,599 --> 00:08:34,928
OK? The entire team, the

250
00:08:34,928 --> 00:08:37,200
entire, uh, solution is built on agent core

251
00:08:37,529 --> 00:08:39,908
and that works with all the other

252
00:08:39,908 --> 00:08:41,889
existing AWS services, OK?

253
00:08:42,649 --> 00:08:44,798
Now, with that said,

254
00:08:45,129 --> 00:08:47,279
little bit zoom into what

255
00:08:47,279 --> 00:08:47,989
exactly

256
00:08:48,288 --> 00:08:49,359
we do with the agents.

257
00:08:49,690 --> 00:08:50,798
Now, we talked about,

258
00:08:51,090 --> 00:08:53,168
we're leveraging multi-agents to

259
00:08:53,168 --> 00:08:54,379
build that solution, right?

260
00:08:54,928 --> 00:08:57,178
Again, Investigation agent,

261
00:08:57,619 --> 00:08:59,658
whenever we, once we receive the alert, we

262
00:08:59,658 --> 00:09:02,000
want to investigate what is that alert about,

263
00:09:02,619 --> 00:09:04,840
and then we want to work with uh

264
00:09:04,840 --> 00:09:05,759
internal system

265
00:09:06,129 --> 00:09:07,399
to gather the information.

266
00:09:07,700 --> 00:09:09,859
What is the server that is impacted? What is the

267
00:09:09,859 --> 00:09:12,038
software or the OS that is currently running

268
00:09:12,038 --> 00:09:14,139
there? What is the pass schedule? You don't

269
00:09:14,139 --> 00:09:16,178
want to update a server while in the

270
00:09:16,178 --> 00:09:17,158
middle of the production.

271
00:09:17,580 --> 00:09:19,440
You want to understand the um

272
00:09:19,899 --> 00:09:22,109
server nature and the workload that is running on the server,

273
00:09:22,129 --> 00:09:23,759
and based on that, you want to take that action.

274
00:09:24,139 --> 00:09:25,000
Those details.

275
00:09:25,580 --> 00:09:27,580
Everything is residing on the CMDB,

276
00:09:27,820 --> 00:09:29,979
so that investigation agent is going to work

277
00:09:29,979 --> 00:09:30,928
with the CMDB

278
00:09:31,298 --> 00:09:32,739
through agent core gateway,

279
00:09:33,019 --> 00:09:34,250
pull all the information,

280
00:09:34,580 --> 00:09:36,779
and it does the investigation report. It's going to

281
00:09:36,779 --> 00:09:39,399
prepare the entire investigation report, so alert

282
00:09:39,580 --> 00:09:41,619
how it is impacted and what's impacted and what

283
00:09:41,619 --> 00:09:42,558
the schedule looks like

284
00:09:43,178 --> 00:09:44,058
once that is done.

285
00:09:45,038 --> 00:09:47,200
We have the 2nd step, we want to remediate.

286
00:09:47,639 --> 00:09:49,960
Here, we created two agents within the remediation

287
00:09:49,960 --> 00:09:51,820
itself, containment agents, where

288
00:09:52,678 --> 00:09:54,460
one of the agents is gonna prepare a

289
00:09:54,840 --> 00:09:56,869
script for you to build a

290
00:09:57,820 --> 00:09:59,129
As a playbook, basically,

291
00:09:59,629 --> 00:10:02,070
uh, you have a non-production system, some production systems,

292
00:10:02,590 --> 00:10:03,849
and you don't want to operate

293
00:10:04,259 --> 00:10:06,399
by an agent in the production systems in some cases.

294
00:10:06,908 --> 00:10:09,210
For that, we create a playbook. So when the

295
00:10:09,210 --> 00:10:11,229
operator receives an alert, he doesn't have to

296
00:10:11,229 --> 00:10:13,389
go to the internal wiki pages or different notes

297
00:10:13,710 --> 00:10:15,428
what exactly the next step he wants to do.

298
00:10:16,009 --> 00:10:18,219
He, we're gonna build a playbook for him so that he's gonna

299
00:10:18,219 --> 00:10:19,139
follow the steps.

300
00:10:19,509 --> 00:10:21,750
In the second containment agent, which

301
00:10:21,750 --> 00:10:22,989
we call it as executor.

302
00:10:23,879 --> 00:10:25,918
That can automatically remediate the

303
00:10:25,918 --> 00:10:27,340
issue, OK? It is not gonna

304
00:10:27,719 --> 00:10:30,070
create the playbook. It is going to execute the playbook, OK?

305
00:10:30,320 --> 00:10:31,769
It is gonna take the alert,

306
00:10:32,259 --> 00:10:34,719
uh, investigation report, and it's gonna apply the remediation

307
00:10:34,719 --> 00:10:36,599
work. Once everything is done,

308
00:10:37,080 --> 00:10:39,239
that third step, which is the reporting agent

309
00:10:39,239 --> 00:10:41,359
actually. So there was an incident happened, there was

310
00:10:41,359 --> 00:10:42,719
an issue happened, OK.

311
00:10:43,570 --> 00:10:45,609
And you want a summarization report at end to

312
00:10:45,609 --> 00:10:47,808
end. We received an alert at 9 o'clock.

313
00:10:48,460 --> 00:10:50,580
We did this investigation and we fixed

314
00:10:50,580 --> 00:10:52,619
it, and this is the solution that we applied.

315
00:10:52,700 --> 00:10:54,820
End to end, we need a report that we want to

316
00:10:54,820 --> 00:10:56,849
report it to our senior management or we

317
00:10:56,849 --> 00:10:58,859
want to keep it, uh, in our records

318
00:10:58,859 --> 00:11:00,879
so that we can build a context, uh,

319
00:11:00,889 --> 00:11:02,649
end to end going forward, OK?

320
00:11:02,979 --> 00:11:05,058
So this is the 3 different agents that

321
00:11:05,058 --> 00:11:07,168
we are using, and we are going to attach

322
00:11:07,168 --> 00:11:09,219
it to the orchestration agent which is gonna manage all

323
00:11:09,219 --> 00:11:10,479
the agents, OK?

324
00:11:11,058 --> 00:11:13,690
So, Let's

325
00:11:13,690 --> 00:11:15,759
move into the core talk today, OK, so

326
00:11:15,759 --> 00:11:17,918
how do we build this solution? Um, Eric

327
00:11:17,918 --> 00:11:20,178
is gonna cover that. Eric, or to you. All right,

328
00:11:20,759 --> 00:11:23,058
so who here has had to deal with a

329
00:11:23,330 --> 00:11:25,359
remediation investigation of a

330
00:11:25,359 --> 00:11:27,460
security incident incident within your

331
00:11:28,000 --> 00:11:28,658
environment?

332
00:11:29,119 --> 00:11:31,119
So this scenario may sound familiar

333
00:11:31,119 --> 00:11:33,279
to you. Several years ago when I worked

334
00:11:33,279 --> 00:11:34,820
at a large manufacturing company,

335
00:11:35,440 --> 00:11:37,639
I got a call from my sec ops team saying

336
00:11:37,639 --> 00:11:39,918
that my AWS account had been quarantined

337
00:11:40,200 --> 00:11:41,899
because of suspicious activity.

338
00:11:42,408 --> 00:11:44,599
And they had detected that several

339
00:11:44,599 --> 00:11:46,889
extra large instances, EC2 instances,

340
00:11:46,918 --> 00:11:48,960
had been launched in the account in a short period

341
00:11:48,960 --> 00:11:50,849
of time. So,

342
00:11:51,590 --> 00:11:53,950
you know, that's the type of call that is going to ruin

343
00:11:53,950 --> 00:11:56,149
your evening plans or your weekend plans

344
00:11:56,149 --> 00:11:57,570
or whatever you have going on,

345
00:11:57,928 --> 00:12:00,109
um. So we got to work

346
00:12:00,109 --> 00:12:02,548
doing the investigation, doing the forensics

347
00:12:02,548 --> 00:12:04,558
works, trying to find out what user

348
00:12:04,869 --> 00:12:05,969
role profile,

349
00:12:06,269 --> 00:12:08,269
uh, launched these instances, how,

350
00:12:08,389 --> 00:12:09,849
what was the entry point that they

351
00:12:10,509 --> 00:12:12,529
accessed, and I have to admit I do love

352
00:12:12,668 --> 00:12:14,710
the forensics work. It may be a little

353
00:12:14,710 --> 00:12:16,729
bit odd, but I do like going through the logs.

354
00:12:17,558 --> 00:12:19,719
Um, it turns out in that instance

355
00:12:19,719 --> 00:12:21,538
that one of our DevOps engineers

356
00:12:21,798 --> 00:12:23,798
troubleshooting an issue launched a

357
00:12:23,798 --> 00:12:24,668
Jenkins server,

358
00:12:25,000 --> 00:12:27,200
didn't change the default password, left some ports

359
00:12:27,200 --> 00:12:29,460
open to the world, and somebody decided to set up

360
00:12:29,719 --> 00:12:31,840
a Bitcoin mining operation within

361
00:12:31,840 --> 00:12:33,219
our account, and luckily

362
00:12:33,519 --> 00:12:34,759
we caught it and,

363
00:12:35,129 --> 00:12:37,308
and we're able to shut it down. Um,

364
00:12:37,479 --> 00:12:39,178
I'm gonna walk through how

365
00:12:39,960 --> 00:12:42,239
we could do that with Bedrock, uh, Agent

366
00:12:42,239 --> 00:12:44,359
Core without human interference.

367
00:12:44,519 --> 00:12:45,639
So once we receive the alert.

368
00:12:46,239 --> 00:12:48,479
Agents are going to work by themselves and then remediate

369
00:12:48,479 --> 00:12:49,489
the issue as well, OK.

370
00:12:50,590 --> 00:12:52,529
So what are we gonna cover? We're gonna go through

371
00:12:53,070 --> 00:12:55,190
just some basics setting up the agent.

372
00:12:55,269 --> 00:12:56,928
We're gonna set up some tools

373
00:12:57,190 --> 00:12:59,548
that the agent can use. We're gonna create

374
00:12:59,750 --> 00:13:01,779
a security analyst agent first using

375
00:13:01,779 --> 00:13:03,288
strand's agent, and we're gonna

376
00:13:03,590 --> 00:13:05,590
show how to orchestrate multiple agents using

377
00:13:05,590 --> 00:13:06,690
a graph pattern,

378
00:13:07,308 --> 00:13:09,509
um, and then we'll go into how to scale that

379
00:13:09,509 --> 00:13:11,668
agent, so deploying the agent, making

380
00:13:11,668 --> 00:13:12,750
it autonomous,

381
00:13:13,190 --> 00:13:15,349
and then some tips

382
00:13:15,349 --> 00:13:16,009
for making,

383
00:13:16,629 --> 00:13:18,190
uh, for helping the agent.

384
00:13:18,840 --> 00:13:20,820
Follow a more deterministic behavior.

385
00:13:21,558 --> 00:13:23,788
So when we, when we mean by autonomous, uh,

386
00:13:23,798 --> 00:13:24,798
autonomous agent,

387
00:13:25,200 --> 00:13:27,239
basically we're talking about single alert right now

388
00:13:27,239 --> 00:13:28,500
for an, uh, for the demo purpose.

389
00:13:28,840 --> 00:13:30,418
But how do you want to scale it for

390
00:13:30,798 --> 00:13:32,658
different types of alerts and

391
00:13:33,450 --> 00:13:35,719
whenever, and the workflow remains the same and the agent

392
00:13:35,719 --> 00:13:37,798
remains the same, the work remains the same. So we want to

393
00:13:37,798 --> 00:13:39,798
make it more autonomous so that it can make the

394
00:13:39,798 --> 00:13:40,700
decisions, yeah, right.

395
00:13:41,779 --> 00:13:43,908
So first, just to give an intro

396
00:13:43,908 --> 00:13:44,879
to anybody who

397
00:13:45,139 --> 00:13:46,330
is new to agents,

398
00:13:46,619 --> 00:13:48,779
the strands agent loop or an agent loop,

399
00:13:49,119 --> 00:13:51,139
uh, what it does, it takes in the input, so

400
00:13:51,139 --> 00:13:53,259
you can think of this as your prompt, but

401
00:13:53,259 --> 00:13:55,619
it also includes the system prompt

402
00:13:55,619 --> 00:13:56,899
which acts as

403
00:13:57,418 --> 00:13:59,080
the job description for your agent.

404
00:13:59,340 --> 00:14:01,418
It includes the tool specs, so

405
00:14:01,418 --> 00:14:03,019
your agent has tools

406
00:14:03,408 --> 00:14:04,570
to, uh, which are

407
00:14:05,298 --> 00:14:07,379
essentially APIs or, or access

408
00:14:07,379 --> 00:14:08,599
to external systems.

409
00:14:09,058 --> 00:14:11,109
And then there's the actual query and

410
00:14:11,109 --> 00:14:12,548
task that's your prompt,

411
00:14:12,830 --> 00:14:15,308
and then the conversation history uh

412
00:14:15,308 --> 00:14:17,509
for what may have happened uh

413
00:14:17,509 --> 00:14:18,349
previously

414
00:14:18,830 --> 00:14:20,989
that feeds into your agent. It

415
00:14:20,989 --> 00:14:23,210
starts with reasoning, so your large language

416
00:14:23,210 --> 00:14:24,408
model, your LLM

417
00:14:25,389 --> 00:14:27,139
processes that, looks at the tools,

418
00:14:27,428 --> 00:14:29,590
makes a selection on tools, executes

419
00:14:29,590 --> 00:14:30,229
the tool,

420
00:14:30,590 --> 00:14:32,700
the output of the tool feeds

421
00:14:32,700 --> 00:14:34,229
back into that reasoning.

422
00:14:34,609 --> 00:14:36,820
And that loop continues until the agent

423
00:14:36,820 --> 00:14:37,330
decides,

424
00:14:37,619 --> 00:14:39,320
OK, I've completed this task,

425
00:14:39,700 --> 00:14:41,460
and then it gives you the response.

426
00:14:41,820 --> 00:14:43,979
Here we are using astra agents, uh,

427
00:14:44,048 --> 00:14:44,678
in the loop,

428
00:14:44,940 --> 00:14:47,330
uh, the framework, uh, to build the multi-agents.

429
00:14:47,619 --> 00:14:49,979
You can leverage lang chain. You can use crew AI

430
00:14:49,979 --> 00:14:52,099
and you can use, uh, lang fuse as well, OK?

431
00:14:52,168 --> 00:14:54,399
You can use any agent framework

432
00:14:54,500 --> 00:14:55,859
and deploy it to the agent core, yeah.

433
00:14:57,239 --> 00:14:59,639
So just, you know, some basic setup and imports

434
00:14:59,639 --> 00:15:01,840
you can see I'm including strands and I'm

435
00:15:01,840 --> 00:15:04,379
including some MCP tools. I have some utilities

436
00:15:04,788 --> 00:15:06,460
that I've included

437
00:15:06,859 --> 00:15:08,879
uh as well. I'm not gonna go

438
00:15:08,879 --> 00:15:11,460
through those because they're less,

439
00:15:11,918 --> 00:15:12,460
uh,

440
00:15:12,719 --> 00:15:14,599
they are helper functions.

441
00:15:15,330 --> 00:15:17,500
And I want to get into the tools, so.

442
00:15:18,529 --> 00:15:19,908
What are some of the tools that we need?

443
00:15:20,210 --> 00:15:22,330
We talked about maybe having access

444
00:15:22,330 --> 00:15:24,369
to our configuration management database or

445
00:15:24,369 --> 00:15:25,048
CMDB.

446
00:15:25,609 --> 00:15:28,029
We want access to the log files.

447
00:15:28,129 --> 00:15:29,678
We want access to

448
00:15:30,009 --> 00:15:32,080
uh forensics, uh,

449
00:15:32,090 --> 00:15:34,178
data store to store any of the

450
00:15:34,489 --> 00:15:36,428
forensics reports that we do.

451
00:15:37,379 --> 00:15:39,469
And if you've used strands agents, you may

452
00:15:39,469 --> 00:15:41,979
know that you can build, uh, tools

453
00:15:41,989 --> 00:15:44,210
directly within strands agents. So why are we using

454
00:15:44,788 --> 00:15:47,070
Bedrock Agent Core, uh, gateway

455
00:15:47,070 --> 00:15:49,570
for hosting these? It's really to maximize

456
00:15:49,570 --> 00:15:52,029
the reuse. Um, so

457
00:15:52,469 --> 00:15:54,710
we may have multiple agents that need

458
00:15:54,710 --> 00:15:56,750
access to a CMDB tool and

459
00:15:56,750 --> 00:15:57,899
access to logs.

460
00:15:58,308 --> 00:16:00,428
We want to allow all those agents

461
00:16:00,428 --> 00:16:01,489
to, to

462
00:16:02,129 --> 00:16:03,178
access these tools

463
00:16:03,950 --> 00:16:06,070
without having to build them in every, every

464
00:16:06,070 --> 00:16:06,590
agent.

465
00:16:07,109 --> 00:16:09,269
And these, these tools are similar tools that we,

466
00:16:09,639 --> 00:16:11,678
as a human, we use to interact and get

467
00:16:11,678 --> 00:16:13,788
the information to analyze the alerts.

468
00:16:14,158 --> 00:16:16,418
Similarly, we are giving the tools to agent

469
00:16:16,719 --> 00:16:18,759
to, uh, do the, its investigation.

470
00:16:20,509 --> 00:16:22,349
So what is the, what is the gateway?

471
00:16:23,149 --> 00:16:25,668
The gateway provides an interface

472
00:16:25,668 --> 00:16:27,869
between the an MCP interface

473
00:16:27,869 --> 00:16:29,369
model context protocol interface

474
00:16:29,830 --> 00:16:32,029
between the agent and the tools.

475
00:16:32,158 --> 00:16:33,168
So in this case,

476
00:16:33,509 --> 00:16:35,750
I'm going to give the

477
00:16:35,750 --> 00:16:37,379
gateway some permissions.

478
00:16:37,710 --> 00:16:39,750
I'm giving it permissions to

479
00:16:39,750 --> 00:16:41,950
invoke 3 lambda functions

480
00:16:41,950 --> 00:16:44,259
that I've created for this purpose. So one,

481
00:16:44,599 --> 00:16:46,710
you can see the first one is a CMDB

482
00:16:46,710 --> 00:16:47,489
function.

483
00:16:48,149 --> 00:16:49,889
You can see the second one

484
00:16:50,229 --> 00:16:50,840
handles.

485
00:16:51,590 --> 00:16:53,750
Our artifacts and then one that does

486
00:16:53,750 --> 00:16:55,330
notification so sends,

487
00:16:55,710 --> 00:16:57,129
sends emails out.

488
00:16:57,629 --> 00:16:59,989
So I'll need to give the gateway permissions

489
00:16:59,989 --> 00:17:01,619
and once I have that set up,

490
00:17:01,908 --> 00:17:04,529
I'm gonna go ahead and create the gateway.

491
00:17:06,410 --> 00:17:07,000
Um,

492
00:17:07,368 --> 00:17:09,598
what does it take to create a gateway? It takes,

493
00:17:09,769 --> 00:17:11,029
you need a gateway name.

494
00:17:11,289 --> 00:17:13,150
You need the role that we just looked at.

495
00:17:13,958 --> 00:17:15,858
And then you define the protocol

496
00:17:16,118 --> 00:17:18,057
MCP and then I save some

497
00:17:18,659 --> 00:17:20,698
uh output from the gateway

498
00:17:20,898 --> 00:17:23,298
so that we can get into our next step, which is

499
00:17:23,837 --> 00:17:25,198
adding, um.

500
00:17:26,077 --> 00:17:27,739
Adding targets to the gateway.

501
00:17:28,249 --> 00:17:29,778
So what is a target?

502
00:17:30,159 --> 00:17:32,597
Uh, target is that is

503
00:17:32,597 --> 00:17:33,138
the

504
00:17:33,398 --> 00:17:35,317
tool spec, that's the end point

505
00:17:35,678 --> 00:17:36,659
that the gateway

506
00:17:37,077 --> 00:17:37,638
uses.

507
00:17:38,449 --> 00:17:39,650
So in this case that

508
00:17:40,420 --> 00:17:42,828
that consists of two things a lambda function,

509
00:17:43,180 --> 00:17:45,078
the ARN for that lambda function,

510
00:17:45,618 --> 00:17:47,680
and then the tool spec is adjacent

511
00:17:47,680 --> 00:17:48,959
schema defining

512
00:17:49,259 --> 00:17:50,598
the various functions

513
00:17:51,289 --> 00:17:53,299
and operations within that lambda function.

514
00:17:53,420 --> 00:17:54,479
So we can see here

515
00:17:54,739 --> 00:17:55,699
that there's a,

516
00:17:56,338 --> 00:17:58,000
there's a save artifact

517
00:17:58,890 --> 00:18:00,979
operation and uh it takes a

518
00:18:00,979 --> 00:18:02,739
finding ID and a file name.

519
00:18:03,180 --> 00:18:04,019
There's a

520
00:18:04,420 --> 00:18:06,039
list artifacts operation.

521
00:18:06,809 --> 00:18:08,809
And a get artifact operation. So those

522
00:18:08,809 --> 00:18:11,130
are the, those are functions that are defined

523
00:18:11,130 --> 00:18:13,289
in my lambda that interact

524
00:18:13,289 --> 00:18:14,229
with my,

525
00:18:14,769 --> 00:18:17,150
uh, my forensics data store.

526
00:18:17,809 --> 00:18:20,049
So these are the tools that we didn't even go to the agent

527
00:18:20,049 --> 00:18:22,209
sets. We're setting up the tools that agents

528
00:18:22,209 --> 00:18:22,910
can use it.

529
00:18:23,209 --> 00:18:24,108
So this is the first step.

530
00:18:25,219 --> 00:18:27,098
So I've defined the,

531
00:18:27,380 --> 00:18:29,469
I've defined the tool. I've defined the tool

532
00:18:29,469 --> 00:18:31,699
spec. Now I want to add that

533
00:18:31,699 --> 00:18:32,289
target

534
00:18:32,699 --> 00:18:33,509
to my agent,

535
00:18:33,858 --> 00:18:35,598
uh, and so I do that by,

536
00:18:35,900 --> 00:18:38,019
uh, creating a target. I give it a

537
00:18:38,019 --> 00:18:39,500
name. I give it a description.

538
00:18:39,779 --> 00:18:41,680
This is what helps the agent when it's

539
00:18:42,098 --> 00:18:44,380
going through that agent loop know what

540
00:18:44,380 --> 00:18:46,559
tools are available and how to use those tools.

541
00:18:47,858 --> 00:18:49,979
The agents are going to leverage the ALLMs

542
00:18:49,979 --> 00:18:52,229
to select the specific tool based on the alert

543
00:18:52,229 --> 00:18:54,269
that it received. Does it have to contact the

544
00:18:54,269 --> 00:18:56,309
CMDB or doesn't have to contact the CMDB?

545
00:18:56,348 --> 00:18:58,348
It depends upon the alert and the use

546
00:18:58,348 --> 00:18:59,019
case. Yeah,

547
00:18:59,309 --> 00:19:02,759
so go ahead. OK,

548
00:19:03,219 --> 00:19:05,358
so now we have, uh, we have some tools.

549
00:19:05,410 --> 00:19:06,189
I have a,

550
00:19:06,608 --> 00:19:07,229
a

551
00:19:07,670 --> 00:19:08,769
gateway that's,

552
00:19:09,160 --> 00:19:10,029
that's loaded.

553
00:19:10,328 --> 00:19:11,309
Uh, if

554
00:19:11,568 --> 00:19:13,858
suppose in, you know, in any enterprise

555
00:19:13,858 --> 00:19:15,890
environment you're gonna have some, some tools

556
00:19:15,890 --> 00:19:17,890
that run in AWS, you're gonna

557
00:19:17,890 --> 00:19:20,229
have some external tools or some things that are.

558
00:19:20,549 --> 00:19:22,618
Uh, you may have your CMDB

559
00:19:22,618 --> 00:19:24,920
with ServiceNow or, or somewhere else,

560
00:19:25,269 --> 00:19:27,469
uh, and you need a, an easy way to

561
00:19:27,469 --> 00:19:29,469
authenticate to those MCP

562
00:19:29,469 --> 00:19:31,489
servers. So Agent Core

563
00:19:31,949 --> 00:19:33,489
provides Agent Core identity,

564
00:19:34,358 --> 00:19:36,529
which will securely store your,

565
00:19:36,868 --> 00:19:39,029
uh, your credentials and

566
00:19:39,029 --> 00:19:40,549
provide you with, uh,

567
00:19:40,949 --> 00:19:43,209
a way to securely get and generate

568
00:19:43,209 --> 00:19:45,250
and refresh OAth tokens to

569
00:19:45,809 --> 00:19:48,229
access those external services. So that's

570
00:19:48,229 --> 00:19:49,868
what I'm doing here. I'm showing.

571
00:19:50,328 --> 00:19:52,328
I'm getting uh access token to a

572
00:19:52,328 --> 00:19:53,390
gateway that I've,

573
00:19:54,009 --> 00:19:56,328
I've created that has some of the tools

574
00:19:56,328 --> 00:19:57,108
that we have

575
00:19:57,489 --> 00:19:58,130
and

576
00:19:58,449 --> 00:20:00,689
I'm loading those tools in the MCP

577
00:20:00,689 --> 00:20:01,229
server

578
00:20:01,500 --> 00:20:02,750
and we can see here

579
00:20:03,529 --> 00:20:05,729
that it's loaded the CMDB tool,

580
00:20:06,009 --> 00:20:08,180
the forensics artifact tool, and

581
00:20:08,180 --> 00:20:09,489
my notification tool.

582
00:20:09,809 --> 00:20:11,848
Yeah, so all we did is we created the

583
00:20:11,848 --> 00:20:12,430
tools

584
00:20:12,729 --> 00:20:14,309
and we connected the tools to

585
00:20:14,689 --> 00:20:16,029
gent core gateway

586
00:20:16,390 --> 00:20:18,640
and we provided the authentication. That's it.

587
00:20:19,049 --> 00:20:20,170
So for the tools are ready.

588
00:20:20,660 --> 00:20:22,318
Now we are trying to build the agents,

589
00:20:22,660 --> 00:20:25,459
so. All

590
00:20:25,459 --> 00:20:27,578
right. So let's talk about what

591
00:20:27,578 --> 00:20:28,799
agents we might need

592
00:20:29,098 --> 00:20:30,719
for our security operations.

593
00:20:31,098 --> 00:20:33,699
Uh, we'll start with building an agent

594
00:20:34,059 --> 00:20:36,539
that, uh, does investigation to gather

595
00:20:36,539 --> 00:20:38,858
details, you know, that first step in our

596
00:20:38,858 --> 00:20:40,880
process. Uh, and,

597
00:20:41,390 --> 00:20:43,578
in many environments, you can, you already have

598
00:20:43,578 --> 00:20:45,699
run books, you can use your runbook to guide you in

599
00:20:45,699 --> 00:20:47,180
creating the agent through prompts.

600
00:20:47,689 --> 00:20:50,189
Uh, the other thing I'm gonna include here is

601
00:20:50,328 --> 00:20:51,729
Strands comes with

602
00:20:52,009 --> 00:20:54,009
a set of community package tools. One

603
00:20:54,009 --> 00:20:56,088
of those is a use AWS tool.

604
00:20:56,410 --> 00:20:58,430
Uh, and so I'm using that within

605
00:20:58,430 --> 00:20:59,269
this tool,

606
00:20:59,930 --> 00:21:01,469
and what that does, it provides

607
00:21:01,959 --> 00:21:04,049
access to your AWS resources

608
00:21:04,049 --> 00:21:05,348
through the AWSSTK.

609
00:21:09,170 --> 00:21:11,000
So what does the agent consist of?

610
00:21:11,318 --> 00:21:13,019
It consists of a name.

611
00:21:13,410 --> 00:21:15,449
It consists of the tools.

612
00:21:15,539 --> 00:21:17,729
So I've got use AWS. I've got

613
00:21:17,729 --> 00:21:19,289
the tools that we just loaded,

614
00:21:19,809 --> 00:21:22,150
and then it consists of

615
00:21:22,289 --> 00:21:24,410
a system prompt, which, as I mentioned

616
00:21:24,410 --> 00:21:26,588
earlier, is the job description for our agent.

617
00:21:26,930 --> 00:21:29,049
So in this case, the job description is

618
00:21:29,368 --> 00:21:30,828
you're a security analyst,

619
00:21:31,118 --> 00:21:33,410
uh, you'll be given a guard duty finding.

620
00:21:33,489 --> 00:21:35,568
Go and gather details around that and

621
00:21:35,568 --> 00:21:36,709
fill out this report.

622
00:21:37,108 --> 00:21:39,239
And then to help the agent know when

623
00:21:39,239 --> 00:21:41,239
to exit the agent loop, I'm telling

624
00:21:41,239 --> 00:21:42,578
it, stop

625
00:21:42,959 --> 00:21:45,078
your analysis when you have information

626
00:21:45,078 --> 00:21:46,019
you need to complete

627
00:21:46,519 --> 00:21:47,059
the report.

628
00:21:48,289 --> 00:21:50,289
Only fill out, only go and get the details that

629
00:21:50,289 --> 00:21:51,430
are needed for the report

630
00:21:52,209 --> 00:21:53,269
and then save the

631
00:21:54,289 --> 00:21:56,469
completed report and you can see throughout here

632
00:21:56,729 --> 00:21:58,769
I've put in, I've specified the tools

633
00:21:58,769 --> 00:22:00,689
that I wanted to use to help it

634
00:22:00,969 --> 00:22:02,338
execute more efficiently.

635
00:22:02,660 --> 00:22:04,670
This is similar to a human, uh,

636
00:22:04,689 --> 00:22:06,848
security analyst. We're just creating an agent and

637
00:22:06,848 --> 00:22:08,848
assigning that role as a security analyst so

638
00:22:08,848 --> 00:22:10,858
that it can work as a human agent,

639
00:22:10,969 --> 00:22:12,979
yeah. To do the

640
00:22:12,979 --> 00:22:15,009
investigation we're not done to the containment yet

641
00:22:15,269 --> 00:22:16,848
we're just starting with the investigation, yeah,

642
00:22:17,709 --> 00:22:20,108
so here I'll just show you what's in that

643
00:22:20,108 --> 00:22:21,559
uh report template.

644
00:22:21,868 --> 00:22:23,910
Uh, in this case I'm asking

645
00:22:23,910 --> 00:22:26,269
for resource details. I'm

646
00:22:26,269 --> 00:22:28,689
asking for the VPC configuration

647
00:22:28,689 --> 00:22:30,209
and the security groups

648
00:22:30,509 --> 00:22:32,660
uh, in a real life scenario you would probably

649
00:22:32,660 --> 00:22:33,380
ask for

650
00:22:33,750 --> 00:22:36,108
additional, uh, forensics logs

651
00:22:36,108 --> 00:22:38,390
from, from cloud watch from cloud

652
00:22:38,390 --> 00:22:39,608
trail from other

653
00:22:40,029 --> 00:22:40,689
systems.

654
00:22:41,680 --> 00:22:43,739
Um, OK,

655
00:22:43,979 --> 00:22:46,078
so then I wanna run the investigation.

656
00:22:46,318 --> 00:22:48,309
So I need a guard duty finding ID

657
00:22:48,588 --> 00:22:50,750
and I need to load that, uh,

658
00:22:50,789 --> 00:22:52,890
and so let's look at this finding.

659
00:22:53,309 --> 00:22:55,469
Um, this is a finding that I

660
00:22:55,469 --> 00:22:56,049
have

661
00:22:56,348 --> 00:22:57,858
set up in my demo account.

662
00:22:58,150 --> 00:23:00,430
One of my EC2 instances is querying

663
00:23:00,430 --> 00:23:02,049
a domain name,

664
00:23:02,430 --> 00:23:04,549
uh, that's used for nefarious

665
00:23:04,549 --> 00:23:05,289
purposes.

666
00:23:05,709 --> 00:23:06,890
So that's gonna be

667
00:23:07,868 --> 00:23:10,269
part of the payload to my agent that

668
00:23:10,269 --> 00:23:11,750
goes in as the task.

669
00:23:13,279 --> 00:23:15,459
And I will go ahead and

670
00:23:16,098 --> 00:23:17,299
Execute the agent,

671
00:23:17,660 --> 00:23:18,989
so it's going to

672
00:23:19,640 --> 00:23:21,719
Um, It's gonna er.

673
00:23:26,858 --> 00:23:27,410
Um

674
00:23:28,269 --> 00:23:29,209
It will

675
00:23:29,709 --> 00:23:31,939
gather the necessary information. It'll

676
00:23:31,939 --> 00:23:33,529
walk through the tools that it's using

677
00:23:34,068 --> 00:23:35,130
to execute

678
00:23:35,549 --> 00:23:36,789
the operation.

679
00:23:38,250 --> 00:23:40,368
Uh, and, and it'll tell us what it's

680
00:23:40,368 --> 00:23:42,489
doing along the way. So it's getting the instance

681
00:23:42,489 --> 00:23:44,838
details, it's getting the security group details,

682
00:23:45,130 --> 00:23:46,809
it's getting the subnet details,

683
00:23:47,130 --> 00:23:49,209
uh, and it, it compiles all

684
00:23:49,209 --> 00:23:50,189
that into

685
00:23:50,969 --> 00:23:51,868
a report,

686
00:23:52,209 --> 00:23:52,828
um,

687
00:23:53,410 --> 00:23:54,848
which then I can.

688
00:23:55,930 --> 00:23:57,930
Um, is saved in S 3

689
00:23:57,930 --> 00:23:59,930
and I can display that down here. So we have

690
00:23:59,930 --> 00:24:01,930
our, uh, that only took a

691
00:24:01,930 --> 00:24:04,209
few seconds. We can see that it's got a

692
00:24:04,209 --> 00:24:05,509
security operations report,

693
00:24:06,209 --> 00:24:08,410
uh, that includes the details and executive

694
00:24:08,410 --> 00:24:08,989
summary,

695
00:24:09,598 --> 00:24:10,170
um.

696
00:24:11,118 --> 00:24:13,118
All, all, all the sort of things that we

697
00:24:13,118 --> 00:24:15,160
need. So if you look at it, if you

698
00:24:15,160 --> 00:24:16,180
want to employ this one,

699
00:24:16,799 --> 00:24:17,979
in the human loop

700
00:24:18,358 --> 00:24:20,469
or human execution, you have to log into

701
00:24:20,469 --> 00:24:22,479
the different services. You have to log into the EC2 instance

702
00:24:22,479 --> 00:24:23,400
and you have to check there.

703
00:24:23,680 --> 00:24:26,000
You have to go to the cloud trail logs and cloud

704
00:24:26,000 --> 00:24:27,759
watch logs to gather the details.

705
00:24:28,029 --> 00:24:30,259
You have to go to different places to identify exact

706
00:24:30,949 --> 00:24:32,949
location of the resource, and you need to get all, all these

707
00:24:32,949 --> 00:24:34,239
details, but agents.

708
00:24:35,029 --> 00:24:37,469
They do it on behalf of you. So they connect to the

709
00:24:37,469 --> 00:24:38,049
different

710
00:24:38,949 --> 00:24:41,108
resources and they pull that information related to that

711
00:24:41,108 --> 00:24:43,269
alert, and then it's gonna generate that risk

712
00:24:43,269 --> 00:24:44,150
report, OK?

713
00:24:44,469 --> 00:24:46,630
So for that reason, we are creating, we created the

714
00:24:46,630 --> 00:24:48,709
tools, uh, a few minutes

715
00:24:48,709 --> 00:24:49,390
back, yeah,

716
00:24:49,828 --> 00:24:52,049
yeah. We

717
00:24:52,049 --> 00:24:53,430
can see the subnet details

718
00:24:53,809 --> 00:24:55,269
and, and everything that it pulled.

719
00:24:57,029 --> 00:24:59,420
OK, so we've got our first agent. Now what

720
00:24:59,420 --> 00:25:01,828
other agents do we need and how do we orchestrate

721
00:25:01,828 --> 00:25:03,390
them to work together?

722
00:25:03,910 --> 00:25:05,209
Uh, so we talked about having

723
00:25:05,750 --> 00:25:08,729
a containment agent to do remediation.

724
00:25:09,209 --> 00:25:11,630
Uh, in this use case, I've created a containment

725
00:25:11,630 --> 00:25:12,630
helper agent

726
00:25:13,108 --> 00:25:14,900
and a containment actor agent,

727
00:25:15,219 --> 00:25:16,689
uh, and a report agent,

728
00:25:17,029 --> 00:25:19,068
and I'm combining those with in

729
00:25:19,068 --> 00:25:20,979
this case, a simple graph pattern.

730
00:25:21,348 --> 00:25:23,858
The graph pattern is it starts with

731
00:25:23,858 --> 00:25:25,289
investigation which we just saw,

732
00:25:25,709 --> 00:25:26,430
and then.

733
00:25:26,809 --> 00:25:27,630
I have

734
00:25:27,890 --> 00:25:30,189
two branches following

735
00:25:30,650 --> 00:25:31,469
a flow.

736
00:25:32,289 --> 00:25:34,489
So on the right hand side

737
00:25:34,809 --> 00:25:37,059
we allow mutative actions

738
00:25:37,209 --> 00:25:39,368
and that will go to the immediate

739
00:25:39,368 --> 00:25:41,410
containment. So think of your

740
00:25:41,689 --> 00:25:43,969
non-production systems in in my story

741
00:25:43,969 --> 00:25:45,150
earlier that was a

742
00:25:45,640 --> 00:25:47,809
developer environment. There's no problem

743
00:25:47,809 --> 00:25:49,130
in shutting that down

744
00:25:49,489 --> 00:25:51,729
immediately, uh, but you may have

745
00:25:51,729 --> 00:25:53,769
highly sensitive production systems you don't want

746
00:25:53,769 --> 00:25:54,348
your agent

747
00:25:54,729 --> 00:25:55,390
to go and.

748
00:25:55,858 --> 00:25:57,858
Uh, shut down your EC2

749
00:25:57,858 --> 00:25:59,489
instances or block um.

750
00:26:01,000 --> 00:26:02,818
Uh, turn off security,

751
00:26:03,078 --> 00:26:05,358
turn off your roles, uh, block

752
00:26:05,358 --> 00:26:06,108
access to that,

753
00:26:06,598 --> 00:26:08,880
that instance, so you wanna create a containment

754
00:26:08,880 --> 00:26:10,959
script. Uh, so those

755
00:26:10,959 --> 00:26:12,459
are the, the two paths,

756
00:26:12,759 --> 00:26:15,059
and then in both paths we're going to

757
00:26:15,479 --> 00:26:16,539
generate a final report.

758
00:26:18,039 --> 00:26:20,469
So what could go wrong with a use AWS

759
00:26:20,469 --> 00:26:22,959
agent that has access to uh

760
00:26:22,959 --> 00:26:25,578
to do things? How do you control permissions

761
00:26:25,959 --> 00:26:28,239
uh for the agent so that it

762
00:26:28,239 --> 00:26:30,279
can only perform actions

763
00:26:30,279 --> 00:26:32,358
in the location in the environments where

764
00:26:32,358 --> 00:26:33,259
you want it to

765
00:26:33,519 --> 00:26:34,459
perform actions.

766
00:26:35,078 --> 00:26:36,779
For that, we want to use

767
00:26:37,890 --> 00:26:40,160
attribute based uh access

768
00:26:40,160 --> 00:26:41,219
control policies,

769
00:26:41,719 --> 00:26:44,239
uh, and this is what allows an opt-in

770
00:26:44,239 --> 00:26:44,979
pattern

771
00:26:45,239 --> 00:26:46,959
for your environments.

772
00:26:47,750 --> 00:26:49,049
And your resources,

773
00:26:49,549 --> 00:26:50,650
what does that look like?

774
00:26:50,949 --> 00:26:53,029
Uh, so the agent, you create

775
00:26:53,029 --> 00:26:54,650
an agent role policy.

776
00:26:55,150 --> 00:26:57,489
So this is, uh, a policy,

777
00:26:57,949 --> 00:26:59,049
uh, that the

778
00:26:59,509 --> 00:27:01,769
agent uses when it's executing

779
00:27:02,108 --> 00:27:03,250
and it has

780
00:27:03,630 --> 00:27:05,209
under the, uh,

781
00:27:05,709 --> 00:27:08,108
actions you can see it we have it

782
00:27:08,108 --> 00:27:09,150
allowed to do

783
00:27:09,509 --> 00:27:11,750
stop EC2 instances, start EC2

784
00:27:11,750 --> 00:27:13,000
instances, etc.

785
00:27:13,380 --> 00:27:15,130
uh, and it has a condition

786
00:27:15,430 --> 00:27:16,670
and the condition says.

787
00:27:17,219 --> 00:27:18,039
If the

788
00:27:18,880 --> 00:27:20,299
Uh, if it has

789
00:27:20,640 --> 00:27:21,410
this tag,

790
00:27:21,670 --> 00:27:23,979
allow mutative actions by role,

791
00:27:24,239 --> 00:27:26,239
and the tag matches, and I don't give

792
00:27:26,239 --> 00:27:28,098
it a role name, I give it a variable.

793
00:27:28,559 --> 00:27:30,598
Uh, I say it has to match the

794
00:27:30,598 --> 00:27:31,959
actual agent role name.

795
00:27:32,680 --> 00:27:35,420
So then within my EC2 resources,

796
00:27:35,920 --> 00:27:38,160
I say allow mutative actions

797
00:27:38,160 --> 00:27:40,160
by role and I set

798
00:27:40,160 --> 00:27:42,719
the value of that tag to secops

799
00:27:42,719 --> 00:27:43,380
agent.

800
00:27:43,890 --> 00:27:46,358
And within my IAM role,

801
00:27:46,519 --> 00:27:47,880
I also have a tag

802
00:27:48,160 --> 00:27:50,209
that says the agent role name is SEC

803
00:27:50,209 --> 00:27:52,078
ops agent. So if those match,

804
00:27:52,479 --> 00:27:54,519
then the action is allowed. If those

805
00:27:54,519 --> 00:27:56,519
don't match or if that EC2

806
00:27:56,519 --> 00:27:57,818
resource doesn't have.

807
00:27:58,269 --> 00:28:00,430
The tag present, it's not

808
00:28:00,430 --> 00:28:01,559
gonna be able to,

809
00:28:01,838 --> 00:28:04,410
uh, the agent won't be able to perform any mutative

810
00:28:04,709 --> 00:28:06,789
actions against that resource.

811
00:28:07,650 --> 00:28:08,489
So that's the

812
00:28:08,890 --> 00:28:11,469
that's the key of the opt-in pattern

813
00:28:11,789 --> 00:28:13,009
uh as a

814
00:28:13,568 --> 00:28:15,608
as a DevOps engineer, as an engineer,

815
00:28:15,729 --> 00:28:17,799
I have to go and add that tag to

816
00:28:17,799 --> 00:28:18,509
my resource

817
00:28:19,170 --> 00:28:21,289
in order for the agent to be able to act on

818
00:28:21,289 --> 00:28:23,368
it um and so I

819
00:28:23,368 --> 00:28:25,368
can, I can choose to do that or not

820
00:28:25,368 --> 00:28:27,410
do that based on the sensitivity of my system.

821
00:28:27,729 --> 00:28:29,769
Basically we're assigning a role to the agent

822
00:28:29,890 --> 00:28:32,250
and what agent can perform on what

823
00:28:32,250 --> 00:28:33,568
resources actually and then.

824
00:28:34,170 --> 00:28:36,170
This role is based on the tax, and you need

825
00:28:36,170 --> 00:28:38,469
to apply those tax to the resources that you want to,

826
00:28:39,029 --> 00:28:40,348
to be managed by the agent,

827
00:28:40,729 --> 00:28:43,309
OK, so we're agreeing with the fine grain, uh,

828
00:28:43,608 --> 00:28:45,189
uh, permissions because

829
00:28:45,568 --> 00:28:47,568
we don't want to turn one incident into another incident.

830
00:28:47,729 --> 00:28:49,809
So we want to limit what agent can do

831
00:28:49,809 --> 00:28:52,068
and what agent cannot do. So that's why we are

832
00:28:52,358 --> 00:28:54,789
choosing to add that role and assign it to the agent.

833
00:28:56,848 --> 00:28:59,430
All right, so for um

834
00:28:59,608 --> 00:29:01,750
to actually create the graph pattern, let's go

835
00:29:01,750 --> 00:29:03,170
through the steps to do that.

836
00:29:03,568 --> 00:29:05,709
Uh, I'm loading some of the pre-built

837
00:29:05,709 --> 00:29:07,969
agent code that I uh specified

838
00:29:07,969 --> 00:29:10,209
above. We have the investigation agent,

839
00:29:10,598 --> 00:29:11,469
containment,

840
00:29:11,789 --> 00:29:13,969
uh, helper, containment actor, and a

841
00:29:13,969 --> 00:29:14,640
report agent,

842
00:29:15,088 --> 00:29:17,328
and I'm using Strand's graph builder.

843
00:29:18,318 --> 00:29:19,469
So the graph builder

844
00:29:19,989 --> 00:29:20,689
has

845
00:29:20,949 --> 00:29:23,108
really two components. You add nodes,

846
00:29:23,229 --> 00:29:24,539
those are your agents,

847
00:29:24,910 --> 00:29:27,150
and then you add edges, and that's the.

848
00:29:28,049 --> 00:29:30,559
Uh, traverse points between your nodes

849
00:29:30,900 --> 00:29:32,939
so we can see the nodes. I've added

850
00:29:32,939 --> 00:29:35,189
containment investigation report

851
00:29:35,539 --> 00:29:37,670
and then the edges investigation

852
00:29:37,979 --> 00:29:40,009
goes to the containment actor and the

853
00:29:40,009 --> 00:29:42,459
containment helper and I've specified a

854
00:29:42,459 --> 00:29:44,578
condition if and only if allowed

855
00:29:44,578 --> 00:29:45,699
mutative action.

856
00:29:46,680 --> 00:29:48,338
Uh, and that function,

857
00:29:49,039 --> 00:29:51,039
uh, that, that references

858
00:29:51,039 --> 00:29:53,479
a function that I have that goes and

859
00:29:53,479 --> 00:29:55,680
looks at the tags

860
00:29:55,680 --> 00:29:57,680
on the resources and, and

861
00:29:57,680 --> 00:29:58,219
decides

862
00:29:58,640 --> 00:30:00,959
what, uh, to do or tags on the cloud

863
00:30:00,959 --> 00:30:01,979
formation stack,

864
00:30:02,549 --> 00:30:04,858
uh, and, and decides what to do.

865
00:30:05,279 --> 00:30:07,519
I could look in my CMDB database.

866
00:30:07,559 --> 00:30:09,500
It can, it can look in various

867
00:30:09,959 --> 00:30:12,039
places, so that, that's one way to

868
00:30:12,039 --> 00:30:13,858
control some deterministic behavior

869
00:30:14,269 --> 00:30:15,420
in your agents.

870
00:30:16,078 --> 00:30:17,818
And then both go to a report

871
00:30:18,289 --> 00:30:19,259
and then finally

872
00:30:19,680 --> 00:30:21,979
uh we have the set entry point

873
00:30:22,199 --> 00:30:23,019
which will

874
00:30:23,568 --> 00:30:25,759
uh we're setting the entry point as

875
00:30:25,759 --> 00:30:26,858
the investigation

876
00:30:27,160 --> 00:30:29,239
we have some controls to set the max number

877
00:30:29,239 --> 00:30:31,519
of executions and a timeout

878
00:30:31,969 --> 00:30:33,029
and then

879
00:30:33,479 --> 00:30:34,059
we

880
00:30:34,439 --> 00:30:36,559
build, we use a graph builder to build

881
00:30:36,559 --> 00:30:39,009
that and that becomes our orchestration agent,

882
00:30:39,400 --> 00:30:41,180
um. That,

883
00:30:42,130 --> 00:30:44,449
uh, the output of that built command, that's

884
00:30:44,449 --> 00:30:47,229
what we actually call to invoke the orchestrator

885
00:30:47,689 --> 00:30:50,088
so we again can get the findings

886
00:30:50,088 --> 00:30:51,150
from guard duty

887
00:30:51,449 --> 00:30:53,689
and feed that becomes our prompt

888
00:30:53,939 --> 00:30:56,209
and the result of the action

889
00:30:56,568 --> 00:30:58,009
is if we,

890
00:30:58,449 --> 00:31:00,630
if we run this and let it get started

891
00:31:01,049 --> 00:31:01,910
it will,

892
00:31:02,529 --> 00:31:04,709
it will begin investigating

893
00:31:04,809 --> 00:31:05,449
this,

894
00:31:05,739 --> 00:31:06,318
uh.

895
00:31:07,479 --> 00:31:08,660
This incident

896
00:31:09,199 --> 00:31:10,559
and provide a response.

897
00:31:11,519 --> 00:31:13,559
So we added the timeout and we added

898
00:31:13,559 --> 00:31:14,549
the executions number,

899
00:31:15,719 --> 00:31:18,000
making sure that the agent is not going to continuously

900
00:31:18,000 --> 00:31:18,939
loop it by itself.

901
00:31:19,439 --> 00:31:21,439
So we want to exit at some point, OK,

902
00:31:21,559 --> 00:31:22,400
if something goes wrong.

903
00:31:24,000 --> 00:31:24,640
But that'll take

904
00:31:25,059 --> 00:31:27,078
a few moments to run. Here's what,

905
00:31:27,098 --> 00:31:28,358
uh, I ran this

906
00:31:28,779 --> 00:31:31,059
just, uh, just before the session,

907
00:31:31,140 --> 00:31:33,559
uh, to show you the incident response report.

908
00:31:33,858 --> 00:31:36,539
Uh, it gives an executive summary,

909
00:31:37,059 --> 00:31:39,500
affected resources, and then actions

910
00:31:39,500 --> 00:31:40,279
taken,

911
00:31:40,588 --> 00:31:42,739
uh, investigation findings

912
00:31:42,739 --> 00:31:44,858
and containment actions. So in this case I

913
00:31:44,858 --> 00:31:45,750
had it to

914
00:31:46,098 --> 00:31:47,519
perform the actual actions

915
00:31:47,858 --> 00:31:48,799
on my,

916
00:31:49,098 --> 00:31:50,338
uh, on my account.

917
00:31:50,750 --> 00:31:53,059
Uh, it created a forensic snapshot.

918
00:31:53,318 --> 00:31:54,279
It, uh,

919
00:31:54,559 --> 00:31:56,299
isolated the security group.

920
00:31:56,759 --> 00:31:59,078
It, uh, revoked some IAM

921
00:31:59,078 --> 00:32:00,009
permissions,

922
00:32:00,400 --> 00:32:03,098
and it shut down the instance, um,

923
00:32:03,680 --> 00:32:05,750
and, uh, blocked some DNS

924
00:32:05,750 --> 00:32:06,618
communication.

925
00:32:07,650 --> 00:32:09,809
Uh, so it provided, it did the actions and

926
00:32:09,809 --> 00:32:11,989
provided the report all without me having

927
00:32:11,989 --> 00:32:13,509
to, uh,

928
00:32:13,969 --> 00:32:15,170
do any manual work.

929
00:32:22,098 --> 00:32:24,578
OK. So let's

930
00:32:25,239 --> 00:32:26,380
step on to

931
00:32:26,949 --> 00:32:27,699
part two.

932
00:32:29,328 --> 00:32:32,059
We've got some agents. We've got agent orchestration.

933
00:32:32,449 --> 00:32:34,578
Uh, how do we scale these agents?

934
00:32:34,650 --> 00:32:36,989
How do we get them working autonomously

935
00:32:37,368 --> 00:32:39,670
and get them working in production?

936
00:32:40,250 --> 00:32:42,459
So using strands agents or using

937
00:32:42,459 --> 00:32:44,108
bedrock agent core, it's,

938
00:32:44,410 --> 00:32:46,469
it's simple. We can,

939
00:32:46,509 --> 00:32:47,108
uh,

940
00:32:47,469 --> 00:32:48,368
in our agent.

941
00:32:49,318 --> 00:32:51,529
We can decorate the agent with an entry

942
00:32:51,529 --> 00:32:53,338
point, so we have app entry point

943
00:32:53,680 --> 00:32:55,059
and that decorator

944
00:32:55,719 --> 00:32:57,479
goes into the

945
00:32:58,239 --> 00:32:59,858
orchestrator and we can see

946
00:33:00,239 --> 00:33:02,459
here with this pattern I'm actually using

947
00:33:04,078 --> 00:33:06,229
an action pattern in the payload.

948
00:33:06,640 --> 00:33:08,640
So I have two actions. I've defined a

949
00:33:08,640 --> 00:33:11,039
chat action and an orchestrate graph action.

950
00:33:11,318 --> 00:33:12,380
The chat action might

951
00:33:12,640 --> 00:33:14,618
allow a security

952
00:33:15,078 --> 00:33:16,420
analyst specialist.

953
00:33:17,250 --> 00:33:19,598
To actually chat with the agent and ask it

954
00:33:19,920 --> 00:33:22,019
about specific incidents that it's

955
00:33:22,318 --> 00:33:24,519
worked on, uh, and do some

956
00:33:24,519 --> 00:33:27,078
additional research, maybe perform additional actions.

957
00:33:27,400 --> 00:33:29,250
The orchestrate graph agent,

958
00:33:29,719 --> 00:33:31,959
uh, is the automation workflow.

959
00:33:32,239 --> 00:33:34,239
So in the architecture we looked

960
00:33:34,239 --> 00:33:35,098
at earlier,

961
00:33:35,519 --> 00:33:37,640
we have guard duty findings or

962
00:33:37,640 --> 00:33:40,000
Amazon inspector findings. You may have findings

963
00:33:40,000 --> 00:33:40,858
from a third party

964
00:33:41,318 --> 00:33:41,838
system.

965
00:33:42,880 --> 00:33:44,618
That you want to feed into

966
00:33:45,259 --> 00:33:47,449
a lambda function and automatically invoke

967
00:33:47,449 --> 00:33:48,078
your agent.

968
00:33:48,400 --> 00:33:50,598
Well, when you do that, you want the agent to

969
00:33:50,598 --> 00:33:52,140
return immediately.

970
00:33:52,930 --> 00:33:54,979
Uh, you don't want to wait for if it takes

971
00:33:55,189 --> 00:33:57,229
5 minutes, 10 minutes, 15 minutes for it to

972
00:33:57,229 --> 00:33:59,318
do its research and do its its job. You

973
00:33:59,318 --> 00:33:59,949
don't want the,

974
00:34:00,250 --> 00:34:02,439
the lambda running, waiting for that response the whole

975
00:34:02,439 --> 00:34:03,539
time. You want it to

976
00:34:04,239 --> 00:34:05,400
get a payload back

977
00:34:05,759 --> 00:34:07,799
immediately. So that's where asynchronous

978
00:34:07,799 --> 00:34:09,030
invocation comes in,

979
00:34:09,309 --> 00:34:10,500
which is supported by.

980
00:34:11,548 --> 00:34:12,079
Uh,

981
00:34:12,358 --> 00:34:14,559
multiple framework strains agents, bedrock agent

982
00:34:14,559 --> 00:34:16,458
core. So in this pattern,

983
00:34:16,918 --> 00:34:17,498
the

984
00:34:17,759 --> 00:34:20,079
agent, uh, we pass in the payload,

985
00:34:20,117 --> 00:34:22,197
the guard duty finding details to our

986
00:34:22,197 --> 00:34:22,759
agent.

987
00:34:23,079 --> 00:34:25,378
We call, we give it an asynchronous

988
00:34:25,599 --> 00:34:26,248
invoke,

989
00:34:26,559 --> 00:34:27,617
and that will

990
00:34:28,358 --> 00:34:30,398
return a response basically saying I've

991
00:34:30,398 --> 00:34:32,559
started my job. Now what's happening in the

992
00:34:32,559 --> 00:34:35,018
background is the agent continues

993
00:34:35,239 --> 00:34:37,559
to run in the background on Bedrock agent corp.

994
00:34:38,590 --> 00:34:40,668
Uh, and continues to

995
00:34:40,668 --> 00:34:42,829
do the work that it needs to do

996
00:34:42,829 --> 00:34:44,929
to complete the remediation.

997
00:34:45,550 --> 00:34:47,708
Yeah, basically, your orchestration agent

998
00:34:47,708 --> 00:34:48,849
is gonna take care of

999
00:34:49,228 --> 00:34:51,228
the, um, flow, basically, uh, once

1000
00:34:51,228 --> 00:34:53,309
you receive the alert, the orchestration

1001
00:34:53,309 --> 00:34:54,958
is gonna work with multiple agents,

1002
00:34:55,429 --> 00:34:55,969
and

1003
00:34:56,628 --> 00:34:58,659
these agents are specialized in the specific

1004
00:34:58,659 --> 00:35:00,269
role. They gather the information,

1005
00:35:00,579 --> 00:35:02,239
contentment, and create the report

1006
00:35:02,668 --> 00:35:04,789
and then pass it back to the orchestration agent,

1007
00:35:04,869 --> 00:35:07,019
uh, to summarize everything and then publish

1008
00:35:07,019 --> 00:35:07,570
it back.

1009
00:35:10,530 --> 00:35:12,510
So we have, uh, we have our agent,

1010
00:35:12,889 --> 00:35:15,199
uh, our, our complex agent

1011
00:35:15,449 --> 00:35:17,378
now we wanna deploy it to production.

1012
00:35:17,889 --> 00:35:20,010
So for that I'm gonna use the Bedrock

1013
00:35:20,010 --> 00:35:21,000
Agent C core toolkit.

1014
00:35:21,648 --> 00:35:23,648
Uh, it's something that, that you

1015
00:35:23,648 --> 00:35:25,780
can download as, as part of the,

1016
00:35:25,978 --> 00:35:26,550
um,

1017
00:35:27,090 --> 00:35:29,329
SDK or libraries available for Agent

1018
00:35:29,329 --> 00:35:31,369
Corre, and it provides

1019
00:35:31,369 --> 00:35:32,228
some simple,

1020
00:35:32,579 --> 00:35:33,090
um.

1021
00:35:33,809 --> 00:35:35,478
Some simple commands.

1022
00:35:37,000 --> 00:35:39,050
As a, as a CLI program, so

1023
00:35:39,050 --> 00:35:40,349
I can just go through

1024
00:35:40,719 --> 00:35:41,530
configure,

1025
00:35:41,929 --> 00:35:44,168
uh, and I'm gonna pass in the configuration,

1026
00:35:44,250 --> 00:35:46,590
the entry point, so I may have multiple

1027
00:35:47,340 --> 00:35:49,369
Python applications within my folder.

1028
00:35:49,449 --> 00:35:51,679
I'm, I'm working in the folder that the agent,

1029
00:35:52,090 --> 00:35:52,989
uh, exists in

1030
00:35:53,250 --> 00:35:55,148
configure, here's the entry point

1031
00:35:55,530 --> 00:35:56,750
and it walks through a wizard,

1032
00:35:57,409 --> 00:35:58,139
uh,

1033
00:35:58,728 --> 00:36:00,728
to build out the configuration for

1034
00:36:00,728 --> 00:36:01,329
my agent.

1035
00:36:01,918 --> 00:36:03,958
Uh, it'll pick a default name based

1036
00:36:03,958 --> 00:36:04,739
on my file.

1037
00:36:05,199 --> 00:36:07,199
It will identify that there's a

1038
00:36:07,199 --> 00:36:09,219
requirement. Uh, this is built on Python,

1039
00:36:09,320 --> 00:36:11,019
so that's the requirements file.

1040
00:36:12,199 --> 00:36:14,438
Uh, it gives me the option to do

1041
00:36:14,438 --> 00:36:16,478
a direct code deploy or a container

1042
00:36:16,478 --> 00:36:17,000
deployment.

1043
00:36:17,280 --> 00:36:19,409
I'm gonna choose direct code deploy,

1044
00:36:19,840 --> 00:36:21,340
uh, for this use case.

1045
00:36:21,789 --> 00:36:24,300
It gives me the option to choose a Python version

1046
00:36:24,639 --> 00:36:26,219
and execution role.

1047
00:36:26,559 --> 00:36:28,019
Uh, so if you've, if you've

1048
00:36:28,519 --> 00:36:30,059
created that role earlier,

1049
00:36:30,438 --> 00:36:32,179
uh, you can pass that in here.

1050
00:36:32,500 --> 00:36:34,610
And uh give

1051
00:36:34,610 --> 00:36:36,079
your agent the access

1052
00:36:36,458 --> 00:36:38,878
to do the mutative actions.

1053
00:36:39,300 --> 00:36:41,340
S3 bucket is for the

1054
00:36:41,340 --> 00:36:42,369
code hosting

1055
00:36:42,739 --> 00:36:44,780
authorization configuration. I'm gonna

1056
00:36:44,780 --> 00:36:47,280
use uh IM authorization,

1057
00:36:47,300 --> 00:36:48,639
which is the default.

1058
00:36:49,219 --> 00:36:50,559
The header allow list,

1059
00:36:50,969 --> 00:36:53,079
that's for use cases where you want to.

1060
00:36:53,829 --> 00:36:56,148
Pass in additional headers if you have

1061
00:36:56,510 --> 00:36:58,659
um if you wanna invoke your agent

1062
00:36:58,659 --> 00:37:00,668
from third party systems

1063
00:37:00,668 --> 00:37:02,699
and and use that OA

1064
00:37:02,699 --> 00:37:04,668
token and pass it through so

1065
00:37:04,989 --> 00:37:07,369
say you have a user or a system that

1066
00:37:07,378 --> 00:37:09,128
already has an authorization token

1067
00:37:09,389 --> 00:37:11,590
you wanna pass that through to your MCP

1068
00:37:11,590 --> 00:37:12,648
endpoints,

1069
00:37:12,938 --> 00:37:14,289
uh, that's where that

1070
00:37:14,789 --> 00:37:16,989
header comes into play and then I'm going

1071
00:37:16,989 --> 00:37:18,869
to skip setting up memory for that.

1072
00:37:19,659 --> 00:37:21,699
So my agent is configured and

1073
00:37:21,699 --> 00:37:23,898
then it gives me the next steps here.

1074
00:37:24,219 --> 00:37:26,579
I can just simply do agent core launch.

1075
00:37:32,139 --> 00:37:34,610
And that will actually deploy my agent

1076
00:37:34,610 --> 00:37:35,929
to Bedrock agent cop

1077
00:37:36,530 --> 00:37:38,769
in production. It uploads

1078
00:37:38,769 --> 00:37:40,769
the code, does all the prep work, so

1079
00:37:40,769 --> 00:37:41,949
it makes it very simple

1080
00:37:42,409 --> 00:37:44,409
to actually get an agent up and

1081
00:37:44,409 --> 00:37:46,570
running and testing and

1082
00:37:46,570 --> 00:37:48,030
then of course there's

1083
00:37:48,289 --> 00:37:49,188
a few other.

1084
00:37:50,219 --> 00:37:52,289
Uh, steps available

1085
00:37:52,289 --> 00:37:52,889
to

1086
00:37:53,188 --> 00:37:54,090
you. You can

1087
00:37:54,668 --> 00:37:55,530
continue on

1088
00:37:55,789 --> 00:37:57,530
doing things like invoke.

1089
00:37:58,019 --> 00:38:00,148
Uh, you can invoke your agent from that

1090
00:38:00,148 --> 00:38:01,849
command line. You can destroy

1091
00:38:02,269 --> 00:38:04,269
the agent, uh, to for your

1092
00:38:04,269 --> 00:38:05,449
tear down scripts,

1093
00:38:05,869 --> 00:38:07,989
uh, so that you're, you're cleaning up. So

1094
00:38:07,989 --> 00:38:09,010
it makes it really easy

1095
00:38:09,389 --> 00:38:11,539
for you to set up and test your agent in

1096
00:38:11,539 --> 00:38:13,559
production and get it, get

1097
00:38:13,559 --> 00:38:14,769
it deployed, of course.

1098
00:38:15,750 --> 00:38:18,000
Other infrastructures, code patterns

1099
00:38:18,000 --> 00:38:19,780
are supported as well, Amazon,

1100
00:38:20,199 --> 00:38:22,659
AWS CDK and cloud formation.

1101
00:38:26,559 --> 00:38:28,590
All right, so we want some more, we

1102
00:38:28,590 --> 00:38:30,599
wanna provide some tips and tricks

1103
00:38:30,599 --> 00:38:32,750
on how to get more deterministic behavior

1104
00:38:32,750 --> 00:38:35,059
out of your agents. Sometimes if you've built agents,

1105
00:38:35,389 --> 00:38:36,059
uh,

1106
00:38:36,360 --> 00:38:38,458
it can be challenging to tune

1107
00:38:38,458 --> 00:38:39,739
the prompts and get everything

1108
00:38:40,119 --> 00:38:41,958
working directly as you want.

1109
00:38:42,360 --> 00:38:44,840
Uh, so, a few things that, that

1110
00:38:44,840 --> 00:38:46,688
we recommend are one,

1111
00:38:47,119 --> 00:38:49,478
within strands, you can use pedantic

1112
00:38:49,478 --> 00:38:51,760
models to define structured output

1113
00:38:51,760 --> 00:38:52,478
for your agents.

1114
00:38:52,889 --> 00:38:54,090
So what does that look like

1115
00:38:54,688 --> 00:38:57,030
in the case of the investigation agent?

1116
00:38:58,378 --> 00:38:59,219
We have,

1117
00:38:59,579 --> 00:39:01,699
uh, we've defined a class based on

1118
00:39:01,699 --> 00:39:02,800
the base model,

1119
00:39:03,099 --> 00:39:05,539
and I've just given it 33

1120
00:39:05,539 --> 00:39:07,659
simple things. Uh, I want a response

1121
00:39:07,659 --> 00:39:08,179
message.

1122
00:39:08,458 --> 00:39:10,628
I want the list of affected resources

1123
00:39:10,628 --> 00:39:11,780
and a severity,

1124
00:39:12,059 --> 00:39:14,139
and then I can pass that in when I invoke

1125
00:39:14,139 --> 00:39:15,820
the agent. I can pass in

1126
00:39:16,139 --> 00:39:18,199
that structured output model.

1127
00:39:18,539 --> 00:39:20,619
What that does is suppose

1128
00:39:20,619 --> 00:39:21,898
after the investigation.

1129
00:39:22,329 --> 00:39:23,469
You have

1130
00:39:23,849 --> 00:39:25,849
a service where you want to iterate

1131
00:39:25,849 --> 00:39:28,309
through the resources affected

1132
00:39:28,530 --> 00:39:30,530
and you wanna perform some

1133
00:39:30,530 --> 00:39:32,070
additional logic on those

1134
00:39:32,409 --> 00:39:33,909
rather than having to parse

1135
00:39:34,208 --> 00:39:36,530
the agent response uh as

1136
00:39:36,530 --> 00:39:38,628
plain text, you can, this gives you

1137
00:39:39,628 --> 00:39:41,250
a nice object format that you can use.

1138
00:39:45,728 --> 00:39:47,929
Another pattern is

1139
00:39:47,929 --> 00:39:48,969
to use hooks

1140
00:39:49,489 --> 00:39:50,809
within your agent. So

1141
00:39:51,168 --> 00:39:53,489
the strange framework provides the

1142
00:39:53,489 --> 00:39:55,070
capability to use hooks,

1143
00:39:55,389 --> 00:39:57,668
uh, and what this does is suppose

1144
00:39:58,090 --> 00:39:58,949
in your.

1145
00:39:59,820 --> 00:40:01,750
Uh, use AWS tool.

1146
00:40:02,059 --> 00:40:03,840
You have some things that are.

1147
00:40:04,659 --> 00:40:07,239
Some things that are tagged as

1148
00:40:07,619 --> 00:40:09,820
as production or you have some resources

1149
00:40:09,820 --> 00:40:11,039
that you want to make sure

1150
00:40:11,378 --> 00:40:12,648
behave in a certain way,

1151
00:40:12,978 --> 00:40:15,099
the hooks allow you to interrupt that

1152
00:40:15,099 --> 00:40:15,639
tool

1153
00:40:15,938 --> 00:40:18,340
execution or uh either

1154
00:40:18,340 --> 00:40:20,860
before or after uh interrupt

1155
00:40:20,860 --> 00:40:23,059
before the um the

1156
00:40:23,059 --> 00:40:25,438
model actually runs to.

1157
00:40:25,869 --> 00:40:27,438
Execute in that agent loop

1158
00:40:27,719 --> 00:40:29,800
and you can perform additional actions so

1159
00:40:29,800 --> 00:40:31,840
you might, you might interrupt when the

1160
00:40:31,840 --> 00:40:32,438
tool start

1161
00:40:32,958 --> 00:40:34,418
tool, uh,

1162
00:40:34,800 --> 00:40:36,059
event calls if you detect

1163
00:40:36,559 --> 00:40:38,898
that the use AWS tool is being called

1164
00:40:39,079 --> 00:40:41,418
and you detect that the action is

1165
00:40:41,679 --> 00:40:43,059
stop EC2 instance

1166
00:40:43,409 --> 00:40:44,389
and you want to

1167
00:40:44,860 --> 00:40:47,039
add some additional logic there to say, you

1168
00:40:47,039 --> 00:40:48,619
know, do this, don't do that,

1169
00:40:48,958 --> 00:40:50,699
uh, that's what hooks will

1170
00:40:50,989 --> 00:40:51,719
allow you to do.

1171
00:40:53,280 --> 00:40:55,398
And then finally you can actually nest

1172
00:40:55,398 --> 00:40:56,559
multi-agent patterns.

1173
00:40:56,918 --> 00:40:59,438
So we've talked a lot about remediating

1174
00:40:59,438 --> 00:41:01,639
EC2 instances, but your environments

1175
00:41:01,639 --> 00:41:03,579
aren't made up primarily of

1176
00:41:03,869 --> 00:41:05,918
EC2 instances. You may have things

1177
00:41:05,918 --> 00:41:06,449
in

1178
00:41:06,840 --> 00:41:09,559
ECR, you may have lambda functions, you may have databases

1179
00:41:09,559 --> 00:41:11,820
and, and RDS or other systems,

1180
00:41:12,119 --> 00:41:14,539
um, so you can create

1181
00:41:14,840 --> 00:41:15,699
multiple.

1182
00:41:16,628 --> 00:41:18,829
Remediation pattern agents following

1183
00:41:18,829 --> 00:41:20,168
your run books

1184
00:41:20,590 --> 00:41:22,628
and use those uh

1185
00:41:22,628 --> 00:41:24,728
in a multi-agent pattern so you have a

1186
00:41:25,059 --> 00:41:26,769
a a graph

1187
00:41:27,188 --> 00:41:29,188
that uh takes care of

1188
00:41:29,188 --> 00:41:31,309
just lambda functions and that can be a

1189
00:41:31,309 --> 00:41:33,510
child graph of your main graph

1190
00:41:33,510 --> 00:41:34,878
that does your sec

1191
00:41:35,349 --> 00:41:37,010
your full secops workflow.

1192
00:41:38,949 --> 00:41:40,489
So, these are the, uh,

1193
00:41:41,148 --> 00:41:43,309
QR codes for our services, and

1194
00:41:43,309 --> 00:41:45,429
we're gonna post the solution uh soon uh

1195
00:41:45,429 --> 00:41:47,530
into our samples, GitHub samples.

1196
00:41:48,030 --> 00:41:48,789
And, uh,

1197
00:41:49,148 --> 00:41:51,228
from your mobile app, uh, if you can

1198
00:41:51,228 --> 00:41:53,269
fill out all the survey, so that would be helpful for

1199
00:41:53,269 --> 00:41:54,019
us, OK?

1200
00:41:54,349 --> 00:41:56,550
Uh, we are here for the next 10 minutes in the hall.

1201
00:41:56,668 --> 00:41:58,398
Uh, if you have any questions, um,

1202
00:41:58,668 --> 00:42:00,619
please stop by here and I'll be happy to help. Yes.

