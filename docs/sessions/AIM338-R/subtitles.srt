1
00:00:00,017 --> 00:00:01,500
- [Aneel] Hello, everyone.

2
00:00:01,500 --> 00:00:06,090
Welcome. Thank you for joining us today.

3
00:00:06,090 --> 00:00:09,450
I'm assuming this is your first
reinvent session for 2025.

4
00:00:09,450 --> 00:00:12,783
Woo. Alright, thanks for
giving us that privilege.

5
00:00:14,730 --> 00:00:19,730
So today we are going to talk
about bridging structured

6
00:00:21,510 --> 00:00:25,440
and unstructured data using AI agents.

7
00:00:25,440 --> 00:00:27,990
Let me begin by asking you a question.

8
00:00:27,990 --> 00:00:31,380
How many of you here
are building AI agents

9
00:00:31,380 --> 00:00:33,780
or maybe they're running
AI agents in production,

10
00:00:33,780 --> 00:00:35,670
or you're experimenting with it?

11
00:00:35,670 --> 00:00:39,570
How many of you? Wow,
quite a few of them, right?

12
00:00:39,570 --> 00:00:42,660
Anybody want to tell me what
kind of data you're using

13
00:00:42,660 --> 00:00:45,123
for these AI agents?

14
00:00:48,570 --> 00:00:52,683
Is it going against unstructured
data like files in S3?

15
00:00:53,640 --> 00:00:55,320
Okay. Alright.

16
00:00:55,320 --> 00:00:59,910
Is there any data that is
in relational data sources,

17
00:00:59,910 --> 00:01:00,963
like structured data?

18
00:01:02,310 --> 00:01:03,990
Okay, yeah, a few of you. Yeah.

19
00:01:03,990 --> 00:01:08,340
So usually in enterprises,
a lot of knowledge

20
00:01:08,340 --> 00:01:11,870
that we have of all these
enterprise systems from last 15,

21
00:01:11,870 --> 00:01:15,510
20 years is the data is logged
in relational databases.

22
00:01:15,510 --> 00:01:18,870
That's the predominant
data storage mechanism

23
00:01:18,870 --> 00:01:21,300
in enterprises, large enterprises.

24
00:01:21,300 --> 00:01:24,990
And we also have a lot
of unstructured data

25
00:01:24,990 --> 00:01:26,550
over the past 10, 15 years

26
00:01:26,550 --> 00:01:29,190
because we have so much of
data that's being generated

27
00:01:29,190 --> 00:01:31,920
in all forms and shapes.

28
00:01:31,920 --> 00:01:35,760
So this talk is about how do
you use AI agents to bridge

29
00:01:35,760 --> 00:01:39,870
that data that is in different
silos in structured data

30
00:01:39,870 --> 00:01:41,010
and unstructured data.

31
00:01:41,010 --> 00:01:43,920
You use AI agents to
bridge all of that together

32
00:01:43,920 --> 00:01:47,430
and have a intelligent system

33
00:01:47,430 --> 00:01:50,100
that can go across these data silos.

34
00:01:50,100 --> 00:01:51,453
This is a core talk.

35
00:01:53,040 --> 00:01:54,930
So we will be doing,

36
00:01:54,930 --> 00:01:58,770
demonstrating a building an
application here, application.

37
00:01:58,770 --> 00:02:00,570
You don't need laptops.

38
00:02:00,570 --> 00:02:02,880
If you try to follow us, follow along

39
00:02:02,880 --> 00:02:04,570
when we are doing, it's probably

40
00:02:06,640 --> 00:02:09,960
not enough time for us
to type all the codes.

41
00:02:09,960 --> 00:02:13,290
So we'll be using some snippets vs.

42
00:02:13,290 --> 00:02:16,380
core snippets to bring in blocks of code,

43
00:02:16,380 --> 00:02:18,810
but you'll generally get
the idea how to build

44
00:02:18,810 --> 00:02:21,270
this type of application.

45
00:02:21,270 --> 00:02:24,060
My name is Aneel Murari, I'm
a senior solutions architect

46
00:02:24,060 --> 00:02:24,960
with AWS.

47
00:02:24,960 --> 00:02:28,800
I work with our nonprofit
financial industry customers.

48
00:02:28,800 --> 00:02:30,750
I've been with AWS for five years.

49
00:02:30,750 --> 00:02:33,153
I'm joined today by my
amazing colleague, Rafia.

50
00:02:34,080 --> 00:02:35,790
- Thank you. Hello, everyone.

51
00:02:35,790 --> 00:02:37,200
My name is Rafia Tapia

52
00:02:37,200 --> 00:02:39,570
and I'm a senior solutions architect,

53
00:02:39,570 --> 00:02:42,150
also working with non-profit customers.

54
00:02:42,150 --> 00:02:46,020
I've been with AWS for a
little more than six years now

55
00:02:46,020 --> 00:02:51,020
and really excited to share
some of the code we've created

56
00:02:52,526 --> 00:02:54,750
for this code talk.

57
00:02:54,750 --> 00:02:57,976
So we can start.

58
00:02:57,976 --> 00:03:00,180
- [Aneel] Alright. Yeah.
- [Rafia] Alright.

59
00:03:00,180 --> 00:03:02,730
So the first thing we'll do is we'll kind

60
00:03:02,730 --> 00:03:06,840
of briefly talk about the
architecture of the application,

61
00:03:06,840 --> 00:03:09,033
the code, which we will be building today.

62
00:03:11,460 --> 00:03:16,260
On the far, let's see,
your left hand side,

63
00:03:16,260 --> 00:03:21,260
you'll see there's a
UI application, right?

64
00:03:22,020 --> 00:03:27,020
We've written that in
streamlit, nothing complicated,

65
00:03:27,150 --> 00:03:31,710
but that UI will be able
to take a user question

66
00:03:31,710 --> 00:03:34,710
and then be able to answer

67
00:03:34,710 --> 00:03:38,310
that user question via two type of data.

68
00:03:38,310 --> 00:03:40,620
One is the unstructured data,

69
00:03:40,620 --> 00:03:44,970
which we have shown on the top yellow pane

70
00:03:44,970 --> 00:03:49,950
on the architecture diagram,
in the unstructured data

71
00:03:49,950 --> 00:03:52,590
would be coming from
Bedrock knowledge bases.

72
00:03:52,590 --> 00:03:54,120
We have one slide

73
00:03:54,120 --> 00:03:56,340
where I will be talking a
little bit more about bedrock

74
00:03:56,340 --> 00:03:57,720
knowledge bases.

75
00:03:57,720 --> 00:03:59,670
And then the structured data,

76
00:03:59,670 --> 00:04:02,970
which we will be coming
from Aurora database.

77
00:04:02,970 --> 00:04:07,800
Now, if anyone who don't
know what Aurora is,

78
00:04:07,800 --> 00:04:10,620
Aurora is our managed
relation database service.

79
00:04:10,620 --> 00:04:14,760
We support my SQL, Postgres SQL,

80
00:04:14,760 --> 00:04:16,800
and some other databases.

81
00:04:16,800 --> 00:04:20,550
But for this demo we will
be targeting Postgres SQL

82
00:04:20,550 --> 00:04:22,443
for all the structured data.

83
00:04:23,880 --> 00:04:25,740
Let's move on to the next one.

84
00:04:25,740 --> 00:04:29,760
So before we go in, I just want to kind of

85
00:04:29,760 --> 00:04:32,730
make sure everyone knows what are

86
00:04:32,730 --> 00:04:37,730
the SDKs and the agent
tools you'll be using.

87
00:04:38,670 --> 00:04:43,023
So we will be building our
agent using Strand SDK.

88
00:04:43,860 --> 00:04:46,680
Is there anyone who has
already done some work

89
00:04:46,680 --> 00:04:48,243
with Strand in this room?

90
00:04:49,260 --> 00:04:50,093
Oh, nice.

91
00:04:50,093 --> 00:04:50,926
- [Aneel] Yeah, we have a couple of hands.

92
00:04:50,926 --> 00:04:52,260
- [Rafia] Nice. Very nice. All right.

93
00:04:52,260 --> 00:04:55,650
So Strand allow you to
build a single agent

94
00:04:55,650 --> 00:04:57,510
as well as multi-agent

95
00:04:57,510 --> 00:04:59,880
where the agents can talk with each other.

96
00:04:59,880 --> 00:05:04,880
Strand supports MCP as
well as a two A protocol.

97
00:05:05,700 --> 00:05:09,930
Here we are showing you a simple agent

98
00:05:09,930 --> 00:05:12,570
where a prompt is sent to the agent.

99
00:05:12,570 --> 00:05:15,000
The agent has certain tools built into it,

100
00:05:15,000 --> 00:05:19,740
and based on the tool,
it'll be able to provide

101
00:05:19,740 --> 00:05:22,890
the service which this
prompt is asking for, right?

102
00:05:22,890 --> 00:05:27,060
So that is the model, a simple agent,

103
00:05:27,060 --> 00:05:30,243
single agent, which we will
be creating today's code talk.

104
00:05:31,710 --> 00:05:36,710
The next is about how do we
access unstructured data.

105
00:05:37,830 --> 00:05:42,543
Now, how many of you have
written rag applications?

106
00:05:44,220 --> 00:05:46,508
Okay, I see quite a few hands, right?

107
00:05:46,508 --> 00:05:47,640
- [Aneel] Yeah, quite a few of them.

108
00:05:47,640 --> 00:05:50,370
- [Rafia] So you guys know
the way when we bring,

109
00:05:50,370 --> 00:05:52,080
when you write a RAG application,

110
00:05:52,080 --> 00:05:55,350
we take our data most
likely unstructured data,

111
00:05:55,350 --> 00:05:58,470
maybe in a PDF format or word format

112
00:05:58,470 --> 00:06:00,480
or plain log files.

113
00:06:00,480 --> 00:06:04,470
And then we convert that into vectors,

114
00:06:04,470 --> 00:06:07,290
because that's what our LLM understands,

115
00:06:07,290 --> 00:06:09,483
and then be able to use that,

116
00:06:10,646 --> 00:06:12,717
the knowledge which is
stored in those unstructured

117
00:06:12,717 --> 00:06:17,717
documents and be able to provide
AI solutions on top of it.

118
00:06:18,480 --> 00:06:22,470
Now, bedrock knowledge
base allow us to build all

119
00:06:22,470 --> 00:06:27,060
that rag infrastructure
very effectively and easily

120
00:06:27,060 --> 00:06:29,970
and this is what we will
be showing you today,

121
00:06:29,970 --> 00:06:33,990
that we will be taking some of the files,

122
00:06:33,990 --> 00:06:36,960
which has some content in
let's say Word document,

123
00:06:36,960 --> 00:06:41,400
and then we will be putting it
into a bedrock knowledge base

124
00:06:41,400 --> 00:06:44,370
and be able to query that via our agent.

125
00:06:44,370 --> 00:06:46,800
Now, because of time constraint,

126
00:06:46,800 --> 00:06:50,100
we have already created a knowledge base

127
00:06:50,100 --> 00:06:52,020
for our code talk,

128
00:06:52,020 --> 00:06:56,100
but if any of you are
interested in knowing how

129
00:06:56,100 --> 00:06:59,880
to build a knowledge base
from from scratch, please come

130
00:06:59,880 --> 00:07:01,290
and talk to us after the session

131
00:07:01,290 --> 00:07:04,110
and we'll be more than happy to point you

132
00:07:04,110 --> 00:07:06,753
to some resources, okay?

133
00:07:07,590 --> 00:07:10,800
- [Aneel] Alright, so
this is the application

134
00:07:10,800 --> 00:07:12,180
that we're going to build today.

135
00:07:12,180 --> 00:07:16,890
So let me play this,

136
00:07:16,890 --> 00:07:18,123
let's see, alright,

137
00:07:20,910 --> 00:07:22,500
so no surprise here.

138
00:07:22,500 --> 00:07:24,720
We both are from the non-profit group,

139
00:07:24,720 --> 00:07:26,760
so we picked the charity use case.

140
00:07:26,760 --> 00:07:30,219
So we're building a charity
chat assistant, a chat bot,

141
00:07:30,219 --> 00:07:34,020
that will go against structured
and unstructured data.

142
00:07:34,020 --> 00:07:35,850
We have all the campaign information,

143
00:07:35,850 --> 00:07:38,643
donation information in a
relational database in Aurora,

144
00:07:38,643 --> 00:07:42,600
and we have some unstructured
campaign related data

145
00:07:42,600 --> 00:07:46,080
in a S3 bucket, which is we are asking

146
00:07:46,080 --> 00:07:48,450
through our bedrock knowledge base.

147
00:07:48,450 --> 00:07:51,810
So as you can see, if
you ask some questions

148
00:07:51,810 --> 00:07:56,810
that needs it to go against
the relational data source,

149
00:07:57,720 --> 00:08:01,200
the AI application that we are building,

150
00:08:01,200 --> 00:08:04,350
the agent application that we
are building, we'll figure out

151
00:08:04,350 --> 00:08:06,360
what is the right data source to go to

152
00:08:06,360 --> 00:08:08,310
and get that data automatically from

153
00:08:08,310 --> 00:08:09,990
that corresponding data source.

154
00:08:09,990 --> 00:08:11,280
So we are going to see all of this

155
00:08:11,280 --> 00:08:13,323
and how we are going to build this.

156
00:08:14,730 --> 00:08:18,993
Alright, let me switch to my ID mode.

157
00:08:21,300 --> 00:08:22,133
Alright.

158
00:08:23,815 --> 00:08:28,080
- [Rafia] And for most part
we will some of the UI aspect,

159
00:08:28,080 --> 00:08:33,080
we'll try to take it out very fast

160
00:08:33,240 --> 00:08:37,890
because there's really
nothing which is extraordinary

161
00:08:37,890 --> 00:08:39,870
or something that you
guys might be interested

162
00:08:39,870 --> 00:08:40,703
in learning today,

163
00:08:40,703 --> 00:08:43,910
but, so the reason why we, we have this UI

164
00:08:43,910 --> 00:08:46,140
so we can show you a
complete agent, right?

165
00:08:46,140 --> 00:08:50,820
But as Aneel is bringing the code,

166
00:08:50,820 --> 00:08:55,170
you'll see that we'll start
with the very basic structure

167
00:08:55,170 --> 00:08:57,153
of the UI and then,

168
00:09:00,246 --> 00:09:02,970
so yeah we'll start with showing you

169
00:09:02,970 --> 00:09:06,963
a very basic UI skeleton, you know how-

170
00:09:09,852 --> 00:09:11,940
- Yeah, so apologies for that.

171
00:09:11,940 --> 00:09:15,480
So as you can see, I'm using
my favorite ID kiro here.

172
00:09:15,480 --> 00:09:17,830
So if you're not familiar
with Kiro ID, it is

173
00:09:22,397 --> 00:09:27,397
an IDE that Amazon supports
and released recently.

174
00:09:27,840 --> 00:09:31,650
It's a IDE where you can do white coding

175
00:09:31,650 --> 00:09:33,510
and also spec driven development.

176
00:09:33,510 --> 00:09:35,010
We are not going to do any of that today.

177
00:09:35,010 --> 00:09:37,860
We are just going to demonstrate
building this application,

178
00:09:37,860 --> 00:09:42,860
but, and you can use
any ID for that matter.

179
00:09:43,350 --> 00:09:47,313
So I'm going to start
with an empty folder here.

180
00:09:48,607 --> 00:09:51,180
I already have some files here.

181
00:09:51,180 --> 00:09:53,370
Let me quickly go through
what those files are doing.

182
00:09:53,370 --> 00:09:54,580
I created a virtual
Python virtual environment

183
00:09:54,580 --> 00:09:57,150
of three point 12

184
00:09:57,150 --> 00:10:01,560
and I have a requirements file
that with all the libraries

185
00:10:01,560 --> 00:10:03,306
that we are going to use today.

186
00:10:03,306 --> 00:10:06,872
Talked about strands,
strands for agent and agent.

187
00:10:06,872 --> 00:10:08,178
Tafia, go ahead.

188
00:10:08,178 --> 00:10:11,640
- Tafia] So, if you are
working with Strand,

189
00:10:11,640 --> 00:10:13,830
there are two packages,

190
00:10:13,830 --> 00:10:17,130
and by the way, right now Strand
only is supporting Python.

191
00:10:17,130 --> 00:10:20,765
So there are these two packages,
which you need to make sure

192
00:10:20,765 --> 00:10:25,060
you bring it in your
environment to be able to use

193
00:10:26,198 --> 00:10:29,640
some of the APIs and tools
we will be showing you.

194
00:10:29,640 --> 00:10:33,060
One is Strand agent and the
other is Strand Agent tools.

195
00:10:33,060 --> 00:10:36,240
- [Aneel] Yeah. And another
file I have is run.sh.

196
00:10:36,240 --> 00:10:40,500
So we are going to build a
Streamlit app for a UI app.

197
00:10:40,500 --> 00:10:43,590
So this run.sh is just
sets up my environment.

198
00:10:43,590 --> 00:10:45,758
If there's no virtual
environment, it creates one

199
00:10:45,758 --> 00:10:48,675
and it starts my Streamlit app at the end.

200
00:10:48,675 --> 00:10:49,860
So that's all it's doing.

201
00:10:49,860 --> 00:10:52,620
So just by to save some time,

202
00:10:52,620 --> 00:10:54,540
we have these two files already here.

203
00:10:54,540 --> 00:10:57,210
So let me start by creating a new file.

204
00:10:57,210 --> 00:11:00,700
I'm going to call that app.py

205
00:11:01,773 --> 00:11:03,893
and we're going to start
putting some code into it.

206
00:11:05,730 --> 00:11:08,130
- [Rafia] So this app.py will have

207
00:11:08,130 --> 00:11:10,353
most of our UI code in it.

208
00:11:11,910 --> 00:11:15,390
- [Aneel] So as you can
imagine, you don't want me

209
00:11:15,390 --> 00:11:18,810
to be typing in front
of you or all this code

210
00:11:18,810 --> 00:11:22,530
and probably going through that pain of

211
00:11:22,530 --> 00:11:23,550
looking at me typing.

212
00:11:23,550 --> 00:11:28,550
So what we did is we are
using VS code snippets.

213
00:11:29,850 --> 00:11:33,690
So to help us just bring
in code that we want.

214
00:11:33,690 --> 00:11:37,230
So we are going to first just
build that shell of the UI

215
00:11:37,230 --> 00:11:38,460
that we showed earlier.

216
00:11:38,460 --> 00:11:40,960
So nothing fancy here, we just going to

217
00:11:42,300 --> 00:11:43,260
bring in some snippets.

218
00:11:43,260 --> 00:11:45,330
This first one is doing imports

219
00:11:45,330 --> 00:11:47,490
and then setting up some constants.

220
00:11:47,490 --> 00:11:50,910
Like if you, for those of you who probably

221
00:11:50,910 --> 00:11:52,770
noticed on the left hand side,

222
00:11:52,770 --> 00:11:55,170
we have some sample questions
and things like that.

223
00:11:55,170 --> 00:11:58,170
So this is just bringing all those things.

224
00:11:58,170 --> 00:12:01,950
Again, this file is not
the most exciting part.

225
00:12:01,950 --> 00:12:06,840
Other files are, so I'm going
to just quickly go over this.

226
00:12:06,840 --> 00:12:10,560
This is going to set
up my team for the app,

227
00:12:10,560 --> 00:12:12,270
which is like a dark theme,

228
00:12:12,270 --> 00:12:16,290
and then I'm going to
just bring in the snippet

229
00:12:16,290 --> 00:12:17,580
for the chat interface.

230
00:12:17,580 --> 00:12:20,520
So again, like I said,
there's nothing much here.

231
00:12:20,520 --> 00:12:24,990
We just brought in a show of
a application Streamlit app.

232
00:12:24,990 --> 00:12:28,080
There's one thing that I
do want you to note though.

233
00:12:28,080 --> 00:12:29,580
I commented out this piece of code,

234
00:12:29,580 --> 00:12:32,550
which we will un-comment
later, which we will bring in,

235
00:12:32,550 --> 00:12:34,020
add in the capabilities of the agent.

236
00:12:34,020 --> 00:12:35,730
For now it's just doing nothing.

237
00:12:35,730 --> 00:12:40,450
So let's try to run this
and see what happens.

238
00:12:46,710 --> 00:12:49,346
- [Rafia] So you'll see that right now

239
00:12:49,346 --> 00:12:52,680
the UI is really not
nothing intelligent, right?

240
00:12:52,680 --> 00:12:55,200
Even if you ask a question,
it might not be able

241
00:12:55,200 --> 00:12:57,417
to answer it correctly.

242
00:12:57,417 --> 00:13:00,060
So why don't we ask a question?

243
00:13:00,060 --> 00:13:03,240
- [Aneel] Yeah, so this
is the empty application.

244
00:13:03,240 --> 00:13:06,330
So let's see if we can ask a question.

245
00:13:06,330 --> 00:13:08,040
I'm expecting an error to come

246
00:13:08,040 --> 00:13:10,947
because we don't have any
agent capabilities yet

247
00:13:10,947 --> 00:13:14,100
as expected there is a error here.

248
00:13:14,100 --> 00:13:17,340
So let's move on to a little
bit more exciting part

249
00:13:17,340 --> 00:13:19,983
of the session today.

250
00:13:22,410 --> 00:13:25,560
Alright, if I can kill this one.

251
00:13:25,560 --> 00:13:28,353
Alright, so I'm going to add another file.

252
00:13:29,220 --> 00:13:31,593
I'm gonna call that agent.py.

253
00:13:33,090 --> 00:13:36,750
- [Rafia] And this file
will have our core logic

254
00:13:36,750 --> 00:13:38,100
of the strand agent,

255
00:13:38,100 --> 00:13:41,340
which you'll see we will
be building it later on.

256
00:13:41,340 --> 00:13:43,624
- Yeah, so I'm start with

257
00:13:43,624 --> 00:13:46,833
just getting some import statements.

258
00:13:50,130 --> 00:13:51,690
And yeah, go ahead.

259
00:13:51,690 --> 00:13:54,743
- [Rafia] So as we are building
this agent, we'll walk you

260
00:13:54,743 --> 00:13:56,250
through line by line, right?

261
00:13:56,250 --> 00:14:00,330
The first thing, of course
we need these, we need

262
00:14:00,330 --> 00:14:02,130
to import some packages,
particularly we need

263
00:14:02,130 --> 00:14:03,570
to import the strand packages

264
00:14:03,570 --> 00:14:07,470
and we have some other
packages like photo three

265
00:14:07,470 --> 00:14:10,650
because we will be going
against Aurora database

266
00:14:10,650 --> 00:14:12,900
and bedrock DB and so forth.

267
00:14:12,900 --> 00:14:14,760
The next thing you'll see that

268
00:14:14,760 --> 00:14:18,810
because we are going to be going against

269
00:14:18,810 --> 00:14:22,350
LLM model here we are using a model ID,

270
00:14:22,350 --> 00:14:23,460
which is Claude model.

271
00:14:23,460 --> 00:14:27,540
So our agent will be using Claude to,

272
00:14:27,540 --> 00:14:31,140
when a user gives a question, it will take

273
00:14:31,140 --> 00:14:34,830
that question, it'll feed
that question into the agent.

274
00:14:34,830 --> 00:14:38,370
The agent of course has to
use a LLM to be able to answer

275
00:14:38,370 --> 00:14:42,870
that question, and the model
it'll use is gonna be cloud.

276
00:14:42,870 --> 00:14:47,220
Now strand, SDK do allow you

277
00:14:47,220 --> 00:14:52,050
to talk to any LLM, even
those LLM outside of Bedrock.

278
00:14:52,050 --> 00:14:56,100
We've chosen it to be
bedrock a supported LLM.

279
00:14:56,100 --> 00:14:59,310
But you, if you are doing
it, you are free to use

280
00:14:59,310 --> 00:15:00,367
any other LLM.

281
00:15:01,483 --> 00:15:05,010
And then the next thing we
are doing is declaring some

282
00:15:05,010 --> 00:15:08,010
inference parameter, like
maximum token allowed

283
00:15:08,010 --> 00:15:09,843
and temperature and so forth.

284
00:15:10,950 --> 00:15:14,760
So now the first thing Aneel,
the code Aneel has put in is

285
00:15:14,760 --> 00:15:19,190
that the code from line 18 to 22 is

286
00:15:21,489 --> 00:15:23,613
the base model we are creating, right?

287
00:15:24,466 --> 00:15:27,480
We are using a model id,
which is a cloud model id,

288
00:15:27,480 --> 00:15:30,150
we've given certain parameters.

289
00:15:30,150 --> 00:15:32,607
Then the code of line which,

290
00:15:32,607 --> 00:15:36,630
and just put from line 28 to 29

291
00:15:36,630 --> 00:15:41,630
or actually to 32, is
using the strand agent

292
00:15:42,960 --> 00:15:45,930
to just create a base agent.

293
00:15:45,930 --> 00:15:50,090
Now, this agent has no
intelligence in it, into it.

294
00:15:50,090 --> 00:15:53,370
We just wanted to show
you two lines of code

295
00:15:53,370 --> 00:15:55,140
how a agent is created.

296
00:15:55,140 --> 00:15:56,790
So you'll see it's as easy

297
00:15:56,790 --> 00:16:00,960
as instantiating a agent object, right?

298
00:16:00,960 --> 00:16:04,241
That agent object takes
two things, it takes

299
00:16:04,241 --> 00:16:09,030
a model id, which we've
already built in from line 18

300
00:16:09,030 --> 00:16:12,060
to line 22, takes a model object

301
00:16:12,060 --> 00:16:15,060
and then the second thing
it takes is a system prompt.

302
00:16:15,060 --> 00:16:19,530
Now this, at this point,
the agent is really

303
00:16:19,530 --> 00:16:21,150
just a blank canvas.

304
00:16:21,150 --> 00:16:23,250
No intelligence has been built in.

305
00:16:23,250 --> 00:16:25,200
- [Rafia] Yeah, notice
in the prompt we said

306
00:16:25,200 --> 00:16:26,220
don't make up answers.

307
00:16:26,220 --> 00:16:29,618
Just if you don't know,
say, don't know, right?

308
00:16:29,618 --> 00:16:33,660
So let's run this
application again, you see?

309
00:16:33,660 --> 00:16:35,400
- [Rafia] And before you
run this, I think you have

310
00:16:35,400 --> 00:16:37,680
to un-comment the-

311
00:16:37,680 --> 00:16:39,210
- [Aneel] Yeah, very good point.

312
00:16:39,210 --> 00:16:43,380
- [Rafia] So, Aneel remember
he showed you in the app.py,

313
00:16:43,380 --> 00:16:46,170
he had commented some code

314
00:16:46,170 --> 00:16:49,020
because that code was what
was calling the agent.

315
00:16:49,020 --> 00:16:52,110
So let's un-comment and go
through that again, right?

316
00:16:52,110 --> 00:16:54,360
- [Aneel] Yeah, thank you.

317
00:16:54,360 --> 00:16:56,520
- [Rafia] Let me just
explain that code Aneel.

318
00:16:56,520 --> 00:16:57,353
- [Aneel] Yeah.

319
00:16:57,353 --> 00:16:58,186
- [Rafia] What's your un-comment.

320
00:16:58,186 --> 00:17:00,270
- [Aneel] Comment this and you go.

321
00:17:00,270 --> 00:17:03,870
- [Rafia] So the code, which
Aneel un-commented, right,

322
00:17:03,870 --> 00:17:08,870
that code, what it does,
it first makes sure that

323
00:17:10,227 --> 00:17:15,227
the agent object is not in
the state of the Streamlit.

324
00:17:16,350 --> 00:17:18,060
So Streamlit maintains,

325
00:17:18,060 --> 00:17:20,880
there's a state management aspect, right?

326
00:17:20,880 --> 00:17:23,950
So first is going to
check if there is already

327
00:17:25,290 --> 00:17:27,930
the session state has a agent object.

328
00:17:27,930 --> 00:17:30,990
If it does not, then
it'll create that agent,

329
00:17:30,990 --> 00:17:33,630
the same agent which Aneel just created

330
00:17:33,630 --> 00:17:35,850
in the agent.py file.

331
00:17:35,850 --> 00:17:37,380
So that's what this code is doing

332
00:17:37,380 --> 00:17:38,820
and we've just un-commented.

333
00:17:38,820 --> 00:17:41,670
But keep in mind at this
point all it's doing,

334
00:17:41,670 --> 00:17:44,490
the Streamlit is going
to be calling our agent.

335
00:17:44,490 --> 00:17:46,080
Our agent has no logic.

336
00:17:46,080 --> 00:17:49,890
So you would not expect
much functionality,

337
00:17:49,890 --> 00:17:52,020
but when he run this code,

338
00:17:52,020 --> 00:17:55,800
you might not see some intelligent answer,

339
00:17:55,800 --> 00:17:58,750
but at least you won't see the
error which you saw earlier.

340
00:17:59,790 --> 00:18:00,630
- [Aneel] Yeah.

341
00:18:00,630 --> 00:18:04,950
So let's ask the application
the same question

342
00:18:04,950 --> 00:18:07,233
we asked how many members do we have?

343
00:18:09,630 --> 00:18:12,270
And let's see what it says.

344
00:18:12,270 --> 00:18:13,590
So it says, I don't have access to

345
00:18:13,590 --> 00:18:16,140
your organization's
current membership data.

346
00:18:16,140 --> 00:18:18,120
So it's basically say, telling us that

347
00:18:18,120 --> 00:18:19,890
it doesn't know the answer.

348
00:18:19,890 --> 00:18:23,550
- So, at this point, we've
completed the entire structure

349
00:18:23,550 --> 00:18:25,350
of our code, right?

350
00:18:25,350 --> 00:18:28,320
We've built the UI, we've built a agent,

351
00:18:28,320 --> 00:18:30,630
which does not have much intelligence,

352
00:18:30,630 --> 00:18:32,313
but at least is functional.

353
00:18:32,313 --> 00:18:34,770
And then as we move forward,

354
00:18:34,770 --> 00:18:38,880
we will start building
more intelligence into it.

355
00:18:38,880 --> 00:18:41,850
- [Aneel] So let's begin by adding quote

356
00:18:41,850 --> 00:18:46,488
to retrieve data from the knowledge base.

357
00:18:46,488 --> 00:18:48,370
- [Rafia] Yeah, so strength, remember

358
00:18:50,100 --> 00:18:52,260
the architect diagram,
which I showed in the slide

359
00:18:52,260 --> 00:18:57,240
after that we showed that agent
can have tools in it, right?

360
00:18:57,240 --> 00:19:00,630
Strand allow you to create
your own custom tool

361
00:19:00,630 --> 00:19:05,193
and it also come up with
lot of ready to use tools.

362
00:19:06,060 --> 00:19:09,390
Today you'll see that we
will be using one custom tool

363
00:19:09,390 --> 00:19:12,510
and one which is already available to us

364
00:19:12,510 --> 00:19:14,253
from the strand SGK.

365
00:19:15,750 --> 00:19:18,720
- [Aneel] Alright, so I
added the retrieve tool here.

366
00:19:18,720 --> 00:19:21,180
For this retrieve tool to work

367
00:19:21,180 --> 00:19:23,700
we also need to set some
environment variables.

368
00:19:23,700 --> 00:19:25,877
- [Rafia] So let me, as
Aneel is typing this in,

369
00:19:25,877 --> 00:19:28,920
let me tell you explain
what retrieve tool is.

370
00:19:28,920 --> 00:19:33,180
Retrieve is out of the
box strand SDK tool,

371
00:19:33,180 --> 00:19:37,980
which allow you to query
bedrock knowledge base.

372
00:19:37,980 --> 00:19:42,780
You don't have to write any custom code

373
00:19:42,780 --> 00:19:45,690
to access knowledge base,
it does it everything.

374
00:19:45,690 --> 00:19:48,000
The only thing you would need, you need

375
00:19:48,000 --> 00:19:50,460
to create a bedrock knowledge base, which

376
00:19:50,460 --> 00:19:53,190
as I mentioned earlier,
we had already created

377
00:19:53,190 --> 00:19:56,533
and the code, which Aneel
just put in on line 26,

378
00:19:59,370 --> 00:20:02,820
you'll see that the knowledge
base when you create

379
00:20:02,820 --> 00:20:04,890
a bedrock knowledge base,

380
00:20:04,890 --> 00:20:07,860
the knowledge base gives you a unique id

381
00:20:07,860 --> 00:20:12,180
and this is the unique id which
we have, which we have kind

382
00:20:12,180 --> 00:20:17,180
of hardcoded here to
let retrieve tool know

383
00:20:17,430 --> 00:20:20,100
which knowledge base it has to go through.

384
00:20:20,100 --> 00:20:23,460
I'm gonna stop here in case
if anyone have any question on

385
00:20:23,460 --> 00:20:25,230
the knowledge base.

386
00:20:25,230 --> 00:20:27,882
- [Speaker 1] So one quick one,

387
00:20:27,882 --> 00:20:30,060
like as I'm kind of following listening,

388
00:20:30,060 --> 00:20:33,630
writing, would you mind if
time permits just give it one

389
00:20:33,630 --> 00:20:36,731
more rundown after all these up?

390
00:20:36,731 --> 00:20:38,820
- [Aneel] Sure, absolutely. Yeah, sure.

391
00:20:38,820 --> 00:20:41,220
- [Rafia] But just to recap, okay.

392
00:20:41,220 --> 00:20:44,620
When you are creating
knowledge base, you identify

393
00:20:45,578 --> 00:20:48,030
your data source, where your
unstructured data is coming

394
00:20:48,030 --> 00:20:50,610
from, most likely will be Word document,

395
00:20:50,610 --> 00:20:52,110
PDF documents, whatever.

396
00:20:52,110 --> 00:20:53,850
And then the knowledge base.

397
00:20:53,850 --> 00:20:56,830
You also, when creating the
knowledge base, you also say

398
00:20:57,768 --> 00:21:02,070
what is that vector database
where you'll be storing that?

399
00:21:02,070 --> 00:21:05,640
All you have to identify is the
data source, a vector store,

400
00:21:05,640 --> 00:21:07,470
and then the knowledge base does all

401
00:21:07,470 --> 00:21:08,823
the heavy lifting for you.

402
00:21:09,720 --> 00:21:11,400
Once you do go through that,

403
00:21:11,400 --> 00:21:15,390
it'll give you a knowledge
base ID, which we have in,

404
00:21:15,390 --> 00:21:19,290
put it in here so we can let
our strand agent know, oh,

405
00:21:19,290 --> 00:21:22,260
this is a knowledge base you have to use.

406
00:21:22,260 --> 00:21:23,940
- [Aneel] Yeah, I have to
put in a disclaimer here.

407
00:21:23,940 --> 00:21:26,733
I know we hard coding these
IDs all over the code.

408
00:21:26,733 --> 00:21:28,590
This is probably not how you would do it

409
00:21:28,590 --> 00:21:30,690
if you want to take this
to production you want

410
00:21:30,690 --> 00:21:32,250
to store this in some parameter store

411
00:21:32,250 --> 00:21:34,530
or some other external
configuration store,

412
00:21:34,530 --> 00:21:38,098
but this is just easy for
us to demonstrate this way.

413
00:21:38,098 --> 00:21:43,098
- [Rafia] And as part of
these retrieve Strand agent,

414
00:21:43,290 --> 00:21:46,740
it has to have, again,
the knowledge base ID

415
00:21:46,740 --> 00:21:48,360
as well as the region.

416
00:21:48,360 --> 00:21:50,040
Now there are two ways
you can do it, right?

417
00:21:50,040 --> 00:21:53,940
You can actually give that
in two pieces of information

418
00:21:53,940 --> 00:21:57,600
to retrieve tool via
environmental variable,

419
00:21:57,600 --> 00:21:59,040
which we are doing it here.

420
00:21:59,040 --> 00:22:02,820
So if you look at the
core on line 29 and 30,

421
00:22:02,820 --> 00:22:07,020
this is where we establish
environmental variable

422
00:22:07,020 --> 00:22:09,810
where the knowledge base
ID and the region where

423
00:22:09,810 --> 00:22:12,510
that knowledge base is created

424
00:22:12,510 --> 00:22:16,140
is injected right into the environment.

425
00:22:16,140 --> 00:22:19,140
So, the retrieve tool will be able

426
00:22:19,140 --> 00:22:21,180
to pick it from the environmental variable

427
00:22:21,180 --> 00:22:23,157
and we'll know where to go.

428
00:22:23,157 --> 00:22:25,303
Okay.
- [Aneel] Alright.

429
00:22:25,303 --> 00:22:27,047
- [Speaker 1] We're
actually the knowledge base

430
00:22:27,047 --> 00:22:28,410
in the vector database
is ready to be used.

431
00:22:28,410 --> 00:22:30,845
- [Rafia] Exactly, exactly.

432
00:22:30,845 --> 00:22:33,990
Because we had a time constraint,

433
00:22:33,990 --> 00:22:35,940
we did not go through that exercise

434
00:22:35,940 --> 00:22:38,040
of creating the knowledge base.

435
00:22:38,040 --> 00:22:40,065
- [Speaker 2] Any standard
factors for embedding

436
00:22:40,065 --> 00:22:43,223
or to create those vector
that you want us to.

437
00:22:45,500 --> 00:22:48,000
- [Rafia] So yeah, go
ahead. Yeah, go, go ahead.

438
00:22:48,000 --> 00:22:50,010
- [Aneel] No, with
bedrock knowledge basis,

439
00:22:50,010 --> 00:22:51,453
it's a few clicks, right?

440
00:22:53,656 --> 00:22:56,910
We can stay after the session and-

441
00:22:56,910 --> 00:22:59,190
- [sPEAKER 2] For the specific
form of data, for example,

442
00:22:59,190 --> 00:23:01,500
you the data in the Word document, right?

443
00:23:01,500 --> 00:23:03,330
Any best practices, you wanna to suggest

444
00:23:03,330 --> 00:23:07,140
that if a Word document
or the S format, right?

445
00:23:07,140 --> 00:23:08,891
What embedding models we can use,

446
00:23:08,891 --> 00:23:10,320
what the size, how we can get.

447
00:23:10,320 --> 00:23:12,750
- [Rafia] So bedrock supports, yeah.

448
00:23:12,750 --> 00:23:15,180
So, Bedrock supports two, embedding Model

449
00:23:15,180 --> 00:23:17,313
Titan and a cohere model.

450
00:23:18,971 --> 00:23:22,650
The chunking strategy, it's
a topic which is definitely

451
00:23:22,650 --> 00:23:23,730
a very important topic,

452
00:23:23,730 --> 00:23:27,090
but I think if you want, we
can definitely talk later on.

453
00:23:27,090 --> 00:23:30,930
It would be way out of scope
for us to focus on chunking,

454
00:23:30,930 --> 00:23:32,340
but it's a important thing.

455
00:23:32,340 --> 00:23:33,720
Let's talk after the session.

456
00:23:33,720 --> 00:23:35,430
- [Speaker 2] That is not right, right?

457
00:23:35,430 --> 00:23:36,660
The answering-

458
00:23:36,660 --> 00:23:38,310
- [Rafia] Absolutely, absolutely.

459
00:23:39,540 --> 00:23:40,650
- [Aneel] Alright, so let's-

460
00:23:40,650 --> 00:23:42,650
- [Rafia] I'm sorry, there's a question.

461
00:23:44,263 --> 00:23:45,671
- [Speaker 3] Does the call to.

462
00:23:45,671 --> 00:23:46,504
- [Rafia] Yes, it is.

463
00:23:46,504 --> 00:23:49,255
- [Speaker 3] Can it be attached
to any other vector tool

464
00:23:49,255 --> 00:23:52,590
like OpenSearch or it has to
be Bedrock knowledge base.

465
00:23:52,590 --> 00:23:55,113
- [Rafia] Retrieve is for
bedrock knowledge base.

466
00:23:56,670 --> 00:24:00,540
But there are, and by the
way, the strands or tools,

467
00:24:00,540 --> 00:24:02,040
it's a community development tool.

468
00:24:02,040 --> 00:24:04,590
So tools are coming up every day.

469
00:24:04,590 --> 00:24:07,980
You might be able to find tools

470
00:24:07,980 --> 00:24:09,513
which can go to other data.

471
00:24:12,120 --> 00:24:14,700
- [Aneel] Alright, so, I
ran this application again.

472
00:24:14,700 --> 00:24:17,610
Now let's go back and
ask the same question

473
00:24:17,610 --> 00:24:20,490
we have been asking how
many members do we have?

474
00:24:20,490 --> 00:24:22,083
And let's see what it does.

475
00:24:27,480 --> 00:24:28,500
It's doing something now

476
00:24:28,500 --> 00:24:31,170
because it's not saying, I don't know.

477
00:24:31,170 --> 00:24:34,290
Alright, so it looked
in the knowledge base

478
00:24:34,290 --> 00:24:37,080
and came back with some answers.

479
00:24:37,080 --> 00:24:39,070
And it clearly states here, like

480
00:24:40,200 --> 00:24:42,750
based on the information I
found in the knowledge base,

481
00:24:42,750 --> 00:24:45,540
these is some like
number of donors we had,

482
00:24:45,540 --> 00:24:47,835
but it's clearly not
coming from the structured

483
00:24:47,835 --> 00:24:50,580
relational data, which
may be more accurate.

484
00:24:50,580 --> 00:24:54,750
So our next step is to
extend this, to go to that.

485
00:24:54,750 --> 00:24:57,540
- [Rafia] So, so now,
because what we did, we did,

486
00:24:57,540 --> 00:25:01,710
we had some documents which
were related to our campaign

487
00:25:01,710 --> 00:25:04,500
and it had some data in it,

488
00:25:04,500 --> 00:25:07,440
but the answer was not a
hundred percent accurate.

489
00:25:07,440 --> 00:25:09,780
The a hundred percent
accurate answer is sitting

490
00:25:09,780 --> 00:25:11,520
in our databases, right?

491
00:25:11,520 --> 00:25:16,520
Our database is where most
of our enterprise data is,

492
00:25:17,130 --> 00:25:20,375
or especially when you
are already going against

493
00:25:20,375 --> 00:25:23,880
your enterprise application data, right?

494
00:25:23,880 --> 00:25:25,320
So now what we will be doing,

495
00:25:25,320 --> 00:25:27,180
we'll be creating a custom tool.

496
00:25:27,180 --> 00:25:29,790
That custom tool, what it will do,

497
00:25:29,790 --> 00:25:32,970
it'll take a prompt from the user

498
00:25:32,970 --> 00:25:36,330
try to answer, if this
prompt can be answered

499
00:25:36,330 --> 00:25:38,970
through our relational database data.

500
00:25:38,970 --> 00:25:42,360
If it can be, it's gonna convert that into

501
00:25:42,360 --> 00:25:44,430
appropriate query language

502
00:25:44,430 --> 00:25:46,530
and be able to retrieve that data.

503
00:25:46,530 --> 00:25:49,893
So for that, the first thing
we will do is create a-

504
00:25:52,920 --> 00:25:56,070
- [Aneel] Yeah, I'm adding
that custom tool, that talking.

505
00:25:56,070 --> 00:25:59,850
- [Rafia] So, all Aneel did
was in the agent definition,

506
00:25:59,850 --> 00:26:02,550
we already had put in a retrieve tool.

507
00:26:02,550 --> 00:26:07,550
Now he also created a
query SQL DB tool, right?

508
00:26:08,400 --> 00:26:10,320
We have not created this tool yet,

509
00:26:10,320 --> 00:26:12,300
but that's the purpose of the tool.

510
00:26:12,300 --> 00:26:14,768
So now we'll create the tool

511
00:26:14,768 --> 00:26:18,780
that the entire logic of
that custom tool will be

512
00:26:18,780 --> 00:26:20,250
in a separate file.

513
00:26:20,250 --> 00:26:22,350
And that's what Aneel is doing.

514
00:26:22,350 --> 00:26:27,350
Let's call that file query_SQL_db.py.

515
00:26:29,460 --> 00:26:32,430
And this is where we will
build our custom tool.

516
00:26:32,430 --> 00:26:34,440
So of course the first
thing we need to do is

517
00:26:34,440 --> 00:26:37,575
import all the appropriate packages,

518
00:26:37,575 --> 00:26:40,083
which we'll do first thing.

519
00:26:41,220 --> 00:26:46,220
Again, strand agent and tool is one of

520
00:26:46,320 --> 00:26:49,110
the fundamental packages
you need to bring in,

521
00:26:49,110 --> 00:26:50,460
and that's what we have.

522
00:26:50,460 --> 00:26:51,960
We also have boto3.

523
00:26:51,960 --> 00:26:56,580
Boto3 is again, anybody
who have used AWS SGK,

524
00:26:56,580 --> 00:27:01,580
that's a Python SGK, to access
most of our AWS services.

525
00:27:03,769 --> 00:27:06,389
- [Speaker] This custom tool
you'll build using strands,

526
00:27:06,389 --> 00:27:08,310
or you'll be consuming using strands.

527
00:27:08,310 --> 00:27:11,040
- [Rafia] We'll build the
logic and then we will feed it

528
00:27:11,040 --> 00:27:12,690
into Strand.

529
00:27:12,690 --> 00:27:15,240
- [Aneel] So, this custom
tool is just a Python script.

530
00:27:15,240 --> 00:27:17,910
So Strands will use this, yeah.

531
00:27:17,910 --> 00:27:21,240
- [Rafia] But there are
some hooks of Strand, right?

532
00:27:21,240 --> 00:27:23,890
Which we need to put
into this code so that

533
00:27:24,741 --> 00:27:26,220
we can feed it into Strand.

534
00:27:26,220 --> 00:27:27,810
And you'll see that the next step,

535
00:27:27,810 --> 00:27:29,613
that's what we will be doing, right?

536
00:27:30,690 --> 00:27:35,690
So, the first two thing
Aneel is doing right now

537
00:27:36,330 --> 00:27:38,910
is actually writing that code,

538
00:27:38,910 --> 00:27:41,823
and you'll see on line six to nine, right?

539
00:27:42,660 --> 00:27:47,100
How do you take any code, any
custom code you've written,

540
00:27:47,100 --> 00:27:51,210
and make sure that that code
can be converted into a tool

541
00:27:51,210 --> 00:27:53,250
for Strand, okay?

542
00:27:53,250 --> 00:27:57,270
So all you have to do to take that code

543
00:27:57,270 --> 00:28:01,239
and convert as a tool for
Strand is annotate that,

544
00:28:01,239 --> 00:28:05,932
create a function, put all
whatever your logic you need in

545
00:28:05,932 --> 00:28:10,060
that function, and then make
that function annotated by this

546
00:28:11,010 --> 00:28:12,270
tool annotation.

547
00:28:12,270 --> 00:28:17,010
So, all you need is a tool annotation.

548
00:28:17,010 --> 00:28:18,120
Once you have that,

549
00:28:18,120 --> 00:28:21,360
and once you feed that into the strand,

550
00:28:21,360 --> 00:28:25,110
strand understand that
whenever it needs to answer

551
00:28:25,110 --> 00:28:28,950
a user using the tool,
it'll run this function.

552
00:28:28,950 --> 00:28:32,520
Whatever is written in the
function, it's gonna run it.

553
00:28:32,520 --> 00:28:36,270
So I'm gonna just make sure
everyone is clear about

554
00:28:36,270 --> 00:28:40,140
how the strand plumbing
is happening, right?

555
00:28:40,140 --> 00:28:45,140
It's very simple as just
one annotation, okay?

556
00:28:46,050 --> 00:28:47,640
Now, what we have done,

557
00:28:47,640 --> 00:28:49,050
because we don't want

558
00:28:49,050 --> 00:28:52,403
to put all the logic into
this one function, right?

559
00:28:52,403 --> 00:28:56,250
we are gonna be creating
a supporting class

560
00:28:56,250 --> 00:28:59,833
where most our logic is going to be,

561
00:28:59,833 --> 00:29:02,430
and in this particular tool function,

562
00:29:02,430 --> 00:29:06,240
all we will be doing is calling
the different methods of

563
00:29:06,240 --> 00:29:07,683
that supporting class.

564
00:29:10,393 --> 00:29:12,810
So, let's first...
No-

565
00:29:12,810 --> 00:29:14,880
- [Aneel] Yeah, I brought
in some constants and then-

566
00:29:14,880 --> 00:29:15,713
- [Rafia] Okay, fine.

567
00:29:15,713 --> 00:29:18,933
So, let's go back to
line the two line, right?

568
00:29:20,040 --> 00:29:22,410
- [Aneel] Two, yeah, sorry, go ahead.

569
00:29:22,410 --> 00:29:26,100
- [Rafia] Okay, so again, the
first thing you probably need

570
00:29:26,100 --> 00:29:28,860
to do is create the-

571
00:29:28,860 --> 00:29:32,580
- [Aneel] Yeah, so, I added
an MT convenience class here,

572
00:29:32,580 --> 00:29:34,926
so I'm going to initialize that.

573
00:29:34,926 --> 00:29:38,310
- [Rafia] Yeah, so this
is the DB structure

574
00:29:38,310 --> 00:29:39,750
data agent class.

575
00:29:39,750 --> 00:29:42,330
It's nothing but a
supporting, which will have

576
00:29:42,330 --> 00:29:44,790
most of our data, most of our logic.

577
00:29:44,790 --> 00:29:48,450
Now, the structure of this class

578
00:29:48,450 --> 00:29:51,510
takes four pieces of argument.

579
00:29:51,510 --> 00:29:56,253
The first is the ARN of
where our Aurora database is.

580
00:29:58,380 --> 00:30:01,080
For those folks who might
not have worked with Aurora,

581
00:30:01,080 --> 00:30:02,850
when you create a database in Aurora,

582
00:30:02,850 --> 00:30:05,010
it gives you a unique ARN

583
00:30:05,010 --> 00:30:07,320
through which you can
identify the database.

584
00:30:07,320 --> 00:30:08,880
So that's all we are doing

585
00:30:08,880 --> 00:30:12,580
and as Aneel has already
mentioned, this is not

586
00:30:13,560 --> 00:30:15,120
a true production ready code.

587
00:30:15,120 --> 00:30:17,160
So we are kind of hard coding things here,

588
00:30:17,160 --> 00:30:20,754
but what Aneel did,
Aneel, can you scroll up?

589
00:30:20,754 --> 00:30:24,660
He defined few constants
and you'll see that

590
00:30:24,660 --> 00:30:26,640
in this four constants we've defined

591
00:30:26,640 --> 00:30:28,710
where our database is coming from.

592
00:30:28,710 --> 00:30:31,260
So we've defined the ARN of Aurora.

593
00:30:31,260 --> 00:30:35,820
Line eight is ARN for the secrets manager.

594
00:30:35,820 --> 00:30:38,640
So as a best practice, right?

595
00:30:38,640 --> 00:30:40,800
Whenever you are accessing a database,

596
00:30:40,800 --> 00:30:43,800
of course you need the
credentials for that database.

597
00:30:43,800 --> 00:30:46,080
As a best practice, you
should never hard code

598
00:30:46,080 --> 00:30:50,130
those credentials in the
code or even in config files,

599
00:30:50,130 --> 00:30:53,610
especially if you are publishing that code

600
00:30:53,610 --> 00:30:55,830
into some sort of a repository, right?

601
00:30:55,830 --> 00:30:59,070
So Secrets Manager is
one of the AWS services,

602
00:30:59,070 --> 00:31:03,690
which makes the storage
of credentials very easy

603
00:31:03,690 --> 00:31:04,710
and convenient.

604
00:31:04,710 --> 00:31:06,150
And that's what we've done.

605
00:31:06,150 --> 00:31:08,970
We've stored our database
credentials and Secret Manager,

606
00:31:08,970 --> 00:31:11,130
but here we are just bringing the ARN of

607
00:31:11,130 --> 00:31:13,213
that Secrets Manager.

608
00:31:13,213 --> 00:31:18,030
Then the other constance, which
Aneel declared was the name

609
00:31:18,030 --> 00:31:21,123
of our database, which is
called NPCO membership.

610
00:31:22,320 --> 00:31:27,320
Here, you'll notice that we
also have identified LLM,

611
00:31:27,480 --> 00:31:30,480
which is not a CLO model,

612
00:31:30,480 --> 00:31:32,550
which we had used earlier,

613
00:31:32,550 --> 00:31:35,100
but we are using a different NOVA model.

614
00:31:35,100 --> 00:31:37,254
Now, first of all, why we are doing this,

615
00:31:37,254 --> 00:31:40,353
I want to take a minute to explain that.

616
00:31:41,970 --> 00:31:46,530
Our agent itself, so agent
is communicating with LLM

617
00:31:46,530 --> 00:31:49,710
and the tool within the agent is also

618
00:31:49,710 --> 00:31:51,660
communicating with LLM.

619
00:31:51,660 --> 00:31:55,110
For the agent communication,
we are using Claude,

620
00:31:55,110 --> 00:31:57,960
for the tool, which will
be part of the agent

621
00:31:57,960 --> 00:31:59,610
we using Nova.

622
00:31:59,610 --> 00:32:02,670
The reason we did that is
because we wanted to make sure

623
00:32:02,670 --> 00:32:06,660
you guys understand that
you can use multiple models

624
00:32:06,660 --> 00:32:08,910
for different things, right?

625
00:32:08,910 --> 00:32:13,560
The model evaluation is a big component

626
00:32:13,560 --> 00:32:15,840
when you are creating AI applications.

627
00:32:15,840 --> 00:32:18,240
So just so that we can give that demo,

628
00:32:18,240 --> 00:32:21,720
we've purposely are using
a different model here.

629
00:32:21,720 --> 00:32:25,203
- [Aneel] By the way, is
this legible to everybody,

630
00:32:25,203 --> 00:32:27,570
like in the back or do you
want me to increase the font?

631
00:32:27,570 --> 00:32:29,436
Yes, thank you. I should have done that.

632
00:32:29,436 --> 00:32:32,205
- [Rafia] Thank you. I could also not it,

633
00:32:32,205 --> 00:32:34,187
- [Speaker 5] But is the
tool not just per rack,

634
00:32:34,187 --> 00:32:37,880
because you already have that clock aging,

635
00:32:37,880 --> 00:32:41,190
this tool is just patient now from Aurora

636
00:32:41,190 --> 00:32:43,950
and feeding back to that
agent cloud aging, right?

637
00:32:43,950 --> 00:32:47,400
- [Rafia] So a agent has a rack component

638
00:32:47,400 --> 00:32:49,920
and another component
which is going against

639
00:32:49,920 --> 00:32:51,270
structured data.

640
00:32:51,270 --> 00:32:53,460
Rack is going against unstructured data.

641
00:32:53,460 --> 00:32:54,570
- [Speaker 5] Oh, the previous tool?

642
00:32:54,570 --> 00:32:55,403
- [Rafia] Yeah, yeah.

643
00:32:55,403 --> 00:32:58,230
The retrieve tool was going
against unstructured data,

644
00:32:58,230 --> 00:33:02,130
this custom, so now you
have two branches of data.

645
00:33:02,130 --> 00:33:05,150
- [Aneel] And you'll see
why we need another model,

646
00:33:05,150 --> 00:33:06,960
or we could have used the same model,

647
00:33:06,960 --> 00:33:09,843
but why we need an LLM
model at all for this tool.

648
00:33:09,843 --> 00:33:11,447
You'll see.

649
00:33:11,447 --> 00:33:12,967
- [Speaker 5] The last
one, you'll keep both

650
00:33:12,967 --> 00:33:14,940
or you'll just switch one to up.

651
00:33:14,940 --> 00:33:15,773
- [Rafia] No.

652
00:33:15,773 --> 00:33:18,720
So we will make sure
the LLM is smart enough

653
00:33:18,720 --> 00:33:22,740
to decide should I be
going against the rack tool

654
00:33:22,740 --> 00:33:25,640
or should I be going against
the structured database tool?

655
00:33:27,870 --> 00:33:29,370
That would be the cloud model.

656
00:33:30,733 --> 00:33:33,450
Okay, so now everyone is clear, right?

657
00:33:33,450 --> 00:33:35,300
So far what we've done? Yeah, please.

658
00:33:36,300 --> 00:33:39,660
- [Speaker] We're using
just basically to figure out

659
00:33:39,660 --> 00:33:41,990
what your structure data
is and create a query.

660
00:33:41,990 --> 00:33:45,210
- [Rafia] Absolutely.
Exactly. You nailed it. Okay.

661
00:33:45,210 --> 00:33:46,290
There are two things, right?

662
00:33:46,290 --> 00:33:48,390
One is we need to make sure

663
00:33:48,390 --> 00:33:50,580
that LLM understand our database.

664
00:33:50,580 --> 00:33:54,030
We want to make sure that if
it's could answer any question,

665
00:33:54,030 --> 00:33:58,110
then and you'll see as
we move forward, right?

666
00:33:58,110 --> 00:34:01,500
But everyone is so far clear
on the way we've defined

667
00:34:01,500 --> 00:34:05,160
the plumbing for strength
tool and the creation of

668
00:34:05,160 --> 00:34:06,213
the helper class.

669
00:34:07,408 --> 00:34:12,408
Now, as we will start building
function in this helper class

670
00:34:13,830 --> 00:34:15,540
to do different things.

671
00:34:15,540 --> 00:34:18,393
The first function we will build, okay?

672
00:34:19,703 --> 00:34:24,703
It is so that our LLM can
understand the database schema.

673
00:34:25,740 --> 00:34:28,050
Without understanding the database schema.

674
00:34:28,050 --> 00:34:29,820
it cannot answer, right?

675
00:34:29,820 --> 00:34:33,900
So the first, what are
we calling this function?

676
00:34:33,900 --> 00:34:36,063
- [Aneel] I think I
pulled the wrong function.

677
00:34:36,063 --> 00:34:37,380
Sorry. Yeah, go ahead.

678
00:34:37,380 --> 00:34:38,550
Generate schema.

679
00:34:38,550 --> 00:34:39,383
- [Rafia] Okay. Yep.

680
00:34:39,383 --> 00:34:44,270
So now every relational
database okay, has a capability

681
00:34:45,437 --> 00:34:48,540
via some system tables

682
00:34:48,540 --> 00:34:51,870
or that you can actually
use that capability

683
00:34:51,870 --> 00:34:55,500
to query what, how your
database looks like,

684
00:34:55,500 --> 00:34:58,981
what are the tables, what are
the columns of those tables,

685
00:34:58,981 --> 00:35:01,500
what are the data types of the columns

686
00:35:01,500 --> 00:35:02,910
and so forth, right?

687
00:35:02,910 --> 00:35:06,180
So the first function,
which we are showing

688
00:35:06,180 --> 00:35:08,280
it's called get table schema,

689
00:35:08,280 --> 00:35:12,780
and you'll see that this is
nothing complicated, okay?

690
00:35:12,780 --> 00:35:15,540
All it is going to be doing
and can you show that query?

691
00:35:15,540 --> 00:35:16,740
Please go.

692
00:35:16,740 --> 00:35:19,653
- [Aneel] Yeah. So I need
to pull in the query too.

693
00:35:20,490 --> 00:35:21,870
- [Rafia] So this is a query,

694
00:35:21,870 --> 00:35:25,050
and again, we are defining
it as a variable here.

695
00:35:25,050 --> 00:35:28,800
In order for us to go to Postgres SQL

696
00:35:28,800 --> 00:35:32,670
and be able to pull
what's in the PostgreSQL,

697
00:35:32,670 --> 00:35:34,080
this is a query, okay?

698
00:35:34,080 --> 00:35:36,030
If you are using, let's say Oracle

699
00:35:36,030 --> 00:35:40,650
or if you're using Microsoft SQL Server,

700
00:35:40,650 --> 00:35:42,510
every database has a mechanism

701
00:35:42,510 --> 00:35:45,120
and that you probably just have to change

702
00:35:45,120 --> 00:35:49,020
this query syntax for whatever
database you would be using.

703
00:35:49,020 --> 00:35:51,180
But the rest would be same, right?

704
00:35:51,180 --> 00:35:54,008
So the first function we

705
00:35:54,008 --> 00:35:57,350
put together was get table schema.

706
00:35:57,350 --> 00:35:59,550
Did we already add that in the two?

707
00:35:59,550 --> 00:36:00,840
- [Aneel] No, let me add that.

708
00:36:00,840 --> 00:36:03,450
I'm going to add that thing.

709
00:36:03,450 --> 00:36:06,210
- [Rafia] Yeah, so we
created our helper class.

710
00:36:06,210 --> 00:36:08,640
Then the second thing we will do,

711
00:36:08,640 --> 00:36:13,140
we will actually query the
SQL or query our database.

712
00:36:13,140 --> 00:36:15,620
In our case is Aurora Postgres SQL.

713
00:36:15,620 --> 00:36:19,740
We are querying it and saying
give me the entire schema

714
00:36:19,740 --> 00:36:21,660
in adjacent format.

715
00:36:21,660 --> 00:36:26,007
And that is now being stored
in the DB_schema variable,

716
00:36:27,000 --> 00:36:29,160
which is on line 82.

717
00:36:29,160 --> 00:36:31,960
I'm gonna pause here, make
sure everyone is clear on it.

718
00:36:34,170 --> 00:36:36,020
No question. Oh, you have a question?

719
00:36:36,966 --> 00:36:40,173
- [Speaker] So is schema
low enough for some sample?

720
00:36:41,520 --> 00:36:44,430
- [Rafia] So right now
you'll see schema is enough,

721
00:36:44,430 --> 00:36:48,060
but yeah, sample data might,
I don't know, depending on

722
00:36:48,060 --> 00:36:51,810
what you're trying to do
it, you might think that

723
00:36:51,810 --> 00:36:54,180
maybe providing a sample data in a prompt

724
00:36:54,180 --> 00:36:56,340
might make it more effective.

725
00:36:56,340 --> 00:36:58,710
- [Aneel] Yeah, you'll see
how we wrote the prompt so

726
00:36:58,710 --> 00:37:01,773
that without the sample
it'll still get it.

727
00:37:02,760 --> 00:37:07,740
- [Rafia] Okay, so once we
know the database schema,

728
00:37:07,740 --> 00:37:09,363
I'm sorry, I have a question.

729
00:37:09,363 --> 00:37:10,718
- [Speaker] One question.

730
00:37:10,718 --> 00:37:12,809
Let's say you record the schema with this,

731
00:37:12,809 --> 00:37:15,429
but you wanna add some
more information to schema

732
00:37:15,429 --> 00:37:18,296
because part name is
probably not very intuitive

733
00:37:18,296 --> 00:37:20,550
for the is that something
- [Rafia] Yeah,

734
00:37:20,550 --> 00:37:22,380
so very good question, right?

735
00:37:22,380 --> 00:37:24,930
Maybe you can then inject some sort

736
00:37:24,930 --> 00:37:26,640
of a transformation logic

737
00:37:26,640 --> 00:37:30,270
before you send that schema to LLM, right?

738
00:37:30,270 --> 00:37:31,572
That's one way of doing it.

739
00:37:31,572 --> 00:37:33,603
Another way of doing it might be that

740
00:37:33,603 --> 00:37:35,730
that transformation logic you can embed

741
00:37:35,730 --> 00:37:40,362
in the system prompt, which
you'll be sending to the LLM.

742
00:37:40,362 --> 00:37:43,560
Whenever you send anything to LLM,

743
00:37:43,560 --> 00:37:47,970
you do provide some context,
some prompt, right? Yeah.

744
00:37:47,970 --> 00:37:50,820
- [Speaker] Just adding to
that question, if for example,

745
00:37:50,820 --> 00:37:53,250
my schema has foreign keys and stuff

746
00:37:53,250 --> 00:37:55,920
and sometimes the LM needs to do like two

747
00:37:55,920 --> 00:37:57,972
or three queries to help it,

748
00:37:57,972 --> 00:38:01,970
there you have only the table
schema with the columns.

749
00:38:01,970 --> 00:38:06,078
Is it possible to put in the schema,

750
00:38:06,078 --> 00:38:07,350
the relationship as well?

751
00:38:07,350 --> 00:38:08,340
- [Rafia] You absolutely.

752
00:38:08,340 --> 00:38:13,340
So right now we chose our
schema, which is very simple.

753
00:38:14,940 --> 00:38:19,410
But if there was relationship,
which we need to make sure,

754
00:38:19,410 --> 00:38:22,260
because let's say right
now when the queries

755
00:38:22,260 --> 00:38:24,750
which will be answered
from will be most likely

756
00:38:24,750 --> 00:38:26,130
from one table.

757
00:38:26,130 --> 00:38:30,370
If that is the case, then
we will make sure that

758
00:38:31,677 --> 00:38:36,450
the prompt which we are
providing has that relationship.

759
00:38:36,450 --> 00:38:39,985
So the SQL generation has the joins in it.

760
00:38:39,985 --> 00:38:41,520
- [Speaker] Yeah. Got it.

761
00:38:41,520 --> 00:38:43,140
- [Rafia] Right, at the end of the day,

762
00:38:43,140 --> 00:38:46,260
when you are creating a
database, you are only

763
00:38:46,260 --> 00:38:49,350
going against sending a SQL statement.

764
00:38:49,350 --> 00:38:52,590
Your SQL statement has to have
that relationship built into.

765
00:38:52,590 --> 00:38:53,763
Right. All right.

766
00:38:54,900 --> 00:38:58,890
So now once the second
thing we will show you is

767
00:38:58,890 --> 00:39:01,920
that system prompt generation, right?

768
00:39:01,920 --> 00:39:04,650
See, remember that system prompt gives

769
00:39:04,650 --> 00:39:06,483
that intelligence, okay?

770
00:39:07,590 --> 00:39:10,563
In your case, you could have
added like the system pro

771
00:39:10,563 --> 00:39:12,960
that hey, this
transformation should happen.

772
00:39:12,960 --> 00:39:16,053
You could have added that
relationship information.

773
00:39:17,400 --> 00:39:20,220
Let's see what we are producing
in the system problem.

774
00:39:20,220 --> 00:39:23,070
- [Aneel] Yeah. So it-

775
00:39:23,070 --> 00:39:24,870
- [Rafia] So I'll go a
little bit line by line.

776
00:39:24,870 --> 00:39:26,320
Can you move up a little bit?

777
00:39:27,780 --> 00:39:30,810
Alright, so this is the system
problem we are creating.

778
00:39:30,810 --> 00:39:32,610
We are saying, the first
thing we are saying,

779
00:39:32,610 --> 00:39:34,380
you are in AI assistance

780
00:39:34,380 --> 00:39:39,380
that create system prompt
for database query.

781
00:39:39,570 --> 00:39:43,860
At this point we are asking LLM

782
00:39:43,860 --> 00:39:45,870
to create a prompt,

783
00:39:45,870 --> 00:39:50,870
which itself has the database
schema embedded into it.

784
00:39:51,240 --> 00:39:54,990
So we are gonna take that
prompt, we are going to embed

785
00:39:54,990 --> 00:39:58,413
with the user question and
send the whole thing together.

786
00:40:00,240 --> 00:40:03,090
I'm gonna make sure everyone got it right.

787
00:40:03,090 --> 00:40:04,103
- [Speaker] One more time.
- [Rafia] Sure.

788
00:40:05,310 --> 00:40:08,100
Let's say you have a user question, right?

789
00:40:08,100 --> 00:40:12,570
User question now send needs
to be sent to Claude model

790
00:40:12,570 --> 00:40:13,950
to answer.

791
00:40:13,950 --> 00:40:17,220
In order for us to send that user question

792
00:40:17,220 --> 00:40:19,879
to the Cloud, we need to build a context

793
00:40:19,879 --> 00:40:22,443
which we will be building
through the prompt.

794
00:40:23,490 --> 00:40:25,410
Everyone clear so far, right?

795
00:40:25,410 --> 00:40:28,020
That context, which we will be building,

796
00:40:28,020 --> 00:40:32,970
needs to have that database
information into it, right?

797
00:40:32,970 --> 00:40:37,380
So instead of us hard coding that context,

798
00:40:37,380 --> 00:40:42,380
what we are telling Nova model, use that,

799
00:40:42,450 --> 00:40:46,440
use the schema, which
you got, give a prompt,

800
00:40:46,440 --> 00:40:50,340
which then I'm gonna subsequently
send to cloud model so

801
00:40:50,340 --> 00:40:54,573
that it can tie the database
schema with the user question.

802
00:40:57,420 --> 00:40:58,470
- [Aneel] Let me see.

803
00:41:01,080 --> 00:41:02,532
We will be here after,

804
00:41:02,532 --> 00:41:04,737
so if you wanna just
go over the code again.

805
00:41:04,737 --> 00:41:07,500
- But so here we are
saying to in the prompt,

806
00:41:07,500 --> 00:41:10,507
Hey, look, you, your job
is to create a smart prom

807
00:41:10,507 --> 00:41:13,440
with this database
knowledge embedded in it.

808
00:41:13,440 --> 00:41:18,440
We are giving it the
schema_Jason on line 96,

809
00:41:19,260 --> 00:41:23,190
which holds our schema
information in a variable.

810
00:41:23,190 --> 00:41:25,080
And we've built this whole thing

811
00:41:25,080 --> 00:41:27,990
and now we are gonna be
sending it to the LLM

812
00:41:27,990 --> 00:41:31,417
and at this point, all
the LLM did was gave us

813
00:41:31,417 --> 00:41:36,417
a smart prompt, which we
will then be able to send it

814
00:41:37,350 --> 00:41:38,373
to cloud model.

815
00:41:39,342 --> 00:41:41,520
- [Speaker] And where the user
prompt is coming into this.

816
00:41:41,520 --> 00:41:42,353
- [Aneel] Yeah, yeah. We'll see that.

817
00:41:42,353 --> 00:41:44,160
- [Rafia] We will see that.

818
00:41:44,160 --> 00:41:46,740
Okay, so now we got our,

819
00:41:46,740 --> 00:41:50,070
the first line was our getting our schema.

820
00:41:50,070 --> 00:41:53,940
The second line was make creation of

821
00:41:53,940 --> 00:41:55,113
that system prompt.

822
00:42:02,790 --> 00:42:07,090
And in this system prompt,
we provided the db_schema

823
00:42:08,730 --> 00:42:09,693
to this function.

824
00:42:11,520 --> 00:42:14,670
So at this point, the line 137,

825
00:42:14,670 --> 00:42:19,670
now we have a prompt which has
our schema embedded into it.

826
00:42:23,029 --> 00:42:23,862
Yeah.

827
00:42:23,862 --> 00:42:25,920
- [Speaker] Any specific
reason why we are passing

828
00:42:25,920 --> 00:42:27,240
this information to other agent,

829
00:42:27,240 --> 00:42:30,540
like this agent should
intelligent enough to answer

830
00:42:30,540 --> 00:42:33,210
and it has the context of the question

831
00:42:33,210 --> 00:42:37,470
and as well as the-

832
00:42:37,470 --> 00:42:41,553
- [Rafia] We are building just
a tool for the agent, right?

833
00:42:44,446 --> 00:42:47,040
What the agent will do, the agent takes

834
00:42:47,040 --> 00:42:50,220
the user input sends it to this tool.

835
00:42:50,220 --> 00:42:53,790
Now this tool, along with
the schema it has, is going

836
00:42:53,790 --> 00:42:58,790
to come up with a SQL query
if it can be answered, right?

837
00:43:02,464 --> 00:43:06,420
Alright, so the third is now
we got our database schema,

838
00:43:06,420 --> 00:43:07,980
we got a prompt.

839
00:43:07,980 --> 00:43:12,360
Now the thing is we need to
tie these two thing together.

840
00:43:12,360 --> 00:43:15,900
We have to now ask a LLM

841
00:43:15,900 --> 00:43:20,329
to generate a SQL query if

842
00:43:20,329 --> 00:43:23,580
that SQL query can be,

843
00:43:23,580 --> 00:43:28,200
if the user question can be
answered through a SQL query.

844
00:43:28,200 --> 00:43:30,660
So let me rephrase this, right?

845
00:43:30,660 --> 00:43:32,190
Let's say my prompt was,

846
00:43:32,190 --> 00:43:33,960
and by the way, our database is related

847
00:43:33,960 --> 00:43:35,910
to a membership model, right?

848
00:43:35,910 --> 00:43:40,210
It has a table like membership, events

849
00:43:41,160 --> 00:43:43,950
campaigns, donors, those
kind of things, right?

850
00:43:43,950 --> 00:43:46,590
But what if I ask a question,

851
00:43:46,590 --> 00:43:48,870
what is the capital of France?

852
00:43:48,870 --> 00:43:52,140
Now that question cannot be answered

853
00:43:52,140 --> 00:43:56,580
from a SQL query from my database.

854
00:43:56,580 --> 00:44:00,000
So when I send my schema

855
00:44:00,000 --> 00:44:03,540
and my user, the LLM will say, well

856
00:44:03,540 --> 00:44:07,470
these two things don't
match, so it cannot come up

857
00:44:07,470 --> 00:44:09,540
with a valid SQL query.

858
00:44:09,540 --> 00:44:12,075
So the third function is,

859
00:44:12,075 --> 00:44:16,745
it's actually is now
taking the user input,

860
00:44:16,745 --> 00:44:20,580
knowing the database schema
is gonna go to the Nova model

861
00:44:20,580 --> 00:44:25,470
and say, can you provide
a valid SQL statement,

862
00:44:25,470 --> 00:44:29,280
which can answer this
particular user question.

863
00:44:29,280 --> 00:44:31,438
- [Speaker] In your previous
statement, you said that

864
00:44:31,438 --> 00:44:36,060
you go back to the cloud model
and then it comes back again.

865
00:44:36,060 --> 00:44:40,410
Now what I understand that
once you see the system from,

866
00:44:40,410 --> 00:44:42,677
there's no need to go back
back to the cloud model,

867
00:44:42,677 --> 00:44:44,687
you can directly go back to the nova,

868
00:44:44,687 --> 00:44:46,157
you get an P to execute,

869
00:44:46,157 --> 00:44:48,782
- [Rafia] But the cloud model is.

870
00:44:48,782 --> 00:44:50,710
- [Speaker] That's the first step.

871
00:44:50,710 --> 00:44:53,640
- [Rafia] The cloud model
will go not only fit the

872
00:44:53,640 --> 00:44:56,010
database, it also could
go against the rag.

873
00:44:56,010 --> 00:44:56,843
- [Speaker] Exactly.

874
00:44:56,843 --> 00:44:58,350
After the schema
generation, there's no need

875
00:44:58,350 --> 00:45:00,030
to go back to the cloud model, right?

876
00:45:00,030 --> 00:45:00,863
- [Aneel] Yeah.

877
00:45:00,863 --> 00:45:01,696
The Nova model is doing.

878
00:45:01,696 --> 00:45:03,000
- [Rafia] Exactly, exactly.

879
00:45:04,561 --> 00:45:05,394
Yeah. Yeah.

880
00:45:05,394 --> 00:45:08,193
- [Speaker] You marry this
schema with the cloud good

881
00:45:08,193 --> 00:45:10,890
to the cloud, no, you go to
the know get the SP execute.

882
00:45:10,890 --> 00:45:11,900
- [Rafia] Yeah.

883
00:45:11,900 --> 00:45:14,520
So the cloud model will only be utilized

884
00:45:14,520 --> 00:45:16,440
to say if I need to go to the database.

885
00:45:16,440 --> 00:45:18,570
- [Speaker] Yeah, but once
it gets the context of

886
00:45:18,570 --> 00:45:23,502
the schema, then the second
call, then I be fit for.

887
00:45:23,502 --> 00:45:25,716
- [Rafia] Yeah, because here you'll see

888
00:45:25,716 --> 00:45:28,653
if I can generate a valid
SQL for the user prompt,

889
00:45:28,653 --> 00:45:32,250
it's going to not only
give me a SQL, it's going

890
00:45:32,250 --> 00:45:35,130
to actually give me the
data of that, you know?

891
00:45:35,130 --> 00:45:37,050
- [Aneel] Simplest way to
think of it is this tool could

892
00:45:37,050 --> 00:45:38,070
have been static, right?

893
00:45:38,070 --> 00:45:40,680
Like you just, if this is the
query, this is the SQL query.

894
00:45:40,680 --> 00:45:42,390
If this is the user query,
this is the SQL query,

895
00:45:42,390 --> 00:45:44,520
we are putting intelligence into this tool

896
00:45:44,520 --> 00:45:47,220
that we are building using
the LLM model to generate

897
00:45:47,220 --> 00:45:49,170
that query dynamically for us.

898
00:45:49,170 --> 00:45:50,940
Quick time check. We have 14 minutes,

899
00:45:50,940 --> 00:45:53,010
so we'll move a little bit faster.

900
00:45:53,010 --> 00:45:56,040
- [Rafia] Okay. So now
we got our system prompt.

901
00:45:56,040 --> 00:46:00,250
The third thing we what Aneel
is typing in is actually

902
00:46:02,010 --> 00:46:04,770
getting those two plumping
things together, right?

903
00:46:04,770 --> 00:46:08,880
The database schema and the user prompt.

904
00:46:08,880 --> 00:46:13,740
So the third thing we will
have is a helper function

905
00:46:13,740 --> 00:46:15,960
called generate SQL.

906
00:46:15,960 --> 00:46:19,020
Let's type this in and let's
go to the definition of

907
00:46:19,020 --> 00:46:21,076
generate SQL please.

908
00:46:21,076 --> 00:46:22,326
- [Aneel] Yeah.

909
00:46:24,720 --> 00:46:26,730
- [Rafia] So again, in
our supporting class,

910
00:46:26,730 --> 00:46:28,230
we have a generate SQL.

911
00:46:28,230 --> 00:46:30,000
Let's go a little bit and make sure

912
00:46:30,000 --> 00:46:31,349
we understand this right.

913
00:46:31,349 --> 00:46:34,357
- [Aneel] Oh, where did
I put it? Where is it?

914
00:46:36,895 --> 00:46:38,553
Alright, yeah.

915
00:46:48,006 --> 00:46:52,860
- [Rafia] So if you look at
this, yeah generate SQL, okay.

916
00:46:52,860 --> 00:46:55,770
What it did was it took the user prompt,

917
00:46:55,770 --> 00:46:57,540
which is in the question variable,

918
00:46:57,540 --> 00:47:01,290
and at this point it
has the a system prompt,

919
00:47:01,290 --> 00:47:03,900
which has the database schema into it.

920
00:47:03,900 --> 00:47:07,440
It defines the model,
which is our Nova model.

921
00:47:07,440 --> 00:47:12,390
And then it asks LLM, Hey look, LLM,

922
00:47:12,390 --> 00:47:14,610
this is my schema, this is my user.

923
00:47:14,610 --> 00:47:18,990
If you think can a valid SQL
can be generated out of it,

924
00:47:18,990 --> 00:47:20,970
give me that Gen SQL.

925
00:47:20,970 --> 00:47:23,778
So once this function is executed,

926
00:47:23,778 --> 00:47:25,890
you will have the valid SQL.

927
00:47:25,890 --> 00:47:28,410
But now what we are also
doing it, we, we want

928
00:47:28,410 --> 00:47:32,280
to make sure the valid SQL is
in some sort of a delimiters

929
00:47:32,280 --> 00:47:36,000
so we can extract them very
well conveniently, right?

930
00:47:36,000 --> 00:47:37,350
So you need to-

931
00:47:37,350 --> 00:47:39,483
- [Aneel] And the ERs, yeah.

932
00:47:42,654 --> 00:47:47,250
- [Rafia] Okay, so in our
going to no models, right?

933
00:47:47,250 --> 00:47:50,370
When we are saying can
you create a valid SQL?

934
00:47:50,370 --> 00:47:53,430
We are also going to say if
you can create a valid SQL,

935
00:47:53,430 --> 00:47:56,790
make sure the valid SQL is
in this SQL start delimiter

936
00:47:56,790 --> 00:47:59,820
and SQL delimeter, okay?

937
00:47:59,820 --> 00:48:02,957
Once our valid SQL is in there, so when

938
00:48:02,957 --> 00:48:05,490
the next function, which is going to pull

939
00:48:05,490 --> 00:48:09,420
that SQL out knows exactly from the output

940
00:48:09,420 --> 00:48:11,880
which I got from the model where I have

941
00:48:11,880 --> 00:48:14,133
to pull the SQL out from.

942
00:48:15,570 --> 00:48:18,093
Everybody okay till for this. Okay.

943
00:48:19,230 --> 00:48:23,060
Alright, so you know the line 226, right?

944
00:48:25,020 --> 00:48:29,850
Is where by this time if
everything is working fine I would

945
00:48:29,850 --> 00:48:31,590
have a valid SQL.

946
00:48:31,590 --> 00:48:36,034
Then line 227 is another function which is

947
00:48:36,034 --> 00:48:38,100
extracting that SQL.

948
00:48:38,100 --> 00:48:43,100
All it is going to do is going
to take the output from LLM,

949
00:48:43,260 --> 00:48:47,370
make sure between those two
start and end dilimeters,

950
00:48:47,370 --> 00:48:49,779
I can pull the valid SQL out.

951
00:48:49,779 --> 00:48:53,610
And nothing complicated here.

952
00:48:53,610 --> 00:48:55,203
Yes please.

953
00:48:55,203 --> 00:48:57,068
- [Speaker] I see your-

954
00:48:57,068 --> 00:48:59,915
- [Rafia] I'm sorry, I can you,

955
00:48:59,915 --> 00:49:03,640
- [Speaker] You're information on schema.

956
00:49:03,640 --> 00:49:05,520
I see that. Don't you
need a data dictionary?

957
00:49:05,520 --> 00:49:07,770
What if the column names are,

958
00:49:07,770 --> 00:49:11,480
let's say city is spelled
CTY, something like that.

959
00:49:11,480 --> 00:49:13,570
How do you know what's in that column?

960
00:49:13,570 --> 00:49:16,320
- [Rafia] Yeah, so it's
a very good question

961
00:49:16,320 --> 00:49:18,930
and I'll, you know what I'll give you,

962
00:49:18,930 --> 00:49:20,743
maybe we can run an example of that.

963
00:49:20,743 --> 00:49:25,743
Our model in our database,
a table is called campaign.

964
00:49:27,540 --> 00:49:30,450
What we will do, instead
of using the word campaign,

965
00:49:30,450 --> 00:49:34,500
we will use the word event
for instance in a prompt.

966
00:49:34,500 --> 00:49:37,050
And that's a beauty of some of this

967
00:49:37,050 --> 00:49:38,353
doing it through LLM.

968
00:49:38,353 --> 00:49:40,830
The LLM is smart enough to understand

969
00:49:40,830 --> 00:49:44,670
that there's a semantic meaning
between event and campaign.

970
00:49:44,670 --> 00:49:47,970
So even though the database
itself has a word campaign

971
00:49:47,970 --> 00:49:51,690
in the table it associated
with the word event

972
00:49:51,690 --> 00:49:54,660
and be able to get the
generic SQL correctly.

973
00:49:54,660 --> 00:49:55,860
- [Speaker] That is a no

974
00:49:56,940 --> 00:49:58,500
- [Rafia] Yeah, that's
a no, but that's a no,

975
00:49:58,500 --> 00:50:01,250
but that is part that could
be part of any LLMs, right?

976
00:50:02,280 --> 00:50:05,130
- [Speaker] Okay. So this
question is completely different.

977
00:50:05,130 --> 00:50:08,700
For example, I give you a
schema that has column A

978
00:50:08,700 --> 00:50:10,800
less column one, column two, column three.

979
00:50:12,525 --> 00:50:14,910
And so by seeing this
column one, column two,

980
00:50:14,910 --> 00:50:16,750
column three, nobody knows what it's

981
00:50:18,030 --> 00:50:19,680
there is also information
about this column.

982
00:50:19,680 --> 00:50:21,990
So, if I pass the information schema,

983
00:50:21,990 --> 00:50:23,520
other column two, color three is Chinese.

984
00:50:23,520 --> 00:50:24,870
- [Rafia] Yeah, yeah, yeah.

985
00:50:25,710 --> 00:50:27,492
- [Speaker] Right, right.
We can't understand.

986
00:50:27,492 --> 00:50:30,520
- [Aneel] So if the column
names are so cryptic like

987
00:50:31,949 --> 00:50:33,755
that exactly, you can pass
the data dictionary also

988
00:50:33,755 --> 00:50:37,383
into your prompt and then
it'll know like how to-

989
00:50:39,720 --> 00:50:40,553
- [Rafia] Not another tool.

990
00:50:40,553 --> 00:50:42,830
You don't want to have so
many tools you might want

991
00:50:42,830 --> 00:50:46,502
to make this tool smart
enough that along with

992
00:50:46,502 --> 00:50:50,640
maybe along with your database information

993
00:50:50,640 --> 00:50:54,150
where you are pulling
the SQL you can have it.

994
00:50:54,150 --> 00:50:56,610
Oh, by the way, we did
not talk about memory.

995
00:50:56,610 --> 00:51:00,990
- [Aneel] Yeah, so in
reality, if you're doing this

996
00:51:00,990 --> 00:51:03,830
in production for example,
you don't want to keep going

997
00:51:03,830 --> 00:51:07,410
to the database and
generating this system prompt

998
00:51:07,410 --> 00:51:09,930
over and over again because
the schema is fixed, right?

999
00:51:09,930 --> 00:51:13,320
Maybe it changes once a month
or only when you want to do

1000
00:51:13,320 --> 00:51:15,120
that update when the schema changes.

1001
00:51:15,120 --> 00:51:17,850
So you can use memory
tools like for example,

1002
00:51:17,850 --> 00:51:21,000
if you're deploying this
using a Amazon agent core

1003
00:51:21,000 --> 00:51:23,995
where you run your AI agents, there is a

1004
00:51:23,995 --> 00:51:27,150
feature functionality that comes

1005
00:51:27,150 --> 00:51:28,410
with agent code that's called memory.

1006
00:51:28,410 --> 00:51:32,580
So it can keep track
of this kind of caching

1007
00:51:32,580 --> 00:51:34,257
that you want to do with the-

1008
00:51:34,257 --> 00:51:37,170
- [Rafia] See and your data
dictionaries could also be

1009
00:51:37,170 --> 00:51:39,900
part of that memory, you know?

1010
00:51:39,900 --> 00:51:42,780
Exactly, you don't keep on change

1011
00:51:42,780 --> 00:51:44,850
you don't change your schemas in your data

1012
00:51:44,850 --> 00:51:46,410
dictionary so often, right?

1013
00:51:46,410 --> 00:51:50,706
So make it again, for this particular,

1014
00:51:50,706 --> 00:51:53,190
we've already said it
is not a hundred percent

1015
00:51:53,190 --> 00:51:55,320
production ready because
we wanted to make it so

1016
00:51:55,320 --> 00:51:56,790
that it's easy for everyone

1017
00:51:56,790 --> 00:51:59,490
to understand what's happening.

1018
00:51:59,490 --> 00:52:03,060
- [Aneel] So I added also
a function to execute

1019
00:52:03,060 --> 00:52:04,980
that same SQL that we just got,

1020
00:52:04,980 --> 00:52:08,220
and I'm going to run this again.

1021
00:52:08,220 --> 00:52:10,443
- So after we extracted our SQL,

1022
00:52:11,408 --> 00:52:14,040
we wrote another function
called execute SQL.

1023
00:52:14,040 --> 00:52:15,780
Again, no brainer there, right?

1024
00:52:15,780 --> 00:52:19,410
It's just gonna take out
SQL it knows how to query

1025
00:52:19,410 --> 00:52:23,520
a Postgres SQL is gonna feed
that SQL into Postgres SQL.

1026
00:52:23,520 --> 00:52:26,700
If you are going against
any other database, Oracle

1027
00:52:26,700 --> 00:52:29,760
or any other, you probably
will use whatever mechanism

1028
00:52:29,760 --> 00:52:31,890
of querying that database you are using.

1029
00:52:31,890 --> 00:52:35,760
As long as you have a valid
SQL, that's all you need

1030
00:52:35,760 --> 00:52:37,563
to talk to a relational database,

1031
00:52:38,700 --> 00:52:40,740
- [Aneel] So I'm asking the same question.

1032
00:52:40,740 --> 00:52:44,100
Theoretically now it should
be going to the database

1033
00:52:44,100 --> 00:52:49,020
to get the exact number
of members that we have.

1034
00:52:49,020 --> 00:52:52,110
Let's see if we can do that

1035
00:52:52,110 --> 00:52:55,320
or if I missed some step
somewhere it happens.

1036
00:52:55,320 --> 00:52:56,493
Well looks like-

1037
00:52:58,260 --> 00:53:01,500
- [Rafia] So you see now the
5,000 member is not coming

1038
00:53:01,500 --> 00:53:02,588
from rag.

1039
00:53:02,588 --> 00:53:05,220
An maybe we should tell
them where it's coming from.

1040
00:53:05,220 --> 00:53:07,230
- [Aneel] Yeah. So this is
coming from the database.

1041
00:53:07,230 --> 00:53:09,990
I mean if you see there's a toggle here

1042
00:53:09,990 --> 00:53:12,750
that will actually show
you how the query is going.

1043
00:53:12,750 --> 00:53:17,750
- [Rafia] So maybe let's
run it to show the audience,

1044
00:53:18,360 --> 00:53:21,557
because you'll be able
to see whether it send it

1045
00:53:21,557 --> 00:53:25,560
to the SQL tool order or the rack tool.

1046
00:53:25,560 --> 00:53:28,691
So now when the question was asked, what

1047
00:53:28,691 --> 00:53:31,290
- I asked answer question,
what membership levels exist?

1048
00:53:31,290 --> 00:53:33,540
So again, this is in the database,

1049
00:53:33,540 --> 00:53:36,363
we have three membership levels.

1050
00:53:40,590 --> 00:53:44,310
So you can see that when
you expand this tool usage,

1051
00:53:44,310 --> 00:53:48,600
it'll show you what it does,
it went to the database,

1052
00:53:48,600 --> 00:53:50,190
it got these results.

1053
00:53:50,190 --> 00:53:55,063
But if I'm asking question
like did we run an event

1054
00:53:58,020 --> 00:54:00,010
to support elderly?

1055
00:54:03,406 --> 00:54:05,490
This probably will go against
the knowledge base instead

1056
00:54:05,490 --> 00:54:07,620
of going against the database.

1057
00:54:07,620 --> 00:54:10,130
- [Rafia] Because this
information is not in a database.

1058
00:54:10,130 --> 00:54:12,390
- [Speaker] This decision
Claude is making,

1059
00:54:12,390 --> 00:54:14,790
- [Rafia] Claude is making, exactly.

1060
00:54:14,790 --> 00:54:18,120
Once Claude make the decision
which tool it's going to use,

1061
00:54:18,120 --> 00:54:22,200
if database tool database needs to be used

1062
00:54:22,200 --> 00:54:25,023
for the answer, then Nova
will come into picture.

1063
00:54:26,490 --> 00:54:29,061
- [Aneel] One thing I
do want to highlight is

1064
00:54:29,061 --> 00:54:32,010
in our app.py,

1065
00:54:32,010 --> 00:54:36,060
our system prompt is, sorry,

1066
00:54:36,060 --> 00:54:39,210
in our agent.py, our system
prompt is still basic,

1067
00:54:39,210 --> 00:54:42,120
but our tool, our
application is simple enough

1068
00:54:42,120 --> 00:54:45,210
that the LLM is able to
figure out that it needs to go

1069
00:54:45,210 --> 00:54:46,680
to the database or structure data.

1070
00:54:46,680 --> 00:54:50,910
But it is always a best practice
to give good system prompt

1071
00:54:50,910 --> 00:54:54,450
to make sure your LLM behaves in more

1072
00:54:54,450 --> 00:54:55,980
or less the way that you want

1073
00:54:55,980 --> 00:54:58,440
to behave rather than
just leaving it up to it.

1074
00:54:58,440 --> 00:55:00,870
So we could have replaced
this system prompt

1075
00:55:00,870 --> 00:55:02,770
with something more robust like

1076
00:55:20,170 --> 00:55:22,670
So right now you'll see
when Aneel is going to put

1077
00:55:24,720 --> 00:55:27,491
a very prompt smart system prong

1078
00:55:27,491 --> 00:55:32,160
because our code example was so simple

1079
00:55:32,160 --> 00:55:34,260
that Claude was able to find this out.

1080
00:55:34,260 --> 00:55:38,310
But imagine if you had
multiple knowledge bases,

1081
00:55:38,310 --> 00:55:42,810
multiple databases, you were
even doing transformation,

1082
00:55:42,810 --> 00:55:45,120
you were defining data dictionary.

1083
00:55:45,120 --> 00:55:48,810
When you are making that
complicated type of agent

1084
00:55:50,700 --> 00:55:53,580
where it's excelling multiple structured,

1085
00:55:53,580 --> 00:55:55,470
non-structured data sources.

1086
00:55:55,470 --> 00:55:59,433
Your system prompt becomes
very, very important.

1087
00:56:01,212 --> 00:56:05,670
The more information you
provide in that system prom,

1088
00:56:05,670 --> 00:56:08,970
the more intelligent
Claude would be to give,

1089
00:56:08,970 --> 00:56:11,460
to decide which tool is going to use.

1090
00:56:11,460 --> 00:56:14,940
- [Aneel] You're kind of
defining your agent's personality

1091
00:56:14,940 --> 00:56:16,320
with this system prompt.

1092
00:56:16,320 --> 00:56:18,420
So I mean it is very important to have

1093
00:56:18,420 --> 00:56:20,040
that good system prompt.

1094
00:56:20,040 --> 00:56:21,750
Alright, so I want to wrap this up.

1095
00:56:21,750 --> 00:56:23,430
We have only two minutes.

1096
00:56:23,430 --> 00:56:27,420
As you can see, we just
build a demo application.

1097
00:56:27,420 --> 00:56:29,220
It's not production
ready, but if you want,

1098
00:56:29,220 --> 00:56:30,780
if you have built this
application, if you want

1099
00:56:30,780 --> 00:56:33,930
to deploy this in AWS you
have multiple choices.

1100
00:56:33,930 --> 00:56:37,800
You have choices like you
can run this in AWS Lambda

1101
00:56:37,800 --> 00:56:42,150
container services like ECS
or EKS or use our latest

1102
00:56:42,150 --> 00:56:45,090
and greatest runtime for running

1103
00:56:45,090 --> 00:56:47,520
these agent tech applications agent code.

1104
00:56:47,520 --> 00:56:49,700
It's because it's just Python, right?

1105
00:56:49,700 --> 00:56:53,640
So it can't run it in any compute.

1106
00:56:53,640 --> 00:56:56,820
We are not deploying this into anywhere.

1107
00:56:56,820 --> 00:56:59,130
We just running it off of any EC2 machine

1108
00:56:59,130 --> 00:57:00,300
that's sitting in AWS

1109
00:57:00,300 --> 00:57:03,190
but theoretically you can
pick any of these choices

1110
00:57:03,190 --> 00:57:04,830
to go there.

1111
00:57:04,830 --> 00:57:08,490
And finally, if you want to
learn more about Agentic Ai,

1112
00:57:08,490 --> 00:57:10,117
there are some resources here

1113
00:57:10,117 --> 00:57:15,117
and please don't forget
to submit survey for-

1114
00:57:16,701 --> 00:57:18,524
- [Speaker] No look.

1115
00:57:18,524 --> 00:57:19,357
- [Aneel] Yeah, exactly.
- [Speaker] Yeah.

1116
00:57:19,357 --> 00:57:21,030
- [Rafia] And we will be
here after the session,

1117
00:57:21,030 --> 00:57:24,810
so please feel free to stay.

1118
00:57:24,810 --> 00:57:26,280
I don't know if you can stay in this room,

1119
00:57:26,280 --> 00:57:27,750
but We'll we can definitely go outside

1120
00:57:27,750 --> 00:57:31,530
and then we'll be happy
to answer any question.

1121
00:57:31,530 --> 00:57:35,880
I know, sir, you wanted to give
us like a one more rundown.

1122
00:57:35,880 --> 00:57:38,778
- [Speaker] I even have a
smaller question, you know?

1123
00:57:38,778 --> 00:57:41,423
- [Aneel] Okay.
- [Rafia] Yeah.

1124
00:57:41,423 --> 00:57:43,253
- [Aneel] So yeah, we'll stay
here. We can chat we'll, yeah.

1125
00:57:43,253 --> 00:57:44,086
- [Rafia] Absolutely.

1126
00:57:44,086 --> 00:57:47,072
And we can also talk about, I'm sorry,

1127
00:57:47,072 --> 00:57:49,500
we can talk about your question. Okay.

1128
00:57:49,500 --> 00:57:51,893
- [Aneel] Alright. So yeah, sorry. Yeah.

1129
00:57:53,940 --> 00:57:55,402
- [Rafia] I'm sorry I didn't get.

1130
00:57:55,402 --> 00:57:58,225
- [Speaker] Knowledge base.

1131
00:57:58,225 --> 00:58:00,844
- [Rafia] So you want
to know how to create

1132
00:58:00,844 --> 00:58:01,920
a knowledge base?

1133
00:58:01,920 --> 00:58:04,030
Of course. Yeah, we can share that.

1134
00:58:04,030 --> 00:58:07,254
- [Aneel] Yeah, we can do that too. Yeah.

1135
00:58:07,254 --> 00:58:10,440
- [Speaker] Share the code.
- [Aneel] Share the code.

1136
00:58:10,440 --> 00:58:14,010
All right, we will get it up
on GitHub and maybe share it.

1137
00:58:14,010 --> 00:58:16,720
If you can connect with
one of us on LinkedIn,

1138
00:58:16,720 --> 00:58:17,553
we'll make that.

1139
00:58:17,553 --> 00:58:20,242
- [Rafia] Yeah, actually
we were going to do share

1140
00:58:20,242 --> 00:58:21,839
the code even before the session

1141
00:58:21,839 --> 00:58:25,653
but didn't go to our review yet.

1142
00:58:26,730 --> 00:58:29,400
- [Aneel] If you go to the
app, you pick the session

1143
00:58:29,400 --> 00:58:30,400
and you submit this.

1144
00:58:31,680 --> 00:58:33,300
- [Rafia] So thank you all
for coming and we will be-

1145
00:58:33,300 --> 00:58:34,943
- [Aneel] Yeah, thank you very much.

