1
00:00:01,020 --> 00:00:03,030
- [Tzoori Tamam] Hi, welcome.

2
00:00:03,030 --> 00:00:05,043
Welcome to Reinvent 2025.

3
00:00:06,063 --> 00:00:08,250
I, I hope you've enjoyed your first day,

4
00:00:08,250 --> 00:00:10,470
and hopefully you'll enjoy
the rest of the week.

5
00:00:10,470 --> 00:00:11,843
My name is Tzoori Tamam,

6
00:00:11,843 --> 00:00:13,020
I'm a solutions architect specialist

7
00:00:13,020 --> 00:00:14,700
for ED Services at AWS.

8
00:00:14,700 --> 00:00:16,650
It's a mouthful, I know.

9
00:00:16,650 --> 00:00:18,450
And with me is Dan Avidan from HSBC.

10
00:00:18,450 --> 00:00:20,580
He'll introduced us himself a bit later

11
00:00:20,580 --> 00:00:22,413
into the, into the presentation.

12
00:00:24,570 --> 00:00:29,370
Today, we're gonna cover
at a level 300 talk,

13
00:00:29,370 --> 00:00:32,490
a typical, or maybe not so typical day,

14
00:00:32,490 --> 00:00:35,130
in a WAF administrator life.

15
00:00:35,130 --> 00:00:37,320
It will be a bit hectic.

16
00:00:37,320 --> 00:00:39,570
It will be a bit technical.

17
00:00:39,570 --> 00:00:41,400
The fact that it's a level 300 talk

18
00:00:41,400 --> 00:00:43,740
means that we assume that you know

19
00:00:43,740 --> 00:00:46,410
some things about AWS WAF already.

20
00:00:46,410 --> 00:00:50,040
So we won't dive into the, what are rules

21
00:00:50,040 --> 00:00:51,810
or what are actions?

22
00:00:51,810 --> 00:00:53,640
We, we'll dive a bit into labels

23
00:00:53,640 --> 00:00:55,890
and maybe a bit more of the new stuff,

24
00:00:55,890 --> 00:00:57,630
but we assume some level,

25
00:00:57,630 --> 00:01:00,363
some technical level from the get-go.

26
00:01:01,320 --> 00:01:02,230
Apologies for the pace.

27
00:01:02,230 --> 00:01:05,040
I, I, I talk fast naturally,

28
00:01:05,040 --> 00:01:06,930
and we have a lot to pack into 60 minutes,

29
00:01:06,930 --> 00:01:08,490
so I'll be even faster.

30
00:01:08,490 --> 00:01:09,750
You can watch it later on YouTube

31
00:01:09,750 --> 00:01:11,790
at like, 75, point 75 and

32
00:01:11,790 --> 00:01:12,690
it will make more sense,

33
00:01:12,690 --> 00:01:14,793
but for now, it's gonna be rushed.

34
00:01:16,140 --> 00:01:21,140
We'll have this talk
built in a way of a story.

35
00:01:21,170 --> 00:01:23,280
I'll, I'll, I'll make belief as if

36
00:01:23,280 --> 00:01:25,470
I'm a WAF administrator and I'll take,

37
00:01:25,470 --> 00:01:27,630
take you through one of my days.

38
00:01:27,630 --> 00:01:31,050
But later we'll have an
actual story by Dan at HSBC,

39
00:01:31,050 --> 00:01:33,180
who will discuss the way they journey

40
00:01:33,180 --> 00:01:35,970
through adopting AWS WAF.

41
00:01:35,970 --> 00:01:38,910
So with that, we'll start at waking up.

42
00:01:38,910 --> 00:01:42,243
It's morning, a new day,
a new web application.

43
00:01:43,320 --> 00:01:45,450
So I just got a, a, a notification

44
00:01:45,450 --> 00:01:47,460
in the morning, on the way to work,

45
00:01:47,460 --> 00:01:49,613
that there's a new application out there.

46
00:01:49,613 --> 00:01:54,613
My company probably
misunderstood the hype with bots

47
00:01:55,110 --> 00:01:58,350
and AI bots, and they built an actual bot,

48
00:01:58,350 --> 00:02:01,500
robot-selling website and mobile app.

49
00:02:01,500 --> 00:02:04,680
So there's this new application that

50
00:02:04,680 --> 00:02:06,330
now I, as the WAF administrator,

51
00:02:06,330 --> 00:02:08,460
need to go out and protect.

52
00:02:08,460 --> 00:02:11,010
Initially, this is the architecture.

53
00:02:11,010 --> 00:02:14,160
So it's built to serve

54
00:02:14,160 --> 00:02:16,830
web users, mobile applications,

55
00:02:16,830 --> 00:02:19,050
sending typically API calls

56
00:02:19,050 --> 00:02:22,890
as well as, well, unknown
automated clients,

57
00:02:22,890 --> 00:02:25,080
such as good bots and bad bots.

58
00:02:25,080 --> 00:02:28,560
So it's just out there
and everybody can use it.

59
00:02:28,560 --> 00:02:30,660
It will initially hit CloudFront,

60
00:02:30,660 --> 00:02:32,340
our CDN service,

61
00:02:32,340 --> 00:02:34,020
as the ingress point.

62
00:02:34,020 --> 00:02:36,030
And from there, CloudFront will route

63
00:02:36,030 --> 00:02:38,310
the traffic into multiple
backend components,

64
00:02:38,310 --> 00:02:40,050
or really front-end components,

65
00:02:40,050 --> 00:02:41,700
at the back of CloudFront.

66
00:02:41,700 --> 00:02:44,430
We'll have an ALB act as the

67
00:02:44,430 --> 00:02:46,650
load balancer for the web components,

68
00:02:46,650 --> 00:02:49,507
we'll have an API gateway
that will route API calls

69
00:02:49,507 --> 00:02:53,130
to different Lambda workers
and Lambda integrations,

70
00:02:53,130 --> 00:02:55,350
and we'll have static content.

71
00:02:55,350 --> 00:02:57,030
It's a single page application eventually.

72
00:02:57,030 --> 00:02:59,010
So the HTMLs and the CSS files

73
00:02:59,010 --> 00:03:02,010
and JavaScript files all
hosted on an S3 bucket.

74
00:03:02,010 --> 00:03:03,810
And, and CloudFront will
take care of all that.

75
00:03:03,810 --> 00:03:07,170
Now, this is my headache.

76
00:03:07,170 --> 00:03:08,890
Like, I got my morning coffee

77
00:03:09,780 --> 00:03:12,690
and now I need to decide how I do it.

78
00:03:12,690 --> 00:03:16,410
How do I protect this
newly birthed application?

79
00:03:16,410 --> 00:03:18,720
So, there are multiple questions

80
00:03:18,720 --> 00:03:21,360
we need to ask ourselves when we decide

81
00:03:21,360 --> 00:03:23,940
how to protect a specific application.

82
00:03:23,940 --> 00:03:25,440
We need to ask ourself where?

83
00:03:25,440 --> 00:03:26,610
So where do we protect it?

84
00:03:26,610 --> 00:03:27,900
We install multiple components.

85
00:03:27,900 --> 00:03:28,830
Where do we put WAF?

86
00:03:28,830 --> 00:03:32,370
Do we put it at the very
edge, on CloudFront?

87
00:03:32,370 --> 00:03:34,829
Do we have separate
WAFs on the API gateway

88
00:03:34,829 --> 00:03:36,750
and on the ALB?

89
00:03:36,750 --> 00:03:37,590
Where should we put it?

90
00:03:37,590 --> 00:03:38,763
And it really depends.

91
00:03:39,630 --> 00:03:41,730
It depends on who's gonna manage it

92
00:03:41,730 --> 00:03:44,310
and how much time do they have?

93
00:03:44,310 --> 00:03:47,070
If we want to spend time and really tune

94
00:03:47,070 --> 00:03:48,780
each and every policy for the different

95
00:03:48,780 --> 00:03:50,220
components of the application,

96
00:03:50,220 --> 00:03:51,661
probably it will make sense to

97
00:03:51,661 --> 00:03:53,970
have different web application

98
00:03:53,970 --> 00:03:56,684
firewall policies on top of the

99
00:03:56,684 --> 00:03:57,990
ALB and the API gateway.

100
00:03:57,990 --> 00:04:00,270
But we don't have that much time to manage

101
00:04:00,270 --> 00:04:02,820
all of these applications separately.

102
00:04:02,820 --> 00:04:04,530
And more, most importantly,

103
00:04:04,530 --> 00:04:06,750
we would want to block attacks

104
00:04:06,750 --> 00:04:08,730
as they come in at the
very edge of the network.

105
00:04:08,730 --> 00:04:11,160
So, we will look into the different

106
00:04:11,160 --> 00:04:13,230
places we can put WAF.

107
00:04:13,230 --> 00:04:15,660
Probably will enable it on CloudFront.

108
00:04:15,660 --> 00:04:17,280
Then, when?

109
00:04:17,280 --> 00:04:19,950
When do we need this
application protected?

110
00:04:19,950 --> 00:04:22,380
If we have time, we can plan ahead

111
00:04:22,380 --> 00:04:23,820
and start things in staging

112
00:04:23,820 --> 00:04:25,560
and test it out and tune it.

113
00:04:25,560 --> 00:04:27,267
And then when we're, we're,

114
00:04:27,267 --> 00:04:29,640
when we're ready to
launch into production,

115
00:04:29,640 --> 00:04:31,410
we can start turning
on the different rules.

116
00:04:31,410 --> 00:04:33,870
But I got this call this morning

117
00:04:33,870 --> 00:04:35,520
and the when is now.

118
00:04:35,520 --> 00:04:37,440
So the application is already out there,

119
00:04:37,440 --> 00:04:38,820
I have to protect it.

120
00:04:38,820 --> 00:04:40,590
So in this case, typically,

121
00:04:40,590 --> 00:04:42,030
we have to make some compromises.

122
00:04:42,030 --> 00:04:44,550
We never have all the time in the world.

123
00:04:44,550 --> 00:04:46,710
So typically there is some, some

124
00:04:46,710 --> 00:04:48,690
urgency when we deploy WAF.

125
00:04:48,690 --> 00:04:50,820
So we will need to make some compromises,

126
00:04:50,820 --> 00:04:51,960
at least initially.

127
00:04:51,960 --> 00:04:53,070
We will need to decide that

128
00:04:53,070 --> 00:04:56,820
some things will go on
immediately in blocking modes.

129
00:04:56,820 --> 00:04:59,010
Other things will go on in count mode

130
00:04:59,010 --> 00:05:01,320
so we can tune them as traffic starts

131
00:05:01,320 --> 00:05:02,820
to flow through the application.

132
00:05:02,820 --> 00:05:05,370
But again, this remains to be seen.

133
00:05:05,370 --> 00:05:07,950
We need to turn it on
and see what happens.

134
00:05:07,950 --> 00:05:09,540
Another question is who?

135
00:05:09,540 --> 00:05:10,680
So, who's gonna manage this

136
00:05:10,680 --> 00:05:13,110
web application firewall policy?

137
00:05:13,110 --> 00:05:14,880
Is it me, the security guy?

138
00:05:14,880 --> 00:05:16,530
Is it the application people?

139
00:05:16,530 --> 00:05:18,870
Each application component
has its own WAF policy,

140
00:05:18,870 --> 00:05:20,460
and that means that each of these people

141
00:05:20,460 --> 00:05:22,140
need to manage their own WAF.

142
00:05:22,140 --> 00:05:25,020
This really changes the complexity

143
00:05:25,020 --> 00:05:27,990
that I can basically put on them.

144
00:05:27,990 --> 00:05:29,370
So if they need to manage something

145
00:05:29,370 --> 00:05:30,957
they don't know really well,

146
00:05:30,957 --> 00:05:33,390
they will typically do simple things.

147
00:05:33,390 --> 00:05:35,580
On the other hand, if
the application people

148
00:05:35,580 --> 00:05:37,283
are managing the web
application firewall policy,

149
00:05:37,283 --> 00:05:40,050
they really know when to introduce

150
00:05:40,050 --> 00:05:41,340
new changes to the application

151
00:05:41,340 --> 00:05:43,650
and they really know
what those changes are.

152
00:05:43,650 --> 00:05:45,944
So they can tune the web
application firewall policy

153
00:05:45,944 --> 00:05:48,450
according to those application changes.

154
00:05:48,450 --> 00:05:50,993
So again, we need to balance things out.

155
00:05:50,993 --> 00:05:53,970
We need to understand and
decide what goes where

156
00:05:53,970 --> 00:05:55,980
and who manages what.

157
00:05:55,980 --> 00:05:58,710
And finally, the what.

158
00:05:58,710 --> 00:06:02,400
So, a WAF policy is a complex thing.

159
00:06:02,400 --> 00:06:04,590
It can do many different things.

160
00:06:04,590 --> 00:06:06,090
Obviously, we can go and turn on

161
00:06:06,090 --> 00:06:07,770
all of the different toggles.

162
00:06:07,770 --> 00:06:09,528
Probably it will be a mess.

163
00:06:09,528 --> 00:06:11,850
Probably some things will get blocked

164
00:06:11,850 --> 00:06:13,650
that weren't meant to be blocked,

165
00:06:13,650 --> 00:06:15,420
and we'll have to roll
back and do something else.

166
00:06:15,420 --> 00:06:17,790
So the what is,

167
00:06:17,790 --> 00:06:21,180
what are we putting in place, day one?

168
00:06:21,180 --> 00:06:25,110
And what are we planning
to put in place day 100?

169
00:06:25,110 --> 00:06:27,390
And how do we plan to roll that out?

170
00:06:27,390 --> 00:06:30,420
So, what will my policy contain?

171
00:06:30,420 --> 00:06:32,790
So we don't have time
for everything today,

172
00:06:32,790 --> 00:06:34,860
so we focus on these two questions:

173
00:06:34,860 --> 00:06:37,833
On the where and on the
what, for this talk.

174
00:06:39,480 --> 00:06:43,080
As for the where, one thing we can do,

175
00:06:43,080 --> 00:06:45,600
and that's typically the best option,

176
00:06:45,600 --> 00:06:48,390
is to put a WAF policy
on top of CloudFront.

177
00:06:48,390 --> 00:06:52,830
Why? Well, initially we
want to block traffic

178
00:06:52,830 --> 00:06:54,240
at the very edge, especially if

179
00:06:54,240 --> 00:06:55,920
we're talking about volumetric attacks.

180
00:06:55,920 --> 00:06:57,780
We do not want them to reach all the way

181
00:06:57,780 --> 00:07:00,360
into our origins, into our VPC.

182
00:07:00,360 --> 00:07:01,411
There are multiple reasons for

183
00:07:01,411 --> 00:07:03,232
why we don't want to do that.

184
00:07:03,232 --> 00:07:05,790
But remember that with CloudFront,

185
00:07:05,790 --> 00:07:09,240
we have 750 plus points of presence,

186
00:07:09,240 --> 00:07:12,180
all of them are hun-,
hundreds of gigabytes,

187
00:07:12,180 --> 00:07:13,680
gigabit per second capacity.

188
00:07:13,680 --> 00:07:17,762
So it's a very well-built mechanism,

189
00:07:17,762 --> 00:07:20,100
built and designed to withstand

190
00:07:20,100 --> 00:07:21,270
these peaks in traffic.

191
00:07:21,270 --> 00:07:23,821
So, blocking bad traffic at that point

192
00:07:23,821 --> 00:07:26,670
makes a lot of sense, right?

193
00:07:26,670 --> 00:07:30,104
On the other hand, we
might also want to consider

194
00:07:30,104 --> 00:07:32,700
building web application
firewall policies,

195
00:07:32,700 --> 00:07:35,100
smaller ones, more granular ones,

196
00:07:35,100 --> 00:07:36,750
and put them in place on top of

197
00:07:36,750 --> 00:07:38,220
the different application components

198
00:07:38,220 --> 00:07:41,163
and maybe let the application
people handle them.

199
00:07:42,000 --> 00:07:44,460
So some designs, we see that

200
00:07:44,460 --> 00:07:46,050
we have a coarse grain control

201
00:07:46,050 --> 00:07:47,704
at the very front, on top of CloudFront,

202
00:07:47,704 --> 00:07:51,330
with finer grain controls,

203
00:07:51,330 --> 00:07:52,710
with smaller WAF policies,

204
00:07:52,710 --> 00:07:55,053
running on top of the underlying services.

205
00:07:55,053 --> 00:07:58,653
ALB, API, Gateway, App Runner, whatever.

206
00:08:00,240 --> 00:08:03,000
At the very least, we do wanna see

207
00:08:03,000 --> 00:08:04,200
WAF running on CloudFront.

208
00:08:04,200 --> 00:08:05,640
That would be the best place

209
00:08:05,640 --> 00:08:08,013
to start blocking incoming attacks.

210
00:08:11,640 --> 00:08:13,860
Once we have put CloudFront
on top of the application,

211
00:08:13,860 --> 00:08:15,750
there is one consideration
we have to think of,

212
00:08:15,750 --> 00:08:17,220
and that is, how do we make sure

213
00:08:17,220 --> 00:08:19,710
that no one bypasses our WAF?

214
00:08:19,710 --> 00:08:21,570
And for that, we, we have to utilize

215
00:08:21,570 --> 00:08:25,380
mechanisms known as origin
cloaking or origin masquerading.

216
00:08:25,380 --> 00:08:27,900
Basically, we want to make
sure that only traffic

217
00:08:27,900 --> 00:08:31,050
that originated from
WAF can hit our origins,

218
00:08:31,050 --> 00:08:34,173
be it an S3 bucket, or an
API gateway, or an ALB.

219
00:08:35,220 --> 00:08:39,360
So when it comes to protecting
the most common use case,

220
00:08:39,360 --> 00:08:42,690
where, where we have a
VPC-based application,

221
00:08:42,690 --> 00:08:44,190
and we need to make sure that only traffic

222
00:08:44,190 --> 00:08:47,949
coming from, from CloudFront
with WAF can hit it,

223
00:08:47,949 --> 00:08:49,920
the best course of action would be

224
00:08:49,920 --> 00:08:52,230
to enable VPC Origins.

225
00:08:52,230 --> 00:08:53,310
It's a kind of a new feature.

226
00:08:53,310 --> 00:08:54,930
We have it for a few
months, so I don't know

227
00:08:54,930 --> 00:08:57,330
how many of you already
use it and know it,

228
00:08:57,330 --> 00:09:00,150
but it's the best way
to protect your origins.

229
00:09:00,150 --> 00:09:02,790
Basically, by enabling VPC Origins,

230
00:09:02,790 --> 00:09:04,530
we turn the load balancer

231
00:09:04,530 --> 00:09:07,170
to become an internal resource.

232
00:09:07,170 --> 00:09:09,840
They no longer have public IP addresses.

233
00:09:09,840 --> 00:09:11,580
They no longer have,

234
00:09:11,580 --> 00:09:13,950
they're no longer accessible
from the internet.

235
00:09:13,950 --> 00:09:15,600
The only thing that can contact these

236
00:09:15,600 --> 00:09:17,743
load balancers is the specific

237
00:09:17,743 --> 00:09:21,120
CloudFront distribution
that we assigned to it.

238
00:09:21,120 --> 00:09:23,610
So it's not even all of CloudFront.

239
00:09:23,610 --> 00:09:25,920
It's a very specific
CloudFront distribution,

240
00:09:25,920 --> 00:09:27,120
and that's called VPC origin.

241
00:09:27,120 --> 00:09:29,250
That, that's the best case scenario.

242
00:09:29,250 --> 00:09:32,340
In case we have an S3 bucket,

243
00:09:32,340 --> 00:09:34,020
the best way to protect that bucket

244
00:09:34,020 --> 00:09:36,510
without making, making it public,

245
00:09:36,510 --> 00:09:40,560
is to enable origin access
control, or OAC, on it.

246
00:09:40,560 --> 00:09:42,480
Basically, that means that whenever

247
00:09:42,480 --> 00:09:44,940
CloudFront communicates to that bucket,

248
00:09:44,940 --> 00:09:46,560
it uses IM policies.

249
00:09:46,560 --> 00:09:48,108
It assumes a role, really, to,

250
00:09:48,108 --> 00:09:50,850
to get access to that bucket.

251
00:09:50,850 --> 00:09:53,640
Just like any other
thing, any other policy

252
00:09:53,640 --> 00:09:55,140
that you would put on a bucket.

253
00:09:55,140 --> 00:09:56,970
The S3 bucket will now have the

254
00:09:56,970 --> 00:09:59,400
CloudFront role assigned and allowed

255
00:09:59,400 --> 00:10:01,740
to fetch the objects
from the bucket, right?

256
00:10:01,740 --> 00:10:06,740
So, these two solutions
will allow you to cloak

257
00:10:07,110 --> 00:10:10,290
and to mask and to protect your resources,

258
00:10:10,290 --> 00:10:12,060
basically forcing traffic to go through

259
00:10:12,060 --> 00:10:14,880
CloudFront and there is no other way in.

260
00:10:14,880 --> 00:10:16,684
In case you don't have one of these

261
00:10:16,684 --> 00:10:18,390
components in the application -

262
00:10:18,390 --> 00:10:20,370
Maybe you're running
an on-prem application,

263
00:10:20,370 --> 00:10:21,810
maybe your application is running

264
00:10:21,810 --> 00:10:24,480
on another cloud, like
Dan will discuss later,

265
00:10:24,480 --> 00:10:26,700
there are still other ways you can utilize

266
00:10:26,700 --> 00:10:28,725
to make sure that no one
can contact your, your,

267
00:10:28,725 --> 00:10:31,260
your origin without
going through CloudFront.

268
00:10:31,260 --> 00:10:32,880
Basically, you would, you would want

269
00:10:32,880 --> 00:10:35,640
to limit access at the IP level

270
00:10:35,640 --> 00:10:38,250
with our managed and
unmanaged prefix lists.

271
00:10:38,250 --> 00:10:40,470
So there's a JSON file
out there on the web,

272
00:10:40,470 --> 00:10:43,893
as well as a managed
prefix list on every VPC

273
00:10:43,893 --> 00:10:45,600
that you can use in your security groups

274
00:10:45,600 --> 00:10:47,580
to make sure that only CloudFront

275
00:10:47,580 --> 00:10:49,890
incoming IP addresses are allowed in.

276
00:10:49,890 --> 00:10:51,540
But that's not good enough because

277
00:10:51,540 --> 00:10:54,180
any CloudFront distribution
can access the application.

278
00:10:54,180 --> 00:10:56,370
And for that reason, we'll
typically want to add,

279
00:10:56,370 --> 00:10:59,190
to add into your CloudFront distribution

280
00:10:59,190 --> 00:11:01,383
configuration, a secret header.

281
00:11:02,580 --> 00:11:05,760
Preferably something that
rotates every once in a while.

282
00:11:05,760 --> 00:11:07,230
And that secret header is being,

283
00:11:07,230 --> 00:11:09,540
being added into every single request

284
00:11:09,540 --> 00:11:12,390
going out of CloudFront
towards the origin.

285
00:11:12,390 --> 00:11:14,730
And it needs to be enforced at the origin,

286
00:11:14,730 --> 00:11:17,820
maybe with an ALB rule,
maybe with an NGINX rule,

287
00:11:17,820 --> 00:11:20,970
but someone needs to look
at the incoming headers

288
00:11:20,970 --> 00:11:23,040
and make sure that only
requests coming with

289
00:11:23,040 --> 00:11:26,280
that secret header are
being allowed through.

290
00:11:26,280 --> 00:11:28,980
So that's, that's just a side discussion

291
00:11:28,980 --> 00:11:31,437
in order to keep a stable and,

292
00:11:31,437 --> 00:11:34,293
and best practice kind of
application architecture.

293
00:11:36,300 --> 00:11:37,680
Let's move on to the what.

294
00:11:37,680 --> 00:11:40,470
So what is a big topic.

295
00:11:40,470 --> 00:11:43,440
How to start building an AWS WAF policy

296
00:11:43,440 --> 00:11:46,260
used to be one of my
biggest conversation topics

297
00:11:46,260 --> 00:11:48,090
with customers, and
I've been dealing with,

298
00:11:48,090 --> 00:11:50,677
with customers about
WAF for too many years

299
00:11:50,677 --> 00:11:52,821
(laughs) that I would like to admit.

300
00:11:52,821 --> 00:11:57,821
But starting kind of recently,
it became super easy.

301
00:11:57,960 --> 00:12:01,973
So one easy way to enable
a WAF policy on top

302
00:12:01,973 --> 00:12:03,540
of your CloudFront is to go into the WAF,

303
00:12:03,540 --> 00:12:06,180
into the CloudFront console and then

304
00:12:06,180 --> 00:12:07,500
I dunno how many of you saw that?

305
00:12:07,500 --> 00:12:08,333
This is kind of new.

306
00:12:08,333 --> 00:12:10,517
We've had it out for about two weeks.

307
00:12:10,517 --> 00:12:14,229
Just pick a flat rate pricing plan

308
00:12:14,229 --> 00:12:16,410
that includes WAF in it.

309
00:12:16,410 --> 00:12:19,530
And it will already include
components of WAF for you.

310
00:12:19,530 --> 00:12:21,653
So if we, if we zoom in for a second,

311
00:12:21,653 --> 00:12:24,150
we will see the different plans

312
00:12:24,150 --> 00:12:26,430
coming all the way from zero for a very

313
00:12:26,430 --> 00:12:29,100
simple configuration still
including CloudFront,

314
00:12:29,100 --> 00:12:32,597
including DNS, including a
simple WAF configuration,

315
00:12:32,597 --> 00:12:36,540
all the way to the
different pricing plans.

316
00:12:36,540 --> 00:12:38,280
And by choosing one of these plans,

317
00:12:38,280 --> 00:12:40,890
you basically get a pre-made policy,

318
00:12:40,890 --> 00:12:42,540
which is typically good enough.

319
00:12:42,540 --> 00:12:45,600
Now these are big words,
"typically good enough".

320
00:12:45,600 --> 00:12:47,460
It's way better than nothing,

321
00:12:47,460 --> 00:12:49,140
and it's a very good start to allow you

322
00:12:49,140 --> 00:12:51,930
to start massaging your
rules into the policy.

323
00:12:51,930 --> 00:12:54,570
It will allow you to start where it's safe

324
00:12:54,570 --> 00:12:57,270
and manageable, and work your way out.

325
00:12:57,270 --> 00:12:58,920
And, and we'll, we'll, we'll talk about

326
00:12:58,920 --> 00:13:00,660
manageability and security,

327
00:13:00,660 --> 00:13:03,870
the security balance, a bit later.

328
00:13:03,870 --> 00:13:06,360
Zooming in into the business offering

329
00:13:06,360 --> 00:13:08,730
in the middle there, just as you see what,

330
00:13:08,730 --> 00:13:10,230
everything that it includes...

331
00:13:10,230 --> 00:13:11,940
I'm just hijacking the discussion

332
00:13:11,940 --> 00:13:13,749
for a second for marketing...

333
00:13:13,749 --> 00:13:16,170
It does include quite a bit.

334
00:13:16,170 --> 00:13:17,910
So it includes the DDoS protection,

335
00:13:17,910 --> 00:13:19,980
it includes storage in S3.

336
00:13:19,980 --> 00:13:21,990
It's, it includes DNS requests.

337
00:13:21,990 --> 00:13:24,540
It's, it's a really nice, nice package

338
00:13:24,540 --> 00:13:26,460
and you can have multiples of these

339
00:13:26,460 --> 00:13:27,540
in your different distributions.

340
00:13:27,540 --> 00:13:29,670
So let's say you have 50 distributions.

341
00:13:29,670 --> 00:13:32,320
Each of them can have one
of these packages attached.

342
00:13:33,632 --> 00:13:36,420
So in, in case you're dealing with

343
00:13:36,420 --> 00:13:38,340
an application that you know nothing about

344
00:13:38,340 --> 00:13:41,400
or you yourself don't
know enough to start out

345
00:13:41,400 --> 00:13:43,200
with a solid WAF configuration,

346
00:13:43,200 --> 00:13:44,190
that would be a very good way

347
00:13:44,190 --> 00:13:46,443
to start from the CloudFront console.

348
00:13:49,110 --> 00:13:50,490
Once you start configuring

349
00:13:50,490 --> 00:13:52,260
or enabling WAF on CloudFront,

350
00:13:52,260 --> 00:13:54,360
there are very simple questions you can,

351
00:13:54,360 --> 00:13:55,860
you can answer by ticking a box.

352
00:13:55,860 --> 00:13:58,350
Do you want SQL, SQL protection?

353
00:13:58,350 --> 00:14:00,180
Do you want rate limiting rules?

354
00:14:00,180 --> 00:14:03,450
Do you want to run in count
mode or monitor mode only?

355
00:14:03,450 --> 00:14:06,330
Very simple toggles. You
don't even have to know WAF.

356
00:14:06,330 --> 00:14:11,330
You or the application
owners that you delegate to,

357
00:14:11,370 --> 00:14:13,830
you don't have to know
really anything about WAF.

358
00:14:13,830 --> 00:14:15,540
It's good enough to start with.

359
00:14:15,540 --> 00:14:17,100
Again, good enough to start with.

360
00:14:17,100 --> 00:14:20,490
You can definitely, and probably, it,

361
00:14:20,490 --> 00:14:22,560
it will be best if you
build on top of this

362
00:14:22,560 --> 00:14:25,050
and add more controls as you go forward.

363
00:14:25,050 --> 00:14:27,390
So this is all the console of AWS,

364
00:14:27,390 --> 00:14:29,460
of, sorry, Amazon CloudFront.

365
00:14:29,460 --> 00:14:32,553
Really easy to begin
building WAF on top of that.

366
00:14:33,570 --> 00:14:35,730
When you start from the WAF console,

367
00:14:35,730 --> 00:14:38,310
the experience is a
bit, is a bit different.

368
00:14:38,310 --> 00:14:40,800
So again, this is a change we've committed

369
00:14:40,800 --> 00:14:42,750
not too many months ago,
so I don't know how many

370
00:14:42,750 --> 00:14:44,190
of you are familiar with it.

371
00:14:44,190 --> 00:14:46,200
Basically, when you create a new web ACL,

372
00:14:46,200 --> 00:14:48,789
or protection pack as we call them now,

373
00:14:48,789 --> 00:14:51,090
you're being asked simple questions

374
00:14:51,090 --> 00:14:52,530
about the application.

375
00:14:52,530 --> 00:14:54,210
What kind of an application is it?

376
00:14:54,210 --> 00:14:56,400
Is it content, content delivery?

377
00:14:56,400 --> 00:14:59,153
Is it an API, is it a mix
of them? Is it retail?

378
00:14:59,153 --> 00:15:03,000
And you just check a box and you start

379
00:15:03,000 --> 00:15:04,530
building your application configuration

380
00:15:04,530 --> 00:15:06,300
from there, without
knowing anything about WAF.

381
00:15:06,300 --> 00:15:08,310
Just basically answering questions

382
00:15:08,310 --> 00:15:09,870
about your application, which you, you,

383
00:15:09,870 --> 00:15:10,703
which you should know.

384
00:15:10,703 --> 00:15:12,303
You or the application owner.

385
00:15:13,260 --> 00:15:15,660
Going from there, you
can pick one of these

386
00:15:15,660 --> 00:15:19,157
pre-made packages,
pre-made protection packs

387
00:15:19,157 --> 00:15:22,440
that include a good
enough security policy.

388
00:15:22,440 --> 00:15:24,930
It contains a bit more than the CloudFront

389
00:15:24,930 --> 00:15:27,600
deployed policy does, assuming that if

390
00:15:27,600 --> 00:15:30,180
you are already on the WAF console,

391
00:15:30,180 --> 00:15:31,740
you probably know a bit more

392
00:15:31,740 --> 00:15:34,976
and you'll be allowed into
more of the secret sauce.

393
00:15:34,976 --> 00:15:37,350
So again, three options.

394
00:15:37,350 --> 00:15:39,968
A basic one, basically rate limiting,

395
00:15:39,968 --> 00:15:44,405
IP reputation services enabled,

396
00:15:44,405 --> 00:15:49,405
bot controlled in count
mode, common bot control.

397
00:15:49,440 --> 00:15:51,290
You can move on to the essential pack

398
00:15:53,640 --> 00:15:54,690
and you can have more.

399
00:15:54,690 --> 00:15:59,690
So more is not necessarily
always better, right?

400
00:15:59,730 --> 00:16:01,230
We obviously want to strive

401
00:16:01,230 --> 00:16:04,230
to a very robust, feature rich policy

402
00:16:04,230 --> 00:16:07,230
that protects you against
different kind of things

403
00:16:07,230 --> 00:16:09,960
that happen in the internet, but it,

404
00:16:09,960 --> 00:16:14,730
it may incur some costs
on you, operational costs.

405
00:16:14,730 --> 00:16:18,450
And typically when we
start too strong with WAF,

406
00:16:18,450 --> 00:16:20,100
and I've seen it happen multiple times,

407
00:16:20,100 --> 00:16:23,550
not with AWS WAF,
necessarily, but all WAFs.

408
00:16:23,550 --> 00:16:25,260
When you start, when
you come on too strong

409
00:16:25,260 --> 00:16:27,243
with WAF at the first sign of trouble,

410
00:16:27,243 --> 00:16:29,610
like, you're getting false positives,

411
00:16:29,610 --> 00:16:31,740
you're getting blocked requests,

412
00:16:31,740 --> 00:16:35,040
there's too much to handle
and you just switch it off.

413
00:16:35,040 --> 00:16:37,710
And the, the hurdle you have to

414
00:16:37,710 --> 00:16:41,010
jump through in order to re-enabling it

415
00:16:41,010 --> 00:16:43,170
after getting bird is super high.

416
00:16:43,170 --> 00:16:45,240
So I would suggest starting low and

417
00:16:45,240 --> 00:16:47,460
building on top of that,
on what you already have,

418
00:16:47,460 --> 00:16:50,370
and you already have
established trust with.

419
00:16:50,370 --> 00:16:52,110
You know how the mechanism works,

420
00:16:52,110 --> 00:16:53,460
you know where the logs are,

421
00:16:53,460 --> 00:16:54,810
you know how to tune things.

422
00:16:54,810 --> 00:16:56,460
You can start building from that.

423
00:16:59,070 --> 00:17:01,867
Once you configure the
application policy through WAF,

424
00:17:01,867 --> 00:17:04,290
there are a few other
things you can configure,

425
00:17:04,290 --> 00:17:07,110
such as what are the
rate limit thresholds?

426
00:17:07,110 --> 00:17:09,867
So, it could be anything
that fits your application.

427
00:17:09,867 --> 00:17:12,240
I think we start here
with a thousand requests

428
00:17:12,240 --> 00:17:15,030
per IP per minute, or per,
per five minutes, sorry.

429
00:17:15,030 --> 00:17:16,950
But you can tune that into something

430
00:17:16,950 --> 00:17:19,230
as low as 10 requests, if that's what

431
00:17:19,230 --> 00:17:21,330
your application needs, or as high as

432
00:17:21,330 --> 00:17:23,010
two billion requests, if that's what

433
00:17:23,010 --> 00:17:23,843
your application needs.

434
00:17:23,843 --> 00:17:26,280
So we start out with a good normal number,

435
00:17:26,280 --> 00:17:27,690
but you can tune that.

436
00:17:27,690 --> 00:17:30,030
And this part here is super simple,

437
00:17:30,030 --> 00:17:31,590
but super important to enable,

438
00:17:31,590 --> 00:17:33,600
and that's logging.

439
00:17:33,600 --> 00:17:34,567
So you just have to say,

440
00:17:34,567 --> 00:17:37,140
"I want logging," basically ticking a box.

441
00:17:37,140 --> 00:17:39,240
And the same goes by, by the way,

442
00:17:39,240 --> 00:17:40,380
on the CloudFront console.

443
00:17:40,380 --> 00:17:42,960
Super easy to enable WAF logging

444
00:17:42,960 --> 00:17:46,440
and it sends logging
towards CloudWatch logs.

445
00:17:46,440 --> 00:17:50,310
Now, going back to the fixed pricing plan

446
00:17:50,310 --> 00:17:52,470
that we announced a few weeks ago,

447
00:17:52,470 --> 00:17:54,510
logs are included in that pricing plan.

448
00:17:54,510 --> 00:17:56,400
So it's no longer a concern.

449
00:17:56,400 --> 00:17:58,560
CloudWatch logs, which are the easiest way

450
00:17:58,560 --> 00:18:01,110
to manage WAF logs, are
included in the pricing plan.

451
00:18:01,110 --> 00:18:02,640
So you can just go ahead,

452
00:18:02,640 --> 00:18:04,950
check the box and enable that.

453
00:18:04,950 --> 00:18:08,430
Even without that,
without the pricing plan,

454
00:18:08,430 --> 00:18:11,610
on the good old pay as you go model,

455
00:18:11,610 --> 00:18:15,570
we've decreased the price
of CloudWatch logs with WAF.

456
00:18:15,570 --> 00:18:17,536
We now provide 500 megabytes

457
00:18:17,536 --> 00:18:21,000
of free logs per every million WAF

458
00:18:21,000 --> 00:18:22,740
requests that you send through.

459
00:18:22,740 --> 00:18:24,570
So it really reduces, help reduce

460
00:18:24,570 --> 00:18:26,970
the cost in case you don't go with the

461
00:18:26,970 --> 00:18:29,420
protection plan, or with
the pricing plan, sorry.

462
00:18:30,660 --> 00:18:33,720
So summarizing, we know
what, we know the what.

463
00:18:33,720 --> 00:18:35,820
We know we're going
for the essential pack.

464
00:18:35,820 --> 00:18:37,290
We know what we're getting.

465
00:18:37,290 --> 00:18:39,000
We're getting some IP based blocks,

466
00:18:39,000 --> 00:18:41,130
we're getting geolocation based blocks,

467
00:18:41,130 --> 00:18:44,437
we're getting some very good core HTTP

468
00:18:44,437 --> 00:18:47,340
compliance protection rules.

469
00:18:47,340 --> 00:18:50,670
We're getting what we
call "known bad inputs"

470
00:18:50,670 --> 00:18:53,640
or "known vulnerabilities"
like Log four J,

471
00:18:53,640 --> 00:18:54,780
all with a simple click.

472
00:18:54,780 --> 00:18:57,390
We're even getting the new layer seven

473
00:18:57,390 --> 00:18:59,340
DDoS rule in count mode.

474
00:18:59,340 --> 00:19:00,570
So it's already enabled,

475
00:19:00,570 --> 00:19:03,936
it's in the right place in
the policy at the very top.

476
00:19:03,936 --> 00:19:06,750
And all the remains to
us is just monitoring

477
00:19:06,750 --> 00:19:08,950
what it does and enable
it when we're ready.

478
00:19:09,900 --> 00:19:11,550
Time for a well earned coffee.

479
00:19:11,550 --> 00:19:14,190
So I got there in the
morning, I got the news

480
00:19:14,190 --> 00:19:15,570
of the new application.

481
00:19:15,570 --> 00:19:17,632
I built with a few clicks, the,

482
00:19:17,632 --> 00:19:20,580
the WAF policy that fits my needs.

483
00:19:20,580 --> 00:19:22,770
Now it's time to look at the logs.

484
00:19:22,770 --> 00:19:25,230
This, this is what makes me feel good:

485
00:19:25,230 --> 00:19:26,490
looking at dashboards all day.

486
00:19:26,490 --> 00:19:27,810
I really like that, so.

487
00:19:27,810 --> 00:19:30,030
I don't know how similar
you think this guy is to me.

488
00:19:30,030 --> 00:19:31,560
I tried. I'm even wearing the,

489
00:19:31,560 --> 00:19:33,483
I'm even wearing the same kind of shirt.

490
00:19:33,483 --> 00:19:36,120
Imagine that, that is me.

491
00:19:36,120 --> 00:19:37,680
That's the best I could do with AI.

492
00:19:37,680 --> 00:19:39,130
I'm a WAF guy, not an AI guy.

493
00:19:41,153 --> 00:19:45,540
So out of the box with AWS WAF,

494
00:19:45,540 --> 00:19:47,400
you have these built-in dashboards.

495
00:19:47,400 --> 00:19:49,560
Again, it used to be a pain to,

496
00:19:49,560 --> 00:19:51,499
to spin up dashboards in WAF.

497
00:19:51,499 --> 00:19:53,983
Or I would say a relative pain,

498
00:19:53,983 --> 00:19:56,160
where you had to know what you're doing

499
00:19:56,160 --> 00:19:58,050
and what kind of queries you need to run

500
00:19:58,050 --> 00:20:00,907
to build a CloudWatch dashboard widget.

501
00:20:00,907 --> 00:20:05,370
Now starting June, last June, we launched

502
00:20:05,370 --> 00:20:08,700
this new UI with this, these super useful

503
00:20:08,700 --> 00:20:10,710
dashboard widgets that really allow you

504
00:20:10,710 --> 00:20:13,200
to see where traffic is coming from,

505
00:20:13,200 --> 00:20:15,040
which rules are being hit,

506
00:20:15,040 --> 00:20:17,760
what kind of bot traffic you're seeing,

507
00:20:17,760 --> 00:20:19,890
what kind of DDoS traffic you're seeing.

508
00:20:19,890 --> 00:20:22,830
Really, really dive into
the different insights,

509
00:20:22,830 --> 00:20:26,220
top IP addresses, top
URIs, top user agents,

510
00:20:26,220 --> 00:20:29,370
top fingerprints, JA3, JA4 fingerprints.

511
00:20:29,370 --> 00:20:33,240
All useful stuff enabled by default.

512
00:20:33,240 --> 00:20:34,890
And the most important
thing, you can start

513
00:20:34,890 --> 00:20:39,890
navigating the logs
directly from the console.

514
00:20:40,590 --> 00:20:43,000
So no need to run these

515
00:20:45,900 --> 00:20:50,730
tiring CloudWatch log queries.

516
00:20:50,730 --> 00:20:51,870
It's all built in.

517
00:20:51,870 --> 00:20:55,980
You can click an IP
address on the top IP list

518
00:20:55,980 --> 00:20:58,110
and filter by that IP and start seeing

519
00:20:58,110 --> 00:21:00,030
what these IPs are doing
in your application.

520
00:21:00,030 --> 00:21:03,510
Each of these lines is
basically clickable.

521
00:21:03,510 --> 00:21:05,970
You can see the full request details,

522
00:21:05,970 --> 00:21:08,160
the IP address, the reputation,

523
00:21:08,160 --> 00:21:10,680
the query string parameters, the labels

524
00:21:10,680 --> 00:21:15,150
that we accumulated for
that specific request.

525
00:21:15,150 --> 00:21:16,320
And everything is actionable.

526
00:21:16,320 --> 00:21:18,300
So you can take anything out of it,

527
00:21:18,300 --> 00:21:19,350
put it back in the filter.

528
00:21:19,350 --> 00:21:21,210
Show me more requests with this URL.

529
00:21:21,210 --> 00:21:24,120
Show me more, more requests
with this fingerprint.

530
00:21:24,120 --> 00:21:26,400
And you can still use the good old

531
00:21:26,400 --> 00:21:28,380
CloudWatch log insight queries if you need

532
00:21:28,380 --> 00:21:30,150
to build something more comprehensive,

533
00:21:30,150 --> 00:21:32,490
like more advanced querying.

534
00:21:32,490 --> 00:21:34,740
Obviously, this is all true if you're

535
00:21:34,740 --> 00:21:36,608
using CloudWatch logs,
but it does make sense

536
00:21:36,608 --> 00:21:39,870
because it's cheaper, it's
included in the pricing plan.

537
00:21:39,870 --> 00:21:41,730
But if you're using other destination

538
00:21:41,730 --> 00:21:43,080
for logging, we'll talk about that.

539
00:21:43,080 --> 00:21:44,850
You can use the same kind of schemes

540
00:21:44,850 --> 00:21:46,197
to build your own dashboards.

541
00:21:46,197 --> 00:21:49,320
Run Athena queries on top of S3 and so on.

542
00:21:49,320 --> 00:21:50,850
Like, like we, like you used to.

543
00:21:50,850 --> 00:21:52,953
We didn't change, we didn't change that.

544
00:21:54,510 --> 00:21:57,120
Okay, looking at the logs, I feel relaxed.

545
00:21:57,120 --> 00:22:01,290
I had my coffee, it's
time for the lunch break.

546
00:22:01,290 --> 00:22:05,400
And you know what, let's put
the "break" in lunch break.

547
00:22:05,400 --> 00:22:08,340
So just sitting down to have my lunch,

548
00:22:08,340 --> 00:22:10,110
we're starting, I start to hear yells

549
00:22:10,110 --> 00:22:12,090
from upstairs in marketing.

550
00:22:12,090 --> 00:22:15,990
They say something about
403 customers complaining.

551
00:22:15,990 --> 00:22:17,939
Probably something they misheard.

552
00:22:17,939 --> 00:22:20,340
So I, I start looking at the dashboard

553
00:22:20,340 --> 00:22:21,570
and I see these 403s.

554
00:22:21,570 --> 00:22:23,790
I see multiple blocks coming from

555
00:22:23,790 --> 00:22:26,379
different IP addresses, all with the

556
00:22:26,379 --> 00:22:29,790
CrossSiteScripting in body rule being hit.

557
00:22:29,790 --> 00:22:32,896
So I, I, I have a sneaking suspicion

558
00:22:32,896 --> 00:22:35,646
it's gonna be a false positive
that I have to mitigate.

559
00:22:36,630 --> 00:22:40,350
So I start diving into
the, into the logs more.

560
00:22:40,350 --> 00:22:41,690
I see different IP addresses.

561
00:22:41,690 --> 00:22:43,620
I, I look at these IP addresses

562
00:22:43,620 --> 00:22:45,570
and I see that they're basically benign.

563
00:22:45,570 --> 00:22:46,680
They're doing good things.

564
00:22:46,680 --> 00:22:48,960
They're logging in,
they're purchasing bots,

565
00:22:48,960 --> 00:22:51,360
they're posting on the forum,

566
00:22:51,360 --> 00:22:53,310
but they're also triggering this

567
00:22:53,310 --> 00:22:56,288
one rule on a very specific webpage

568
00:22:56,288 --> 00:22:58,920
where we are detecting
a CrossSiteScripting

569
00:22:58,920 --> 00:23:00,810
attempt in the body.

570
00:23:00,810 --> 00:23:02,710
I'm assuming this is a false positive.

571
00:23:04,410 --> 00:23:05,970
We have to deal with it.

572
00:23:05,970 --> 00:23:07,650
So first rule in dealing with false

573
00:23:07,650 --> 00:23:09,960
positives is stay calm.

574
00:23:09,960 --> 00:23:13,410
Don't turn off WAF, don't
roll back the change.

575
00:23:13,410 --> 00:23:15,900
Try and understand exactly
what is the pattern

576
00:23:15,900 --> 00:23:18,003
that triggers the false positive.

577
00:23:18,900 --> 00:23:22,880
Once you do that, it could
be a, a, a specific URI,

578
00:23:22,880 --> 00:23:25,050
it could be a specific parameter,

579
00:23:25,050 --> 00:23:27,240
it could be anything
really in the request,

580
00:23:27,240 --> 00:23:29,010
but by looking and navigating through

581
00:23:29,010 --> 00:23:31,290
the dashboard, you really can pinpoint and

582
00:23:31,290 --> 00:23:33,190
you start building a rule around that.

583
00:23:34,410 --> 00:23:35,973
So you see now I'm calm.

584
00:23:37,020 --> 00:23:39,035
Again, I think this guy looks like me.

585
00:23:39,035 --> 00:23:41,910
So first we go and switch off the rule

586
00:23:41,910 --> 00:23:43,290
that triggered the false positive.

587
00:23:43,290 --> 00:23:45,120
In our case, it was a CrossSiteScripting

588
00:23:45,120 --> 00:23:47,190
attempt in the request body.

589
00:23:47,190 --> 00:23:50,426
So we go and turn that
off, or switch it to count.

590
00:23:50,426 --> 00:23:53,160
Right? So now no more
users are getting blocked,

591
00:23:53,160 --> 00:23:55,320
but then again, we're not enforcing

592
00:23:55,320 --> 00:23:56,880
CrossSiteScripting in body anymore,

593
00:23:56,880 --> 00:23:58,380
which is not a good thing.

594
00:23:58,380 --> 00:24:01,470
So we are building a different rule

595
00:24:01,470 --> 00:24:04,144
right after the rule
that that triggered the,

596
00:24:04,144 --> 00:24:06,330
the, the false positive.

597
00:24:06,330 --> 00:24:09,561
And that rule is built in a way that says

598
00:24:09,561 --> 00:24:11,825
still block CrossSiteScripting attacks

599
00:24:11,825 --> 00:24:14,370
based on this label, and we'll talk about

600
00:24:14,370 --> 00:24:16,080
the label in a second.

601
00:24:16,080 --> 00:24:17,882
Still mitigate CrossSiteScripting attacks,

602
00:24:17,882 --> 00:24:21,570
but don't do it if the URI is

603
00:24:21,570 --> 00:24:23,520
slash missing robots form.

604
00:24:23,520 --> 00:24:26,250
Because that was the one
that I saw in my logs.

605
00:24:26,250 --> 00:24:29,880
So by that, I basically
turned CrossSiteScripting

606
00:24:29,880 --> 00:24:33,300
in body back on, back into
being, being enforced.

607
00:24:33,300 --> 00:24:38,130
But I exempted the, this
specific URI from that rule.

608
00:24:38,130 --> 00:24:41,730
All other attacks on
that URI are still valid.

609
00:24:41,730 --> 00:24:44,310
So this is a very good, fine-grain way

610
00:24:44,310 --> 00:24:45,783
to mitigate false positives.

611
00:24:47,040 --> 00:24:50,550
So once we do that, we start tuning.

612
00:24:50,550 --> 00:24:54,240
So tuning helps us avoid chaos.

613
00:24:54,240 --> 00:24:57,570
So tune your policy often, tune it early,

614
00:24:57,570 --> 00:24:59,803
don't wait for something to happen.

615
00:24:59,803 --> 00:25:01,233
So review the logs, make sure that

616
00:25:01,233 --> 00:25:03,270
you're doing the right things.

617
00:25:03,270 --> 00:25:05,640
Enough traffic is being
blocked, enough blocked.

618
00:25:05,640 --> 00:25:07,921
Enough traffic is being let through.

619
00:25:07,921 --> 00:25:12,360
When you do make changes,
make changes gradually.

620
00:25:12,360 --> 00:25:15,270
Don't add five different
rules on the same day.

621
00:25:15,270 --> 00:25:19,680
So again, too much is not
better necessarily with WAF.

622
00:25:19,680 --> 00:25:22,803
So add rules gradually, monitor effect.

623
00:25:23,910 --> 00:25:27,060
And manage your traffic with labels.

624
00:25:27,060 --> 00:25:28,770
So there's a little
star there, with labels.

625
00:25:28,770 --> 00:25:30,780
I don't know how many of you know labels,

626
00:25:30,780 --> 00:25:33,960
but labels are my and your best friend

627
00:25:33,960 --> 00:25:36,420
when it comes to WAF,
so a bit about labels.

628
00:25:36,420 --> 00:25:40,380
Labels are metadata that we add into

629
00:25:40,380 --> 00:25:42,780
every single request
that goes through WAF.

630
00:25:42,780 --> 00:25:44,850
We can add them with managed rules -

631
00:25:44,850 --> 00:25:47,880
By default, all managed
rules add different labels.

632
00:25:47,880 --> 00:25:50,310
For example, these are
the labels being emitted

633
00:25:50,310 --> 00:25:52,290
by the core rule set, a part of them.

634
00:25:52,290 --> 00:25:53,760
There are more.

635
00:25:53,760 --> 00:25:55,710
We can add labels on our custom rules

636
00:25:55,710 --> 00:25:56,853
as part of the action.

637
00:25:58,080 --> 00:26:00,930
We can use them as a match or

638
00:26:00,930 --> 00:26:03,300
scope down condition on rules.

639
00:26:03,300 --> 00:26:06,342
So, let's say I want to not inspect

640
00:26:06,342 --> 00:26:09,030
certain traffic from a certain IP address.

641
00:26:09,030 --> 00:26:11,610
I can create a custom
rule that adds a label

642
00:26:11,610 --> 00:26:13,169
to all traffic from a certain,

643
00:26:13,169 --> 00:26:14,910
from a certain IP address and then

644
00:26:14,910 --> 00:26:17,649
use that label to scope down another rule

645
00:26:17,649 --> 00:26:20,850
to not inspect that specific traffic.

646
00:26:20,850 --> 00:26:23,974
So we use labels. It will help you

647
00:26:23,974 --> 00:26:28,500
investigate because labels
are visible in your logs.

648
00:26:28,500 --> 00:26:30,900
They are visible in CloudWatch metrics

649
00:26:30,900 --> 00:26:33,150
and they're also usable if you want

650
00:26:33,150 --> 00:26:35,430
to filter out certain rules

651
00:26:35,430 --> 00:26:38,100
or certain traffic patterns from your logs

652
00:26:38,100 --> 00:26:40,200
because they're too, too noisy

653
00:26:40,200 --> 00:26:41,910
or cost too much or whatever.

654
00:26:41,910 --> 00:26:45,360
So labels, super useful tool.

655
00:26:45,360 --> 00:26:46,800
They're like the multi-tool of WAF.

656
00:26:46,800 --> 00:26:49,260
They can really be used to do anything.

657
00:26:49,260 --> 00:26:52,020
So add them, add them always.

658
00:26:52,020 --> 00:26:54,120
Then think about what to do with them.

659
00:26:54,120 --> 00:26:55,623
Labels are your best friends.

660
00:26:58,380 --> 00:27:02,139
Then lastly... I know I'm
running late, don't worry.

661
00:27:02,139 --> 00:27:06,270
Lastly, after ...

662
00:27:06,270 --> 00:27:07,230
Typically ... I'm from Israel.

663
00:27:07,230 --> 00:27:08,910
So typically at 2:00 PM,
we're having a coffee.

664
00:27:08,910 --> 00:27:10,020
I don't know how it is in the US,

665
00:27:10,020 --> 00:27:12,120
but at 2:00 PM we're breaking for coffee.

666
00:27:12,120 --> 00:27:14,737
Typically, it's a strong black coffee.

667
00:27:14,737 --> 00:27:19,050
So that time I would use
to optimize my costs.

668
00:27:19,050 --> 00:27:20,550
So I tuned my policy.

669
00:27:20,550 --> 00:27:22,290
I know that I'm blocking
the, the bad stuff.

670
00:27:22,290 --> 00:27:24,420
I know that I'm letting
through the good stuff.

671
00:27:24,420 --> 00:27:26,280
It's already deployed, but now

672
00:27:26,280 --> 00:27:27,960
I'm making sure that I'm not making any,

673
00:27:27,960 --> 00:27:29,430
any mistakes when it comes to costs.

674
00:27:29,430 --> 00:27:33,270
So in order to control our cost,

675
00:27:33,270 --> 00:27:34,650
we initially make, need to make sure

676
00:27:34,650 --> 00:27:36,570
that the right things
are getting blocked at

677
00:27:36,570 --> 00:27:38,670
the right places with WAF.

678
00:27:38,670 --> 00:27:40,110
So making sure that the layer seven

679
00:27:40,110 --> 00:27:41,873
DDoS rule at the, is, is at the very top

680
00:27:41,873 --> 00:27:44,010
because whenever it blocks traffic,

681
00:27:44,010 --> 00:27:46,110
it is not incurring any costs.

682
00:27:46,110 --> 00:27:49,830
So, blocked requests are
free in layer seven DDoS

683
00:27:49,830 --> 00:27:51,030
even without a pricing plan.

684
00:27:51,030 --> 00:27:53,730
So making sure that this
rule is going first.

685
00:27:53,730 --> 00:27:55,530
Making sure that other paid rules,

686
00:27:55,530 --> 00:27:59,280
such as bot control,
are scoped down and only

687
00:27:59,280 --> 00:28:02,598
getting traffic which we
think they should inspect.

688
00:28:02,598 --> 00:28:04,357
And also looking at logs where

689
00:28:04,357 --> 00:28:06,900
I need to make sure that logs are not

690
00:28:06,900 --> 00:28:08,610
being carried over for too long.

691
00:28:08,610 --> 00:28:11,577
So, setting up a specific
log retention period,

692
00:28:11,577 --> 00:28:14,340
whatever your business
needs, be it 14 days

693
00:28:14,340 --> 00:28:15,720
or seven years, but make sure that

694
00:28:15,720 --> 00:28:18,641
you stick to that and
don't carry logs forever.

695
00:28:18,641 --> 00:28:22,512
Use labels again to filter out noisy logs.

696
00:28:22,512 --> 00:28:25,295
And again, switch to flat rate plans.

697
00:28:25,295 --> 00:28:28,081
Really predictable. No overages.

698
00:28:28,081 --> 00:28:30,670
You know what you're getting every month

699
00:28:32,390 --> 00:28:34,470
When it comes to logs, I really rush,

700
00:28:34,470 --> 00:28:35,790
I will really rush through with it

701
00:28:35,790 --> 00:28:38,700
because CloudWatch logs are
the easiest to configure.

702
00:28:38,700 --> 00:28:40,530
Typically the cheapest, especially if

703
00:28:40,530 --> 00:28:42,390
you have low rates of traffic.

704
00:28:42,390 --> 00:28:44,520
When it comes to higher
rates, you might want

705
00:28:44,520 --> 00:28:47,310
to consider other ways
to send out WAF logs.

706
00:28:47,310 --> 00:28:49,009
You might want to consider Kinesis,

707
00:28:49,009 --> 00:28:52,260
Data Fare, Fire Hose, which is,

708
00:28:52,260 --> 00:28:53,970
outside of the pricing plan, probably the

709
00:28:53,970 --> 00:28:56,282
cheapest way for very
high volumes of traffic.

710
00:28:56,282 --> 00:28:58,020
It can also be used to send traffic

711
00:28:58,020 --> 00:29:01,050
to different locations like S3,

712
00:29:01,050 --> 00:29:03,853
like an, an external, a third party ...

713
00:29:05,790 --> 00:29:08,190
vendor like a SaaS offering.

714
00:29:08,190 --> 00:29:12,270
And lastly, you can
use S3 buckets directly

715
00:29:12,270 --> 00:29:14,970
to send out WAF logs
directly to an S3 bucket.

716
00:29:14,970 --> 00:29:17,370
Behind the scenes it
does use CloudWatch logs.

717
00:29:17,370 --> 00:29:19,980
So at high volumes you might incur some,

718
00:29:19,980 --> 00:29:22,110
some vending costs that you don't expect,

719
00:29:22,110 --> 00:29:23,730
but it's the easiest to configure.

720
00:29:23,730 --> 00:29:27,150
So preferably CloudWatch logs.

721
00:29:27,150 --> 00:29:29,790
If not that, Kinesis Fire Hose.

722
00:29:29,790 --> 00:29:32,220
If you need S3, use the Kinesis Fire Hose

723
00:29:32,220 --> 00:29:34,953
to send traffic or logs towards S3.

724
00:29:36,330 --> 00:29:39,000
And finally, if you're
using pricing plans,

725
00:29:39,000 --> 00:29:41,520
it's really easy to see if you're about to

726
00:29:41,520 --> 00:29:43,440
breach the contract that you've signed.

727
00:29:43,440 --> 00:29:46,080
You can see, based on what you

728
00:29:46,080 --> 00:29:48,330
already had in the month, like, how soon

729
00:29:48,330 --> 00:29:51,360
will you breach the,
the quota that you got?

730
00:29:51,360 --> 00:29:53,400
Like, out of the 500 million requests,

731
00:29:53,400 --> 00:29:54,900
how many you already sent?

732
00:29:54,900 --> 00:29:57,720
Same goes for data transfer,
but it's fine though.

733
00:29:57,720 --> 00:29:59,790
If you're about to breach, as long as it's

734
00:29:59,790 --> 00:30:01,950
not a consistent breach, like every month

735
00:30:01,950 --> 00:30:04,713
you, you're breaching,
there will be no overages.

736
00:30:06,193 --> 00:30:07,440
If this is happening more often than not,

737
00:30:07,440 --> 00:30:08,820
that you're breaching your quotas,

738
00:30:08,820 --> 00:30:11,100
eventually you will
experience some throttling.

739
00:30:11,100 --> 00:30:12,810
But for that we have a very clear

740
00:30:12,810 --> 00:30:15,180
dashboard in the UI allowing you to

741
00:30:15,180 --> 00:30:16,530
keep track of where you're going

742
00:30:16,530 --> 00:30:19,350
and is that plan the right plan for you?

743
00:30:19,350 --> 00:30:21,060
So this is the end of my coffee break

744
00:30:21,060 --> 00:30:22,510
and I'll hand it over to Dan.

745
00:30:25,230 --> 00:30:28,650
- [Dan Avidan] Thank you. Hello everyone.

746
00:30:28,650 --> 00:30:31,680
Hopefully having a great Reinvent so far.

747
00:30:31,680 --> 00:30:35,418
I'm Dan Avidan from HSBC Retail Bank,

748
00:30:35,418 --> 00:30:40,140
IWPB, International Wealth
and Premier Banking.

749
00:30:40,140 --> 00:30:43,290
And I'm gonna walk you
through our WAF journey.

750
00:30:43,290 --> 00:30:45,760
So first, in terms of who we are and

751
00:30:45,760 --> 00:30:47,760
where we sit within the organization,

752
00:30:47,760 --> 00:30:49,560
we are digital enablers.

753
00:30:49,560 --> 00:30:52,170
So we provide things like common

754
00:30:52,170 --> 00:30:54,690
frameworks and platforms pertaining to

755
00:30:54,690 --> 00:30:57,630
mobile authentication and authorization,

756
00:30:57,630 --> 00:30:59,730
business process orchestration.

757
00:30:59,730 --> 00:31:01,860
And of course what we are
gonna talk about today,

758
00:31:01,860 --> 00:31:06,420
which is our edge routing
and protection platform.

759
00:31:06,420 --> 00:31:08,430
The services that we provide specifically

760
00:31:08,430 --> 00:31:10,650
allow the various value stream

761
00:31:10,650 --> 00:31:14,280
to concentrate on their specific business

762
00:31:14,280 --> 00:31:16,260
verticals without having to worry about

763
00:31:16,260 --> 00:31:18,033
things such as WAF protection.

764
00:31:19,620 --> 00:31:22,470
So HSBC, one of the
biggest banks in the world.

765
00:31:22,470 --> 00:31:26,161
We operate in a large number of markets.

766
00:31:26,161 --> 00:31:28,680
Some of them, and the
vast majority of them,

767
00:31:28,680 --> 00:31:30,693
for example, can adapt AWS.

768
00:31:32,130 --> 00:31:35,580
But there's other ones, for
example, where we cannot.

769
00:31:35,580 --> 00:31:36,923
So we need to make sure that we operate

770
00:31:36,923 --> 00:31:40,080
across multiple cloud providers.

771
00:31:40,080 --> 00:31:43,410
So for example, highly regulated markets

772
00:31:43,410 --> 00:31:48,000
that have debt residency
requirements like China

773
00:31:48,000 --> 00:31:49,260
where we cannot use AWS.

774
00:31:49,260 --> 00:31:51,660
Or markets like Egypt, for example,

775
00:31:51,660 --> 00:31:54,870
where we cannot use any
cloud providers yet.

776
00:31:54,870 --> 00:31:57,753
We have to make sure
that we port WAF rules

777
00:31:58,619 --> 00:32:02,790
and our WAF protection
across the entire state.

778
00:32:02,790 --> 00:32:06,900
We operate in a highly
regulated environment.

779
00:32:06,900 --> 00:32:11,900
Every downtime have to be
reported to regulators.

780
00:32:12,300 --> 00:32:14,460
So protecting the brand,

781
00:32:14,460 --> 00:32:16,410
protecting against DDoS attacks is

782
00:32:16,410 --> 00:32:20,913
really of the outmost importance.

783
00:32:20,913 --> 00:32:24,213
Maybe perhaps a few interesting anecdotes.

784
00:32:25,563 --> 00:32:27,899
There's markets, for example, when we own

785
00:32:27,899 --> 00:32:30,420
white label brands such as Marks & Spencer

786
00:32:30,420 --> 00:32:31,750
Money in the UK.

787
00:32:31,750 --> 00:32:34,170
In Asia Pacific, for example, we own

788
00:32:34,170 --> 00:32:37,590
competing brand that we
need to keep separation

789
00:32:37,590 --> 00:32:40,620
between them to meet
anti-competition laws.

790
00:32:40,620 --> 00:32:45,330
For example, Hang Seng Bank
versus Hong Kong Retail Bank.

791
00:32:45,330 --> 00:32:50,160
We own not only banking, but
insurance product as well.

792
00:32:50,160 --> 00:32:52,020
So all in all, ultimately it creates

793
00:32:52,020 --> 00:32:55,770
a fairly diverse traffic
pattern to our sites,

794
00:32:55,770 --> 00:32:57,750
which we obviously need
to take account for

795
00:32:57,750 --> 00:32:59,907
in our various WAF rules.

796
00:33:01,920 --> 00:33:04,350
We have a regulatory obligation to allow

797
00:33:04,350 --> 00:33:06,510
our customers to transact.

798
00:33:06,510 --> 00:33:08,580
If people can't access their money,

799
00:33:08,580 --> 00:33:11,670
it obviously erodes trust
in the financial industry,

800
00:33:11,670 --> 00:33:14,220
which regulators feel very strongly about.

801
00:33:14,220 --> 00:33:16,590
And of course, peak times tends to be in

802
00:33:16,590 --> 00:33:20,646
challenging times during
geopolitical tensions,

803
00:33:20,646 --> 00:33:22,230
during natural disasters,

804
00:33:22,230 --> 00:33:24,213
which makes it challenging as well.

805
00:33:26,370 --> 00:33:28,410
In terms of our team specifically,

806
00:33:28,410 --> 00:33:31,366
so as mentioned, we operate
in a large number of markets.

807
00:33:31,366 --> 00:33:34,590
We have multiple non production

808
00:33:34,590 --> 00:33:37,080
and production AWS account.

809
00:33:37,080 --> 00:33:39,330
We support many value streams.

810
00:33:39,330 --> 00:33:43,590
Each one of those value streams
have multiple applications.

811
00:33:43,590 --> 00:33:45,690
So if you do the math, it ultimately

812
00:33:45,690 --> 00:33:49,080
ends up being a huge, huge attack surface,

813
00:33:49,080 --> 00:33:51,030
which means that our WAF protections

814
00:33:51,030 --> 00:33:54,540
really have to be top-notch.

815
00:33:54,540 --> 00:33:59,010
We get hundreds of terabytes
worth of traffic each month.

816
00:33:59,010 --> 00:34:02,460
Billions upon billions of requests.

817
00:34:02,460 --> 00:34:05,220
We have hundreds of
CloudFront distributions,

818
00:34:05,220 --> 00:34:09,030
multiple web ACLs, and again,

819
00:34:09,030 --> 00:34:10,890
supporting multiple cloud providers.

820
00:34:10,890 --> 00:34:12,690
And unfortunately the reality is

821
00:34:12,690 --> 00:34:15,270
that we're literally under daily attacks.

822
00:34:15,270 --> 00:34:18,240
It's not something that
happens once in a blue moon.

823
00:34:18,240 --> 00:34:20,370
It's literally around the clock,

824
00:34:20,370 --> 00:34:22,863
there's some sort of an attack going on.

825
00:34:24,540 --> 00:34:25,950
I'm not gonna dwell on this slide too much

826
00:34:25,950 --> 00:34:27,300
'cause it's not, those challenge,

827
00:34:27,300 --> 00:34:29,250
banking challenges are not WAF specific,

828
00:34:29,250 --> 00:34:31,320
but it is interesting to know that we're

829
00:34:31,320 --> 00:34:34,530
seeing regulators more and
more interested in WAF.

830
00:34:34,530 --> 00:34:36,540
Not so much in the US, but more certainly

831
00:34:36,540 --> 00:34:38,097
in Europe from the European Central Bank.

832
00:34:38,097 --> 00:34:41,478
And in Asia Pacific, WAF is now

833
00:34:41,478 --> 00:34:44,640
a mandatory regulatory requirement.

834
00:34:44,640 --> 00:34:46,620
So it's quite interesting to see

835
00:34:46,620 --> 00:34:48,240
regulators getting involved and

836
00:34:48,240 --> 00:34:50,103
mandating the use of WAF.

837
00:34:51,643 --> 00:34:54,600
In terms of when the journey started,

838
00:34:54,600 --> 00:34:56,850
well, interesting enough also in

839
00:34:56,850 --> 00:34:58,673
Reinvent back in 2018, which coincided

840
00:34:58,673 --> 00:35:03,660
with the need to create
a new cloud platform.

841
00:35:03,660 --> 00:35:05,250
I was personally really inspired with

842
00:35:05,250 --> 00:35:06,960
all things serverless, so it was a

843
00:35:06,960 --> 00:35:08,730
personal crusade to try and do it

844
00:35:08,730 --> 00:35:12,210
completely serverlessly, which we did.

845
00:35:12,210 --> 00:35:14,580
Of course, the migration to cloud have

846
00:35:14,580 --> 00:35:17,160
taken longer than we anticipated.

847
00:35:17,160 --> 00:35:19,710
We're still operating in a
hybrid cloud environment,

848
00:35:19,710 --> 00:35:23,190
which requires special WAF considerations.

849
00:35:23,190 --> 00:35:25,230
The intention was to specifically

850
00:35:25,230 --> 00:35:27,801
shift security left to try and obstruct

851
00:35:27,801 --> 00:35:32,040
third party service
providers in our origins

852
00:35:32,040 --> 00:35:36,240
from sensitive security
tokens, making sure

853
00:35:36,240 --> 00:35:39,090
that we really make sure
that they don't have

854
00:35:39,090 --> 00:35:41,790
to worry about the edge protection.

855
00:35:41,790 --> 00:35:43,200
And this is something
that we're providing,

856
00:35:43,200 --> 00:35:45,210
and again, we're doing it all through

857
00:35:45,210 --> 00:35:47,583
compute at the edge,
completely serverlessly.

858
00:35:48,900 --> 00:35:51,900
So it is the architecture,
nothing too exotic, right?

859
00:35:51,900 --> 00:35:55,290
So SHIELD provides the
layer four mitigation,

860
00:35:55,290 --> 00:35:57,240
which passes request to CloudFront

861
00:35:57,240 --> 00:36:00,690
and of course WAF inspect the, the,

862
00:36:01,650 --> 00:36:03,451
the request, which if not blocked,

863
00:36:03,451 --> 00:36:05,160
passes it over to Lambda.

864
00:36:05,160 --> 00:36:07,560
So you can see there's
no EC2 reverse boxing.

865
00:36:07,560 --> 00:36:09,420
It's all done serverlessly.

866
00:36:09,420 --> 00:36:11,250
This predates CloudFront function.

867
00:36:11,250 --> 00:36:12,660
Ideally now, some of this we would

868
00:36:12,660 --> 00:36:14,760
migrate to CloudFront function.

869
00:36:14,760 --> 00:36:15,870
And the other thing to take away,

870
00:36:15,870 --> 00:36:18,630
that we are not protecting
just AWS origin.

871
00:36:18,630 --> 00:36:23,370
We created a generic, abstracted platform

872
00:36:23,370 --> 00:36:25,140
that provide protection to a wide

873
00:36:25,140 --> 00:36:27,366
variety of origins, specifically On Prem

874
00:36:27,366 --> 00:36:30,180
and even, even other cloud providers.

875
00:36:30,180 --> 00:36:33,273
So for example, some GCP based origins.

876
00:36:35,250 --> 00:36:36,510
Okay, some challenges.

877
00:36:36,510 --> 00:36:39,210
So one, it's an ever
evolving threat landscape.

878
00:36:39,210 --> 00:36:41,760
Back when we started, DDoS
was really not so much

879
00:36:41,760 --> 00:36:45,090
of a problem and if it
did, then AWS shield

880
00:36:45,090 --> 00:36:46,920
would mitigate the layer four type attacks

881
00:36:46,920 --> 00:36:48,420
and you get to claim credit without

882
00:36:48,420 --> 00:36:50,640
really having to do much for it, right?

883
00:36:50,640 --> 00:36:51,840
AWS shield would kick in, mitigate the

884
00:36:51,840 --> 00:36:53,790
attack and, and you're done.

885
00:36:53,790 --> 00:36:56,571
To layer seven attacks, right?

886
00:36:56,571 --> 00:36:59,970
Malicious attempts to your domain name

887
00:36:59,970 --> 00:37:02,494
slash ETC password, right?
Hoping to get lucky.

888
00:37:02,494 --> 00:37:06,870
To high volume attacks, which we in the

889
00:37:06,870 --> 00:37:09,870
industry responded with rate-based tools.

890
00:37:09,870 --> 00:37:14,870
To then of course, to
low and slow type attack.

891
00:37:15,090 --> 00:37:18,150
And of course, the concern
these days is agentic.

892
00:37:18,150 --> 00:37:20,640
So for example, if I have a genuine agent

893
00:37:20,640 --> 00:37:22,500
that I really, really want to transfer

894
00:37:22,500 --> 00:37:25,350
money on my behalf, how do I distinguish

895
00:37:25,350 --> 00:37:28,983
my legitimate agent
from a malicious agent?

896
00:37:30,360 --> 00:37:32,700
The reality is that unfortunately

897
00:37:32,700 --> 00:37:35,640
execs don't really understand WAF.

898
00:37:35,640 --> 00:37:37,380
The type, even if you're
not a tier one bank,

899
00:37:37,380 --> 00:37:38,670
the type of thing that your management

900
00:37:38,670 --> 00:37:41,797
have probably told you is things like,

901
00:37:41,797 --> 00:37:44,910
"Well make sure that, can you confirm that

902
00:37:44,910 --> 00:37:47,700
you're getting paged every
time we're under attack?"

903
00:37:47,700 --> 00:37:49,740
No, the team's never gonna get any sleep.

904
00:37:49,740 --> 00:37:51,360
We're constantly under attack.

905
00:37:51,360 --> 00:37:53,040
You want to get paged, for example,

906
00:37:53,040 --> 00:37:54,480
when the origin are suffering.

907
00:37:54,480 --> 00:37:57,222
When, when the origins are under duress.

908
00:37:57,222 --> 00:38:00,870
There's gonna be a
misconception, for example,

909
00:38:00,870 --> 00:38:03,900
that you invest in WAF
once and it's done, right?

910
00:38:03,900 --> 00:38:06,210
So whatever money I invested this year,

911
00:38:06,210 --> 00:38:08,250
I don't have to spend it again next year.

912
00:38:08,250 --> 00:38:10,320
No, the reality is that you have to

913
00:38:10,320 --> 00:38:11,897
continuously invent,
you continuously have to

914
00:38:11,897 --> 00:38:14,490
make sure that you enhance WAF

915
00:38:14,490 --> 00:38:17,370
to protect against new threats.

916
00:38:17,370 --> 00:38:19,230
Specifically given the serverless nature

917
00:38:19,230 --> 00:38:21,330
of our platform, when there there,

918
00:38:21,330 --> 00:38:23,550
there were attacks that did breach

919
00:38:23,550 --> 00:38:25,861
our perimeters ... We got hit for example,

920
00:38:25,861 --> 00:38:29,040
for doing it serverlessly, right?

921
00:38:29,040 --> 00:38:31,170
Saying, "Well if you were to use EC2,

922
00:38:31,170 --> 00:38:32,280
you wouldn't have those issues.

923
00:38:32,280 --> 00:38:33,810
Why are you using Lambda?"

924
00:38:33,810 --> 00:38:36,240
And the key to take away is that no amount

925
00:38:36,240 --> 00:38:37,745
of compute in the world is gonna mitigate

926
00:38:37,745 --> 00:38:40,290
a really high volume DDoS attack, right?

927
00:38:40,290 --> 00:38:42,270
It's not about the compute that you use.

928
00:38:42,270 --> 00:38:43,931
The key is to have really strong

929
00:38:43,931 --> 00:38:46,950
WAF protection in place
to thwart the attacks.

930
00:38:46,950 --> 00:38:49,450
It's not about the compute
type that you're using.

931
00:38:50,520 --> 00:38:53,010
The other reality is that engineers or

932
00:38:53,010 --> 00:38:55,113
application teams don't
really understand WAF, right?

933
00:38:55,113 --> 00:38:57,000
It's not something that, unfortunately,

934
00:38:57,000 --> 00:38:58,560
they deal with on a daily basis, right?

935
00:38:58,560 --> 00:39:01,530
They probably understand
API gateway really well.

936
00:39:01,530 --> 00:39:04,830
Kubernetes, EC2. WAF, not really.

937
00:39:04,830 --> 00:39:06,420
Plus they're obviously under pressure

938
00:39:06,420 --> 00:39:09,270
to provide new business capabilities.

939
00:39:09,270 --> 00:39:11,610
WAF is probably not one of them.

940
00:39:11,610 --> 00:39:13,080
Cyber on the other hand, understand

941
00:39:13,080 --> 00:39:14,790
security really well, but don't really

942
00:39:14,790 --> 00:39:18,270
understand the applications
and how to protect them.

943
00:39:18,270 --> 00:39:19,770
And this is where our team comes in,

944
00:39:19,770 --> 00:39:21,930
to kind of try and bridge this gap

945
00:39:21,930 --> 00:39:24,450
between cyber and application team.

946
00:39:24,450 --> 00:39:27,600
We are in between trying
to bridge that gap.

947
00:39:27,600 --> 00:39:31,110
From an application perspective,

948
00:39:31,110 --> 00:39:34,171
if you're using AWS firewall manager,

949
00:39:34,171 --> 00:39:37,320
organizational policies like you should

950
00:39:37,320 --> 00:39:40,170
say, "Oh, I have 10 type rules."

951
00:39:40,170 --> 00:39:41,860
Then you have to think, how do I

952
00:39:42,806 --> 00:39:43,800
integrate applications specific,

953
00:39:43,800 --> 00:39:47,580
or AWS account specific rules

954
00:39:47,580 --> 00:39:49,380
into those policies?

955
00:39:49,380 --> 00:39:50,705
Do I do it at build time?
Do I do it at run time?

956
00:39:50,705 --> 00:39:53,163
There's some consideration there.

957
00:39:54,705 --> 00:39:57,897
AWS WAF, unfortunately, let's say like

958
00:39:57,897 --> 00:40:00,270
AWS gateway doesn't
have deployment stages.

959
00:40:00,270 --> 00:40:01,257
So you really have to think about,

960
00:40:01,257 --> 00:40:03,960
how am I gonna roll out my new rules?

961
00:40:03,960 --> 00:40:05,190
Maybe I've done a really good job

962
00:40:05,190 --> 00:40:07,560
consolidating into a single cloud fund

963
00:40:07,560 --> 00:40:10,523
distribution onto a single WAF web ACL.

964
00:40:10,523 --> 00:40:15,240
But if now you have one WAF rule that

965
00:40:15,240 --> 00:40:16,470
does something that it shouldn't,

966
00:40:16,470 --> 00:40:18,750
all of a sudden the
entire organization down.

967
00:40:18,750 --> 00:40:20,198
So you have to think,
am I gonna do it through

968
00:40:20,198 --> 00:40:23,419
blue green web ACLs that
I'm toggling between?

969
00:40:23,419 --> 00:40:26,430
Or maybe I just create artificially more

970
00:40:26,430 --> 00:40:30,240
web ACLs than I need to just minimize

971
00:40:30,240 --> 00:40:32,793
the blast radius for my organization.

972
00:40:35,190 --> 00:40:36,600
It's counterintuitive, but detecting

973
00:40:36,600 --> 00:40:39,000
actual attacks can
actually be complicated.

974
00:40:39,000 --> 00:40:40,560
Maybe the business had a really, really

975
00:40:40,560 --> 00:40:42,060
successful campaign that they didn't

976
00:40:42,060 --> 00:40:44,460
notify you about and you're getting

977
00:40:44,460 --> 00:40:46,860
a lot of requests that
seems really distributed.

978
00:40:46,860 --> 00:40:51,510
Well, is it a genuine user's
traffic or is it an attack?

979
00:40:51,510 --> 00:40:53,105
So you have to think,
am I really gonna know

980
00:40:53,105 --> 00:40:57,009
when I'm being attacked,
or is it genuine traffic?

981
00:40:57,009 --> 00:41:00,270
If you're using the AWS managed

982
00:41:00,270 --> 00:41:01,770
WAF rules like you should,

983
00:41:01,770 --> 00:41:03,781
you have to think how do I tune them?

984
00:41:03,781 --> 00:41:08,610
For example, if you have an AWS WAF

985
00:41:08,610 --> 00:41:11,792
or stop 10 rule to
restrict a certain size,

986
00:41:11,792 --> 00:41:13,620
then what happens if all of a sudden

987
00:41:13,620 --> 00:41:15,780
one of your application
needs to be able to

988
00:41:15,780 --> 00:41:17,940
support a threshold higher than that?

989
00:41:17,940 --> 00:41:20,880
Say, for document uploads, for example.

990
00:41:20,880 --> 00:41:22,938
So you really want to be able to tune

991
00:41:22,938 --> 00:41:24,780
for that specific journey,

992
00:41:24,780 --> 00:41:26,610
for that specific application,

993
00:41:26,610 --> 00:41:28,650
to minimize the impact.

994
00:41:28,650 --> 00:41:30,990
And this tuning can take time.

995
00:41:30,990 --> 00:41:33,720
So here is a specific example

996
00:41:33,720 --> 00:41:37,020
for tuning an Amazon managed rule.

997
00:41:37,020 --> 00:41:38,760
It took us quite a bit of time,

998
00:41:38,760 --> 00:41:41,250
including support from AWS.

999
00:41:41,250 --> 00:41:44,280
I'm not gonna go through it line by line,

1000
00:41:44,280 --> 00:41:46,710
but you can see the the type of changes

1001
00:41:46,710 --> 00:41:48,420
that we needed to make, ranging from

1002
00:41:48,420 --> 00:41:52,050
application changes to the way in which

1003
00:41:52,050 --> 00:41:55,890
we're acquiring the AWS WAF tokens.

1004
00:41:55,890 --> 00:41:59,400
Some changes even on the AWS
side by the service team.

1005
00:41:59,400 --> 00:42:01,140
Shout out to the service team. Thank you.

1006
00:42:01,140 --> 00:42:03,120
Quite amazing agility where AWS have

1007
00:42:03,120 --> 00:42:05,250
rolled out some enhancement across

1008
00:42:05,250 --> 00:42:07,380
the entire state within a sprint.

1009
00:42:07,380 --> 00:42:11,040
So yeah, and agility that
we can definitely aspire to.

1010
00:42:11,040 --> 00:42:13,890
Eventually it was time well spent because

1011
00:42:13,890 --> 00:42:15,660
we were able to achieve the business

1012
00:42:15,660 --> 00:42:18,960
accepted level of false positive.

1013
00:42:18,960 --> 00:42:23,730
So don't be, don't be scared away from it.

1014
00:42:23,730 --> 00:42:25,980
It was ultimately, it allowed us

1015
00:42:25,980 --> 00:42:27,480
to create a cookie cutter report

1016
00:42:27,480 --> 00:42:30,510
across this two initial tuning

1017
00:42:30,510 --> 00:42:31,770
periods in those two markets.

1018
00:42:31,770 --> 00:42:33,090
We were able to then roll it out

1019
00:42:33,090 --> 00:42:35,553
successfully to the other 35 markets.

1020
00:42:37,110 --> 00:42:40,590
Some challenges on the WAF side.

1021
00:42:40,590 --> 00:42:42,480
So you really have to think
like Tzoori mentioned,

1022
00:42:42,480 --> 00:42:45,414
how do you protect your on premise origin?

1023
00:42:45,414 --> 00:42:49,230
Previously with VPC
origin for the AWS origin,

1024
00:42:49,230 --> 00:42:50,550
there used to be this restriction

1025
00:42:50,550 --> 00:42:51,690
that now is no longer there.

1026
00:42:51,690 --> 00:42:54,843
So we're excited to now roll it out wider.

1027
00:42:56,760 --> 00:42:58,650
VPC Origins don't, no longer need

1028
00:42:58,650 --> 00:43:01,113
to be within the same AWS
account as CloudFront.

1029
00:43:01,950 --> 00:43:03,450
If you're adding CloudFront distribution

1030
00:43:03,450 --> 00:43:05,940
from a regular basis, you need to remember

1031
00:43:05,940 --> 00:43:08,160
that they don't automatically enroll

1032
00:43:08,160 --> 00:43:11,100
in the shield advanced auto mitigation.

1033
00:43:11,100 --> 00:43:12,630
So if you're adding
CloudFront distribution,

1034
00:43:12,630 --> 00:43:14,550
you need to make sure that you are

1035
00:43:14,550 --> 00:43:16,920
enrolling them so that they're protected.

1036
00:43:16,920 --> 00:43:20,027
And actually, only recently realized that

1037
00:43:20,027 --> 00:43:24,945
while WAF can add custom labels,

1038
00:43:24,945 --> 00:43:28,680
while there's no triggers
for CloudFront function

1039
00:43:28,680 --> 00:43:31,057
for Lambda@Edge, WAF could in fact

1040
00:43:31,057 --> 00:43:33,420
inject headers as well, which then

1041
00:43:33,420 --> 00:43:35,880
you can do quite interesting things with,

1042
00:43:35,880 --> 00:43:38,160
within CloudFront
functions or Lambda@Edge.

1043
00:43:38,160 --> 00:43:40,383
So, quite useful.

1044
00:43:41,947 --> 00:43:45,567
We learned the hard way that at the time,

1045
00:43:45,567 --> 00:43:49,080
our logging solution was not scaling to

1046
00:43:49,080 --> 00:43:50,910
DDoS attack, so something that

1047
00:43:50,910 --> 00:43:52,440
you want to be thinking about.

1048
00:43:52,440 --> 00:43:55,230
I'm sure you have a
working logging solution,

1049
00:43:55,230 --> 00:43:57,030
but you want to make sure that

1050
00:43:57,030 --> 00:43:59,040
it can scale up during DDoS attack.

1051
00:43:59,040 --> 00:44:00,600
It's quite important, or else how are

1052
00:44:00,600 --> 00:44:03,210
you gonna analyze data can be able to add,

1053
00:44:03,210 --> 00:44:07,950
for example, JA4 based
rules to mitigate it?

1054
00:44:07,950 --> 00:44:10,800
Yes, CloudWatch logs insight is there,

1055
00:44:10,800 --> 00:44:12,570
but for our traffic we noticed that

1056
00:44:12,570 --> 00:44:15,390
you can have quite a bit
long running queries.

1057
00:44:15,390 --> 00:44:19,260
It's not the cheapest service.

1058
00:44:19,260 --> 00:44:20,757
So we, for example, exploring using

1059
00:44:20,757 --> 00:44:22,983
AWS OpenSearch instead.

1060
00:44:24,270 --> 00:44:27,390
Some final lesson
learned, and I appreciate

1061
00:44:27,390 --> 00:44:30,180
it's like saying sell
stocks high, buy them low.

1062
00:44:30,180 --> 00:44:32,190
But what I mean by protect against

1063
00:44:32,190 --> 00:44:34,110
tomorrow's attack, not yesterday,

1064
00:44:34,110 --> 00:44:36,120
have you added any new infrastructure?

1065
00:44:36,120 --> 00:44:37,740
Have you added any new applications?

1066
00:44:37,740 --> 00:44:40,050
Do application have new capabilities that

1067
00:44:40,050 --> 00:44:43,067
you really want to add
new WAF rules for them?

1068
00:44:43,067 --> 00:44:46,410
WAF does come with API,
if you're not aware,

1069
00:44:46,410 --> 00:44:47,880
the WAF automation framework.

1070
00:44:47,880 --> 00:44:50,940
So you can mine the logs for
interesting events, right?

1071
00:44:50,940 --> 00:44:54,610
If there's any IPs, for
example, that introducing

1072
00:44:55,710 --> 00:45:00,710
any 404, any extra or
large number of 500 errors,

1073
00:45:01,260 --> 00:45:02,700
why not automatically block them,

1074
00:45:02,700 --> 00:45:04,413
say, for 24 hours period?

1075
00:45:05,640 --> 00:45:08,070
Know who your TAMS and
solution architects are.

1076
00:45:08,070 --> 00:45:10,680
We derive tremendous value from them.

1077
00:45:10,680 --> 00:45:13,361
They can enroll you in IWS betas and,

1078
00:45:13,361 --> 00:45:16,560
and various previews.

1079
00:45:16,560 --> 00:45:20,580
Continue to invest in your
stock and your WAF team.

1080
00:45:20,580 --> 00:45:22,200
It's not something that, you're not

1081
00:45:22,200 --> 00:45:24,056
setting WAF and forget it.

1082
00:45:24,056 --> 00:45:25,560
It requires continuous investment.

1083
00:45:25,560 --> 00:45:29,490
And of course the AWS
SRT team is always there,

1084
00:45:29,490 --> 00:45:30,540
but you really want to be able

1085
00:45:30,540 --> 00:45:32,820
to independently analyze your log,

1086
00:45:32,820 --> 00:45:36,210
mine your logs, and be
able to add, for example,

1087
00:45:36,210 --> 00:45:39,993
JA4 fingerprint blocking rules yourself.

1088
00:45:40,953 --> 00:45:42,330
And yeah, automation is absolutely key.

1089
00:45:42,330 --> 00:45:43,650
You don't want to be
there at 2:00 AM in the

1090
00:45:43,650 --> 00:45:46,260
morning, figuring out how
to revert back a rule.

1091
00:45:46,260 --> 00:45:49,110
So automation is absolutely key.

1092
00:45:49,110 --> 00:45:49,943
In terms of what's coming up,

1093
00:45:49,943 --> 00:45:52,050
coming up for us next is to

1094
00:45:52,050 --> 00:45:53,430
ultimately capitalize on the

1095
00:45:53,430 --> 00:45:55,380
investment that we've made in WAF so far.

1096
00:45:55,380 --> 00:45:57,450
Making sure that we roll everything that

1097
00:45:57,450 --> 00:46:00,090
we have done and by consolidating our

1098
00:46:00,090 --> 00:46:03,060
various endpoints and
thousands upon thousands

1099
00:46:03,060 --> 00:46:05,400
of domains onto our top level domains so

1100
00:46:05,400 --> 00:46:07,440
that they can ultimately benefit from this

1101
00:46:07,440 --> 00:46:09,243
very protection that we spoke about.

1102
00:46:12,120 --> 00:46:13,240
Back to you, Tzoori.

1103
00:46:18,734 --> 00:46:19,567
- [Tzoori Tamam] Thanks, Dan.

1104
00:46:19,567 --> 00:46:22,140
And I, I know HSBC is a big bank.

1105
00:46:22,140 --> 00:46:24,540
A lot of the challenges they encountered

1106
00:46:24,540 --> 00:46:26,730
are not your challenges,
but learning from them

1107
00:46:26,730 --> 00:46:29,730
and seeing that it's
possible even at their scale,

1108
00:46:29,730 --> 00:46:32,520
to basically use WAF as a layer

1109
00:46:32,520 --> 00:46:35,340
to protect all of the
applications they have -

1110
00:46:35,340 --> 00:46:37,080
thousands and thousands of them -

1111
00:46:37,080 --> 00:46:38,370
is a really good practice.

1112
00:46:38,370 --> 00:46:41,490
Now, as the day grow, goes, grows long,

1113
00:46:41,490 --> 00:46:43,080
I tend to be more philosophical

1114
00:46:43,080 --> 00:46:44,820
and I want to look into the future

1115
00:46:44,820 --> 00:46:46,320
and see what else is possible.

1116
00:46:46,320 --> 00:46:47,910
As Dan said, we have to look ahead

1117
00:46:47,910 --> 00:46:49,500
when it comes to AWS WAF.

1118
00:46:49,500 --> 00:46:50,670
We can't be reactive.

1119
00:46:50,670 --> 00:46:53,850
We have to be proactive and be faster,

1120
00:46:53,850 --> 00:46:55,830
or at least as fast as the attackers

1121
00:46:55,830 --> 00:46:57,000
that look to harm us.

1122
00:46:57,000 --> 00:47:00,660
So practicing new rules, adding new rules,

1123
00:47:00,660 --> 00:47:03,110
configuring, tuning,
tightening the security.

1124
00:47:03,110 --> 00:47:05,490
I, I will talk about
three different things,

1125
00:47:05,490 --> 00:47:07,800
rushing through for the last few minutes.

1126
00:47:07,800 --> 00:47:09,750
Initially what's, we'll
talk about bot control,

1127
00:47:09,750 --> 00:47:11,910
we'll talk about layer seven protection,

1128
00:47:11,910 --> 00:47:15,183
and we'll talk about the
general use for new rules,

1129
00:47:15,183 --> 00:47:17,190
new, new custom rules
and new managed rules.

1130
00:47:17,190 --> 00:47:19,410
So when it comes to bot control, again,

1131
00:47:19,410 --> 00:47:21,810
my company completely
misunderstood what bot,

1132
00:47:21,810 --> 00:47:23,566
what bots really mean.

1133
00:47:23,566 --> 00:47:27,990
But for bot control, you
can use the managed rule

1134
00:47:27,990 --> 00:47:30,780
that we have to first identify

1135
00:47:30,780 --> 00:47:32,670
common bots for good and bad.

1136
00:47:32,670 --> 00:47:35,850
So specifically allowing in search engines

1137
00:47:35,850 --> 00:47:38,610
or SEO engines, that's an important thing.

1138
00:47:38,610 --> 00:47:41,070
That can be achieved with
the common bot control.

1139
00:47:41,070 --> 00:47:44,670
Or maybe blocking noisy health checkers

1140
00:47:44,670 --> 00:47:46,980
that come from the web, just because

1141
00:47:46,980 --> 00:47:48,210
they are self-identifying,

1142
00:47:48,210 --> 00:47:49,440
That's an easy thing you can do

1143
00:47:49,440 --> 00:47:50,703
with common bot control.

1144
00:47:52,110 --> 00:47:55,350
Detecting and, and finding the more

1145
00:47:55,350 --> 00:47:57,780
sophisticated bots, what
we call targeted bots.

1146
00:47:57,780 --> 00:47:59,550
The bots that were built in order

1147
00:47:59,550 --> 00:48:02,070
to specifically harm your application.

1148
00:48:02,070 --> 00:48:04,230
This is where we typically enable targeted

1149
00:48:04,230 --> 00:48:06,420
bot control, the next
level of bot control,

1150
00:48:06,420 --> 00:48:08,610
where we can track abnormal behaviors.

1151
00:48:08,610 --> 00:48:10,950
Not only a specific request, but looking

1152
00:48:10,950 --> 00:48:13,290
throughout the session lifetime and see

1153
00:48:13,290 --> 00:48:15,210
which sessions are more volumetric

1154
00:48:15,210 --> 00:48:17,700
or they differ, they differ dramatically

1155
00:48:17,700 --> 00:48:19,800
from normal user sessions.

1156
00:48:19,800 --> 00:48:22,020
So we can start challenging
them with a Captcha,

1157
00:48:22,020 --> 00:48:23,430
with a JavaScript challenge,

1158
00:48:23,430 --> 00:48:27,240
or just plainly blocking them if we see

1159
00:48:27,240 --> 00:48:29,640
that they're acting too suspiciously.

1160
00:48:29,640 --> 00:48:32,520
And now with the age of AI and AI bots,

1161
00:48:32,520 --> 00:48:34,410
a lot of your incoming traffic...

1162
00:48:34,410 --> 00:48:38,116
And when I say a lot,
sometimes more than 50%

1163
00:48:38,116 --> 00:48:42,540
of your incoming traffic might
be generated by AI agents.

1164
00:48:42,540 --> 00:48:44,700
Some of them benign,
some of them not so much.

1165
00:48:44,700 --> 00:48:46,680
All of them very noisy, and you have to

1166
00:48:46,680 --> 00:48:49,470
make sure that you're only
allowing the good ones in.

1167
00:48:49,470 --> 00:48:52,110
So by utilizing bot control, make sure

1168
00:48:52,110 --> 00:48:53,550
that you upgrade to the latest

1169
00:48:53,550 --> 00:48:55,710
version of bot control, version four.

1170
00:48:55,710 --> 00:48:58,393
You can now use Web Auth-, Web Bot Auth,

1171
00:48:58,393 --> 00:49:00,810
it's a mouthful, to make sure that

1172
00:49:00,810 --> 00:49:02,862
only the allow agents, the allowed,

1173
00:49:02,862 --> 00:49:06,960
the verified agents are allowed into

1174
00:49:06,960 --> 00:49:08,880
your application and all other agents

1175
00:49:08,880 --> 00:49:10,680
probably should somehow register

1176
00:49:10,680 --> 00:49:12,877
and verify with this.

1177
00:49:12,877 --> 00:49:15,390
It's not, not yet a standard,

1178
00:49:15,390 --> 00:49:18,690
but this is the mechanism
most WAF providers

1179
00:49:18,690 --> 00:49:21,750
and agent registries used to make sure

1180
00:49:21,750 --> 00:49:24,213
that only good bots are
being allowed through.

1181
00:49:25,350 --> 00:49:27,000
Where it comes to layer seven DDoS,

1182
00:49:27,000 --> 00:49:28,380
again, this is kind of a new rule,

1183
00:49:28,380 --> 00:49:29,760
so if you don't, if you're not aware

1184
00:49:29,760 --> 00:49:32,970
or are not familiar with
it, be familiar with it.

1185
00:49:32,970 --> 00:49:35,430
There will be a QR card,
a QR code at the end.

1186
00:49:35,430 --> 00:49:37,890
You can scan and learn more about it.

1187
00:49:37,890 --> 00:49:41,070
But by enabling the
essentials pack, we got this,

1188
00:49:41,070 --> 00:49:46,020
we got this included in
the business pricing plan

1189
00:49:46,020 --> 00:49:47,310
and we can start using it.

1190
00:49:47,310 --> 00:49:51,270
It was created with the
override check enabled.

1191
00:49:51,270 --> 00:49:53,040
So once we saw in the dashboard...

1192
00:49:53,040 --> 00:49:55,320
There's a specific dashboard for DDoS.

1193
00:49:55,320 --> 00:49:58,140
Once we saw it causes
no false positives...

1194
00:49:58,140 --> 00:50:01,320
And it doesn't, it's a
very safe rule to use.

1195
00:50:01,320 --> 00:50:04,170
You can just check off this box

1196
00:50:04,170 --> 00:50:07,230
and see that it only
acts during DDoS attacks.

1197
00:50:07,230 --> 00:50:09,720
It's super silent, it's doing nothing

1198
00:50:09,720 --> 00:50:11,790
during peace times, but only when

1199
00:50:11,790 --> 00:50:13,558
there is an actual event, it starts

1200
00:50:13,558 --> 00:50:16,830
targeting the offensive actors,

1201
00:50:16,830 --> 00:50:19,380
be it specific IP addresses, or countries,

1202
00:50:19,380 --> 00:50:21,060
or AS numbers, or user agents,

1203
00:50:21,060 --> 00:50:22,770
or, or fingerprints.

1204
00:50:22,770 --> 00:50:26,250
And only those will get this challenge or

1205
00:50:26,250 --> 00:50:29,280
eventually get blocked if
they, if they don't behave.

1206
00:50:29,280 --> 00:50:31,361
So make sure that you use that

1207
00:50:31,361 --> 00:50:34,743
super important, very powerful tool.

1208
00:50:36,090 --> 00:50:38,130
Where, when it comes to evolving your WAF,

1209
00:50:38,130 --> 00:50:40,890
so adding new rules, so make sure

1210
00:50:40,890 --> 00:50:42,630
that you track your traffic.

1211
00:50:42,630 --> 00:50:44,610
Traffic changes, right?

1212
00:50:44,610 --> 00:50:48,780
You can maybe go viral, see more traffic.

1213
00:50:48,780 --> 00:50:50,700
You might go viral in a bad way,

1214
00:50:50,700 --> 00:50:53,340
where attackers look out to harm you.

1215
00:50:53,340 --> 00:50:55,650
So make sure that you keep track of all of

1216
00:50:55,650 --> 00:50:57,420
the traffic, not only
the one that you block.

1217
00:50:57,420 --> 00:50:58,703
Only, also the ones that you are,

1218
00:50:58,703 --> 00:51:01,953
you are being allowed in,
that is being allowed in.

1219
00:51:01,953 --> 00:51:04,290
Are different rules being hit?

1220
00:51:04,290 --> 00:51:05,670
Are different rules not being,

1221
00:51:05,670 --> 00:51:06,750
being hit all of a sudden?

1222
00:51:06,750 --> 00:51:07,890
Maybe we're missing something.

1223
00:51:07,890 --> 00:51:10,440
Maybe some attacker evolved and now

1224
00:51:10,440 --> 00:51:11,790
we're not finding them anymore.

1225
00:51:11,790 --> 00:51:15,390
So make sure that you
track traffic all the time.

1226
00:51:15,390 --> 00:51:17,880
On the flip side though, strike the

1227
00:51:17,880 --> 00:51:21,570
right balance between a secure policy

1228
00:51:21,570 --> 00:51:24,300
and a manageable policy, right?

1229
00:51:24,300 --> 00:51:26,940
The most secure computer
is locked in a safe,

1230
00:51:26,940 --> 00:51:30,240
disconnected from the
world. That's not usable.

1231
00:51:30,240 --> 00:51:31,860
So strike the right balance for you.

1232
00:51:31,860 --> 00:51:33,240
I don't know how much time you have to

1233
00:51:33,240 --> 00:51:36,390
invest in WAF, but it is
an investment in time.

1234
00:51:36,390 --> 00:51:38,970
So add the rules that you
get the most value out of.

1235
00:51:38,970 --> 00:51:40,500
Even if it's not the perfect

1236
00:51:40,500 --> 00:51:42,510
WAF policy, that's good enough.

1237
00:51:42,510 --> 00:51:46,320
The best WAF policy is the
one that you can manage,

1238
00:51:46,320 --> 00:51:48,180
Otherwise, you'll just turn it off and

1239
00:51:48,180 --> 00:51:50,160
do nothing with it, which is way worse.

1240
00:51:50,160 --> 00:51:52,590
So strike the right balance, tighten the

1241
00:51:52,590 --> 00:51:55,020
right rules, make sure that the, the,

1242
00:51:55,020 --> 00:51:57,060
the rate based rule that you encountered

1243
00:51:57,060 --> 00:51:59,880
or introduce into the
policy, not only track

1244
00:51:59,880 --> 00:52:02,040
IP addresses, but also track

1245
00:52:02,040 --> 00:52:04,500
fingerprints, methods, labels.

1246
00:52:04,500 --> 00:52:09,500
Again, make, make full use
of what WAF has to offer.

1247
00:52:09,570 --> 00:52:11,400
And this is an ongoing effort.

1248
00:52:11,400 --> 00:52:13,860
You make WAF tighter
and tighter and tighter

1249
00:52:13,860 --> 00:52:15,270
as the attacker become more

1250
00:52:15,270 --> 00:52:16,870
and more and more sophisticated.

1251
00:52:18,900 --> 00:52:20,430
Another good practice is to maintain

1252
00:52:20,430 --> 00:52:23,340
a staging environment.
Dan mentioned it a bit.

1253
00:52:23,340 --> 00:52:26,850
Keep track of your changes,
roll them out gradually.

1254
00:52:26,850 --> 00:52:27,870
Make sure that you are, you,

1255
00:52:27,870 --> 00:52:30,450
you expect what they will be doing

1256
00:52:30,450 --> 00:52:33,324
if you're launching them into production.

1257
00:52:33,324 --> 00:52:36,210
Build your label logic in a way

1258
00:52:36,210 --> 00:52:39,780
that allows you to test it out

1259
00:52:39,780 --> 00:52:41,550
in your staging environments, right?

1260
00:52:41,550 --> 00:52:43,890
If you have the luxury of it, great.

1261
00:52:43,890 --> 00:52:47,308
In some scenarios you can
even add the same rules

1262
00:52:47,308 --> 00:52:49,050
to the same... Oh, sorry.

1263
00:52:49,050 --> 00:52:52,200
Add new rules to the same
policy, in count mode.

1264
00:52:52,200 --> 00:52:55,260
Even managed rules, you
can add multiples of them

1265
00:52:55,260 --> 00:52:57,540
and make sure and seeing
your production traffic,

1266
00:52:57,540 --> 00:53:00,300
how they would've behaved were they in

1267
00:53:00,300 --> 00:53:01,920
blocking mode and not in count mode.

1268
00:53:01,920 --> 00:53:04,080
So if you don't have the capacity to

1269
00:53:04,080 --> 00:53:06,690
run a full staging
environment, at least do that.

1270
00:53:06,690 --> 00:53:08,700
Add multiple versions of the same rule

1271
00:53:08,700 --> 00:53:11,790
into the policy with
different actions on them,

1272
00:53:11,790 --> 00:53:14,160
order them correctly and
see what would happen

1273
00:53:14,160 --> 00:53:17,280
if you switch a, a rule into block.

1274
00:53:17,280 --> 00:53:18,963
Again, labels are your friends.

1275
00:53:20,940 --> 00:53:23,100
And lastly, remember AWS WAF

1276
00:53:23,100 --> 00:53:26,070
configurations are code, right?

1277
00:53:26,070 --> 00:53:27,930
If you look at the WAF console,

1278
00:53:27,930 --> 00:53:30,840
there is this JSON button up there.

1279
00:53:30,840 --> 00:53:32,160
The entire WAF configuration

1280
00:53:32,160 --> 00:53:34,350
is just a JSON document, right?

1281
00:53:34,350 --> 00:53:37,367
So use it, use this power, use the API

1282
00:53:37,367 --> 00:53:40,980
that a WAF provides to automate.

1283
00:53:40,980 --> 00:53:43,410
Use infrastructure as code tooling.

1284
00:53:43,410 --> 00:53:45,030
It allows for better versionings,

1285
00:53:45,030 --> 00:53:47,777
better, better change management.

1286
00:53:47,777 --> 00:53:49,950
It allows for automation when

1287
00:53:49,950 --> 00:53:51,300
it comes to new deployments.

1288
00:53:51,300 --> 00:53:53,550
So if you have the resource to do it...

1289
00:53:53,550 --> 00:53:54,980
and with AI writing most of your

1290
00:53:54,980 --> 00:53:57,621
automations now, it's super simple

1291
00:53:57,621 --> 00:54:02,130
and it will save you
a lot of pain day 100.

1292
00:54:02,130 --> 00:54:04,080
Day one, everything is quick and dirty.

1293
00:54:04,080 --> 00:54:07,683
Day 100, probably we
should be doing better.

1294
00:54:09,240 --> 00:54:14,220
So the day is done, the
application is good for now.

1295
00:54:14,220 --> 00:54:15,900
Tomorrow's a new day, obviously.

1296
00:54:15,900 --> 00:54:17,820
And on the drive home, I'm reflecting

1297
00:54:17,820 --> 00:54:22,380
on the lessons learned
from this busy, busy day.

1298
00:54:22,380 --> 00:54:24,660
So we talked about architecture

1299
00:54:24,660 --> 00:54:26,670
and cloaking your origins.

1300
00:54:26,670 --> 00:54:29,940
We talked about a good
enough initial policy.

1301
00:54:29,940 --> 00:54:31,440
Build it however you want:

1302
00:54:31,440 --> 00:54:33,994
manually, with the pricing plan packages,

1303
00:54:33,994 --> 00:54:37,830
with the WAF configuration
protection packs, whatever.

1304
00:54:37,830 --> 00:54:41,250
But do something day one, right?

1305
00:54:41,250 --> 00:54:43,710
Even a policy with a
single rule in count mode

1306
00:54:43,710 --> 00:54:46,890
and logging is way better than no policy.

1307
00:54:46,890 --> 00:54:48,810
At least you get visibility.

1308
00:54:48,810 --> 00:54:50,640
Do the one thing you know you can

1309
00:54:50,640 --> 00:54:52,503
manage and then grow from there.

1310
00:54:53,730 --> 00:54:55,710
But make sure you do follow up,

1311
00:54:55,710 --> 00:54:59,070
and do follow up quickly and repeatedly.

1312
00:54:59,070 --> 00:55:00,600
The web is a bad place, right?

1313
00:55:00,600 --> 00:55:02,610
So I'm not here to scare you, I'm just

1314
00:55:02,610 --> 00:55:05,790
here to show that WAF
is an ongoing effort.

1315
00:55:05,790 --> 00:55:08,463
And I've been doing WAF
for too many years now.

1316
00:55:09,990 --> 00:55:12,060
Utilizing new pricing plans.

1317
00:55:12,060 --> 00:55:15,300
Super prediction, predictable, super easy.

1318
00:55:15,300 --> 00:55:17,670
They contain a bunch of value in them

1319
00:55:17,670 --> 00:55:19,923
for a, for a fixed price.

1320
00:55:20,910 --> 00:55:22,500
Make sure that your WAF configurations

1321
00:55:22,500 --> 00:55:25,260
are evolving as attackers will evolve.

1322
00:55:25,260 --> 00:55:27,480
So make sure that you introduce new rules,

1323
00:55:27,480 --> 00:55:30,000
upgrade your rule versions if,

1324
00:55:30,000 --> 00:55:31,650
if there are managed rules.

1325
00:55:31,650 --> 00:55:34,020
Keep on testing, keep on viewing the logs,

1326
00:55:34,020 --> 00:55:35,787
keep on looking for what changed

1327
00:55:35,787 --> 00:55:38,070
in traffic, in rule hits.

1328
00:55:38,070 --> 00:55:40,530
What rules are, what,
what rules are being hit,

1329
00:55:40,530 --> 00:55:45,120
what rules are being
missed, right? As important.

1330
00:55:45,120 --> 00:55:48,870
And automate and test your
changes if you can, right?

1331
00:55:48,870 --> 00:55:51,360
So it's a, it's a repeated,
it's a repeatable,

1332
00:55:51,360 --> 00:55:54,359
predictable, easily rolled back process.

1333
00:55:54,359 --> 00:55:58,023
WAF configurations are
code, treat them like code.

1334
00:55:59,070 --> 00:56:01,650
Now I promised three QR codes.

1335
00:56:01,650 --> 00:56:04,087
Don't scan them, take a picture of it.

1336
00:56:04,087 --> 00:56:07,980
One will be a blog about the
new flat rate pricing plans.

1337
00:56:07,980 --> 00:56:10,260
It's new, so we'll learn about them.

1338
00:56:10,260 --> 00:56:12,270
We didn't cover a lot in depth about them,

1339
00:56:12,270 --> 00:56:14,040
but they're super useful.

1340
00:56:14,040 --> 00:56:17,878
And these two other QR codes deal with

1341
00:56:17,878 --> 00:56:20,220
layer seven DDoS mitigation

1342
00:56:20,220 --> 00:56:22,110
with our new managed rule.

1343
00:56:22,110 --> 00:56:24,270
So the one blog is a launch blog,

1344
00:56:24,270 --> 00:56:27,390
the middle one, and the right hand side...

1345
00:56:27,390 --> 00:56:30,000
Your, yeah, right hand side, is more

1346
00:56:30,000 --> 00:56:31,587
of a deep dive into how to configure it

1347
00:56:31,587 --> 00:56:33,783
and how to tune it if you need to.

1348
00:56:34,650 --> 00:56:38,400
And with that, I really
appreciate your time.

1349
00:56:38,400 --> 00:56:41,217
I know it's a, you know,
busy hour, long day.

1350
00:56:41,217 --> 00:56:44,970
Some of you're still jet lagged or worse.

1351
00:56:44,970 --> 00:56:46,350
So thank you for your time.

1352
00:56:46,350 --> 00:56:47,850
We would really appreciate the feedback

1353
00:56:47,850 --> 00:56:49,230
if you can leave it in the app.

1354
00:56:49,230 --> 00:56:51,600
And have a great rest of the week.

1355
00:56:51,600 --> 00:56:52,792
Thank you all.

1356
00:56:52,792 --> 00:56:54,894
(applause)

