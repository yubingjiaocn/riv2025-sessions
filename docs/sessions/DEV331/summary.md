# AWS re:Invent 2025 - 使用 Kira、MCP 和 Agent Core 构建 AI 代理

## 会议概述

本次 AWS re:Invent 2025 的 300 级技术分会探讨了如何使用 Amazon Bedrock Agent Core、Kira IDE 和模型上下文协议(MCP)构建 AI 代理系统。演讲者 Eric Henchin 和 Dwan Lightfoot(均为 AWS 高级开发者倡导者)详细介绍了 AI 代理的核心概念、部署架构以及实际开发流程。

会议重点展示了 Agent Core 如何解决代理部署中的"无差异化繁重工作",包括安全隔离运行时、上下文记忆管理、身份验证、工具管理和可观测性等挑战。演讲者通过一个食物追踪应用的实际演示,展示了如何构建多层代理系统,其中包括前端应用、食物追踪代理、配方代理服务器,以及通过 MCP 服务器连接的配方和营养成分数据源。

Kira IDE 作为 AWS 新推出的代理式集成开发环境,在会议中被重点介绍。它支持规范驱动开发(Spec Mode)和快速开发(Vibe Mode)两种模式,并原生集成 MCP 服务器支持。会议还宣布了当天刚发布的 Kira Powers 功能,允许开发者添加 MCP 服务器、引导文件和更多上下文信息,其中包括专门为 Agent Core 设计的 Kira Power。

## 详细时间线

### 开场与介绍 (00:00 - 03:30)
- **00:00** - 会议开始,演讲者欢迎参会者并介绍今天的主题:使用 Kira、MCP 和 Agent Core 构建 AI 代理
- **00:30** - 现场调查:少数人使用过 Agent Core,更多人使用过 Kira,大多数人使用过 MCP 服务器
- **01:00** - 说明这是 300 级技术讲座,将包含深入的代码演示
- **01:30** - 介绍会议议程:AI 代理定义、Agent Core 深入讲解、Kira 介绍、MCP 概述和实际演示
- **02:30** - 演讲者自我介绍:Eric Henchin 和 Dwan Lightfoot,均为 AWS 开发者倡导者

### AI 代理基础概念 (03:30 - 08:00)
- **03:30** - Dwan 开始讲解 AI 代理的定义
- **04:00** - AWS 对代理的定义:利用 AI 进行推理、规划并代表人类采取行动以实现目标的自主系统
- **04:30** - 强调三个关键要素:推理能力、软件系统、计算和存储需求
- **05:00** - 回顾生成式 AI 的演进历程:从 2022 年 11 月 ChatGPT 发布开始
- **05:30** - 分享个人经历:2023 年初使用 AI 总结博客文章,当时上下文窗口仅 8,192 tokens
- **06:00** - 技术演进:从分块总结到 RAG,再到工具调用和函数调用
- **06:30** - 2024 年出现代理框架,支持记忆维护和多代理系统
- **07:00** - 解释代理的组成:核心是 LLM,配合 API/工具访问、短期和长期记忆
- **07:30** - 强调现有软件开发知识在构建代理时仍然重要

### Agent Core 深入讲解 (08:00 - 15:30)
- **08:00** - 介绍代理部署面临的挑战:安全隔离运行时、上下文记忆、身份验证、工具管理和可观测性
- **08:30** - 引入 Agent Core 作为解决"无差异化繁重工作"的方案
- **09:00** - Runtime(运行时):支持任何框架(LangGraph、LangChain、Strands Agents、Claude Agents SDK 等)和任何模型
- **09:30** - Runtime 支持 MCP 服务器,工作负载最长可运行 8 小时,采用无服务器架构
- **10:00** - Memory(记忆):支持短期记忆(聊天消息和用户状态)和长期记忆
- **10:30** - 记忆策略:自动提取信息,支持语义搜索、用户偏好、摘要或自定义策略
- **11:00** - Gateway(网关):为现有 API(OpenAPI、Smithy)和 Lambda 函数创建经过身份验证的 MCP 连接
- **11:30** - Gateway 支持出站连接的身份验证,可连接第三方 API 和 JWT tokens
- **12:00** - 语义搜索功能:解决 MCP 服务器工具过多导致的性能和成本问题,仅在需要时提供相关工具
- **12:30** - Identity(身份):管理谁可以访问代理以及代理可以访问什么(机器对机器通信)
- **13:00** - Browser(浏览器):支持网络搜索功能
- **13:30** - Code Interpreter(代码解释器):提供安全隔离环境来卸载代码执行,处理计算密集型工作负载
- **14:00** - Observability(可观测性):与 CloudWatch 的 GenAI 可观测性完全集成,支持导出到 OpenTelemetry
- **14:30** - 支持与 LangFuse 或 Datadog 等第三方工具集成
- **15:00** - Evaluations(评估):强调从一开始就构建可观测性,测量指标、延迟、工具使用和成本

### Agent Core 组件详解 (15:30 - 18:00)
- **15:30** - Runtime 部署方式:Docker 容器或 ZIP 文件(类似 Lambda)
- **16:00** - 可使用 Agent Core Starter Kit,几行代码即可将代理部署到运行时
- **16:30** - Memory 详解:短期记忆存储聊天消息,自动提取信息到长期记忆
- **17:00** - 策略示例:创建自定义策略来记住搜索过的博客文章
- **17:30** - Gateway 详解:将现有 API 和 Lambda 函数暴露为 MCP 服务器

### Kira IDE 介绍 (18:00 - 22:00)
- **18:00** - Eric 介绍 Kira,AWS 新推出的代理式 IDE
- **18:30** - Kira 几个月前进入预览版,几周前正式发布 GA 版本
- **19:00** - 预览期间获得数十万次下载,反响热烈
- **19:30** - 强调 Kira 不是"AWS Kira"或"Bedrock Kira",而是独立产品,支持社交登录,无需 AWS 账户
- **20:00** - Spec Mode(规范模式):规范驱动开发,创建需求文档、设计文档和任务列表
- **20:30** - Vibe Mode(快速模式):直接解决问题,无需详细规范
- **21:00** - Dwan 解释区别:Spec Mode 像架构师创建高层验证设计,Vibe Mode 是直接解决问题
- **21:30** - Spec Mode 在构建复杂功能时更准确、更快速

### MCP 集成与 Kira Powers (22:00 - 25:00)
- **22:00** - Kira 支持添加本地或远程 MCP 服务器
- **22:30** - 宣布 Kira Powers:当天刚发布的新功能,可添加 MCP 服务器、引导文件和更多上下文
- **23:00** - Kira Powers 与多个合作伙伴一起发布,包括 Agent Core
- **23:30** - 可在 kira.dev 网站安装 Agent Core Kira Power
- **24:00** - AWS 提供多个 MCP 服务器:通用文档 MCP 服务器和 Agent Core 专用 MCP 服务器
- **24:30** - 推荐使用 AWS 文档 MCP 服务器和 Bedrock Agent Core MCP 服务器

### 架构概览 (25:00 - 28:00)
- **25:00** - 展示高层架构图:可观测性贯穿整个系统
- **25:30** - 前端连接到食物追踪代理
- **26:00** - 多层代理架构:食物追踪代理作为主代理,配方代理作为 MCP 服务器充当协调器
- **26:30** - 配方代理连接两个 MCP 服务器:配方服务器 MCP 和营养成分 MCP
- **27:00** - 营养成分服务器使用 Agent Core Gateway
- **27:30** - 提到可以使用语义搜索,但演示中未使用(因为工具数量较少)

### 详细架构流程 (28:00 - 30:00)
- **28:00** - 展示详细架构图,说明数据流向
- **28:30** - 用户 → 前端(React/Vue.js)→ 食物追踪代理
- **29:00** - 食物追踪代理作为前端网关,以友好自然的方式交互
- **29:30** - 配方代理服务器作为协调器,格式化来自 MCP 服务器的数据
- **30:00** - 使用 Amazon Bedrock(Anthropic 模型和 Nova 模型)

### 实际演示准备 (30:00 - 33:00)
- **30:00** - 准备进入代码演示环节
- **30:30** - 邀请观众提问
- **31:00** - 问题 1:Kira IDE 与 VS Code 中的 Q CLI 扩展有什么区别?
- **31:30** - 回答:Q CLI 更新后变成 Kira CLI,Q 不会消失但重点转向 Kira
- **32:00** - Transform 功能已独立为单独服务
- **32:30** - 问题 2:如何在 Agent Core 中设置长期和短期记忆?是否使用更多 tokens?
- **33:00** - 回答:可通过 Boto3 或 CDK 配置记忆策略,包括摘要、用户偏好、事实等

### Kira IDE 界面演示 (33:00 - 38:00)
- **33:00** - 打开 Kira IDE,基于 VS Code
- **33:30** - 左侧有幽灵图标(Kira 吉祥物),点击可访问 Kira 特定功能
- **34:00** - Agent Hooks(代理钩子):在特定操作时运行代理,如保存文件时更新文档
- **34:30** - Steering Files(引导文件):类似其他 IDE 的规则文件,添加到上下文中
- **35:00** - 演示创建的 Agent Core 引导文件,包含 CDK 最佳实践
- **35:30** - 可为项目生成 Kira 引导文件,自动识别现有项目结构
- **36:00** - Spec-driven Development(规范驱动开发):创建需求文档(EARS 格式)
- **36:30** - 包含介绍、术语表、需求和验收标准
- **37:00** - 可通过设计和任务列表让 Kira 构建应用
- **37:30** - 演示中混合使用了 Spec Mode 和 Vibe Mode

### MCP 服务器配置 (38:00 - 41:00)
- **38:00** - 展示配置的四个 MCP 服务器
- **38:30** - Contact 7:推荐给 MCP 初学者,包含数百个文档
- **39:00** - AWS 文档 MCP 服务器:最常用的综合服务器,包含所有 AWS 文档和 GitHub 仓库
- **39:30** - Bedrock Agent Core MCP 服务器:专门为 Agent Core 设计,强烈推荐
- **40:00** - Brave Search:用于网络搜索
- **40:30** - Dwan 补充:Kira 本身是代理式工具,添加 MCP 服务器可提供额外信息
- **41:00** - 强调 MCP 服务器帮助代理编写正确的代码,而不是编造抽象或错误实现

### MCP 服务器最佳实践 (41:00 - 43:00)
- **41:00** - Dwan 警告:构建自己的代理时不要添加太多 MCP 服务器
- **41:30** - 建议构建专门化代理,只提供完成任务所需的工具
- **42:00** - 工具和 MCP 服务器越多,成本越高,处理时间越长
- **42:30** - Eric 同意这是高级示例,实际应用应更精简
- **43:00** - 展示 Vibe Mode 和 Spec Mode 的聊天界面,支持多模态输入(包括图片)

### 代码结构介绍 (43:00 - 45:00)
- **43:00** - 在 Kira 中展示项目结构:后端和前端分离
- **43:30** - 前端使用 Vue.js,后端包含基础设施(使用 CDK)
- **44:00** - 决定从配方服务器开始讲解
- **44:30** - 使用 Python,推荐 Agent Core 开发使用 Python(最简单)
- **45:00** - 使用 Fast MCP 库,这是流行的 Python MCP 库

### 配方服务器代码演示 (45:00 - 48:00)
- **45:00** - 展示配方服务器代码,设置工具(MCP 的核心)
- **45:30** - 使用 JSON 文件存储配方数据(演示用途)
- **46:00** - 生产环境中应使用 RDS 或 S3 存储数据
- **46:30** - 每个配方包含:食材、说明、卡路里
- **47:00** - 暴露的工具:按难度获取配方、获取快速配方等
- **47:30** - 介绍 Model Context Protocol Inspector(MCP 检查器)
- **48:00** - 这是 MCP 基金会提供的开源工具,用于本地测试 MCP 服务器

### MCP Inspector 演示 (48:00 - 51:00)
- **48:00** - 使用 UV(Python 包管理器)运行配方服务器
- **48:30** - 在端口 8000 创建新的 MCP 服务器
- **49:00** - 运行 NPX 命令启动 Inspector
- **49:30** - 使用 Streamable HTTP 连接到本地服务器(172.0.0.1:8000)
- **50:00** - 展示 MCP 服务器的不同功能:资源、提示、工具、ping
- **50:30** - 测试"按菜系获取配方"工具,输入"pasta"
- **51:00** - 成功返回意大利面配方列表:经典意大利面、carbonara、beef stroganoff 等

### MCP 测试最佳实践 (51:00 - 52:30)
- **51:00** - 强调在部署前本地测试 MCP 服务器的重要性
- **51:30** - Inspector 是很好的本地测试工具
- **52:00** - 这个配方服务器将在 Agent Core Runtime 中运行
- **52:30** - 停止配方服务器(Ctrl+C)

### MCP 服务器构建讲解 (52:30 - 55:00)
- **52:30** - Dwan 询问有多少人在构建 MCP 服务器(少数人举手)
- **53:00** - 解释 MCP 服务器构建基础:@tool 装饰器标识工具
- **53:30** - 类型定义让 LLM 知道应传入的参数
- **54:00** - Docstring 非常重要:它会传递给代理/LLM,说明如何使用工具
- **54:30** - 所有信息被创建为 JSON schema 发送给 LLM
- **55:00** - 强调清晰定义的 docstring 对代理理解工具使用至关重要

### Lambda Gateway 演示 (55:00 - 58:00)
- **55:00** - 展示 Lambda 函数代码:标准的 Lambda handler
- **55:30** - 函数接收事件:food(食物)和 serving_size(份量)
- **56:00** - 返回食材列表,使用 JSON 文件查找营养信息
- **56:30** - 展示如何将现有 Lambda 函数转换为 MCP 服务器
- **57:00** - 不是魔法,需要额外步骤:在基础设施中定义
- **57:30** - 在 CDK 代码中定义 Agent Core Gateway
- **58:00** - 创建 food_tracker_gateway,指定名称和 IAM 配置

### Gateway Schema 定义 (58:00 - 60:00)
- **58:00** - 在 Gateway 中定义 schema,告诉 Agent Core Lambda 函数的结构
- **58:30** - Schema 定义 properties:food(字符串)和 serving_size(数字)
- **59:00** - 这些对应 Lambda 函数接收的事件参数
- **59:30** - Agent Core 使用此 schema 创建 MCP 服务器
- **60:00** - 所有部署到 Agent Core Runtime 的内容都由 IAM 支持,或可使用 Cognito 的 OAuth2

### 会议结束
- **60:00** - 演示继续(字幕在此处截断)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意:本摘要基于提供的字幕文本,涵盖了会议的主要内容和技术要点。时间戳为近似值,基于字幕中的时间标记。