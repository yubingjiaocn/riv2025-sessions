# AWS re:Invent 2025 NET 331 会议总结：AWS CloudWAN MCP 服务器

## 会议概述

本次会议由 Andy 和 Jose 主讲，主题是 AWS CloudWAN MCP（Model Context Protocol）服务器的开发与应用。会议采用互动形式，旨在展示如何利用 AI 代理和 MCP 服务器来简化复杂的 AWS 网络故障排查工作。

演讲者首先通过现场调查了解到，越来越多的参会者同时从事核心网络和 DevOps 工作，这种跨领域融合正在成为趋势。项目的起源来自于一个实际需求：Andy 需要对一个极其复杂的网络环境进行故障排查，该网络包含双核心网络、多区域部署、检查 VPC、网络功能组等众多组件。传统的故障排查方法（如 AWS 控制台点击操作、AWS CLI 脚本、Python Boto3 脚本）都存在各自的局限性，因此团队决定开发一个类似传统网络工程师常用的 traceroute 工具，但专门针对 AWS 云环境。

项目的核心理念是将复杂任务分解为更小的、可管理的子任务，使用 Python 脚本实现这些功能，并借助 AI 代理辅助编码，最终将这些离散的脚本整合到 MCP 服务器中。团队特别强调了一个关键设计决策：让 AI 代理和 LLM 负责决策制定，而不是将所有逻辑都构建在脚本中。MCP 工具应该返回信息给代理，由代理使用 LLM 来决定下一步操作，这样可以保持工具的灵活性和可扩展性。

## 详细时间线与关键要点

### 开场与背景介绍（00:00 - 05:30）
- **00:00** - 会议开始，Andy 介绍 NET 331 会议主题：AWS CloudWAN MCP 服务器
- **01:15** - 现场调查：了解参会者背景（核心网络工程师、DevOps 工程师、两者兼具）
- **02:30** - 观察到趋势：越来越多的人同时从事网络和 DevOps 工作
- **03:00** - 展示项目起源：一个极其复杂的网络环境（双核心网络、多区域、检查 VPC、网络功能组等）

### 项目动机与挑战（05:30 - 08:00）
- **05:30** - 描述故障排查的困难：非常耗时且容易出错
- **06:00** - 介绍使用的工具：咖啡、顽强的意志、生成式 AI 辅助、团队协作
- **06:45** - 强调协作的重要性：不同视角可以带来更好的解决方案
- **07:30** - 讨论传统方法的局限性：AWS 控制台（难以记忆和重复）、AWS CLI（脚本变得脆弱）、Python Boto3（需要开发技能）

### 战略目标与方法（08:00 - 11:00）
- **08:00** - 提出战略目标：创建类似 traceroute 的工具，用于 AWS 云环境
- **08:30** - 目标功能：显示从 A 到 B 的路径、路由信息、可能阻止连接的安全控制
- **09:00** - 方法论：将大任务分解为小任务
- **09:30** - 具体任务示例：查找全局网络、核心网络、路由表等
- **10:00** - 使用 Python Rich 库实现彩色输出
- **10:30** - 展示路由表信息的可视化输出

### AI 代理与 MCP 概念讲解（11:00 - 18:00）
- **11:00** - Jose 开始讲解 AI 代理的概念
- **11:30** - AI 代理定义：可以推理、规划并通过 LLM 完成目标的应用
- **12:00** - 代理循环（Agentic Loop）解释：输入 → LLM 推理 → 工具调用 → 结果返回 → 再次推理
- **13:00** - 示例：简单问题（如"什么是 IPv4 地址"）可直接回答，复杂问题需要调用工具
- **14:00** - MCP（Model Context Protocol）介绍：由 Anthropic 开发的开源协议
- **14:30** - MCP 作用：为 AI 模型连接外部数据源和工具提供标准化方式
- **15:00** - MCP 架构：客户端在 AI 代理中运行，连接到本地或远程的 MCP 服务器
- **16:00** - 现场调查：使用脚本管理 AWS 网络的人数 vs 使用 AI 管理网络的人数
- **17:00** - 脚本 vs AI 对比：脚本适合已知输出的场景，AI 适合复杂或未知的查询

### 演示环境介绍（18:00 - 20:00）
- **18:00** - 介绍演示环境：AWS CloudWAN 网络、两个 Transit Gateway、多个 VPC、AWS Network Firewall
- **19:00** - 准备进入代码演示环节
- **19:30** - 询问观众是否有问题

### 代码结构详解（20:00 - 30:00）
- **20:00** - 启动 Kira CLI 作为 AI 代理
- **20:30** - 加载两个 MCP 服务器：AWS Network MCP 和 AWS Knowledge MCP
- **21:00** - 切换到预定义代理，展示代理配置信息
- **21:30** - 查看可用工具列表
- **22:00** - 深入代码：展示 get_cloud_wan_details 工具的实现
- **22:30** - 解释工具参数：core_network_id（必需）、core_network_region（必需）、next_token（分页控制）、profile_name（账户切换）
- **24:00** - 强调描述字段的重要性：帮助 LLM 理解如何使用工具
- **25:00** - 工具文档字符串（docstring）：提供高层信息、使用场景、工作流建议
- **26:00** - 代码实现：使用 Boto3 库、区域切换、多个 API 调用的组合
- **27:00** - 设计选择：提高抽象级别，一个工具执行多个 API 调用
- **28:00** - 错误处理：捕获所有异常并返回给 LLM，让 LLM 决定下一步操作
- **29:00** - 返回值：核心网络策略、实时策略、附件信息

### 实时演示：列出核心网络（30:00 - 35:00）
- **30:00** - 演示开始：列出 US West 2 区域的核心网络
- **30:30** - 使用 list_core_networks 工具
- **31:00** - 结果显示：找到一个核心网络，包含基本信息（ID、状态）
- **31:30** - 请求更多详细信息
- **32:00** - 使用 get_cloud_wan_details 工具
- **32:30** - 详细结果展示：名称、ID、状态、核心网络策略、边缘位置、ASN 号码、段信息、网络功能组、VPC 附件
- **34:00** - 错误处理演示：使用无效的核心网络 ID
- **34:30** - LLM 返回友好的错误信息，建议使用有效的核心网络 ID

### 脚本 vs MCP 的设计决策（35:00 - 38:00）
- **35:00** - Andy 强调关键设计决策：使用 LLM 进行决策制定
- **35:30** - 避免将 MCP 变成巨大的脚本，所有逻辑都在脚本中
- **36:00** - 工具应返回信息给代理，由代理使用 LLM 决定下一步
- **36:30** - 这种方法在结果上有显著差异
- **37:00** - 解释为什么使用代理文件（Agent File）

### 代理文件的作用（38:00 - 41:00）
- **38:00** - 介绍代理文件：不改变 MCP 服务器的功能，但提供额外优势
- **38:30** - 代理文件的好处：稳定的角色定位（如网络工程师）、工具使用策略、引导性提示
- **39:00** - 代理文件的效果：上下文优先、工作流编排、知识和提示的专业化
- **40:00** - 使用代理文件可以获得更精确的输出格式
- **40:30** - 准备进入视频演示环节

### 实时创建 MCP 工具演示（41:00 - 48:00）
- **41:00** - 观众提问：工具是否为自定义视图
- **41:30** - Andy 解释：MCP 最初名为 CloudWAN MCP，后改名为 AWS Networking MCP
- **42:00** - 原因：工具涉及的技术范围超出 CloudWAN（包括 VPC、Network Firewall、Transit Gateway 等）
- **42:30** - 确认：核心网络工具是专门为 MCP 服务器编写的
- **43:00** - 介绍 MCP 服务器结构：包含多个专用工具
- **43:30** - 观众提问：代理文件是否开源
- **44:00** - 回答：已在多个代理上测试（Kira、Claude、VS Code 等）
- **44:30** - 开始实时演示：创建"查找 IP 地址"MCP 服务器
- **45:00** - 使用 Kira 生成 MCP 服务器代码
- **45:30** - Kira 创建工具和 JSON 配置文件
- **46:00** - 将新 MCP 添加到配置并测试
- **46:30** - 使用工具搜索 IP 地址（未指定区域）
- **47:00** - 工具使用并行异步函数搜索所有区域
- **47:30** - 结果显示：IP 地址、区域、ENI、子网、实例、IP 类型（私有）

### 工具设计讨论（48:00 - 52:00）
- **48:00** - 观众提问：是否推荐构建特定目标的工具 vs 通用工具
- **48:30** - Andy 回答：AWS Networking MCP 包含多个工具
- **49:00** - 两种方法：单一巨大的 server.py vs 逻辑分组并动态加载
- **49:30** - 团队选择：逻辑分组方法
- **50:00** - 工具设计原则：每个工具实现特定目的
- **50:30** - 示例：查找 IP 地址、查找核心网络、查找全局网络、查找 Network Firewall 策略
- **51:00** - 使用代理文件提供进一步指导
- **51:30** - 代理选择工具链来实现复杂目标

### Jose 补充说明（52:00 - 54:00）
- **52:00** - Jose 补充：避免创建过小或过大的工具
- **52:30** - 目标：在抽象级别上找到平衡
- **53:00** - 如果构建成脚本，就失去了使用 AI 的意义
- **53:30** - Andy 总结：利用 LLM 的智能处理大量数据

### 观众提问：输出定制（54:00 - 56:00）
- **54:00** - 观众提问：IP 地址工具的输出是否基于工具构建方式
- **54:30** - 如果想包含账户 ID，是否需要修改工具
- **55:00** - Andy 回答：如果信息在查找过程中可获得，会返回
- **55:30** - 如果信息与查找无关，则不会包含
- **56:00** - 强调：构建小型离散工具，使用代理/LLM 智能组合

### Markdown 和 Mermaid 图表的重要性（56:00 - 58:00）
- **56:00** - Andy 强调：使用 Markdown 报告和 Mermaid 图表
- **56:30** - 这不仅适用于 MCP，也适用于一般的代理使用
- **57:00** - Mermaid 图表可以使信息可视化
- **57:30** - 准备展示路径追踪演示

### 路径追踪演示（58:00 - 68:00）
- **58:00** - 开始路径追踪录制演示（已剪辑，去除思考时间）
- **58:30** - 演示命令：在两个 IP 地址之间提供路径追踪
- **59:00** - 强调：小型特定工具 + 代理智能 = 强大功能
- **59:30** - 工具逐跳分析网络路径
- **60:00** - 视频播放问题，切换到结果展示
- **60:30** - 请求生成 Markdown 报告和 Mermaid 图表
- **61:00** - 展示路径追踪报告
- **61:30** - Mermaid 图表显示完整路径，包括检查 VPC 和防火墙（带表情符号）
- **62:00** - 详细显示每一跳的组成
- **62:30** - 强调：返回路径同样重要（对称性检查）
- **63:00** - 报告包含云架构概览：段、网络功能组
- **63:30** - 显示路由表信息
- **64:00** - 安全控制分析：网络 ACL、防火墙检查 VPC、策略允许情况
- **64:30** - 识别潜在问题
- **65:00** - 显示安全组信息
- **65:30** - 提供连接矩阵
- **66:00** - 解释：调用多个离散工具，收集所有数据
- **66:30** - 使用数据创建 Markdown 报告和 Mermaid 图表
- **67:00** - 提供 CLI 工具命令用于验证
- **67:30** - 可以手动验证每一跳的信息

### 经验教训讨论（68:00 - 结束）
- **68:00** - 观众提问：试错过程中的关键经验教训
- **68:30** - Andy 幽默回应：开始时还有头发
- **69:00** - 准备分享关键经验（演讲在此处结束，未完整记录后续内容）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意：本次会议展示了如何使用 AI 代理和 MCP 服务器简化复杂的 AWS 网络故障排查工作。AWS Networking MCP 服务器已于演讲前一天在 GitHub AWS Labs 开源发布，参会者可以访问源代码并自行测试。