# AWS re:Invent 2025 会议总结：使用 AI Agent 改善可观测性

## 会议概述

本次会议探讨了如何利用 AWS 的 AI Agent 工具来改善应用程序的可观测性态势，避免凌晨 3 点被生产环境故障叫醒的困境。演讲者 Kevin 和 Andrea 通过实际代码演示，展示了如何构建一个智能可观测性代理，该代理能够自动分析 AWS 基础设施、发现问题、创建告警，并生成可操作的建议报告。

会议的核心观点是：可观测性领域的问题已经从"数据不足"转变为"数据过载"。随着 OpenTelemetry 和 CloudWatch 等工具的普及，生成可观测性数据变得非常容易，但快速解决问题却变得更加困难。AI Agent 正是解决这一问题的理想方案，它能够处理大量结构化数据，并将其转化为自然语言的可操作建议。

演讲者使用了一个宠物领养网站（Pet Adoption Clinic）作为示例应用，展示了如何通过 Strands Agent SDK 和 MCP（Model Context Protocol）工具构建一个功能完整的可观测性代理。该代理能够自动发现资源、分析指标、检测安全扫描、创建告警，并生成包含即时行动、短期改进和长期优化建议的 HTML 报告。

## 详细时间线与关键要点

### 开场与问题定义 (0:00 - 3:30)
- **0:00** - 演讲者通过提问开场：有多少人曾在凌晨 3 点被叫醒查看生产环境日志？
- **0:45** - 介绍演讲者：Kevin 和 Andrea，强调这是一场代码演示会议
- **1:15** - Kevin 分享在 AWS 从事可观测性工作 7 年的经验
- **1:45** - 核心问题转变：从"缺少数据"到"数据过多但难以快速解决问题"
- **2:30** - 提出 AI 是可观测性领域的理想应用场景

### Agent 架构与工作原理 (3:30 - 7:00)
- **3:30** - 解释 Agent 的基本概念：LLM + 上下文 + 查询 + 编程工作能力
- **4:15** - Agent 的目标：将 Java 堆栈跟踪等技术信息转化为自然语言建议
- **5:00** - 介绍 MCP（Model Context Protocol）工具的作用
- **5:30** - MCP 工具提供两个关键功能：告知 Agent 可用的 API、提供安全边界
- **6:15** - 展示宠物领养网站演示应用的架构

### 数据流与策略 (7:00 - 10:30)
- **7:00** - 分布式应用导致可观测性数据爆炸式增长
- **7:45** - 所有数据发送到 CloudWatch 进行集中分析
- **8:30** - 构建 Agent 的三大策略：提供丰富上下文、定义 SLO、分析趋势
- **9:15** - 强调 SLO（服务级别目标）的重要性：例如 99% 的请求延迟应在 30ms 以内
- **10:00** - 通过反馈循环让 Agent 随时间改进

### 解决方案架构 (10:30 - 13:00)
- **10:30** - 展示完整的工作流程：自然语言查询 → LLM 处理 → MCP 工具访问 → 生成报告
- **11:15** - 使用 Strands Agent SDK，仅需 10 行代码即可构建基础 Agent
- **12:00** - 提供操作租户、SLO 和历史报告作为上下文
- **12:45** - 输出格式：HTML 报告、自动创建告警等

### 实际报告分析 (13:00 - 22:00)
- **13:00** - Andrea 开始展示实际生成的可观测性报告
- **13:45** - 执行摘要：发现 EKS 宠物领养系统、Lambda 函数、检测到安全扫描
- **14:30** - Agent 自动创建了 4 个关键告警：高延迟、高故障率、Lambda 持续时间告警
- **15:15** - 关键指标分析：错误率 0.07%、故障率平稳、平均延迟 400 毫秒
- **16:30** - 发现有故障但没有相关错误（500 错误但没有 400 错误）
- **17:45** - 运营审计树视图：显示 EKS 应用、延迟 42 毫秒
- **18:30** - Lambda 函数分析和 Synthetic 监控（端到端测试）
- **19:15** - CloudWatch 日志分析：2GB 存储中 1.36GB 是应用日志，存在成本优化空间
- **20:00** - 运营发现：检测到大量安全扫描（PHP 漏洞利用、管理面板探测、WordPress 漏洞）

### 可操作建议 (22:00 - 25:30)
- **22:00** - 建议分为三个层级：立即行动、短期改进、长期优化
- **22:30** - 立即行动：启用 WAF（Web 应用防火墙）阻止扫描、审查 CloudTrail
- **23:15** - Agent 已自动创建告警，建议创建 SLO
- **24:00** - 短期改进：解决 400 毫秒延迟问题
- **24:30** - 长期优化：改善 3% 的服务利用率，使用自动扩展策略
- **25:00** - 关联行业已知事件：WordPress 2022 安全漏洞，提供具体解决方案

### 代码实现详解 (25:30 - 45:00)
- **25:30** - Andrea 开始代码演示，强调代码会实际执行操作
- **26:15** - 项目结构：observability-agent 文件夹，Python 实现
- **27:00** - 主文件参数：区域、输出格式（Markdown/HTML）、详细程度
- **27:45** - 核心代码：创建 Agent 和运行分析仅需 2 行代码
- **28:30** - 深入 MCP Client Manager：管理 CloudWatch、Application Signals、CloudTrail 三个 MCP 工具
- **29:45** - MCP 工具的本质：为 LLM 提供的 API，比直接 API 调用更友好
- **31:00** - 创建 MCP Client：只需传入 GitHub 仓库句柄（如 aws-labs/cloudwatch-mcp-server）
- **32:15** - 初始化组件：设置 MCP 客户端并创建 Agent

### System Prompt 设计 (33:00 - 40:00)
- **33:00** - 强调编写高质量 Prompt 与代码同等重要
- **33:45** - 创建 Agent：传入 system prompt 和工具列表
- **34:30** - 工具列表：HTTP 请求、自定义告警创建工具、MCP 工具
- **35:15** - System Prompt 详解：定义 Agent 为"可观测性专家"
- **36:00** - 能力描述：发现资源、查询指标、关联数据、创建告警、生成报告
- **37:00** - 关键指令：通过指标和日志反向工程资源（避免调用所有 API）
- **38:00** - 告警创建策略：保守创建，仅在真正缺口时创建，避免重复
- **39:00** - 关注领域：性能监控、客户体验、成本优化、安全、运营卓越
- **39:45** - 指定使用自定义工具创建 CloudWatch 告警

### Agent 调用流程 (40:00 - 48:00)
- **40:00** - 两步流程：1) 创建并配置 Agent，2) 准备 Prompt 并调用
- **41:00** - 运行分析方法：发现和分析资源 → 生成报告
- **41:45** - 调用 Agent：使用 agent.query() 方法传入 Prompt
- **42:30** - MCP Manager 执行上下文：仅在调用时连接 MCP 服务器，而非整个生命周期
- **43:45** - 状态管理：Agent 本身是无状态的，除非提供历史运行数据
- **44:30** - Prompt 结构化的重要性：避免随机输出和幻觉

### 详细 Prompt 指令 (45:00 - 52:00)
- **45:00** - 多步骤任务定义：发现资源 → 分析健康状况 → 生成深链接
- **45:45** - 资源类型：计算、数据库、无服务器、负载均衡器、存储服务
- **46:30** - 健康分析维度：指标值、趋势、健康状态、活动告警、近期事件、性能
- **47:15** - 生成 AWS 控制台深链接，方便一键跳转
- **48:00** - 继续展示 Prompt 的其他部分（字幕在此处截断）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意事项：
- 所有代码均为开源，会议结束时提供 QR 码下载
- 代码会实际执行操作，建议在预生产环境测试
- 可以基于告警创建示例，自行实现 SLO 创建功能
- 使用 Strands Agent SDK 和 MCP 协议可快速构建类似解决方案