# AWS re:Invent 2025 基础设施创新会议总结

## 会议概述

本次会议由AWS基础设施团队的两位高级首席工程师George Vasquez和Stephen Callahan主讲,主题为"通过AWS基础设施创新助力客户成功"。演讲者通过一个虚构的在线商店"Shannon Store"(以爱尔兰的香农河命名)的成功故事,展示了AWS基础设施从物理层到应用层的全栈创新。会议涵盖了从数据中心地下混凝土管道中的光纤布线,到每月账单生成的整个技术栈,特别关注了AI工作负载对网络性能和带宽的高要求。

演讲强调了AWS如何通过幕后创新使客户的工作负载更加安全、可靠和高效。Shannon Store部署在爱尔兰的EU-West-1区域,使用三个可用区和三个VPC(前端VPC、后端VPC和支付VPC),展示了现代电商架构如何利用AWS服务应对大规模流量和安全挑战。整个演讲贯穿了AWS"代客户承担繁重工作"的理念,让客户专注于业务创新而非基础设施管理。

## 详细时间线与关键要点

### 开场介绍 (00:00 - 02:30)
- **00:00** - 会议开始,介绍演讲者George Vasquez和Stephen Callahan,均为AWS基础设施高级首席工程师
- **00:45** - 说明会议将涵盖从数据中心物理基础设施到账单系统的全栈创新
- **01:15** - 特别强调AI工作负载带来的性能和带宽挑战
- **01:45** - 介绍虚构案例"Shannon Store"(以爱尔兰香农河命名的在线商店)

### Shannon Store架构 (02:30 - 04:00)
- **02:30** - Shannon Store部署在EU-West-1(爱尔兰)区域
- **03:00** - 使用三个可用区提高可靠性
- **03:15** - 采用三个VPC架构:前端VPC(唯一接受互联网连接)、后端VPC(微服务部署)、支付VPC(PCI合规的信用卡处理)

### CloudFront创新 (04:00 - 08:30)
- **04:00** - Shannon选择CloudFront作为前端解决方案
- **04:30** - CloudFront拥有超过700个全球边缘节点,提供最佳延迟和最低数据传输成本
- **05:00** - 介绍新推出的CloudFront固定费率计划,包含数据传输、S3存储、WAF、API请求、DNS等所有服务
- **05:45** - 固定费率计划的优势:即使流量超出预期也不会产生意外账单
- **06:30** - CloudFront加速动态内容的三个原因:
  - TCP/TLS握手优化(从118毫秒降至20毫秒以下)
  - 保持与源服务器的持久连接
  - Origin Shield功能可预先打开连接
- **07:30** - 所有流量通过Amazon骨干网传输,确保低延迟和高可用性
- **08:00** - 支持HTTP/3和TLS 1.3等先进协议

### HTTPS DNS记录优化 (08:30 - 09:30)
- **08:30** - CloudFront支持HTTPS DNS记录,允许客户端在首次连接前知道端点支持QUIC协议
- **09:00** - 该优化使P90首字节延迟减少超过20毫秒
- **09:15** - HTTP/3连接相比HTTP/2连接显著增加

### TLS安全创新 (09:30 - 13:00)
- **09:30** - AWS自Heartbleed漏洞(约10年前)后投资TLS安全
- **10:00** - 开发并开源S2N TLS库,采用现代工程实践和形式化验证
- **10:30** - 通过AWS服务(ALB、NLB、CloudFront)可一键限制最新TLS版本
- **11:00** - 量子安全算法准备:应对未来量子计算机威胁
- **11:30** - 量子计算机可能破解椭圆曲线、RSA、Diffie-Hellman等算法
- **12:00** - AWS自2019年起与NIST合作标准化量子安全算法
- **12:30** - CloudFront、ALB、NLB已实现量子安全算法,CloudFront默认启用
- **12:45** - 量子安全保护客户隐私,防止"现在收集,未来解密"攻击

### CloudFront VPC私有源 (13:00 - 15:00)
- **13:00** - CloudFront现可连接VPC内的私有资源
- **13:30** - Shannon利用此功能加固前端VPC,消除最后的公网端点
- **14:00** - 工作原理:CloudFront在边缘节点和VPC之间创建安全隧道,使用Hyperplane技术连接
- **14:30** - 只有Shannon的CloudFront分配可访问VPC内资源,无需配置安全组

### VPC Block Public Access (15:00 - 17:00)
- **15:00** - 介绍VPC Block Public Access功能(去年推出)
- **15:30** - 后端和支付VPC无需互联网访问,防止意外配置创建互联网入口
- **16:00** - 平台团队可声明VPC不得连接互联网,阻止IGW、NAT Gateway、Global Accelerator、NLB、ALB、API Gateway等配置
- **16:45** - 这是"改变游戏规则"的创新:客户表达意图,AWS在幕后执行

### VPC加密控制 (17:00 - 19:00)
- **17:00** - 今年新推出的VPC加密控制功能
- **17:30** - Nitro V3及以上实例原生支持VPC加密
- **18:00** - 平台团队可限制只启动支持加密的实例类型
- **18:30** - 问题:其他服务(如RDS)可能启动不合规实例
- **18:45** - 解决方案:加密控制强制模式会阻止不合规实例启动

### WAF和DDoS防护 (19:00 - 23:00)
- **19:00** - Shannon使用Web Application Firewall防止机器人爬取目录
- **19:30** - WAF计算挑战功能:要求机器人执行计算密集型任务,改变经济学平衡
- **20:00** - Shannon目录有数千万商品,增加爬取成本
- **20:30** - AWS托管规则集提供自动DDoS缓解
- **21:00** - 工作原理:WAF数据平面收集请求元数据,中央集群进行指纹识别并与基线比较
- **21:45** - 即使机器人伪造User-Agent、Header顺序、JA3指纹或使用非运营商IP地址也能检测
- **22:30** - 90%的流量洪水攻击在开始后20秒内被阻止和缓解
- **22:45** - 目标:工程师收到告警时攻击已被缓解

### 网络扩展策略 (23:00 - 26:00)
- **23:00** - 目标:让Shannon永远不必担心网络规模
- **23:30** - 两个基本原则:主动扩展(不等待容量耗尽)和充足冗余(应对中断)
- **24:00** - 网络扩展涉及物理世界:铺设光纤、获取新建筑、挖掘沟渠,没有弹性可言
- **24:45** - 每天有数百万设备下线进行OS升级和配置更新,必须规划这些中断
- **25:15** - 案例:新建跨大西洋海底光缆FastNet(马里兰-科克),容量320 Tbps
- **25:45** - 包含新开发的光交换和分支单元,可适应未来网络拓扑变化

### 网络冗余规划创新 (26:00 - 29:00)
- **26:00** - 过去按固定故障数规划(如数据中心两个并发故障)
- **26:30** - 问题:高可靠性区域容量过剩,低可靠性区域容量不足
- **27:00** - 解决方案双管齐下:
  - 全面表征每个网络元素的MTBF和MTTR
  - 理解相关故障(如一次挖掘切断多条光纤)
- **28:00** - 将详细表征输入定制网络模拟器,运行与生产相同的网络控制器
- **28:30** - 可模拟正确的并行和顺序故障,将网络扩展重定向到最需要的地方

### VPC无限扩展 (29:00 - 31:30)
- **29:00** - VPC实例数量无限制(仅受子网IP地址限制)
- **29:15** - IPv6 VPC实际上无实例数量限制
- **29:45** - Nitro系统硬件虚拟化网络功能,但硬件内存有限
- **30:15** - 问题:数据包封装需要查找表,超大VPC的表无法装入Nitro卡内存
- **30:45** - 解决方案:部署大型服务响应"VPC中的实例位于何处"
- **31:00** - 必须在不到1毫秒内完成,需要两项创新:
  - 定制协议(HTTP REST API over TLS太慢)
  - 在每栋建筑内部署服务,靠近实例以减少网络路径延迟

### Stephen's Day销售与流量工程 (31:30 - 38:00)
- **31:30** - 爱尔兰圣斯蒂芬节(12月26日)是最大销售日
- **32:00** - Shannon扩展容量但无需扩展网络,通过网络协作实现
- **32:30** - 视频存储在S3,通过CloudFront分发
- **33:00** - 两类视频:可缓存的产品描述视频和不太可缓存的用户评论视频
- **33:45** - 不可缓存内容使CloudFront更像代理,增加骨干网需求
- **34:15** - 流量工程控制器介入,通过曼彻斯特重定向部分内容
- **35:00** - 分布式市场模拟:无中央大脑,避免单点故障
- **35:30** - 不使用RSVP等预留系统,避免先到先得和死锁
- **36:00** - 当所有路径接近容量时,流量工程系统通知CloudFront
- **36:30** - CloudFront可将内容移至不同边缘位置,优先移动对延迟不敏感的视频内容
- **37:00** - 限制因素可能是连接ISP的端口,流量工程控制器也会平衡这些连接
- **37:30** - 今年EC2流量工程控制器(内部称为Catapult)也集成了骨干网和互联网连接控制器

### 自动化流量管理 (38:00 - 39:30)
- **38:00** - 所有流量管理自动在幕后进行
- **38:15** - 客户可能看到轻微延迟波动,但永不拥塞
- **38:45** - 对真实客户有用:Amazon.com Prime Day、周四夜足球直播、Fortnite多GB更新下载

### 可用区物理冗余 (39:30 - 43:00)
- **39:30** - Stephen接手演讲,讨论基础设施如何可预测地失败
- **40:00** - 可用区是离散实体,物理上分离
- **40:30** - 可用区通过有意义的距离分隔,拥有独立电源和光纤路径
- **41:00** - 单一事件不会影响多个可用区
- **41:30** - 大型区域多栋建筑间有多条连接
- **42:00** - 需要考虑机场、房屋、企业、山脉、河流等物理基础设施
- **42:30** - 使用地理信息系统(GIS)详细了解光纤布局

### 光纤路径管理 (43:00 - 46:00)
- **43:00** - 光纤设施在AWS完全控制下:可用区内、可用区间、骨干网
- **43:30** - 需要了解管道内光纤数量、路径、甚至过桥时是在高速公路上方还是下方
- **44:00** - 真实案例:光纤分布在高速公路左侧、右侧和中央分隔带
- **44:30** - 了解这些细节可以建模不同故障特征
- **45:00** - 保护措施:用混凝土包裹光纤管道
- **45:30** - 传统现场浇筑混凝土耗时且受天气影响
- **45:45** - 创新:使用预制光纤管道组

### 预制光纤管道优势 (46:00 - 47:30)
- **46:00** - 多重优势:
  - 加快部署(无需等待混凝土干燥)
  - 快速部署容量并预留扩展空间
  - 车间环境制造质量更高
  - 最重要:施工团队更安全,减少在沟渠中的时间

### SRLG共享风险链路组 (47:30 - 51:00)
- **47:30** - 从物理层上升到逻辑层
- **48:00** - 在数据中心对之间建模需求
- **48:30** - 任意两个数据中心间可能有2-4条路径,多个管道、子管道和光纤
- **49:00** - 每条光纤连接到电路(EC2、骨干网或Direct Connect)
- **49:30** - 使用SRLG(共享风险链路组)管理容量和需求网格
- **50:00** - 分析逻辑和物理复杂图,寻找光纤管道交叉或容量集中点(如跨海)
- **50:30** - 在弗吉尼亚等大型区域,有数百或数千条光纤路径需要规划

### 快速故障切换 (51:00 - 54:00)
- **51:00** - 欧洲区域间有数千条光纤路径、海底光缆和互连点
- **51:30** - 去年介绍的基于惩罚的流量工程系统可逐步恢复平衡
- **52:00** - 但光纤切断时不想等待逐步再平衡,需要快速行动
- **52:30** - 除最优路径外,还通过预配置的基于IP的旁路隧道保护每条路径
- **53:00** - 平衡规模和性能:将责任委托给能最快响应的堆栈层
- **53:30** - 区域或骨干网级别无需了解数千个交换机,这是底层路由协议的职责
- **53:45** - 只需了解链路束而非每条链路

### 备份路径计算 (54:00 - 57:00)
- **54:00** - 主路径创建后,骨干网控制器也为每个段计算备份路径(蓝色显示)
- **54:30** - 备份路径预先计算并配置,但不承载流量
- **55:00** - 检测到故障时立即切换到备份路径
- **55:30** - 备份路径设计避开主路径的SRLG
- **56:00** - 确保单一物理事件不会同时影响主路径和备份路径
- **56:30** - 这种快速故障切换机制对Shannon等客户完全透明

### 总结 (57:00 - 结束)
- **57:00** - 回顾从物理光纤到应用层的全栈创新
- **57:30** - 强调AWS"代客户承担繁重工作"的理念
- **58:00** - 客户只需专注业务,AWS在幕后确保安全、可靠和高效