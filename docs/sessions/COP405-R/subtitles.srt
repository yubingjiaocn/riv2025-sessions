1
00:00:00,690 --> 00:00:01,940
- [Kevin] Hello everyone.

2
00:00:03,360 --> 00:00:08,360
I have a question, who here
has been woken up at 3:00 AM

3
00:00:09,240 --> 00:00:11,490
to look at a log for a production outage?

4
00:00:11,490 --> 00:00:13,083
Can I see a show of hands?

5
00:00:14,310 --> 00:00:16,140
Is it everybody?

6
00:00:16,140 --> 00:00:18,003
I see some people with hands down.

7
00:00:18,960 --> 00:00:19,980
What's your secret?

8
00:00:19,980 --> 00:00:22,083
Maybe you want to come up and do the talk?

9
00:00:24,660 --> 00:00:25,623
I know I have.

10
00:00:26,850 --> 00:00:28,620
And so what we're talking about today

11
00:00:28,620 --> 00:00:33,060
is how we can use some
of our new agentic tools

12
00:00:33,060 --> 00:00:34,653
to help avoid that situation.

13
00:00:35,610 --> 00:00:38,583
My name's Kevin, I have
Andrea with me here today,

14
00:00:39,829 --> 00:00:42,540
and we're here to talk to you about,

15
00:00:42,540 --> 00:00:43,950
this is a code talk by the way.

16
00:00:43,950 --> 00:00:48,360
So we're gonna talk about what
tools do we have available

17
00:00:48,360 --> 00:00:50,802
and how can we build something

18
00:00:50,802 --> 00:00:54,303
that helps us improve our
observability posture.

19
00:00:57,510 --> 00:01:01,170
So I started working with
observability at AWS,

20
00:01:01,170 --> 00:01:06,170
I think seven years ago and
the space has changed a lot.

21
00:01:07,860 --> 00:01:09,120
We used to see a problem

22
00:01:09,120 --> 00:01:12,330
where customers did not
have the metrics logs

23
00:01:12,330 --> 00:01:15,063
and traces that they needed
to solve their problems.

24
00:01:15,930 --> 00:01:18,870
Maybe a key log method was missing,

25
00:01:18,870 --> 00:01:21,663
maybe distributed tracing wasn't there.

26
00:01:23,220 --> 00:01:25,930
But that situation has changed

27
00:01:27,090 --> 00:01:29,580
with tools like Open Telemetry

28
00:01:29,580 --> 00:01:33,060
and CloudWatch being
integrated into everything.

29
00:01:33,060 --> 00:01:37,440
It's easier than ever to produce
usable observability data.

30
00:01:37,440 --> 00:01:39,900
Sometimes just a few clicks of a button,

31
00:01:39,900 --> 00:01:42,330
sometimes, you know, one Terraform module

32
00:01:42,330 --> 00:01:45,633
and all of a sudden you have
all the observability you need.

33
00:01:47,010 --> 00:01:49,200
So the problem has changed.

34
00:01:49,200 --> 00:01:53,760
What we see is that customers
have too much data now

35
00:01:53,760 --> 00:01:56,550
to quickly solve the problems they need.

36
00:01:56,550 --> 00:01:59,880
You can produce all of
the data, and traces,

37
00:01:59,880 --> 00:02:01,980
and logging that you need,

38
00:02:01,980 --> 00:02:05,820
but if you can't quickly solve a problem,

39
00:02:05,820 --> 00:02:08,793
you're not really getting
your value for that.

40
00:02:09,688 --> 00:02:14,550
And it's very exciting
because in our opinion,

41
00:02:14,550 --> 00:02:17,880
AI is a really good use case for us.

42
00:02:17,880 --> 00:02:21,750
And I know you hear it's a
good use case for everything,

43
00:02:21,750 --> 00:02:24,750
but I think for observability,
we really do make a case

44
00:02:24,750 --> 00:02:27,483
for AI and it works really good for us.

45
00:02:29,940 --> 00:02:32,640
And so when we think about an agent,

46
00:02:32,640 --> 00:02:34,890
I'm sure you all know most of this,

47
00:02:34,890 --> 00:02:39,890
but we're essentially having
some LLM do some processing.

48
00:02:42,259 --> 00:02:45,333
We're giving it a lot of context.

49
00:02:46,320 --> 00:02:49,350
We're giving it a query,

50
00:02:49,350 --> 00:02:54,350
and then we want it to perform
the programmatic work, right?

51
00:02:54,540 --> 00:02:56,400
We want it to do SQL queries,

52
00:02:56,400 --> 00:02:59,040
it to write metric insights queries,

53
00:02:59,040 --> 00:03:01,830
and it to process all those values.

54
00:03:01,830 --> 00:03:04,953
And we wanna see just a
natural language response.

55
00:03:07,410 --> 00:03:09,540
I know that sometimes,

56
00:03:09,540 --> 00:03:11,490
I would be deploying
something a long time ago

57
00:03:11,490 --> 00:03:13,560
and you look and you just
see a Java stack trace

58
00:03:13,560 --> 00:03:16,080
or something and you're like,
just what is this, right?

59
00:03:16,080 --> 00:03:19,260
And this really helps
that problem a lot, right?

60
00:03:19,260 --> 00:03:22,590
To take that and make it
natural language that is saying,

61
00:03:22,590 --> 00:03:26,430
we think this is the problem,
we recommend you do this.

62
00:03:26,430 --> 00:03:28,023
That's a big leap.

63
00:03:31,260 --> 00:03:35,100
But the agents don't
really work great for this

64
00:03:35,100 --> 00:03:38,433
unless we give them
access to the right data.

65
00:03:40,080 --> 00:03:43,620
Show of hands, who here
uses MCP tools today?

66
00:03:43,620 --> 00:03:45,660
I think probably a lot of you.

67
00:03:45,660 --> 00:03:47,133
Great, yeah, most of you.

68
00:03:48,840 --> 00:03:52,140
So at AWS we of course make a lot of them,

69
00:03:52,140 --> 00:03:55,080
but this talk is not
really about that, right?

70
00:03:55,080 --> 00:03:58,000
We want to think about
how we use the tools

71
00:03:59,280 --> 00:04:02,820
and how we can gain extra value from them.

72
00:04:02,820 --> 00:04:07,740
And what we're doing is thinking about

73
00:04:07,740 --> 00:04:11,675
how our MCPs can access
these tools like CloudWatch

74
00:04:11,675 --> 00:04:15,420
or Prometheus or some
type of postmortem tool.

75
00:04:15,420 --> 00:04:20,420
And the MCP's job is to, one,
tell the agent what it can do,

76
00:04:22,770 --> 00:04:25,890
what APIs are available, and
then maybe more importantly,

77
00:04:25,890 --> 00:04:28,950
provide a security boundary
where you're saying,

78
00:04:28,950 --> 00:04:32,040
my MCP tool can query Prometheus,

79
00:04:32,040 --> 00:04:34,860
but I don't want 1,000 agents
on everybody's computer

80
00:04:34,860 --> 00:04:37,844
directly with permissions to query.

81
00:04:37,844 --> 00:04:40,443
And so, the MCP is very
important for that.

82
00:04:43,389 --> 00:04:45,533
And so, how are we gonna use these?

83
00:04:47,340 --> 00:04:48,990
Has anybody seen this screen before?

84
00:04:48,990 --> 00:04:51,990
Has anybody done our
one observability demo?

85
00:04:51,990 --> 00:04:54,720
Just, okay, you guys
should all check that out.

86
00:04:54,720 --> 00:04:57,570
But essentially, what we're gonna do today

87
00:04:57,570 --> 00:05:01,320
and what we're gonna build and
Andrea is gonna show you is,

88
00:05:01,320 --> 00:05:04,590
we have this pet adoption
website with some very cute pets.

89
00:05:04,590 --> 00:05:07,620
And these are actually real
pictures from our team,

90
00:05:07,620 --> 00:05:08,453
most of them.

91
00:05:08,453 --> 00:05:12,840
And, "The Pet Adoption
Clinic" is what it's called.

92
00:05:12,840 --> 00:05:16,260
And you could, it's a
fictional web application

93
00:05:16,260 --> 00:05:17,940
where you can go and
you could adopt a pet,

94
00:05:17,940 --> 00:05:21,330
you could bring your pet to the vet,

95
00:05:21,330 --> 00:05:24,993
and buy food for your pet and
all different types of things.

96
00:05:27,030 --> 00:05:32,030
So when we look at this, let's
think about the data, right?

97
00:05:32,460 --> 00:05:36,090
So as applications have changed,

98
00:05:36,090 --> 00:05:38,850
they've become more and more distributed.

99
00:05:38,850 --> 00:05:41,240
And so, each of these services

100
00:05:41,240 --> 00:05:44,130
is going to produce
observability data, right?

101
00:05:44,130 --> 00:05:45,900
Metrics, logs, and traces.

102
00:05:45,900 --> 00:05:49,770
So maybe you used to have a monolith

103
00:05:49,770 --> 00:05:53,670
where you have your logs and
your data all in one spot.

104
00:05:53,670 --> 00:05:55,980
Now you have this explosion of data

105
00:05:55,980 --> 00:05:57,960
because you've took one thing

106
00:05:57,960 --> 00:06:00,860
and abstracted it to
maybe 50 things, right?

107
00:06:00,860 --> 00:06:04,020
I have three up here, but it
could be way more for you guys

108
00:06:04,020 --> 00:06:06,183
in a more complicated deployment.

109
00:06:07,890 --> 00:06:10,863
And when we see that happening,

110
00:06:11,970 --> 00:06:13,950
we need a way to easily analyze this.

111
00:06:13,950 --> 00:06:16,950
So in our case, we're
sending it to CloudWatch,

112
00:06:16,950 --> 00:06:19,230
but this could be even
other observability tools

113
00:06:19,230 --> 00:06:21,903
or other data stores, the
same thing still applies.

114
00:06:24,810 --> 00:06:26,460
And so, what's our strategy here?

115
00:06:27,804 --> 00:06:29,823
When we build an agent,

116
00:06:30,780 --> 00:06:33,060
and I think this is the
most important thing,

117
00:06:33,060 --> 00:06:36,303
we need to provide it with
as much context as possible.

118
00:06:38,100 --> 00:06:42,240
We wanna define SLOs, that's
a service level objective

119
00:06:42,240 --> 00:06:44,610
where you're essentially telling the agent

120
00:06:44,610 --> 00:06:47,520
what is important to you
and your organization.

121
00:06:47,520 --> 00:06:50,670
You're saying, over the last 30 days,

122
00:06:50,670 --> 00:06:55,320
I expect my application to have a latency

123
00:06:55,320 --> 00:06:58,920
of 30 MS for 99% of request.

124
00:06:58,920 --> 00:07:00,900
That's an example of an SLO.

125
00:07:00,900 --> 00:07:05,250
And when you provide this
rich context to the agent,

126
00:07:05,250 --> 00:07:08,340
you're going to get a lot more data

127
00:07:08,340 --> 00:07:10,503
that is specific to you and your team.

128
00:07:12,750 --> 00:07:14,190
And then we need to take that data,

129
00:07:14,190 --> 00:07:16,440
we need to analyze the trends.

130
00:07:16,440 --> 00:07:18,670
We need to say to our agent,

131
00:07:18,670 --> 00:07:21,630
don't just look at the current state,

132
00:07:21,630 --> 00:07:24,024
look around the corners, right?

133
00:07:24,024 --> 00:07:26,253
What could potentially be an issue later?

134
00:07:28,110 --> 00:07:28,943
And then finally,

135
00:07:28,943 --> 00:07:32,760
we want to make our
agent better over time.

136
00:07:32,760 --> 00:07:35,520
So let's take an example of
our pet adoption website.

137
00:07:35,520 --> 00:07:39,660
And we run this agent that creates,

138
00:07:39,660 --> 00:07:44,660
let's say an HTML report
of observability findings.

139
00:07:44,730 --> 00:07:47,820
And we want to feed those
findings back into the agent

140
00:07:47,820 --> 00:07:50,223
on each successful invocation.

141
00:07:51,060 --> 00:07:53,373
That way it can get better over time.

142
00:07:56,910 --> 00:07:59,400
And so, what are we gonna
actually show today?

143
00:07:59,400 --> 00:08:01,170
Or what are we gonna build?

144
00:08:01,170 --> 00:08:03,060
And, I promise we're
getting to code, right?

145
00:08:03,060 --> 00:08:05,003
I'm not just gonna talk the whole time.

146
00:08:06,360 --> 00:08:08,070
But essentially, we are starting

147
00:08:08,070 --> 00:08:10,143
with a natural language query.

148
00:08:11,389 --> 00:08:12,690
It could be manual

149
00:08:12,690 --> 00:08:15,120
or it could be triggered
by an alarm, right?

150
00:08:15,120 --> 00:08:16,830
That would be a little bit better

151
00:08:16,830 --> 00:08:21,690
to have something lying in
wait and an alarm is triggered

152
00:08:21,690 --> 00:08:23,490
and your agent gets to work for you.

153
00:08:25,050 --> 00:08:28,470
We have our LLM and what we do

154
00:08:28,470 --> 00:08:33,210
and what I think is really cool
is using the strands agent,

155
00:08:33,210 --> 00:08:35,910
this is a SDK, it's open source.

156
00:08:35,910 --> 00:08:39,963
You can build an agent in, I
don't know, 10 lines of code.

157
00:08:41,049 --> 00:08:43,110
We're gonna show you a lot
more, not just 10 lines,

158
00:08:43,110 --> 00:08:45,210
but you can get started that quickly.

159
00:08:45,210 --> 00:08:46,290
It's really amazing

160
00:08:46,290 --> 00:08:49,090
how quickly you can build
something interesting for you.

161
00:08:50,970 --> 00:08:54,150
And then we want to provide
it with all the context

162
00:08:54,150 --> 00:08:55,590
that it needs.

163
00:08:55,590 --> 00:08:59,580
So we want to provide it
with our operational tenants,

164
00:08:59,580 --> 00:09:01,200
with our SLOs.

165
00:09:01,200 --> 00:09:04,770
We want to tell it exactly
its purpose, and its job,

166
00:09:04,770 --> 00:09:06,570
and how it should do things.

167
00:09:06,570 --> 00:09:09,930
And we also need to provide
it with the MCP access

168
00:09:09,930 --> 00:09:12,543
so it can properly query
things and get data.

169
00:09:15,570 --> 00:09:20,190
And finally, we want some
type of usable output.

170
00:09:20,190 --> 00:09:24,360
So it could be an HTML report
that you send out daily

171
00:09:24,360 --> 00:09:26,220
to a stakeholder.

172
00:09:26,220 --> 00:09:29,700
It could be, it finds a gap

173
00:09:29,700 --> 00:09:31,830
and then it creates an alarm for you.

174
00:09:31,830 --> 00:09:35,100
It's very useful and we're
gonna show that in a little bit.

175
00:09:35,100 --> 00:09:36,450
But the goal is to have

176
00:09:36,450 --> 00:09:41,040
some type of human understandable output

177
00:09:41,040 --> 00:09:44,883
from your programmatic
queries of structured data.

178
00:09:45,750 --> 00:09:48,090
And I'm gonna pass it over to Andrea now.

179
00:09:48,090 --> 00:09:50,310
He's gonna show you the code
and show, you what we built,

180
00:09:50,310 --> 00:09:52,160
and how we think about this, and...

181
00:09:53,010 --> 00:09:54,150
- [Andrea] Thank you Kevin.

182
00:09:54,150 --> 00:09:57,840
All right, so before I swap the screen,

183
00:09:57,840 --> 00:10:00,450
so one thing I wanna mention
is, you're gonna see a QR code

184
00:10:00,450 --> 00:10:01,710
at the end of this presentation.

185
00:10:01,710 --> 00:10:03,960
So all the code you're
gonna see is open source,

186
00:10:03,960 --> 00:10:06,267
so you can go off download it,

187
00:10:06,267 --> 00:10:10,423
but before going into
that, I wanna do a premise.

188
00:10:10,423 --> 00:10:12,540
So code will run, we'll do stuff.

189
00:10:12,540 --> 00:10:16,560
So make sure that if you
try modify the free stuff

190
00:10:16,560 --> 00:10:18,810
like you do with your
pre-production environment,

191
00:10:18,810 --> 00:10:22,200
'cause it's gonna create
artifacts as we're gonna see.

192
00:10:22,200 --> 00:10:24,390
Okay, lemme say that I wanna start this

193
00:10:24,390 --> 00:10:28,800
by looking at what the
agent is gonna create

194
00:10:28,800 --> 00:10:30,690
after each run, all right?

195
00:10:30,690 --> 00:10:34,020
So what you see on screen
is the observability report

196
00:10:34,020 --> 00:10:37,080
from one run of the agent where,

197
00:10:37,080 --> 00:10:39,064
what we are asking the agent to do is,

198
00:10:39,064 --> 00:10:43,620
go off into my account and
find interesting stuff for me.

199
00:10:43,620 --> 00:10:45,900
We can say that what
interesting stuff means,

200
00:10:45,900 --> 00:10:50,280
'cause you need to steer the
agent in a very specific way

201
00:10:50,280 --> 00:10:52,290
if you want it to be valuable.

202
00:10:52,290 --> 00:10:55,140
So I wanna analyze that report with you

203
00:10:55,140 --> 00:10:58,050
so that you can actually
see what's the outcome.

204
00:10:58,050 --> 00:10:59,760
And so, we can relate that with the code

205
00:10:59,760 --> 00:11:01,470
that we're gonna see in a second, okay?

206
00:11:01,470 --> 00:11:04,980
So the report is split
into a different section.

207
00:11:04,980 --> 00:11:07,860
The first one is the executive summary.

208
00:11:07,860 --> 00:11:10,060
And so, the agent is telling us that,

209
00:11:10,060 --> 00:11:14,183
we have AWS infrastructure
with mainly an EKS-based

210
00:11:14,183 --> 00:11:18,840
PetSite adoption system
that Kevin mentioned before.

211
00:11:18,840 --> 00:11:23,760
We have Lambda functions
and comprehensive logging.

212
00:11:23,760 --> 00:11:26,700
And one interesting thing
that it's already highlighting

213
00:11:26,700 --> 00:11:29,793
is that our PetSite deployment service,

214
00:11:31,069 --> 00:11:34,050
there is active traffic and
there are some security scan

215
00:11:34,050 --> 00:11:35,343
happening in my system.

216
00:11:36,600 --> 00:11:38,130
And then the agent took the decision

217
00:11:38,130 --> 00:11:42,210
to create a critical
monitoring alarms for us, okay?

218
00:11:42,210 --> 00:11:44,040
So that's kind of like a TLDR

219
00:11:44,040 --> 00:11:47,250
of what the agent has done, really.

220
00:11:47,250 --> 00:11:48,930
So now we can actually go down

221
00:11:48,930 --> 00:11:50,460
and look a little bit more in details.

222
00:11:50,460 --> 00:11:53,567
So we can see we have
an alarm section here.

223
00:11:53,567 --> 00:11:56,217
One says, okay, so this
system didn't have any alarm.

224
00:11:57,060 --> 00:12:02,053
And so, when the agent run, he
created four critical alarms.

225
00:12:02,053 --> 00:12:05,520
A PetSite, high latency,
high fault error rate,

226
00:12:05,520 --> 00:12:08,040
and then a lambda duration alarm.

227
00:12:08,040 --> 00:12:11,910
If you think about those,
it's quite impressive

228
00:12:11,910 --> 00:12:16,680
that the agent is
interpreting what we have

229
00:12:16,680 --> 00:12:18,870
into the account, understand
what are the alarms

230
00:12:18,870 --> 00:12:20,610
that needs to be created
and creating them.

231
00:12:20,610 --> 00:12:22,480
And we're gonna see how we did this

232
00:12:24,374 --> 00:12:25,950
in a few minutes, all right?

233
00:12:25,950 --> 00:12:28,680
And then definitely,
there is security scan,

234
00:12:28,680 --> 00:12:30,480
again it's highlight that.

235
00:12:30,480 --> 00:12:33,000
Then next, we have some key metrics

236
00:12:33,000 --> 00:12:35,730
that the agent is telling us
that we should be looking at.

237
00:12:35,730 --> 00:12:38,940
And you can see here we
have PetSite error rate,

238
00:12:38,940 --> 00:12:41,460
PetSite fault rate, and PetSite latency.

239
00:12:41,460 --> 00:12:45,120
So now interestingly, if we
go to the fault rate first,

240
00:12:45,120 --> 00:12:47,340
you're gonna see we have a
low level amount of fault

241
00:12:47,340 --> 00:12:49,590
is 0.07%, nothing concerning,

242
00:12:49,590 --> 00:12:52,470
but something definitely
you wanna be aware of.

243
00:12:52,470 --> 00:12:56,640
But most interestingly is the error rate

244
00:12:56,640 --> 00:12:59,670
flat time series here.

245
00:12:59,670 --> 00:13:02,911
Now, there's one thing
that in this new AI world

246
00:13:02,911 --> 00:13:05,100
people used to say, which is like,

247
00:13:05,100 --> 00:13:07,440
oh, I'm gonna find
something that is anomalous.

248
00:13:07,440 --> 00:13:10,170
But most of the time, looking at something

249
00:13:10,170 --> 00:13:13,680
that is not anomalous
is as equally important

250
00:13:13,680 --> 00:13:15,630
as what is going wrong.

251
00:13:15,630 --> 00:13:19,380
In this case, specifically
the agent has found out

252
00:13:19,380 --> 00:13:21,450
that we have faults,

253
00:13:21,450 --> 00:13:24,420
but there are no error related
to those faults, all right?

254
00:13:24,420 --> 00:13:29,010
So you can see that probably
we have a level of 500 errors

255
00:13:29,010 --> 00:13:31,890
but not 400, and you can
relate that with your code.

256
00:13:31,890 --> 00:13:34,173
'Cause in general, they
may be related, okay?

257
00:13:35,400 --> 00:13:37,790
And at the same time, agent
found out that we have a latency

258
00:13:37,790 --> 00:13:42,240
of 400 milliseconds on average, roughly,

259
00:13:42,240 --> 00:13:43,350
this is also not very good.

260
00:13:43,350 --> 00:13:45,540
And we are gonna see it's
gonna talk about that

261
00:13:45,540 --> 00:13:48,060
in a few sections here.

262
00:13:48,060 --> 00:13:52,320
Then next on, we have an
operational audit review

263
00:13:52,320 --> 00:13:55,978
where the agent is telling
us we have an EKS application

264
00:13:55,978 --> 00:14:00,978
where we have this latency
of 402 millisecond on average

265
00:14:01,460 --> 00:14:04,410
and you know, yeah, with
the last day average

266
00:14:04,410 --> 00:14:05,700
and we have a link to the console

267
00:14:05,700 --> 00:14:08,070
to actually go off and check it ourself.

268
00:14:08,070 --> 00:14:11,220
And then fault rate and error
rate that we just saw above.

269
00:14:11,220 --> 00:14:12,720
You know, and this saying to us like,

270
00:14:12,720 --> 00:14:17,720
okay, 500 server errors
are still acceptable levels

271
00:14:18,231 --> 00:14:21,630
'cause it's 0.06%, not bad

272
00:14:21,630 --> 00:14:24,240
but definitely something to notice.

273
00:14:24,240 --> 00:14:26,790
And definitely there is active traffic.

274
00:14:26,790 --> 00:14:29,700
Then we have a Lambda functional analysis

275
00:14:29,700 --> 00:14:33,030
where we have like few
status updated functions.

276
00:14:33,030 --> 00:14:36,960
We have step functions and
we have synthetic monitoring.

277
00:14:36,960 --> 00:14:40,260
How many of you know what synthetic is?

278
00:14:40,260 --> 00:14:42,090
Anyone familiar with it?

279
00:14:42,090 --> 00:14:43,170
Raise your hand.

280
00:14:43,170 --> 00:14:46,378
Okay, for everybody that
doesn't know Synthetic is,

281
00:14:46,378 --> 00:14:48,900
it's a CloudWatch service,
an AWS service that

282
00:14:48,900 --> 00:14:50,938
what it does is, you can write your code

283
00:14:50,938 --> 00:14:53,100
and run cannery testing, okay?

284
00:14:53,100 --> 00:14:56,340
So it's a way to do full
end-to-end testing to your service.

285
00:14:56,340 --> 00:15:00,360
You call your API, you expect
the result is 200, 500,

286
00:15:00,360 --> 00:15:02,400
depending on what you're testing there.

287
00:15:02,400 --> 00:15:04,560
And it's based on Lambda.

288
00:15:04,560 --> 00:15:05,580
So it's actually saying like,

289
00:15:05,580 --> 00:15:07,470
okay, so we have four end-to-end tests,

290
00:15:07,470 --> 00:15:08,770
that's the way to read it.

291
00:15:10,170 --> 00:15:13,320
Then sure, we have a EKS
infrastructure with a cluster,

292
00:15:13,320 --> 00:15:15,420
you know, linked to the
cluster if we want to go there.

293
00:15:15,420 --> 00:15:17,640
There are two gig of storage,

294
00:15:17,640 --> 00:15:19,920
which is probably something interesting.

295
00:15:19,920 --> 00:15:24,920
In fact, the agent also
thought that it's worth it

296
00:15:25,080 --> 00:15:27,510
to think about the
CloudWatch logs analysis.

297
00:15:27,510 --> 00:15:30,480
'Cause of those two gig
of storage, we have 1.36

298
00:15:30,480 --> 00:15:32,460
that are just in my
application logs, right?

299
00:15:32,460 --> 00:15:36,600
So some optimization costs
that we can actually look at.

300
00:15:36,600 --> 00:15:41,527
Now, operational finding, this
is where the security scan

301
00:15:42,390 --> 00:15:44,760
has been described a little bit more.

302
00:15:44,760 --> 00:15:48,330
So the agent found out that
there were significant scan

303
00:15:48,330 --> 00:15:51,630
across all those hundreds of
operations that were happening

304
00:15:51,630 --> 00:15:53,940
and you know, to different
common path, right?

305
00:15:53,940 --> 00:15:58,110
So PHP exploitation, admin panel probing,

306
00:15:58,110 --> 00:16:01,143
there is WordPress
vulnerability and so on.

307
00:16:03,270 --> 00:16:05,760
And now the agent tells us like,

308
00:16:05,760 --> 00:16:07,500
what should we do, all right?

309
00:16:07,500 --> 00:16:09,360
So now this section,

310
00:16:09,360 --> 00:16:12,611
and we're gonna see the code
is split into like three tiers.

311
00:16:12,611 --> 00:16:17,611
Like, what you should right
now, medium term, and long term.

312
00:16:19,590 --> 00:16:21,390
And so immediate actions it say like,

313
00:16:21,390 --> 00:16:25,830
okay, you should be enabling
AWS web application firewall

314
00:16:25,830 --> 00:16:27,427
on PetSite to block all these paths,

315
00:16:27,427 --> 00:16:30,060
you know, the scanning that it's happening

316
00:16:30,060 --> 00:16:31,650
and review CloudTrail.

317
00:16:31,650 --> 00:16:35,700
And then as part of
monitoring, there are like,

318
00:16:35,700 --> 00:16:37,380
you know, there weren't
alarms remember, right?

319
00:16:37,380 --> 00:16:39,420
So the agent say like,
okay, I took an action

320
00:16:39,420 --> 00:16:42,390
and I created the alarms for
you and we're gonna see how.

321
00:16:42,390 --> 00:16:45,160
So this is a first step
where we make the agent

322
00:16:46,873 --> 00:16:50,400
to operate into our
observability artifacts,

323
00:16:50,400 --> 00:16:54,960
and there should be also SLOs
into application signals.

324
00:16:54,960 --> 00:16:56,460
Now, the agent haven't done this

325
00:16:56,460 --> 00:16:57,990
because we haven't created the tool.

326
00:16:57,990 --> 00:16:59,850
So this is an exercise for home, right?

327
00:16:59,850 --> 00:17:02,490
So I'll show you how we did four alarms

328
00:17:02,490 --> 00:17:03,960
and you can use the same approach

329
00:17:03,960 --> 00:17:06,540
to create application signal SLOs.

330
00:17:06,540 --> 00:17:10,350
And then moving forward, we
have short term improvements.

331
00:17:10,350 --> 00:17:12,480
That is our 400 millisecond
latency, you know,

332
00:17:12,480 --> 00:17:15,030
definitely it's something to look into.

333
00:17:15,030 --> 00:17:18,029
And long term, we have a two,

334
00:17:18,029 --> 00:17:20,880
almost 3% service quarter utilization.

335
00:17:20,880 --> 00:17:24,600
So we can improve this by
using auto scanning policies

336
00:17:24,600 --> 00:17:26,730
and things like that.

337
00:17:26,730 --> 00:17:29,550
Now, one interesting part I
wanna highlight here is like,

338
00:17:29,550 --> 00:17:31,620
a relation with industry create incident.

339
00:17:31,620 --> 00:17:34,860
So one of the things that the
engine we're gonna build today

340
00:17:34,860 --> 00:17:37,940
is gonna do is not only
going into your account

341
00:17:37,940 --> 00:17:40,380
to find stuff and maybe
create some artifacts.

342
00:17:40,380 --> 00:17:45,090
But, what I want when I wake
up 3:00 AM in the morning

343
00:17:45,090 --> 00:17:47,010
and something is happening is like,

344
00:17:47,010 --> 00:17:49,200
is what I'm saying something

345
00:17:49,200 --> 00:17:51,480
that it's well known in the industry?

346
00:17:51,480 --> 00:17:53,010
And that's what the agent is doing.

347
00:17:53,010 --> 00:17:56,040
And if you look here, the security scan

348
00:17:56,040 --> 00:17:58,230
that we seeing into this system,

349
00:17:58,230 --> 00:18:03,000
they're related to WordPress
security vulnerability of 2022.

350
00:18:03,000 --> 00:18:05,940
And the agent is telling
us like, what was that?

351
00:18:05,940 --> 00:18:08,763
It's multiple requests to
WordPress or WordPress login.

352
00:18:10,050 --> 00:18:12,180
You know, what's the industry context?

353
00:18:12,180 --> 00:18:14,550
This was like a problem in 2022.

354
00:18:14,550 --> 00:18:17,430
And what is the applied solution?

355
00:18:17,430 --> 00:18:19,320
AWS web application firewall.

356
00:18:19,320 --> 00:18:22,440
So effectively, the
agent is telling us like,

357
00:18:22,440 --> 00:18:24,150
hey, this is a well-known thing

358
00:18:24,150 --> 00:18:27,630
and the industry has
fixed this in this way,

359
00:18:27,630 --> 00:18:28,740
go off and do it.

360
00:18:28,740 --> 00:18:30,810
And it's also telling us how to do it.

361
00:18:30,810 --> 00:18:32,610
Like, deploy web application firewall,

362
00:18:32,610 --> 00:18:34,341
use the top 10 rule sets

363
00:18:34,341 --> 00:18:37,402
and then enable CloudTrail
for API level monitoring.

364
00:18:37,402 --> 00:18:40,320
And optionally, we can also set up

365
00:18:40,320 --> 00:18:44,610
automated incident response
for those requests, right?

366
00:18:44,610 --> 00:18:45,443
It's pretty cool.

367
00:18:45,443 --> 00:18:47,820
So this just a single run of the agent

368
00:18:47,820 --> 00:18:49,110
that is creating this report

369
00:18:49,110 --> 00:18:52,320
and it found a few things for us.

370
00:18:52,320 --> 00:18:54,630
So now, I think what I wanna do is,

371
00:18:54,630 --> 00:18:57,330
I wanna show you how
the agent is doing that.

372
00:18:57,330 --> 00:19:00,360
So, are you ready for some coding here?

373
00:19:00,360 --> 00:19:01,620
Raise your hand.

374
00:19:01,620 --> 00:19:04,320
Okay, so your laptop out,
I'm kidding you, right?

375
00:19:04,320 --> 00:19:05,730
I'm gonna walk you through the code

376
00:19:05,730 --> 00:19:09,450
and we're gonna see,
unfortunately we only have an hour

377
00:19:09,450 --> 00:19:11,820
for this session, so I'll try my best

378
00:19:11,820 --> 00:19:14,160
to walk through the most interesting code

379
00:19:14,160 --> 00:19:17,130
and then, definitely as as I mentioned,

380
00:19:17,130 --> 00:19:20,430
this is open source so you can go off

381
00:19:20,430 --> 00:19:24,180
and download, change, and try.

382
00:19:24,180 --> 00:19:25,440
Okay, so as I talk,

383
00:19:25,440 --> 00:19:27,330
I'm actually starting the
agent in the terminal.

384
00:19:27,330 --> 00:19:29,370
That's what you're gonna see there running

385
00:19:29,370 --> 00:19:33,540
and we're gonna look at
what it's doing bit by bit,

386
00:19:33,540 --> 00:19:36,270
but don't get distracted too much, okay?

387
00:19:36,270 --> 00:19:40,073
Okay, so when you're gonna
download this repository,

388
00:19:40,073 --> 00:19:43,770
you're gonna see a folder called
observability agent, okay?

389
00:19:43,770 --> 00:19:48,190
And in this folder,
effectively, it's a Python agent

390
00:19:49,530 --> 00:19:51,570
and there is a main file.

391
00:19:51,570 --> 00:19:56,570
So in this main file there
is, effectively some settings

392
00:19:57,630 --> 00:19:59,640
that we're using,
arguments, so effectively,

393
00:19:59,640 --> 00:20:01,830
when we run the agent,
we wanna specify options,

394
00:20:01,830 --> 00:20:03,660
the regions that we're gonna be using

395
00:20:03,660 --> 00:20:05,280
unless we use the default.

396
00:20:05,280 --> 00:20:07,590
You know, whether we want
this reporting markdown

397
00:20:07,590 --> 00:20:10,080
because effectively we wanna
feed a different agent,

398
00:20:10,080 --> 00:20:13,740
for example, or we want HTML
for consuming from an image,

399
00:20:13,740 --> 00:20:15,420
or maybe both, right?

400
00:20:15,420 --> 00:20:18,711
And then definitely if we
want some verbose there

401
00:20:18,711 --> 00:20:21,843
in case you're debugging and
you wanna see what's going on.

402
00:20:23,121 --> 00:20:26,700
But effectively, the most
important lines of code here

403
00:20:26,700 --> 00:20:31,290
is here, line 52 and 53,
where what we're doing is,

404
00:20:31,290 --> 00:20:34,770
we are creating these natural
language observability agent

405
00:20:34,770 --> 00:20:38,160
and we're actually asking the
agent to run the analysis.

406
00:20:38,160 --> 00:20:40,980
Okay, so now, let's go into
this observability agent.

407
00:20:40,980 --> 00:20:42,930
Let's see what we're
talking about here, okay?

408
00:20:42,930 --> 00:20:45,750
So a premise here, Kevin mentioned before,

409
00:20:45,750 --> 00:20:47,820
we're gonna be using a strands agent

410
00:20:47,820 --> 00:20:49,500
across all the code here,

411
00:20:49,500 --> 00:20:52,860
and we're gonna do that
to create our tools

412
00:20:52,860 --> 00:20:57,090
to use MCP servers and tools
and to create the actual agent.

413
00:20:57,090 --> 00:21:00,840
So, and you're gonna see
how easy this is, all right?

414
00:21:00,840 --> 00:21:03,660
So the natural language
of observability agent,

415
00:21:03,660 --> 00:21:07,830
what it does here is, as an innate method

416
00:21:07,830 --> 00:21:10,440
that it's loading the application setting.

417
00:21:10,440 --> 00:21:13,170
So things like regions
and stuff like that.

418
00:21:13,170 --> 00:21:14,760
It's not super interesting,

419
00:21:14,760 --> 00:21:18,000
but it's also initializing
the MCP client manager,

420
00:21:18,000 --> 00:21:19,290
which we're gonna see in a second.

421
00:21:19,290 --> 00:21:23,730
That's where we gonna use
existing tools out there

422
00:21:23,730 --> 00:21:27,600
and that to our agent to
announce its capabilities.

423
00:21:27,600 --> 00:21:29,553
And we have a report generator.

424
00:21:31,144 --> 00:21:33,900
The cluster is gonna be in
charge of creating an HTML

425
00:21:33,900 --> 00:21:37,020
or markdown for us.

426
00:21:37,020 --> 00:21:39,120
And definitely we
initialize the component.

427
00:21:39,120 --> 00:21:43,170
So let me go one second
into the MCP client manager

428
00:21:43,170 --> 00:21:45,780
'cause I wanna show you
what this is, really.

429
00:21:45,780 --> 00:21:49,436
So few of you were not
familiar with the MCP.

430
00:21:49,436 --> 00:21:52,260
So let me do a step back here.

431
00:21:52,260 --> 00:21:54,210
I wanna explain a little bit what it is

432
00:21:55,183 --> 00:21:57,240
so we're all on the same page, okay?

433
00:21:57,240 --> 00:22:00,690
So MCP servers, those are tools.

434
00:22:00,690 --> 00:22:03,120
So MCP stands for model
context protocol, right?

435
00:22:03,120 --> 00:22:05,460
And those are servers that are in general,

436
00:22:05,460 --> 00:22:08,430
vendored by companies like AWS

437
00:22:08,430 --> 00:22:13,430
and they contain tools to
do work, as simple as that.

438
00:22:15,120 --> 00:22:17,580
So, a way to imagine MCP tools is like,

439
00:22:17,580 --> 00:22:21,563
the APIs for LLMs, okay?

440
00:22:23,725 --> 00:22:26,490
So APIs are not that LLM friendly

441
00:22:26,490 --> 00:22:27,920
because you have a bunch of parameters

442
00:22:27,920 --> 00:22:30,360
but the LLM doesn't really know like,

443
00:22:30,360 --> 00:22:32,190
it can do trial and error, right?

444
00:22:32,190 --> 00:22:35,970
But MCP tools are meant
to be like use cases

445
00:22:35,970 --> 00:22:39,540
that that agent and an
LLM can actually use

446
00:22:39,540 --> 00:22:41,970
to fulfill a full job, okay?

447
00:22:41,970 --> 00:22:43,920
And we're gonna see this again

448
00:22:43,920 --> 00:22:46,503
when we're gonna build
our own custom tool.

449
00:22:47,550 --> 00:22:49,050
So there are different tools.

450
00:22:49,050 --> 00:22:52,140
So the idea here is
like, we don't want to,

451
00:22:52,140 --> 00:22:56,046
like for example, we wanna
connect to CloudWatch

452
00:22:56,046 --> 00:22:59,520
or CloudTrail application
signals, all those things.

453
00:22:59,520 --> 00:23:01,710
Like, we don't want to have like a client

454
00:23:01,710 --> 00:23:06,710
and make the agent to try
this API or this other API,

455
00:23:07,470 --> 00:23:09,330
without really having the context

456
00:23:09,330 --> 00:23:11,070
about what it's really doing.

457
00:23:11,070 --> 00:23:12,750
That's what MCPs are for.

458
00:23:12,750 --> 00:23:16,648
And today in this agent we're
gonna use three MCP tools,

459
00:23:16,648 --> 00:23:19,650
the CloudWatch ones that
contains like metrics, logs,

460
00:23:19,650 --> 00:23:21,117
alarms and so on.

461
00:23:21,117 --> 00:23:25,530
Application signals for
monitoring your applications

462
00:23:25,530 --> 00:23:30,270
and CloudTrail to see
logs into your account.

463
00:23:30,270 --> 00:23:35,270
So to create MCP client with strands agent

464
00:23:35,550 --> 00:23:38,520
is as simple as creating an MCP client

465
00:23:38,520 --> 00:23:41,640
and parsing in as an argument,

466
00:23:41,640 --> 00:23:46,640
the handle to the GitHub public
repository handle, right?

467
00:23:47,520 --> 00:23:50,457
Which is AWS labs, CloudWatch MCP server,

468
00:23:50,457 --> 00:23:53,940
AWS labs CloudWatch signal MCP server,

469
00:23:53,940 --> 00:23:56,040
AWS labs CloudWatch MCP server, right?

470
00:23:56,040 --> 00:23:57,660
And you're gonna find a lot of them

471
00:23:57,660 --> 00:24:00,120
into the AWS labs repository.

472
00:24:00,120 --> 00:24:02,190
In this case we're just
gonna use those three, right?

473
00:24:02,190 --> 00:24:03,453
For our use case.

474
00:24:04,859 --> 00:24:07,800
And then, these MCP clients.

475
00:24:07,800 --> 00:24:11,550
So what it does is it
creates the MCP, sorry,

476
00:24:11,550 --> 00:24:14,910
this MCP manager, it
creates those MCP clients

477
00:24:14,910 --> 00:24:16,740
for the clients that we want.

478
00:24:16,740 --> 00:24:19,830
And then it expose them with
a get all tool functions

479
00:24:19,830 --> 00:24:21,480
where we return the tool

480
00:24:21,480 --> 00:24:23,673
that is gonna be used within the agent.

481
00:24:25,260 --> 00:24:30,260
So if we go back to the agent again,

482
00:24:33,232 --> 00:24:36,270
we're gonna see here that we
initialize the components.

483
00:24:36,270 --> 00:24:38,910
So effectively, we ask the MCP
manager, set up the clients,

484
00:24:38,910 --> 00:24:40,170
the code that we just saw, okay?

485
00:24:40,170 --> 00:24:42,120
So we use the AWS labs repository

486
00:24:42,120 --> 00:24:45,750
to create the clients for
us and then create agent.

487
00:24:45,750 --> 00:24:48,540
Okay, so now, before
I go and show you the,

488
00:24:48,540 --> 00:24:51,573
literally two lines of code on
how you can create an agent,

489
00:24:53,190 --> 00:24:54,480
I'm exaggerating a little bit.

490
00:24:54,480 --> 00:24:56,010
I mean, there are technically two lines,

491
00:24:56,010 --> 00:24:57,750
but there is a little bit around that,

492
00:24:57,750 --> 00:25:00,180
I wanna explain to you one
thing that is very important

493
00:25:00,180 --> 00:25:01,013
that we're doing here, right?

494
00:25:01,013 --> 00:25:02,280
So one assumption we're making.

495
00:25:02,280 --> 00:25:06,183
So you saw before in the slides
that Kevin showed us that,

496
00:25:07,260 --> 00:25:09,192
to create an agent,

497
00:25:09,192 --> 00:25:11,850
we're gonna need to
provide them some context

498
00:25:11,850 --> 00:25:14,100
and we're gonna be interactive
with them, all right?

499
00:25:14,100 --> 00:25:15,810
It's a two step process, really.

500
00:25:15,810 --> 00:25:18,720
And this is exactly what we're
gonna do in the code, right?

501
00:25:18,720 --> 00:25:21,360
So the first step is,
we're gonna create an agent

502
00:25:21,360 --> 00:25:24,810
and set up like, make it
stick into some context

503
00:25:24,810 --> 00:25:29,640
and then we're gonna prepare
a well written prompt

504
00:25:29,640 --> 00:25:31,740
of what we're doing to actually invoke it.

505
00:25:32,970 --> 00:25:35,280
At least like one thing,

506
00:25:35,280 --> 00:25:37,593
like in this experience
of building this agent

507
00:25:37,593 --> 00:25:41,251
that we also learned is,
writing a good quality prompt

508
00:25:41,251 --> 00:25:45,660
for the agent is probably as
important as the code itself.

509
00:25:45,660 --> 00:25:46,800
Because if you think about this,

510
00:25:46,800 --> 00:25:48,720
like LLMs are general knowledge,

511
00:25:48,720 --> 00:25:52,500
so the last thing that you
want is you run this agent,

512
00:25:52,500 --> 00:25:54,720
it goes off, you know, maybe
find something for you,

513
00:25:54,720 --> 00:25:56,782
maybe doesn't, but every time

514
00:25:56,782 --> 00:25:59,370
it's telling you something
completely different.

515
00:25:59,370 --> 00:26:03,540
You wanna really, almost
create a tunnel vision for it.

516
00:26:03,540 --> 00:26:05,850
Like, you know about
everything in the world,

517
00:26:05,850 --> 00:26:07,530
we're talking about like monitoring here.

518
00:26:07,530 --> 00:26:09,840
So I want to restrict
your focus into monitoring

519
00:26:09,840 --> 00:26:12,270
and do exactly what I'm
asking you to do, all right?

520
00:26:12,270 --> 00:26:14,130
And you're gonna see a lot of that

521
00:26:14,130 --> 00:26:15,960
into the code starting from now.

522
00:26:15,960 --> 00:26:18,170
Okay, so the first step
is to create an agent.

523
00:26:18,170 --> 00:26:21,930
As I said, we start with a system prompt.

524
00:26:21,930 --> 00:26:24,510
We're gonna go back into
this prompt in a second.

525
00:26:24,510 --> 00:26:27,420
I wanna show you how easy it
is to create an agent itself.

526
00:26:27,420 --> 00:26:29,910
So to create an agent,
all you need to do is,

527
00:26:29,910 --> 00:26:31,980
instantiate an agent class,

528
00:26:31,980 --> 00:26:33,750
you're gonna pass the system prompt to it.

529
00:26:33,750 --> 00:26:35,310
This is gonna be the initial context,

530
00:26:35,310 --> 00:26:37,500
who the agent is, right?

531
00:26:37,500 --> 00:26:40,410
Is the persona, like, who
are you impersonating.

532
00:26:40,410 --> 00:26:43,230
And then you're gonna send
a list of tools to it.

533
00:26:43,230 --> 00:26:46,020
So those are the tools
that an agent can use.

534
00:26:46,020 --> 00:26:48,840
And you can see here HDP
requests, which you know,

535
00:26:48,840 --> 00:26:52,770
basically means you can go
off the web and search stuff

536
00:26:52,770 --> 00:26:56,700
and that's gonna be used
for postmortem search

537
00:26:56,700 --> 00:26:58,230
and create CloudWatch alarm,

538
00:26:58,230 --> 00:27:01,650
which is our custom tools
we're gonna see in a second.

539
00:27:01,650 --> 00:27:03,900
And then there are MCP tools,

540
00:27:03,900 --> 00:27:07,620
which are the tools that are
coming from the MCP manager.

541
00:27:07,620 --> 00:27:10,263
So CloudWatch, CloudTrail,
and application signal.

542
00:27:11,222 --> 00:27:15,300
So now, let's spend some time
just looking into this prompt

543
00:27:15,300 --> 00:27:17,730
'cause I think it's really worth it.

544
00:27:17,730 --> 00:27:20,970
So this is the context
that we set the agent on

545
00:27:20,970 --> 00:27:22,830
and we say as the first thing,

546
00:27:22,830 --> 00:27:24,990
you are an observability expert.

547
00:27:24,990 --> 00:27:27,390
So we're really, remember
the tunnel visioning thing?

548
00:27:27,390 --> 00:27:29,580
Like, we're saying to
the agent who you are,

549
00:27:29,580 --> 00:27:30,660
what's the persona?

550
00:27:30,660 --> 00:27:32,910
And we describe what are the capabilities.

551
00:27:32,910 --> 00:27:35,850
So discovering, analyzing resources,

552
00:27:35,850 --> 00:27:37,980
querying CloudWatch
metrics, CloudTrail event,

553
00:27:37,980 --> 00:27:40,290
correlating data and so on.

554
00:27:40,290 --> 00:27:41,910
You know, create CloudWatch alarm

555
00:27:41,910 --> 00:27:46,440
using the tool that we
created for the agent itself,

556
00:27:46,440 --> 00:27:48,690
and generate reports.

557
00:27:48,690 --> 00:27:51,180
So now, one thing we're
gonna need to do is like,

558
00:27:51,180 --> 00:27:54,150
if you're generic enough
in your prompt, right?

559
00:27:54,150 --> 00:27:57,030
So you say like go off
and find the stuff for me.

560
00:27:57,030 --> 00:27:58,703
Like, what does that mean for the LLM?

561
00:27:58,703 --> 00:28:03,240
Like, it probably will go off
and do definitely something,

562
00:28:03,240 --> 00:28:05,220
but we want to be precise, remember?

563
00:28:05,220 --> 00:28:08,495
And so we want to tell the agent

564
00:28:08,495 --> 00:28:13,320
how it's supposed to analyze
the AWS infrastructure.

565
00:28:13,320 --> 00:28:15,660
And so we say, discover the resources

566
00:28:15,660 --> 00:28:17,280
that exist in the region,

567
00:28:17,280 --> 00:28:19,500
get infrastructure and
application metrics.

568
00:28:19,500 --> 00:28:21,300
That's one way you can discover resources.

569
00:28:21,300 --> 00:28:24,720
Like, don't go off and call
all the APIs for 250 services.

570
00:28:24,720 --> 00:28:27,060
That's gonna be mental, it's
gonna take like days to run.

571
00:28:27,060 --> 00:28:29,066
So one way you can avoid that,

572
00:28:29,066 --> 00:28:31,740
go off into your observability artifacts,

573
00:28:31,740 --> 00:28:33,330
you're gonna see metrics and logs

574
00:28:33,330 --> 00:28:35,790
and that's how you can reverse engineer

575
00:28:35,790 --> 00:28:37,290
the resources that you have, all right?

576
00:28:37,290 --> 00:28:40,470
It's a shortcut for the agent,

577
00:28:40,470 --> 00:28:42,630
but you see how important that is.

578
00:28:42,630 --> 00:28:45,000
And then check for existing alarms

579
00:28:45,000 --> 00:28:46,800
and look for pattern anomalies,

580
00:28:46,800 --> 00:28:49,923
and then generate
actionable recommendation.

581
00:28:51,030 --> 00:28:53,430
Now one important thing here is like,

582
00:28:53,430 --> 00:28:55,470
we're saying to the agent context,

583
00:28:55,470 --> 00:28:57,510
be conservative with alarm creation.

584
00:28:57,510 --> 00:29:00,870
Remember, the agent will
do what we tell him to do.

585
00:29:00,870 --> 00:29:05,386
So if you're not really
precise to the intent,

586
00:29:05,386 --> 00:29:09,180
every time these agent will
run, we'll create alarms for us

587
00:29:09,180 --> 00:29:11,400
because we're saying like, go off,

588
00:29:11,400 --> 00:29:14,190
identify alarms that you
should create and create them.

589
00:29:14,190 --> 00:29:15,240
But we don't want that

590
00:29:15,240 --> 00:29:20,100
because you can end up creating
alarms that are very similar

591
00:29:20,100 --> 00:29:21,975
maybe different configurations slightly,

592
00:29:21,975 --> 00:29:24,030
data point or threshold to alarm,

593
00:29:24,030 --> 00:29:26,100
but effectively the same semantic, right?

594
00:29:26,100 --> 00:29:29,760
We don't want that, we want
alarms only on genuine gaps.

595
00:29:29,760 --> 00:29:31,320
And that's exactly what we're saying here.

596
00:29:31,320 --> 00:29:32,640
So be conservative.

597
00:29:32,640 --> 00:29:35,400
We want those alarm for genuine gaps,

598
00:29:35,400 --> 00:29:38,883
do not create duplicate or
near duplicate alarms, okay?

599
00:29:41,190 --> 00:29:46,190
Then we ask him, please put some attention

600
00:29:47,460 --> 00:29:50,040
into the resource type,
the key metrics, deep links

601
00:29:50,040 --> 00:29:55,040
'cause we want that one step
click to the AWS console.

602
00:29:55,500 --> 00:29:59,370
And we say what should be
focusing on, performance,

603
00:29:59,370 --> 00:30:01,620
monitoring, customer
experience, customer impact

604
00:30:01,620 --> 00:30:04,440
and optimization, cost, security.

605
00:30:04,440 --> 00:30:06,480
That's how we found out the security scan

606
00:30:06,480 --> 00:30:07,440
that we saw before.

607
00:30:07,440 --> 00:30:09,360
And operational excellence improvement.

608
00:30:09,360 --> 00:30:10,710
You know, all the thing about like,

609
00:30:10,710 --> 00:30:12,600
hey, you have two gig of logs,

610
00:30:12,600 --> 00:30:14,513
there is something you can do about it.

611
00:30:16,650 --> 00:30:20,820
So now one interesting thing
here as we say is, hey,

612
00:30:20,820 --> 00:30:23,730
we're also providing a create
CloudWatch alarm tool here.

613
00:30:23,730 --> 00:30:26,100
So when you need to create those alarm,

614
00:30:26,100 --> 00:30:27,960
that's the tool you're gonna need to use.

615
00:30:27,960 --> 00:30:31,680
Don't go off and try to use a Boto client

616
00:30:31,680 --> 00:30:33,240
or any API by yourself,

617
00:30:33,240 --> 00:30:35,670
I'm gonna provide you a tool to do that.

618
00:30:35,670 --> 00:30:38,970
Last but not the least,
be thorough, but concise.

619
00:30:38,970 --> 00:30:43,970
So, okay, so at this stage
what we've done is go back here

620
00:30:44,130 --> 00:30:48,090
and this is what our natural
observability agent is.

621
00:30:48,090 --> 00:30:50,160
And at this stage, as first step,

622
00:30:50,160 --> 00:30:52,620
we have the agent primed with the context.

623
00:30:52,620 --> 00:30:56,610
He has the tools that he can
use, the MCP tools as well.

624
00:30:56,610 --> 00:31:00,674
And now it's the next step
where we can actually go off

625
00:31:00,674 --> 00:31:03,843
and run the analysis, all right?

626
00:31:07,440 --> 00:31:08,273
Okay, cool.

627
00:31:08,273 --> 00:31:12,600
So let's see how do we
run this analysis, okay?

628
00:31:12,600 --> 00:31:15,220
So in this method here, you're gonna see

629
00:31:16,465 --> 00:31:17,850
that there are two steps.

630
00:31:17,850 --> 00:31:22,290
So one that says like, okay,
discover and analyze resources

631
00:31:22,290 --> 00:31:25,500
and then generate the report, okay?

632
00:31:25,500 --> 00:31:30,500
So let's go and look at how
we discover these resources.

633
00:31:30,720 --> 00:31:33,090
So once again, here is the second step

634
00:31:33,090 --> 00:31:35,910
where we are gonna be
interacting with the agent.

635
00:31:35,910 --> 00:31:38,490
And I'm gonna skip the query for a second

636
00:31:38,490 --> 00:31:40,680
'cause we're gonna see what it looks like.

637
00:31:40,680 --> 00:31:45,150
But one thing that it's worth
to look at here is like,

638
00:31:45,150 --> 00:31:47,850
how do we invoke the agent?

639
00:31:47,850 --> 00:31:52,770
So invoking the agent is as
simple as, use agent as a method

640
00:31:52,770 --> 00:31:57,630
and pass on the prompt that we wrote above

641
00:31:57,630 --> 00:31:59,280
that we're gonna see in a second, okay?

642
00:31:59,280 --> 00:32:03,633
So what that will do is,
we'll start the agent,

643
00:32:04,560 --> 00:32:07,470
we'll send the prompt,
LLM will start working.

644
00:32:07,470 --> 00:32:09,270
We'll go find out the things,

645
00:32:09,270 --> 00:32:11,130
you know, using the tools
and everything like that.

646
00:32:11,130 --> 00:32:13,440
And then we're gonna have results,

647
00:32:13,440 --> 00:32:16,620
another language result from the agent.

648
00:32:16,620 --> 00:32:18,540
And then we're gonna parse
it, we're gonna extract

649
00:32:18,540 --> 00:32:20,790
and do some notification that
we're gonna see in a second.

650
00:32:20,790 --> 00:32:22,170
Now, there are two things here

651
00:32:22,170 --> 00:32:24,060
that are important to know this, right?

652
00:32:24,060 --> 00:32:27,660
So the first is when we say,

653
00:32:27,660 --> 00:32:30,180
MCP manager execute with client.

654
00:32:30,180 --> 00:32:34,260
So if you go back here,
we have this function

655
00:32:34,260 --> 00:32:38,250
that is maybe can be seen
as cryptic at the beginning,

656
00:32:38,250 --> 00:32:40,800
but effectively, we have
a context manager here

657
00:32:40,800 --> 00:32:45,800
that is connecting the
clients to the MCP server.

658
00:32:46,440 --> 00:32:50,310
So remember, when we say
we have agent creations,

659
00:32:50,310 --> 00:32:53,730
step number one, and agent
invocation is step number two.

660
00:32:53,730 --> 00:32:57,090
So the idea here is, we
don't want the clients

661
00:32:57,090 --> 00:33:00,180
to be connected for all
the lifetime of the agent

662
00:33:00,180 --> 00:33:01,590
to the agent itself.

663
00:33:01,590 --> 00:33:04,290
We want to connect the clients just

664
00:33:04,290 --> 00:33:06,540
and only when we invoke them.

665
00:33:06,540 --> 00:33:09,363
And that's the reason why
when we create the agent,

666
00:33:10,290 --> 00:33:11,940
we invocate all tools.

667
00:33:11,940 --> 00:33:15,180
So we prime the agent with
the client initialization,

668
00:33:15,180 --> 00:33:17,490
but there is no connection
to the MCP server

669
00:33:17,490 --> 00:33:18,840
and the client itself.

670
00:33:18,840 --> 00:33:22,110
But then when we're actually
invoking the agent here,

671
00:33:22,110 --> 00:33:23,730
we do agent query,

672
00:33:23,730 --> 00:33:26,190
that's where we actually
need to execute with clients.

673
00:33:26,190 --> 00:33:27,767
So effectively what we're
doing there is like,

674
00:33:27,767 --> 00:33:29,760
we are saying to the initialized client,

675
00:33:29,760 --> 00:33:31,530
connect to the MCP servers now

676
00:33:31,530 --> 00:33:35,133
'cause I'm gonna need
to use the LLM, right?

677
00:33:36,544 --> 00:33:37,530
Okay, cool.

678
00:33:37,530 --> 00:33:42,530
So now, effectively this line
here is what you're seeing

679
00:33:42,900 --> 00:33:45,180
in my terminal here, like
everything that is happening,

680
00:33:45,180 --> 00:33:47,760
it's because the agent has been invoked.

681
00:33:47,760 --> 00:33:51,270
And after this what we
do is we extract metric

682
00:33:51,270 --> 00:33:54,240
from the response and then
we return the markdown

683
00:33:54,240 --> 00:33:55,320
and the metric data.

684
00:33:55,320 --> 00:33:58,164
So now, before we look into this,

685
00:33:58,164 --> 00:34:00,744
I wanna go back into our prompt here

686
00:34:00,744 --> 00:34:02,910
'cause you can see this prompt
is quite verbose, right?

687
00:34:02,910 --> 00:34:04,773
And there's a reason for that.

688
00:34:06,614 --> 00:34:09,060
So the prompt is what we're
asking the agent to do.

689
00:34:09,060 --> 00:34:10,560
This is the core of the thing here, right?

690
00:34:10,560 --> 00:34:12,063
So what should it do?

691
00:34:12,960 --> 00:34:15,990
And so, the query is like,
analyze my infrastructure

692
00:34:15,990 --> 00:34:18,283
and create the report,
that's what we want.

693
00:34:18,283 --> 00:34:22,830
But before we go down, there is something

694
00:34:22,830 --> 00:34:25,950
that it's worth to mention
and I'm stressing this a lot

695
00:34:25,950 --> 00:34:29,730
because it's important,
which is, agent is stateless

696
00:34:29,730 --> 00:34:32,820
unless you're gonna be fitting
with the previous run, right?

697
00:34:32,820 --> 00:34:35,402
Which is something that we can do here.

698
00:34:35,402 --> 00:34:37,983
But every time you're gonna run it,

699
00:34:37,983 --> 00:34:41,130
it's gonna go off and do
stuff, we say this already.

700
00:34:41,130 --> 00:34:44,580
And so, to create a report
that makes sense for humans,

701
00:34:44,580 --> 00:34:46,890
you don't want them to
be random, all right?

702
00:34:46,890 --> 00:34:48,390
And you're gonna find very quickly

703
00:34:48,390 --> 00:34:51,960
if you try to create an agent yourself

704
00:34:51,960 --> 00:34:55,440
without looking into
this code that the LLM,

705
00:34:55,440 --> 00:34:58,680
what it's gonna do is, it's
gonna make like a few mistakes

706
00:34:58,680 --> 00:34:59,760
and a few hallucination.

707
00:34:59,760 --> 00:35:01,830
For example, it's gonna go off,

708
00:35:01,830 --> 00:35:04,013
look at stuff and then
perhaps generate metrics

709
00:35:04,013 --> 00:35:07,523
with what it thinks is the
right thing to show you.

710
00:35:07,523 --> 00:35:12,523
Or creating sections that
are probably random, right?

711
00:35:12,780 --> 00:35:14,250
It's not the one that you expect.

712
00:35:14,250 --> 00:35:17,220
So it's not structured in
a way for a human to read

713
00:35:17,220 --> 00:35:19,590
or for you to parse and send, for example,

714
00:35:19,590 --> 00:35:21,120
to an agent pipeline, all right?

715
00:35:21,120 --> 00:35:23,610
And we wanna fix all of
that with this prompt, okay?

716
00:35:23,610 --> 00:35:25,140
So that's why it's very important.

717
00:35:25,140 --> 00:35:30,140
So what we say here is like,
this is a multiple step job

718
00:35:30,390 --> 00:35:32,430
so please, first thing is,

719
00:35:32,430 --> 00:35:34,050
you're gonna need to discover resources,

720
00:35:34,050 --> 00:35:37,180
find all the resources and
their relevant metrics.

721
00:35:37,180 --> 00:35:40,770
There are compute resources,
database, serverless,

722
00:35:40,770 --> 00:35:43,980
load balancers, storage
services and so on.

723
00:35:43,980 --> 00:35:46,290
Then you're gonna need
to analyze the health

724
00:35:46,290 --> 00:35:47,610
for each resource.

725
00:35:47,610 --> 00:35:52,410
Go look into their metrics,
values, trends, health status,

726
00:35:52,410 --> 00:35:57,120
active alarms, recent incidents,
performance and so on.

727
00:35:57,120 --> 00:35:58,980
And then we need to generate deep links.

728
00:35:58,980 --> 00:36:03,490
'cause the report is gonna
allow us to go into the console.

729
00:36:05,940 --> 00:36:06,840
And then step four

730
00:36:06,840 --> 00:36:09,390
is where we link to the postmortem, right?

731
00:36:09,390 --> 00:36:11,430
So the public incidents.

732
00:36:11,430 --> 00:36:15,813
And so, for any issue,
looking into postmortem up

733
00:36:18,330 --> 00:36:19,860
for similar instance.

734
00:36:19,860 --> 00:36:22,920
And don't do that just for the love,

735
00:36:22,920 --> 00:36:26,880
go check if what you're seeing makes sense

736
00:36:26,880 --> 00:36:28,710
with the publicly available incidents.

737
00:36:28,710 --> 00:36:30,330
Don't force it, okay?

738
00:36:30,330 --> 00:36:32,220
Because otherwise, it would just say like,

739
00:36:32,220 --> 00:36:34,950
okay, so there is this
incident that maybe is related,

740
00:36:34,950 --> 00:36:36,720
but there is really nothing to do with it.

741
00:36:36,720 --> 00:36:39,210
So we're just saying like,
okay, so go look into that,

742
00:36:39,210 --> 00:36:42,390
but only show up if it's really required.

743
00:36:42,390 --> 00:36:46,950
Now, then there is the alarm
management section where,

744
00:36:46,950 --> 00:36:48,270
so this is kind of interesting

745
00:36:48,270 --> 00:36:51,930
because what we do here is
like, so think about this.

746
00:36:51,930 --> 00:36:54,510
So the agent is gonna go into your account

747
00:36:54,510 --> 00:36:56,850
and we need to get some recommendation

748
00:36:56,850 --> 00:36:58,740
and perhaps creating some alarms, okay?

749
00:36:58,740 --> 00:37:01,380
And we need to tell the agent,
how do you create alarms.

750
00:37:01,380 --> 00:37:04,500
Like, how can you come up with
an alarm that makes sense?

751
00:37:04,500 --> 00:37:06,270
You know, alarms are complicated, right?

752
00:37:06,270 --> 00:37:07,770
You need to choose the right metrics,

753
00:37:07,770 --> 00:37:12,300
or maybe set the metrics,
or a query to alarm on.

754
00:37:12,300 --> 00:37:14,850
You need to find the right threshold.

755
00:37:14,850 --> 00:37:17,790
Data point missing, how do you treat that?

756
00:37:17,790 --> 00:37:19,560
Should the alarm be breaching or not?

757
00:37:19,560 --> 00:37:22,350
And so, to solve all these
problem, what we do is,

758
00:37:22,350 --> 00:37:27,350
we actually use MCP tools,
the CloudWatch MCP tools.

759
00:37:27,390 --> 00:37:28,650
They have a tool that is called,

760
00:37:28,650 --> 00:37:31,020
get recommended metrics alarms.

761
00:37:31,020 --> 00:37:33,640
So this tool, it's vendored by AWS

762
00:37:33,640 --> 00:37:36,150
and it's in the MCP tools servers.

763
00:37:36,150 --> 00:37:39,450
And what it does is, it provides the LLMs

764
00:37:39,450 --> 00:37:42,720
a kind of best practice
recommendation for alarming,

765
00:37:42,720 --> 00:37:43,860
where you're gonna see

766
00:37:43,860 --> 00:37:47,070
how different AWS services metrics relate

767
00:37:47,070 --> 00:37:49,414
to a good alarms recommendation thresholds

768
00:37:49,414 --> 00:37:50,940
and things like that.

769
00:37:50,940 --> 00:37:53,614
And that's to prime the LLM and say like,

770
00:37:53,614 --> 00:37:55,762
go check that first, right?

771
00:37:55,762 --> 00:38:00,270
This is our best practice
alarm from AWS itself.

772
00:38:00,270 --> 00:38:04,140
And after you do that,
check existing alarms,

773
00:38:04,140 --> 00:38:06,840
you do comparison with best practices

774
00:38:06,840 --> 00:38:10,830
and then only create new alarm
if there are gaps, as we say,

775
00:38:10,830 --> 00:38:12,600
do not create duplicate alarms.

776
00:38:12,600 --> 00:38:15,040
And then at some point we say

777
00:38:16,560 --> 00:38:18,900
that you can actually use
the tool that we created

778
00:38:18,900 --> 00:38:21,330
to create those alarms.

779
00:38:21,330 --> 00:38:25,680
And then we ask next,
gimme a recommendation.

780
00:38:25,680 --> 00:38:27,720
Include actionable
insights for performance,

781
00:38:27,720 --> 00:38:30,363
cost monitoring and security.

782
00:38:31,710 --> 00:38:32,543
So far so good.

783
00:38:32,543 --> 00:38:34,800
So this is what we are
asking the agent to do.

784
00:38:34,800 --> 00:38:36,360
But we can't stop there as we say

785
00:38:36,360 --> 00:38:38,100
'cause the agent will output something

786
00:38:38,100 --> 00:38:39,540
that is completely different every time.

787
00:38:39,540 --> 00:38:40,620
So we need to parse this.

788
00:38:40,620 --> 00:38:42,327
'Cause remember, we
want to create a report

789
00:38:42,327 --> 00:38:45,330
and we want that report to be
as much stable as possible.

790
00:38:45,330 --> 00:38:47,400
And that's why we say
to the agent, critical,

791
00:38:47,400 --> 00:38:50,340
we're gonna need to structure
this report exactly this way.

792
00:38:50,340 --> 00:38:53,190
We want an executive
summary two, three sentences

793
00:38:53,190 --> 00:38:55,200
of what you found.

794
00:38:55,200 --> 00:38:59,220
Active alarms and issues,
operational audit overview,

795
00:38:59,220 --> 00:39:02,340
operational findings,
action recommendations

796
00:39:02,340 --> 00:39:04,770
and relation to industry create incidents.

797
00:39:04,770 --> 00:39:06,360
Remember that, like in our report,

798
00:39:06,360 --> 00:39:09,310
that's exactly the sections
that we've been through, right?

799
00:39:11,130 --> 00:39:13,950
So, and then another critical
requirement we're saying is,

800
00:39:13,950 --> 00:39:16,560
don't come up with some
time series on your own.

801
00:39:16,560 --> 00:39:19,680
Use the time series that
I have in CloudWatch,

802
00:39:19,680 --> 00:39:24,450
use the MCP tool get metric
data and then return them back

803
00:39:24,450 --> 00:39:26,610
so that I can actually
print my time series

804
00:39:26,610 --> 00:39:27,807
like as we saw in the report.

805
00:39:27,807 --> 00:39:29,190
And that's also very important.

806
00:39:29,190 --> 00:39:32,430
'Cause what the LLM will do in general is,

807
00:39:32,430 --> 00:39:35,370
it will analyze your
environment and stuff like that,

808
00:39:35,370 --> 00:39:38,250
perhaps looking into some slides window

809
00:39:38,250 --> 00:39:40,200
and then just make up values for you,

810
00:39:40,200 --> 00:39:42,030
which is not what we want.

811
00:39:42,030 --> 00:39:45,930
And to do that we also asking the agent

812
00:39:45,930 --> 00:39:48,900
to provide a JSON into the output

813
00:39:48,900 --> 00:39:52,200
where we have the list of the metric names

814
00:39:52,200 --> 00:39:54,360
with the timestamps, the values, the unit,

815
00:39:54,360 --> 00:39:55,440
and the brief description

816
00:39:55,440 --> 00:40:00,243
so we can craft that into our report.

817
00:40:01,830 --> 00:40:02,850
So perfect.

818
00:40:02,850 --> 00:40:06,180
So we're back to here
where we run the agent

819
00:40:06,180 --> 00:40:07,470
with this prompt.

820
00:40:07,470 --> 00:40:10,796
And so from the markdown
result that you're gonna see

821
00:40:10,796 --> 00:40:15,178
in the run here, you see, in the report

822
00:40:15,178 --> 00:40:19,590
that is effectively like all
the section we talked about.

823
00:40:19,590 --> 00:40:24,590
But what we need to do here
is, we need to parse the JSON,

824
00:40:26,883 --> 00:40:28,620
for the metrics and, and all of that.

825
00:40:28,620 --> 00:40:31,084
So effectively, we don't
want to show the JSON

826
00:40:31,084 --> 00:40:34,560
into the HTMR report.

827
00:40:34,560 --> 00:40:36,180
And so, that's why what we do is like,

828
00:40:36,180 --> 00:40:37,980
we instruct this JSON, parse it

829
00:40:37,980 --> 00:40:40,260
so that we can provide
to our JavaScript library

830
00:40:40,260 --> 00:40:42,750
and we remove it from the markdown itself.

831
00:40:42,750 --> 00:40:45,000
And that's effectively
what we're doing here.

832
00:40:45,000 --> 00:40:46,200
And then we return the markdown

833
00:40:46,200 --> 00:40:48,950
with all the content that we
found and the metric data.

834
00:40:50,160 --> 00:40:52,983
So at this stage, if we go back up here,

835
00:40:55,710 --> 00:40:58,332
that's where we analyzed our results.

836
00:40:58,332 --> 00:41:01,860
And then at this stage we're
gonna generate the report.

837
00:41:01,860 --> 00:41:05,623
So we generate this report
with the analysis result

838
00:41:05,623 --> 00:41:07,200
and the metric data.

839
00:41:07,200 --> 00:41:11,700
Now we can check this, sorry,
this method very quickly.

840
00:41:11,700 --> 00:41:15,270
But in reality what we're doing here is,

841
00:41:15,270 --> 00:41:18,060
we're getting the markdown and the JSON,

842
00:41:18,060 --> 00:41:20,520
and then we're using Jinja template.

843
00:41:20,520 --> 00:41:25,520
So in the template
folder, there is an HTML,

844
00:41:25,620 --> 00:41:27,695
which has like CSS and everything else.

845
00:41:27,695 --> 00:41:31,170
And effectively this is a Jinja template

846
00:41:31,170 --> 00:41:35,190
where we are iterating over
the markdown and print it over,

847
00:41:35,190 --> 00:41:37,290
and then use the JSON for the metrics

848
00:41:37,290 --> 00:41:40,350
and generate the graphs that
you've seen before, okay?

849
00:41:40,350 --> 00:41:41,643
So nothing special there.

850
00:41:43,530 --> 00:41:48,153
So one thing I want to
talk about though is,

851
00:41:49,350 --> 00:41:51,900
we saw how we invoked this agent,

852
00:41:51,900 --> 00:41:56,820
but we also want to see how
we're instructing the agent

853
00:41:56,820 --> 00:41:57,960
to create those alarms, right?

854
00:41:57,960 --> 00:42:00,930
And that's where we
actually creating our tools.

855
00:42:00,930 --> 00:42:03,180
So if you go into the tool folder,

856
00:42:03,180 --> 00:42:05,640
there is an alarm tool file.

857
00:42:05,640 --> 00:42:09,660
So this is the tool that is used

858
00:42:09,660 --> 00:42:11,700
for the agent to create an alarm.

859
00:42:11,700 --> 00:42:13,710
There are a few things
that are important here

860
00:42:13,710 --> 00:42:15,420
to keep in mind.

861
00:42:15,420 --> 00:42:19,770
So the first thing is, we
need to make our methods,

862
00:42:19,770 --> 00:42:23,760
our Python code to be
exposed as a tool for MCP.

863
00:42:23,760 --> 00:42:28,760
And that is as easy as
annotate with Art tool.

864
00:42:29,130 --> 00:42:33,750
Art tool is a strands annotation

865
00:42:33,750 --> 00:42:36,840
that you can just use on
any method that you want.

866
00:42:36,840 --> 00:42:38,193
And that's about it.

867
00:42:39,182 --> 00:42:40,500
You have your tool, right?

868
00:42:40,500 --> 00:42:42,840
So at that stage you can actually take it

869
00:42:42,840 --> 00:42:44,670
and fit it into the agent.

870
00:42:44,670 --> 00:42:47,070
However, if you do that,

871
00:42:47,070 --> 00:42:49,680
you gonna have a problem
pretty soon, right?

872
00:42:49,680 --> 00:42:53,163
Because if you look into these
create CloudWatch alarms,

873
00:42:54,241 --> 00:42:57,000
when you create an
alarm, as we said before,

874
00:42:57,000 --> 00:42:59,970
it's not as easy as
like, just create a name,

875
00:42:59,970 --> 00:43:01,530
maybe a metric and that's about it.

876
00:43:01,530 --> 00:43:04,110
Like, there is a lot of configuration,

877
00:43:04,110 --> 00:43:07,170
like there is alarm name, metric
name, namespace, and so on.

878
00:43:07,170 --> 00:43:08,610
But most importantly,

879
00:43:08,610 --> 00:43:11,220
there are like some configuration
here, like for example,

880
00:43:11,220 --> 00:43:14,430
comparison operator greater than threshold

881
00:43:14,430 --> 00:43:16,100
or statistic coverage,

882
00:43:16,100 --> 00:43:20,400
that if we don't instruct
a agent on how to use them,

883
00:43:20,400 --> 00:43:23,850
it would just go off and
try like average, AVG

884
00:43:23,850 --> 00:43:25,350
or something else.

885
00:43:25,350 --> 00:43:27,480
Or maybe it's like all over letters

886
00:43:27,480 --> 00:43:31,290
and you're gonna have errors
from the client every time.

887
00:43:31,290 --> 00:43:33,390
And then at some point the
agent will surrender and say,

888
00:43:33,390 --> 00:43:35,550
I'm gonna try a different way, right?

889
00:43:35,550 --> 00:43:36,510
We don't want that.

890
00:43:36,510 --> 00:43:39,420
And that's why although
creating a tool is as simple

891
00:43:39,420 --> 00:43:43,630
as adding this annotation,
again, giving the context

892
00:43:44,820 --> 00:43:47,580
to the LLM is probably one
of the most critical thing

893
00:43:47,580 --> 00:43:48,750
you're gonna need to do here.

894
00:43:48,750 --> 00:43:51,180
And that's exactly what we do next.

895
00:43:51,180 --> 00:43:53,520
So we say what this tool is about.

896
00:43:53,520 --> 00:43:58,520
This is for the LLM to know
what this code is about to do.

897
00:43:59,640 --> 00:44:03,000
And you can see we say,
this is for creating alarms,

898
00:44:03,000 --> 00:44:04,350
they're a common use case

899
00:44:04,350 --> 00:44:06,810
and then we talk about the arguments.

900
00:44:06,810 --> 00:44:09,750
So we have alarm name, metric
name, namespace, and so on.

901
00:44:09,750 --> 00:44:11,880
And see here, comparison operator.

902
00:44:11,880 --> 00:44:15,818
Don't come up with some parameters
that probably won't work.

903
00:44:15,818 --> 00:44:18,480
This comparator operator can
be greater than threshold,

904
00:44:18,480 --> 00:44:21,180
less than threshold, greater
than or equals to threshold.

905
00:44:21,180 --> 00:44:22,170
Same with statistic.

906
00:44:22,170 --> 00:44:25,080
You can only use average, sum,
minimum, and maximum, right?

907
00:44:25,080 --> 00:44:28,320
And this is important, this
is how the agent can go off,

908
00:44:28,320 --> 00:44:30,783
use the tool in one shot, it works okay?

909
00:44:31,860 --> 00:44:35,070
And then we say, what we returns back

910
00:44:35,070 --> 00:44:38,970
and some examples of how to use the tool.

911
00:44:38,970 --> 00:44:40,533
And then the tool itself is,

912
00:44:41,760 --> 00:44:44,365
it's a mirror of our
CloudWatch alarms APIs.

913
00:44:44,365 --> 00:44:47,760
So CloudWatch alarms provides an API

914
00:44:47,760 --> 00:44:49,290
that is called put metric alarm

915
00:44:49,290 --> 00:44:51,030
where you send all those parameters

916
00:44:51,030 --> 00:44:53,250
and you just create an alarm.

917
00:44:53,250 --> 00:44:55,680
Now this tool has been done on
purpose just for simplicity.

918
00:44:55,680 --> 00:44:57,150
It's a mirror of the API.

919
00:44:57,150 --> 00:44:59,430
But in reality, think about tools as like,

920
00:44:59,430 --> 00:45:01,920
you pass only the parameters
that you really need

921
00:45:01,920 --> 00:45:05,670
for your use case and then the
code will do the rest, right?

922
00:45:05,670 --> 00:45:07,707
So you make it simple
for the LLM to use it.

923
00:45:07,707 --> 00:45:10,380
And so here, all we are doing is,

924
00:45:10,380 --> 00:45:13,005
we're using a Boto3 client for CloudWatch

925
00:45:13,005 --> 00:45:16,590
and then we do some
validation and all of that.

926
00:45:16,590 --> 00:45:20,100
And then we create a dictionary
with the alarm configuration

927
00:45:20,100 --> 00:45:22,410
after validating parameters,

928
00:45:22,410 --> 00:45:26,130
and then we call put metric alarm

929
00:45:26,130 --> 00:45:28,350
with that configuration, right?

930
00:45:28,350 --> 00:45:31,050
And this is exactly the same strategy

931
00:45:31,050 --> 00:45:33,180
that is used into the MCP tools.

932
00:45:33,180 --> 00:45:36,390
If you go off and open the AWS
labs code, you're gonna see

933
00:45:36,390 --> 00:45:38,640
that they're kinda like
very similar to this.

934
00:45:38,640 --> 00:45:42,300
Some are like a little bit
more complex, for example

935
00:45:42,300 --> 00:45:45,117
there is a metrics insights tool,

936
00:45:45,117 --> 00:45:50,117
which is the SQL language to
query metrics for CloudWatch.

937
00:45:51,720 --> 00:45:53,130
So that's a little bit more complex.

938
00:45:53,130 --> 00:45:56,430
So obviously you're gonna need
to build the SQL statements

939
00:45:56,430 --> 00:45:58,887
and stuff, but most of the common tools

940
00:45:58,887 --> 00:46:01,890
are kind of like a mirror of the APIs

941
00:46:01,890 --> 00:46:04,353
or like, with some flavor of it.

942
00:46:05,610 --> 00:46:07,650
So that's our agent.

943
00:46:07,650 --> 00:46:10,800
Now, one thing I wanna show you quickly

944
00:46:10,800 --> 00:46:15,780
is what our terminal
has output to us, right?

945
00:46:15,780 --> 00:46:18,490
So you can see, I can go up above here

946
00:46:19,830 --> 00:46:21,750
when the terminal was running

947
00:46:21,750 --> 00:46:24,480
and you can see like all the
metrics that he found out.

948
00:46:24,480 --> 00:46:27,420
So now I actually run
out of the space here,

949
00:46:27,420 --> 00:46:32,420
but you can see there is an
application signal MCP server,

950
00:46:33,660 --> 00:46:36,840
which is doing like
execute audit API, right?

951
00:46:36,840 --> 00:46:38,610
So there are like multiple invocation

952
00:46:38,610 --> 00:46:40,205
of the MCP servers here.

953
00:46:40,205 --> 00:46:44,853
Like, or if we scroll
down, you're gonna see,

954
00:46:48,870 --> 00:46:53,253
so this is still auditing,
still auditing, that's good.

955
00:46:54,270 --> 00:46:56,823
So I'm gonna show you something there.

956
00:46:59,430 --> 00:47:01,650
Yeah, so for example, like
publish metrics tools,

957
00:47:01,650 --> 00:47:03,960
this is another MCP tools
where we're saying like,

958
00:47:03,960 --> 00:47:06,120
okay, so building metrics insights query

959
00:47:06,120 --> 00:47:08,280
for AWS EC2 CPU utilization.

960
00:47:08,280 --> 00:47:10,053
So effectively this line here,

961
00:47:10,890 --> 00:47:13,080
you see like we're using the MCP tools

962
00:47:13,080 --> 00:47:15,420
that contains build metrics insights query

963
00:47:15,420 --> 00:47:17,760
that I just talked about,
which is very complex

964
00:47:17,760 --> 00:47:20,280
if you have to do all of
that just out of the box.

965
00:47:20,280 --> 00:47:23,640
So I'm actually taking
all the CPU authorization

966
00:47:23,640 --> 00:47:26,370
across all your fleet,
no matter how big it is,

967
00:47:26,370 --> 00:47:27,840
and then getting your metrics out.

968
00:47:27,840 --> 00:47:30,900
Like, one single query, you
get a lot of metrics back

969
00:47:30,900 --> 00:47:32,550
and the agent can be instructed,

970
00:47:32,550 --> 00:47:36,630
is there any EC2 instance
that is not performing well

971
00:47:36,630 --> 00:47:38,640
or like an outlier into my system?

972
00:47:38,640 --> 00:47:41,580
That's exactly how you're
instructing the agent

973
00:47:41,580 --> 00:47:43,710
to behave, right?

974
00:47:43,710 --> 00:47:47,610
And you know similar, log
group, describe log group,

975
00:47:47,610 --> 00:47:50,010
I'm gonna see like, oh my
log group here, you know?

976
00:47:50,010 --> 00:47:54,870
Or SLO tools and all of that.

977
00:47:54,870 --> 00:47:56,717
And then at some point, all it does is,

978
00:47:56,717 --> 00:48:00,480
as you can see here is,
based of my analysis,

979
00:48:00,480 --> 00:48:02,076
this is my report.

980
00:48:02,076 --> 00:48:07,076
And then, infrastructure consist
of 66 monitoring services

981
00:48:09,330 --> 00:48:12,180
across ECS, EKS, Lambda and so on.

982
00:48:12,180 --> 00:48:15,420
And high severity latency issues

983
00:48:15,420 --> 00:48:17,220
identified in these other service,

984
00:48:17,220 --> 00:48:19,080
no critical outage detected.

985
00:48:19,080 --> 00:48:21,600
So effectively, this scan
has been fixed, right?

986
00:48:21,600 --> 00:48:24,543
So this is a new run of the system.

987
00:48:26,610 --> 00:48:28,857
I just wanna show you very, very quickly

988
00:48:28,857 --> 00:48:33,857
how you can actually deploy
this in your environment.

989
00:48:34,530 --> 00:48:35,790
So one of the idea here is,

990
00:48:35,790 --> 00:48:40,790
you're gonna find an
agent setup Python file

991
00:48:41,580 --> 00:48:43,890
that what is doing here is effectively,

992
00:48:43,890 --> 00:48:46,110
what we want is this
agent not running manually

993
00:48:46,110 --> 00:48:50,220
but perhaps run it
automatically based on an event

994
00:48:50,220 --> 00:48:55,140
or even periodically, right?

995
00:48:55,140 --> 00:48:58,020
And so, there are really
many ways to do this

996
00:48:58,020 --> 00:48:59,280
and there are like a lot of talks here,

997
00:48:59,280 --> 00:49:00,690
reinvent and talk about deployments.

998
00:49:00,690 --> 00:49:01,920
So I'm not gonna go there,

999
00:49:01,920 --> 00:49:06,920
but you can use CDK, Bedrock
core, really, you name it.

1000
00:49:07,530 --> 00:49:11,610
But one idea here is from an
observability standpoint is,

1001
00:49:11,610 --> 00:49:15,930
we will like from the agent
to be woken up before us.

1002
00:49:15,930 --> 00:49:18,930
So it'd be cool if all
the alarms that we have,

1003
00:49:18,930 --> 00:49:22,740
we have a duplicate of them
with more aggressive thresholds

1004
00:49:22,740 --> 00:49:26,340
in a way that can actually
trigger your agent to run.

1005
00:49:26,340 --> 00:49:28,680
So the idea is like,
the moment I get paged

1006
00:49:28,680 --> 00:49:31,260
at 3:00 AM in the morning,
the agent was already there

1007
00:49:31,260 --> 00:49:33,480
doing the work for me so
I can actually go off,

1008
00:49:33,480 --> 00:49:35,820
look at the report and see
what's going on, right?

1009
00:49:35,820 --> 00:49:38,640
And this is exactly what
these agents STEP.py is doing.

1010
00:49:38,640 --> 00:49:41,340
So again, we using the
MCP clients and all that.

1011
00:49:41,340 --> 00:49:45,660
There is a setup context prompt,

1012
00:49:45,660 --> 00:49:49,080
but then what we do here
is create CloudWatch alarms

1013
00:49:49,080 --> 00:49:51,060
with human alarms for operator

1014
00:49:51,060 --> 00:49:55,410
and trigger alarms for
preemptive assessment, all right?

1015
00:49:55,410 --> 00:49:59,310
And we created event bridge tools

1016
00:49:59,310 --> 00:50:02,460
to actually start up the agent itself.

1017
00:50:02,460 --> 00:50:04,089
So this is one way, clearly

1018
00:50:04,089 --> 00:50:09,089
that you can run the agent and deploy it.

1019
00:50:09,240 --> 00:50:11,400
Having said that, I think
I can pass it over to you

1020
00:50:11,400 --> 00:50:13,620
so we can actually show the QR code

1021
00:50:13,620 --> 00:50:16,500
if you wanna look at the repository.

1022
00:50:16,500 --> 00:50:19,290
Once again, please try
into pre-prod, all right?

1023
00:50:19,290 --> 00:50:20,213
Because as you can see,

1024
00:50:20,213 --> 00:50:23,253
the agent will go off
and do stuff, all right?

1025
00:50:24,452 --> 00:50:27,090
- [Kevin] Yeah, and we have
time for a question or two,

1026
00:50:27,090 --> 00:50:29,610
a few questions if anybody wants to ask

1027
00:50:29,610 --> 00:50:31,470
or talk about anything.

1028
00:50:31,470 --> 00:50:35,013
Let me come give you a
mic so we can hear you.

1029
00:50:37,140 --> 00:50:38,730
Go ahead.

1030
00:50:38,730 --> 00:50:39,563
- [Audience Member] Thanks.

1031
00:50:39,563 --> 00:50:42,990
MCP servers are notoriously
inefficient with token usage.

1032
00:50:42,990 --> 00:50:44,550
I'm just kind of curious how many tokens

1033
00:50:44,550 --> 00:50:46,023
this report took to run.

1034
00:50:47,400 --> 00:50:51,900
- [Kevin] So I don't think
we have the statistics,

1035
00:50:51,900 --> 00:50:56,900
but we did make sure
to carefully scope down

1036
00:50:57,933 --> 00:51:00,120
and be very specific with the context

1037
00:51:00,120 --> 00:51:01,970
because we ran into the same problem.

1038
00:51:02,910 --> 00:51:07,800
So I think it comes down
to being very specific

1039
00:51:07,800 --> 00:51:10,458
in terms of what you tell it to do.

1040
00:51:10,458 --> 00:51:14,940
Yeah, I don't know a
token count for the runs,

1041
00:51:14,940 --> 00:51:17,190
but we had the same
problem, so you're right.

1042
00:51:18,360 --> 00:51:21,150
So yeah, I think with
an observability tool

1043
00:51:21,150 --> 00:51:24,810
you really want to narrow
down what its scope is, right?

1044
00:51:24,810 --> 00:51:26,460
For us it was producing our report,

1045
00:51:26,460 --> 00:51:29,100
it wasn't doing everything.

1046
00:51:29,100 --> 00:51:31,500
It was just saying, give us an overview.

1047
00:51:31,500 --> 00:51:33,480
And I think when you keep the scope down,

1048
00:51:33,480 --> 00:51:36,150
you can also keep the token usage down.

1049
00:51:36,150 --> 00:51:40,110
- [Andrea] Yeah, and one thing
you've seen in the code is,

1050
00:51:40,110 --> 00:51:41,460
we took some shortcuts

1051
00:51:41,460 --> 00:51:43,920
to make sure that we
consume less token, right?

1052
00:51:43,920 --> 00:51:45,780
So for example, the metrics insights query

1053
00:51:45,780 --> 00:51:47,970
to understand if there is something wrong

1054
00:51:47,970 --> 00:51:49,800
with your EC2 instances,

1055
00:51:49,800 --> 00:51:53,490
that's one execution of one MCP tool only,

1056
00:51:53,490 --> 00:51:56,760
as opposed to go off into EC2 MCP tools

1057
00:51:56,760 --> 00:51:58,830
and find out all your EC2 instances

1058
00:51:58,830 --> 00:52:00,900
and then for each one of
those, go into metrics.

1059
00:52:00,900 --> 00:52:02,670
So there are some shortcuts like that

1060
00:52:02,670 --> 00:52:05,190
that can help you reduce number of tokens

1061
00:52:05,190 --> 00:52:06,333
quite significantly.

1062
00:52:10,146 --> 00:52:12,229
- [Kevin] Yeah, go ahead.

1063
00:52:17,216 --> 00:52:18,150
- [Audience Member] Sorry.

1064
00:52:18,150 --> 00:52:20,558
How do you execute the analysis?

1065
00:52:20,558 --> 00:52:25,080
Do you execute periodically
or each time we have an alert

1066
00:52:25,080 --> 00:52:28,830
we execute the whole workflow?

1067
00:52:28,830 --> 00:52:31,110
- [Kevin] Yeah, so you could do either.

1068
00:52:31,110 --> 00:52:34,347
So with our specific tool
we, you can see on GitHub

1069
00:52:34,347 --> 00:52:36,930
you can just execute it from the terminal

1070
00:52:36,930 --> 00:52:38,430
on a crown schedule if you wanted,

1071
00:52:38,430 --> 00:52:41,850
or you probably may have seen we came out

1072
00:52:41,850 --> 00:52:44,130
with something called Bedrock Agent Core,

1073
00:52:44,130 --> 00:52:45,780
where you can essentially put this

1074
00:52:45,780 --> 00:52:48,900
into a docker container image

1075
00:52:48,900 --> 00:52:51,723
and you can just deploy
it to AWS very easily.

1076
00:52:52,620 --> 00:52:56,010
So it could be listening
for an EventBridge event

1077
00:52:56,010 --> 00:52:57,570
or something like that.

1078
00:52:57,570 --> 00:53:00,930
Since we essentially were
just making a demonstration,

1079
00:53:00,930 --> 00:53:03,720
we kind of just, were running
it manually on a schedule,

1080
00:53:03,720 --> 00:53:05,730
but there's a lot of options that are new

1081
00:53:05,730 --> 00:53:10,653
and allow you to deploy
it and trigger it easily.

1082
00:53:12,165 --> 00:53:13,415
Yeah, go ahead.

1083
00:53:14,687 --> 00:53:17,220
- [Audience Member] So did you
test this workflow at scale?

1084
00:53:17,220 --> 00:53:19,860
For example, if we have a platform

1085
00:53:19,860 --> 00:53:24,860
with some hundreds of
thousands of alerts per day,

1086
00:53:26,914 --> 00:53:30,994
if we execute with a webhook, for example,

1087
00:53:30,994 --> 00:53:35,994
how have you imagined the platform behind

1088
00:53:36,510 --> 00:53:41,130
to support the toll, all this workflow?

1089
00:53:41,130 --> 00:53:42,840
- [Andrea] Yeah, well definitely.

1090
00:53:42,840 --> 00:53:47,100
So we did test this with a,
you know, not 100K scale.

1091
00:53:47,100 --> 00:53:48,360
That's definitely not.

1092
00:53:48,360 --> 00:53:49,980
You know, take the repository

1093
00:53:49,980 --> 00:53:52,830
as a demonstration of
what you can do, right?

1094
00:53:52,830 --> 00:53:55,770
But like if you have
like a high scale system

1095
00:53:55,770 --> 00:53:59,379
like 100K, that's exactly what
we were just saying before,

1096
00:53:59,379 --> 00:54:01,170
all the simplification that we have done.

1097
00:54:01,170 --> 00:54:03,968
Like, don't go off and discover sources.

1098
00:54:03,968 --> 00:54:07,650
There are some tricks
that you can do in AWS

1099
00:54:07,650 --> 00:54:10,380
especially when you talk
about observability,

1100
00:54:10,380 --> 00:54:12,930
like, use metrics insights, right?

1101
00:54:12,930 --> 00:54:17,400
So metrics insights is
like a 10K metric query.

1102
00:54:17,400 --> 00:54:18,420
So like for example,

1103
00:54:18,420 --> 00:54:21,270
if you have to analyze CPU
utilization for 10K metric,

1104
00:54:21,270 --> 00:54:24,363
it just takes like one
MCP invocation, right?

1105
00:54:24,363 --> 00:54:26,250
For one specific tool.

1106
00:54:26,250 --> 00:54:29,190
So like, definitely, 100K is a big scale.

1107
00:54:29,190 --> 00:54:33,930
So you're gonna expect to
perhaps like write tools yourself

1108
00:54:33,930 --> 00:54:35,940
to optimize for that scale.

1109
00:54:35,940 --> 00:54:40,940
But the trick there is like,
if you use those bulk MCP tools

1110
00:54:44,100 --> 00:54:46,350
or like bulk KPIs behind the scenes,

1111
00:54:46,350 --> 00:54:47,850
that's gonna make your life easier

1112
00:54:47,850 --> 00:54:49,503
when you go at that big scale.

1113
00:54:58,740 --> 00:55:01,141
- [Audience Member] So this
LLM model has a limitation,

1114
00:55:01,141 --> 00:55:03,390
it works only through Bedrock

1115
00:55:03,390 --> 00:55:07,680
or if I have my own open AI keys,

1116
00:55:07,680 --> 00:55:09,137
can I use this one with this repository?

1117
00:55:09,137 --> 00:55:10,650
- [Andrea] Yeah, it's a Python scoop.

1118
00:55:10,650 --> 00:55:12,390
Like, there is nothing
to do with Bedrock core,

1119
00:55:12,390 --> 00:55:14,503
it's just Python, pure python.

1120
00:55:14,503 --> 00:55:15,517
- [Kevin] The strands SDK,

1121
00:55:15,517 --> 00:55:20,173
you can put in an open AI
API key or any of them.

1122
00:55:20,173 --> 00:55:22,093
- [Audience Member] All models, okay.

1123
00:55:22,093 --> 00:55:23,466
- [Kevin] Whatever you're using, yeah.

1124
00:55:23,466 --> 00:55:25,266
- [Audience Member] Okay, thank you.

1125
00:55:41,655 --> 00:55:42,488
- [Audience Member] Is this on?

1126
00:55:42,488 --> 00:55:43,321
- [Kevin] Yeah.

1127
00:55:43,321 --> 00:55:44,460
- [Audience Member] Thanks for the talk.

1128
00:55:44,460 --> 00:55:46,500
Really, really cool stuff,
I just cloned the code.

1129
00:55:46,500 --> 00:55:48,930
I was curious about the,
if you ran into any issues

1130
00:55:48,930 --> 00:55:51,073
with structured outputs on any of this

1131
00:55:51,073 --> 00:55:52,320
since like the rendering,

1132
00:55:52,320 --> 00:55:54,210
it looks like it's taking a lot of data

1133
00:55:54,210 --> 00:55:56,850
that was generated as JSON from the model

1134
00:55:56,850 --> 00:56:00,720
and basically putting
that into the HTML output.

1135
00:56:00,720 --> 00:56:02,340
I've run into that before
and I was just curious

1136
00:56:02,340 --> 00:56:03,330
how you kind of dealt with that.

1137
00:56:03,330 --> 00:56:05,630
Maybe it was prompting
and that kind of thing.

1138
00:56:06,480 --> 00:56:07,680
And I know (indistinct).

1139
00:56:10,920 --> 00:56:15,150
- [Kevin] Yeah, so we
had to rely on templating

1140
00:56:15,150 --> 00:56:16,230
to do it, right?

1141
00:56:16,230 --> 00:56:20,730
So you're right, if you
essentially say like,

1142
00:56:20,730 --> 00:56:22,440
just make an output, right?

1143
00:56:22,440 --> 00:56:26,100
It's not there yet in our experience.

1144
00:56:26,100 --> 00:56:29,760
So we actually made our
template and we just fill it in.

1145
00:56:29,760 --> 00:56:32,700
It's just a standard Python
Jinja template where we can go

1146
00:56:32,700 --> 00:56:37,560
and fill in the sections that
it extracted from the fields,

1147
00:56:37,560 --> 00:56:38,957
from the log and metric data.

1148
00:56:38,957 --> 00:56:43,957
'Cause we had similar things
if you just kind of tell it

1149
00:56:44,130 --> 00:56:46,890
to do things like the graphs
would look all strange

1150
00:56:46,890 --> 00:56:49,740
or would use some strange
CSS or something like that.

1151
00:56:49,740 --> 00:56:53,653
So yeah, we had to be
more manual in that part

1152
00:56:53,653 --> 00:56:56,013
to get it to look proper, yeah.

1153
00:57:00,600 --> 00:57:01,587
About out time here.

1154
00:57:01,587 --> 00:57:03,445
And we will be standing outside

1155
00:57:03,445 --> 00:57:05,430
if you guys wanna ask us more questions.

1156
00:57:05,430 --> 00:57:08,040
But please take the survey.

1157
00:57:08,040 --> 00:57:10,140
Thanks for hanging out with
us and please take the survey,

1158
00:57:10,140 --> 00:57:11,640
it helps us a lot.
(audience applauds)

1159
00:57:11,640 --> 00:57:12,790
You guys, were awesome.

1160
00:57:13,980 --> 00:57:15,983
Clap for yourself, thank you.

1161
00:57:15,983 --> 00:57:18,003
- [Andrea] Thanks for joining us today.

