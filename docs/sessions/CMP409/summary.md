# AWS re:Invent 2025 - CMP409 会议总结

## 会议概述

本次会议主题为"关于时间：通过 Amazon Time Sync 改进分布式系统"（It's About Time: Improving Distributed Systems with Amazon Time Sync）。会议由 AWS EC2 首席产品经理 Josh Levenson、首席软件工程师 Julian Redu 以及纳斯达克云战略与企业架构高级副总裁 Nikolai 共同主讲。

会议深入探讨了时钟在分布式系统中的重要性，以及 AWS 如何通过硬件投资和创新技术解决时钟同步这一复杂问题。传统上，分布式系统由于时钟不可靠而不信任时钟，但准确的时钟可以简化系统设计、减少通信开销和锁竞争。AWS 通过 Amazon Time Sync 服务提供了从毫秒级到纳秒级的时钟精度，使客户无需理解复杂的时钟同步技术就能在其工作负载中使用高精度时钟。

纳斯达克作为客户案例，展示了如何利用 Amazon Time Sync 的硬件时间戳功能来实现在公有云中运行超低延迟交易系统的目标。通过使用纳秒级精度的硬件时间戳，纳斯达克能够在云环境中重新排序交易消息，确保公平和确定性的市场运作，这是将关键金融基础设施迁移到云端的重要里程碑。

## 详细时间线

### 开场与背景介绍 (00:00 - 05:30)
- **00:00** - 会议开始，Josh Levenson 介绍会议主题 CMP409 和演讲嘉宾
- **01:15** - 强调这是 400 级别的技术讲座，但最终会展示如何简化使用
- **02:00** - 引用 Barbara Liskov 的名言：同步时钟可以通过减少通信来提高分布式系统性能
- **02:45** - 介绍时钟的四大用途：通用度量标准、人类可观测性、审计、分布式系统

### 时钟基础知识 (05:30 - 15:00)
- **05:30** - Julian 开始讲解如何构建计算机时钟：需要周期性振荡器和计数器
- **06:45** - 展示时钟硬件范围：从小型晶体振荡器到铯原子钟和氢钟
- **08:00** - 说明所有振荡器都会漂移，即使是最精确的原子钟
- **09:15** - 展示 EC2 实例在 5 天内自由运行时钟漂移约 75 毫秒的实例
- **10:30** - 解释网络时间协议（NTP）的工作原理：客户端向服务器询问时间并调整时钟

### 时钟同步的挑战 (15:00 - 20:00)
- **15:00** - 讲解时钟同步为何困难：网络延迟的可变性和网络不对称性
- **16:30** - 展示网络延迟噪声如何影响时钟漂移检测
- **18:00** - 说明即使时钟完美同步，网络不对称也会导致时间差异
- **19:00** - 总结：客户不应该担心这些复杂问题，AWS 已经解决了

### Amazon Time Sync 服务 - NTP 层 (20:00 - 25:00)
- **20:00** - Josh 介绍 Amazon Time Sync 服务，2017 年推出
- **21:00** - 展示 NTP 架构：通过 Nitro 系统提供链路本地端点
- **22:00** - NTP 服务精度：500-700 微秒（低于 1 毫秒）
- **23:30** - 客户需求更高精度，挑战是如何达到纳秒级

### Amazon Time Sync 服务 - 硬件级精度 (25:00 - 32:00)
- **25:00** - 介绍 AWS 的硬件投资：专用 GPS 电缆、冗余原子钟
- **26:30** - 展示专用时钟同步信号，不经过 AWS 数据平面或控制平面
- **28:00** - 详细架构：Nitro 时钟硬件参考时钟和 PTP 硬件时钟
- **29:30** - 性能指标：NTP 低于 100 微秒，PTP 约 20 微秒
- **31:00** - 基于 Nitro 系统，支持 Graviton、Intel、AMD 和 GPU 服务器

### 硬件数据包时间戳 (32:00 - 40:00)
- **32:00** - Julian 介绍硬件数据包时间戳功能（2025 年早些时候推出）
- **33:30** - 对比软件层时间戳和硬件时间戳的代码实现
- **35:00** - 展示动画：硬件时间戳在 Nitro 层完成，然后传递给应用
- **37:00** - 实验结果：跨可用区 ping 测试，用户空间测量约 400 微秒，硬件时间戳测量约 150 微秒
- **38:30** - 差异约 200-250 微秒，占往返时间的 2/3，提供更准确的网络性能视图
- **39:30** - 可通过 Socket API 或 DPDK 工具包访问纳秒级分辨率

### 纳斯达克客户案例 - 背景 (40:00 - 48:00)
- **40:00** - Nikolai 介绍纳斯达克：1971 年创立的全球首个电子交易所
- **41:00** - 运营全球 30 多个市场，为 130 多个市场运营商提供技术
- **42:30** - 纳斯达克的云之旅：10-15 年前开始，从边缘向核心推进
- **43:30** - 2012-2013 年在 AWS 上建立首个数据仓库（Redshift），存储 60 PB 数据
- **45:00** - 2022 年在 AWS Outposts 上推出首个期权交易所 NASDAQ MRX
- **46:30** - 目前有 6 个以上市场系统运行在 Outposts 上

### 纳斯达克的云挑战 (48:00 - 52:00)
- **48:00** - 地理限制：美国股票和期权交易主要在新泽西北部
- **49:00** - 超低延迟要求：订单到执行约 20 微秒
- **50:00** - 大容量：每天超过 1000 亿条消息，单个交易所每秒处理 200-300 万条消息
- **51:00** - 高可用性要求和监管监督

### 交易所系统架构 (52:00 - 56:00)
- **52:00** - 介绍交易所系统三大组件：撮合引擎、订单端口、公共市场数据源
- **53:30** - 传统本地数据中心模型：依赖物理特性（光纤长度、交换机跳数）
- **54:30** - 确定性和统计公平性：通过固定网络延迟实现顺序处理
- **55:30** - 公有云挑战：电缆长度不固定、交换机跳数未知、计算节点位置不可预测

### 时间戳解决方案 (56:00 - 63:00)
- **56:00** - 使用硬件时间戳记录每个交易点的时间
- **57:30** - 重排序缓冲区（Reordering Buffer）：位于撮合引擎前，确保按时间戳顺序处理
- **59:00** - 示例：T1、T2、T3 时间戳的订单通过重排序缓冲区恢复原始顺序
- **60:00** - 纳斯达克已为此技术申请专利
- **61:00** - 测试环境：AWS 公有云实例（M7i.2xlarge）、使用邻近放置组
- **62:00** - 测试结果：5 微秒边界重排序成功率约 25%，50 微秒边界成功率高达 84%

### 未来展望与总结 (63:00 - 结束)
- **63:00** - 纳斯达克的战略目标：开发可扩展的交易系统、利用公有云创新
- **64:00** - 增强安全性和可靠性，利用战略市场专业知识
- **65:00** - 作为全球 30 个交易所的运营商和 130 个市场的技术供应商，纳斯达克需要战略性地应用技术
- **66:00** - 会议结束