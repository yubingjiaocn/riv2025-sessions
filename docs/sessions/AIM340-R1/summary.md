# AWS re:Invent 2025 - AI代理在云运营中的应用

## 会议概述

本次AWS re:Invent 2025分组会议由解决方案架构师Omar Tobaca和Sean Abdi主讲,重点探讨了如何利用AI代理(Agentic AI)自动化云基础设施管理和安全运营。会议通过实际演示展示了多代理系统如何协同工作,解决安全事件响应中的复杂问题。

演讲者首先描绘了一个典型的安全工程师场景:凌晨2点接到安全事件告警,需要在不同格式的海量日志中(VPC流日志、防火墙日志、CloudTrail日志等)寻找线索,这个过程既耗时又容易出错。传统的手动分析方法已经无法应对当今快节奏、自动化的网络攻击。AI代理系统能够在几秒钟内分析复杂数据集,检测人类可能遗漏的模式和异常,自动化重复性任务如日志关联和威胁分类,让安全工程师能够专注于真正的威胁响应而非繁琐的基础工作。

会议的核心内容包括AI代理的基本概念、多代理架构设计、以及使用Strands Agents开源SDK构建实际应用。演讲者强调了数据集中化的重要性,推荐使用Amazon Security Lake将不同来源的安全数据标准化为OCSF(开放网络安全架构框架)格式。整个演示展示了如何构建包括业务上下文代理、安全日志分析代理和云运营代理在内的多代理系统,这些代理能够协同工作,从检测威胁到自动执行响应措施(如阻止可疑IP、隔离EC2实例、创建取证快照等)。演讲者特别强调了在关键操作中保持"人在回路"(human-in-the-loop)的重要性,确保AI代理的决策得到人工审核。

## 详细时间线

### 开场与问题场景 (00:00 - 05:30)

00:00 - 会议开始,Omar Tobaca和Sean Abdi介绍今天的主题:AI代理在云运营和安全运营中的应用

00:45 - 通过举手调查了解听众背景,少数听众已经构建过代理应用

01:15 - 描绘安全工程师的痛点场景:凌晨2点接到安全事件告警,需要处理来自不同系统、不同格式的海量日志数据

02:30 - 说明传统手动流程的问题:需要花费数小时在VPC流日志、防火墙日志、API日志、CloudTrail日志、Guard Duty告警、Security Hub发现等不同数据源中寻找线索

03:45 - 提出解决方案:使用专门的智能系统(AI代理)来梳理这些日志,提供可操作的洞察

04:30 - 阐述为什么需要AI用于安全运营:攻击变得自动化和快节奏,传统手动方法无法跟上

05:00 - AI的优势:能在几秒钟内分析复杂数据集,检测人类可能遗漏的模式和异常,自动化重复性任务

### LLM与代理AI的区别 (05:30 - 08:00)

05:30 - 对比传统LLM与代理AI:LLM基于已训练知识提供简单答案(如"法国大革命发生在1789年")

06:15 - 代理AI的特点:能够自主思考、使用工具、迭代推理。以天气查询为例,代理可以访问天气网站、分析未来一周预报、评估并得出"下周五是富士山徒步的理想日子"

07:00 - 强调数据是构建代理的关键:需要正确的数据源,集中化且易于读取的格式

07:30 - 介绍Amazon Security Lake:将不同工具和日志集中到AWS账户的数据湖中,标准化为OCSF(开放网络安全架构框架)格式

### 解决方案架构 (08:00 - 12:00)

08:00 - Omar介绍多代理应用架构:类似团队协作,每个代理专注于特定技能

08:45 - 第一个子代理:从DynamoDB获取业务上下文信息

09:15 - 第二个子代理:使用Security Lake访问和分析安全日志

09:45 - 第三个子代理:云运营代理,介绍MCP(模型上下文协议)的概念

10:30 - 云运营代理的功能:添加IP阻止规则、隔离EC2实例、创建EBS卷的取证快照等

11:00 - 讨论关键问题:是否应该将生产环境的控制权交给代理?强调需要护栏和人在回路(human-in-the-loop)机制

11:30 - 说明代理成功率约为90%,对于关键操作必须保持人工审核

### 前端演示 (12:00 - 15:30)

12:00 - 展示使用Streamlit开发的前端应用界面

12:30 - 演示威胁检测查询示例:"查找过去一小时内超过10次的失败登录尝试,分析源IP和受影响账户,然后阻止可疑IP并创建快照"

13:15 - 实时演示代理执行过程:分析认证日志、查询CloudTrail事件和Security Hub发现

13:45 - 代理识别出三个主要源IP地址,跨越不同区域

14:15 - 展示自动响应操作:阻止IP地址

14:45 - 讨论人在回路的实现:代理可以先提供摘要,询问用户是否执行阻止操作

### Strands Agents框架介绍 (15:30 - 19:00)

15:30 - 介绍Strands Agents开源SDK:用几行代码构建代理

16:00 - Omar分享个人经验:一年前开始学习,Python技能生疏,但Strands让学习变得容易

16:30 - Strands的特性:原生工具支持、社区工具、MCP服务器集成、支持任何模型提供商

17:15 - 解释代理循环(Agentic Loop):提示发送给代理→调用模型→模型推理需要使用工具→执行工具→返回结果→继续循环直到得到最终答案

18:00 - 展示代码量对比:使用Strands从350行代码减少到55行代码(天气应用示例)

18:45 - 强调Strands抽象了工具注册、对话管理、API通信等复杂性,将4-6小时的工作缩短到15-30分钟

### 控制台演示 - 业务上下文代理 (19:00 - 26:00)

19:00 - Sean开始演示第一个代理:业务上下文元数据代理

19:30 - 说明代理功能:基于AWS账户ID(12位数字)从DynamoDB获取业务上下文

20:00 - 业务上下文包括:业务单元、关键性、联系人、合规范围等

20:30 - 强调业务上下文与技术细节同样重要,帮助快速确定优先级

21:00 - 进入AWS控制台,导航到Amazon SageMaker AI

21:30 - 解释使用Jupyter Notebook的原因:交互式IDE,便于可视化输出和实时实验

22:00 - 安装依赖:boto3、pandas等库

22:30 - 导入Strands组件:agent、tool函数、bedrock模型

23:00 - 创建boto3会话连接DynamoDB,区域为US East 2

23:30 - 展示DynamoDB表结构:账户ID、账户名称、合规范围、关键性、环境类型、联系人等

24:15 - 定义工具:使用@tool装饰器创建get_aws_account_metadata函数

24:45 - 工具说明:检索给定账户ID的AWS账户元数据,参数为12位账户ID

25:15 - 初始化代理:定义系统提示"你是一个有用的代理,根据账户ID查找AWS账户元数据"

25:45 - 使用默认模型Claude Sonnet 4.0,验证模型配置

26:00 - 发送消息测试:"告诉我关于账户679817130713的信息"

### 业务上下文代理结果展示 (26:00 - 28:00)

26:00 - 代理返回结果:账户名称"Production Main"、业务单元、生产环境、关键性为"Critical"

26:30 - 显示安全联系人:security@company.com,事件优先级:最高优先级

27:00 - Sean强调:这些信息通常需要花费数小时从不同数据源收集,代理在几秒钟内完成

27:30 - 过渡到下一个代理演示

### 控制台演示 - Security Lake代理 (28:00 - 40:00)

28:00 - Omar开始演示Security Lake代理,强调从简单用例开始学习代理构建

28:30 - 说明Security Lake代理是整体架构的核心组件

29:00 - 介绍Amazon Athena:无服务器交互式查询服务,直接在Security Lake数据上运行SQL

29:30 - 展示自然语言查询示例:"显示安全组变更后的异常流量模式"

30:00 - 互动提问:安全组变更存储在哪里?观众回答:CloudTrail

30:30 - 继续提问:异常流量模式在哪里?观众回答:VPC Flow日志

31:00 - 展示多代理查询示例:"关联异常API活动与网络异常,然后遏制威胁"

31:30 - 提问需要哪两个代理:Security Lake代理和Cloud Ops代理

32:00 - 进入Security Lake notebook,安装依赖

32:30 - 导入agent和tool类

33:00 - Security Lake配置:授予代理访问Athena工作组的权限

33:30 - 初始化AWS客户端:Athena、Bedrock、Glue

34:00 - 定义Bedrock模型:Claude Opus 4.5(一两周前发布)

34:30 - 讨论模型选择策略:根据代理任务复杂度选择模型,简单任务用Haiku(更快更便宜),复杂任务用Opus

35:30 - 互动提问:Security Lake代理需要什么工具?观众回答:Athena

36:00 - 定义第一个工具:query_security_lake,使用Athena查询Security Lake

36:45 - 工具描述:需要SQL查询作为参数,返回结果表或错误消息

37:30 - 连接Amazon Athena,获取查询执行ID

38:00 - 提问第二个工具的功能:列出表(list tables)

38:30 - 说明原因:代理需要知道有哪些数据源(VPC流日志、CloudTrail、Security Hub等)

39:00 - 强调Security Lake的优势:统一标准化的数据格式

39:30 - 定义第三个工具:get_table_schema,从Glue数据目录检索架构信息

### Security Lake代理配置与测试 (40:00 - 45:00)

40:00 - 说明代理需要查看列信息和数据分区方式来创建查询

40:30 - 运行工具定义代码

41:00 - 调用agent类,定义三个核心组件:模型、工具、系统提示

41:30 - 强调系统提示的重要性:定义代理的角色和个性

42:00 - 系统提示内容:"你是一个网络安全分析师,可以访问AWS安全数据湖"

42:30 - 提供重要的数据库上下文信息

43:00 - 系统提示中的工作流程指导:列出表→获取架构→构建查询→执行查询→分析结果

43:30 - 强调在系统提示中提供清晰的工作流程指导的重要性

44:00 - 运行代理初始化代码

44:30 - 准备测试查询

### 实际查询演示 (45:00 - 50:00)

45:00 - 发送查询:"显示过去24小时内所有失败的登录尝试"

45:30 - 代理开始执行:列出可用表

46:00 - 代理识别出CloudTrail表,获取架构信息

46:30 - 代理构建SQL查询,针对失败的登录尝试

47:00 - 执行查询,返回结果

47:30 - 展示结果:包含时间戳、源IP、用户名、失败原因等

48:00 - 演示更复杂的查询:"查找来自同一IP的多次失败登录尝试"

48:30 - 代理自动调整查询,添加GROUP BY和HAVING子句

49:00 - 返回聚合结果,显示可疑IP地址

49:30 - 讨论如何将此代理与其他代理集成

### 多代理协作与最佳实践 (50:00 - 55:00)

50:00 - 解释监督代理(supervisor agent)的概念:协调多个专业子代理

50:45 - 展示事件驱动架构:Guard Duty发现自动触发代理系统

51:30 - 示例场景:S3存储桶被公开,触发Guard Duty告警

52:00 - 代理自动分析:确定账户、查看日志、识别操作者、确定修复步骤

52:30 - 代理可以选择:向安全团队发送告警或直接执行修复

53:00 - 讨论护栏(guardrails)的重要性:防止代理执行不当操作

53:30 - 强调事件响应手册(incident response playbooks)的作用

54:00 - 根据数据敏感性和环境关键性采用不同的响应策略

54:30 - 讨论自动化程度:某些流程完全自动化,关键操作需要人工审核

### 云运营代理与MCP (55:00 - 58:00)

55:00 - 简要介绍云运营代理和MCP服务器

55:30 - MCP的优势:标准化的工具集成方式

56:00 - AWS提供的MCP服务器示例:Cloud Control MCP

56:30 - 云运营代理的功能:添加阻止规则、隔离实例、创建快照等

57:00 - 强调安全性:使用IAM角色和权限控制代理的操作范围

57:30 - 讨论审计和日志记录:所有代理操作都应该被记录

### 问答环节 (58:00 - 结束)

58:00 - 开放问答环节

58:30 - 观众提问关于成本优化的问题

59:00 - 回答:根据代理任务选择合适的模型,简单任务用小模型节省成本

59:30 - 观众提问关于延迟的问题

60:00 - 回答:Strands支持流式响应,可以实时看到代理的思考过程

60:30 - 观众提问关于多区域部署

61:00 - 回答:Security Lake支持多区域聚合,代理可以跨区域分析

61:30 - 总结:强调从简单用例开始,逐步构建更复杂的多代理系统

62:00 - 会议结束,感谢观众参与