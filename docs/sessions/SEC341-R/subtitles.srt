1
00:00:00,170 --> 00:00:02,250
Well thank you. I know you, you

2
00:00:02,250 --> 00:00:04,368
had uh an alternative today, you

3
00:00:04,368 --> 00:00:06,368
could have gone and watched the keynote from uh

4
00:00:06,368 --> 00:00:08,489
from, from Werner, so we really appreciate you

5
00:00:08,489 --> 00:00:10,288
dedicated folks coming and spending

6
00:00:10,648 --> 00:00:12,800
what I think is the last session of the day um

7
00:00:12,800 --> 00:00:14,849
with us, um, so hopefully it's worth it. In

8
00:00:14,849 --> 00:00:16,370
fact, we know it'll be worth it.

9
00:00:16,728 --> 00:00:18,929
You're gonna walk away with some hopefully interesting

10
00:00:18,929 --> 00:00:20,649
uh ideas and, and, uh.

11
00:00:21,769 --> 00:00:23,958
Things you can take back and apply to your own

12
00:00:23,958 --> 00:00:26,539
organizations. So this is SEC 341,

13
00:00:26,920 --> 00:00:28,978
automating IEM policy validation

14
00:00:28,978 --> 00:00:30,978
and analysis using GitHub

15
00:00:30,978 --> 00:00:31,769
actions.

16
00:00:32,319 --> 00:00:34,329
Uh, if it's not the session you

17
00:00:34,329 --> 00:00:36,368
thought it was going to be, I'm afraid the doors

18
00:00:36,368 --> 00:00:38,450
are already closed, so you can't leave

19
00:00:38,450 --> 00:00:39,048
now.

20
00:00:39,408 --> 00:00:41,490
Um, but please stick around, I think you'll, you'll get something out

21
00:00:41,490 --> 00:00:43,029
of it. Uh, my name's Mitch.

22
00:00:43,368 --> 00:00:45,840
I'm a solutions architect for AWS

23
00:00:45,840 --> 00:00:47,130
based in Sydney,

24
00:00:47,609 --> 00:00:49,689
Australia, and I get to work with our financial

25
00:00:49,689 --> 00:00:52,168
services customers, so identity

26
00:00:52,168 --> 00:00:54,289
is a pretty common topic that I spend a bunch

27
00:00:54,289 --> 00:00:55,978
of time talking about with them.

28
00:00:56,259 --> 00:00:58,270
And it's my pleasure to be joined here by

29
00:00:58,270 --> 00:01:00,359
Nitin today. Yeah, hi everyone, uh, my

30
00:01:00,359 --> 00:01:01,490
name is Nitin Kulkarni.

31
00:01:02,020 --> 00:01:04,338
I'm also a solutions architect in the

32
00:01:04,338 --> 00:01:05,638
identity Solutions Team,

33
00:01:05,939 --> 00:01:07,778
uh, based out of Arlington, Virginia.

34
00:01:10,049 --> 00:01:12,159
So you've hopefully got an idea of

35
00:01:12,159 --> 00:01:14,338
what we're going to talk about from the title of the session

36
00:01:14,338 --> 00:01:16,359
and the synopsis if you, if you read it,

37
00:01:16,489 --> 00:01:17,579
but um.

38
00:01:18,569 --> 00:01:20,588
And it's a code talk, so it's supposed

39
00:01:20,588 --> 00:01:22,719
to be uh a lot more practical and hands

40
00:01:22,719 --> 00:01:24,819
on than uh than

41
00:01:24,819 --> 00:01:26,668
it is slides, but

42
00:01:27,209 --> 00:01:29,250
we're gonna level set with a few slides, we're gonna try

43
00:01:29,250 --> 00:01:31,250
and keep them to an absolute minimum, but I just

44
00:01:31,250 --> 00:01:33,379
think it's important that you get the idea of,

45
00:01:33,448 --> 00:01:35,489
of where we're going with this, where we've

46
00:01:35,489 --> 00:01:37,689
come from, and the problem that we're trying to help

47
00:01:37,689 --> 00:01:39,409
solve with what we're gonna present to you today.

48
00:01:40,000 --> 00:01:42,120
And um and then we'll get straight into

49
00:01:42,120 --> 00:01:44,260
the practical parts uh and uh

50
00:01:44,260 --> 00:01:45,109
and um

51
00:01:45,430 --> 00:01:46,099
we'll, we'll.

52
00:01:47,099 --> 00:01:49,099
As we're going through this, um, because there's not too

53
00:01:49,099 --> 00:01:50,799
many people here, if, if there are questions,

54
00:01:51,138 --> 00:01:53,219
you can put your hands up and we'll we'll have a go at asking them

55
00:01:53,219 --> 00:01:54,439
for answering them for you.

56
00:01:54,739 --> 00:01:56,739
Um, equally if, if you want to wait till

57
00:01:56,739 --> 00:01:58,769
the end, you can do that as well. We're, we're pretty flexible,

58
00:01:58,778 --> 00:02:00,500
I think, uh, with, with timing at the minute.

59
00:02:01,528 --> 00:02:03,879
So what we're gonna cover, uh, traditional IEM

60
00:02:03,879 --> 00:02:05,888
models, and I'll explain what I mean by that in a second.

61
00:02:06,040 --> 00:02:08,528
We're gonna give everyone a quick overview of GitHub actions,

62
00:02:08,919 --> 00:02:10,929
but last time we ran this, which was yesterday,

63
00:02:11,008 --> 00:02:12,969
most people seemed to already know what that was.

64
00:02:13,288 --> 00:02:15,610
Show of hands, who's using or used GitHub

65
00:02:15,610 --> 00:02:16,270
actions?

66
00:02:17,330 --> 00:02:19,338
Yeah, OK, it's pretty similar to what we got

67
00:02:19,338 --> 00:02:20,050
yesterday, which is good.

68
00:02:20,538 --> 00:02:22,808
Then a quick, a quick overview of IEM Access

69
00:02:22,808 --> 00:02:24,889
Analyzer, which is gonna form the basis

70
00:02:24,889 --> 00:02:26,879
of the practical part of what we're doing today,

71
00:02:27,179 --> 00:02:29,419
uh, and really help solve the problem that we're trying to solve.

72
00:02:29,778 --> 00:02:31,899
Uh, a quick introduction to custom policy checks,

73
00:02:31,939 --> 00:02:34,139
which is a feature of Access Analyzer,

74
00:02:34,460 --> 00:02:36,538
and then we're gonna get into the building part of it.

75
00:02:37,349 --> 00:02:39,588
So, what do I mean by the traditional models

76
00:02:39,588 --> 00:02:40,629
of IAM,

77
00:02:41,069 --> 00:02:43,169
uh, in the context of today's session, we mean

78
00:02:43,169 --> 00:02:45,788
the way in which IAM policies

79
00:02:45,788 --> 00:02:47,830
in particular and, and, and roles

80
00:02:47,830 --> 00:02:49,868
and, and users in some cases, but essentially

81
00:02:49,868 --> 00:02:51,949
the things you create in the IAM part of the

82
00:02:51,949 --> 00:02:52,949
AWS console,

83
00:02:53,229 --> 00:02:55,610
how they're managed within your organizations.

84
00:02:56,020 --> 00:02:57,830
Um, traditionally,

85
00:02:58,210 --> 00:03:00,210
one of the patterns that we saw used quite a

86
00:03:00,210 --> 00:03:02,250
lot was the centralized model, and

87
00:03:02,250 --> 00:03:04,449
that's where there was a clear delineation between the

88
00:03:04,449 --> 00:03:07,219
security team and the software engineers within the

89
00:03:07,219 --> 00:03:09,409
organization. The security engineers would

90
00:03:09,409 --> 00:03:11,508
be responsible for creating

91
00:03:11,508 --> 00:03:12,588
the policies.

92
00:03:13,008 --> 00:03:15,169
Um, they often created them

93
00:03:15,169 --> 00:03:17,368
in standard patterns, maybe t-shirt

94
00:03:17,368 --> 00:03:18,469
sizes with

95
00:03:18,969 --> 00:03:21,868
certain permissions based on persona, developer,

96
00:03:22,149 --> 00:03:23,189
um, you know,

97
00:03:23,449 --> 00:03:25,189
knowledge worker, those kinds of things.

98
00:03:25,669 --> 00:03:27,949
Then the builders who are creating

99
00:03:27,949 --> 00:03:30,229
the software, the applications within the

100
00:03:30,229 --> 00:03:32,229
organization would, um, would have to use what

101
00:03:32,229 --> 00:03:34,429
they're given. Um, they would be given a policy.

102
00:03:34,550 --> 00:03:36,710
It might be slightly overly

103
00:03:36,710 --> 00:03:38,909
permissive for what they needed, but it, it met their

104
00:03:38,909 --> 00:03:39,689
requirements, um,

105
00:03:40,149 --> 00:03:42,229
so, you know, that, that was the pattern that we

106
00:03:42,229 --> 00:03:44,229
saw used quite a lot in many organizations

107
00:03:44,229 --> 00:03:46,389
and, and maybe is still used in some

108
00:03:46,389 --> 00:03:47,250
places today.

109
00:03:47,508 --> 00:03:49,629
The challenge with this is that

110
00:03:49,629 --> 00:03:51,868
several challenges. One is that the

111
00:03:51,868 --> 00:03:53,050
security engineering team.

112
00:03:53,550 --> 00:03:55,588
Tend not to know much about the

113
00:03:55,588 --> 00:03:57,710
applications that are being developed, so

114
00:03:57,710 --> 00:03:59,909
the policies can either be way

115
00:03:59,909 --> 00:04:02,028
too broad or way too narrow in

116
00:04:02,028 --> 00:04:04,349
terms of scope, making it hard for the software

117
00:04:04,349 --> 00:04:06,439
engineers to get the exact outcome they're looking

118
00:04:06,439 --> 00:04:08,669
for. The other challenge is that there are

119
00:04:08,669 --> 00:04:10,849
a finite number of security engineers. Any

120
00:04:10,849 --> 00:04:12,409
security people in the room here today?

121
00:04:14,099 --> 00:04:16,108
Yeah, there you go. So those are the unicorns, you guys will

122
00:04:16,108 --> 00:04:18,290
be asking for pay rises from your managers soon.

123
00:04:18,829 --> 00:04:20,869
Um, yep, I mean there were some statistics I

124
00:04:20,869 --> 00:04:22,879
read that the, the cybersecurity

125
00:04:22,879 --> 00:04:25,470
industry is short some, I don't know, there's some ridiculous

126
00:04:25,470 --> 00:04:27,738
amount, millions of security engineers. Um,

127
00:04:27,869 --> 00:04:30,028
so if you want to change roles and practices,

128
00:04:30,230 --> 00:04:31,329
security is the way to go.

129
00:04:31,879 --> 00:04:33,928
Um, so there are finite numbers of those,

130
00:04:33,988 --> 00:04:36,069
and not enough, and when the security engineering

131
00:04:36,069 --> 00:04:38,389
team is getting feedback from the software builders

132
00:04:38,389 --> 00:04:40,579
that they need to keep tweaking these policies,

133
00:04:40,750 --> 00:04:41,829
they become a bottleneck.

134
00:04:42,699 --> 00:04:44,970
So that's the centralized model. It doesn't

135
00:04:44,970 --> 00:04:47,129
necessarily work too well because you often end up

136
00:04:47,129 --> 00:04:48,970
with with these challenges, these bottlenecks,

137
00:04:49,309 --> 00:04:51,309
and policies that are either

138
00:04:51,309 --> 00:04:53,048
too permissive or not permissive enough.

139
00:04:53,389 --> 00:04:55,389
Then we've got the gated model. Um, this is

140
00:04:55,389 --> 00:04:57,709
slightly more in the direction that we think

141
00:04:57,709 --> 00:05:00,069
we should be going. This is where our security

142
00:05:00,069 --> 00:05:00,970
teams are.

143
00:05:01,639 --> 00:05:03,970
Um, Essentially they're to act as risk

144
00:05:03,970 --> 00:05:06,439
advisors, um, risk assessors

145
00:05:06,439 --> 00:05:08,608
if you like, of policies that are being created,

146
00:05:08,720 --> 00:05:10,420
so the builders themselves who

147
00:05:10,959 --> 00:05:12,980
understand the applications will create

148
00:05:12,980 --> 00:05:15,459
the policies as part of their builder workflow.

149
00:05:15,899 --> 00:05:18,028
Um, they, they may not fully

150
00:05:18,028 --> 00:05:20,588
understand the intricacies of the very expressive

151
00:05:20,588 --> 00:05:22,588
I IAM policy language, but they'll

152
00:05:22,588 --> 00:05:24,869
have a good crack, they'll create a policy, they'll submit

153
00:05:24,869 --> 00:05:25,829
it along with their

154
00:05:26,619 --> 00:05:28,790
application code or whatever mechanism they use

155
00:05:28,790 --> 00:05:30,970
to submit these things, and then the

156
00:05:30,970 --> 00:05:33,088
security engineering team will step in and they'll

157
00:05:33,088 --> 00:05:33,689
review that,

158
00:05:34,230 --> 00:05:36,389
um, better because the policies

159
00:05:36,389 --> 00:05:38,470
are more scoped to what the application actually

160
00:05:38,470 --> 00:05:40,548
needs because the app engineers understand it.

161
00:05:41,730 --> 00:05:44,309
Slightly more challenging from a security engineer perspective

162
00:05:44,309 --> 00:05:46,720
because depending on how many times these developers are committing

163
00:05:46,720 --> 00:05:48,769
these requests for new policies,

164
00:05:49,000 --> 00:05:51,338
you could be backwards and forwards, backwards and forwards. The

165
00:05:51,338 --> 00:05:52,220
other challenge is again,

166
00:05:52,678 --> 00:05:54,720
because you're a security engineer and you don't have the

167
00:05:54,720 --> 00:05:56,389
context of the application,

168
00:05:56,670 --> 00:05:58,720
a lot of the time you might be questioning

169
00:05:58,720 --> 00:06:01,069
why they've done certain things, and there can be tangos

170
00:06:01,069 --> 00:06:03,295
going on between the security teams and. The builder

171
00:06:03,295 --> 00:06:05,415
teams as they negotiate, why are you

172
00:06:05,415 --> 00:06:07,454
doing this? Have you considered this, this is not best

173
00:06:07,454 --> 00:06:09,795
practice backwards and forwards, backwards and forwards.

174
00:06:10,095 --> 00:06:12,295
Um, if the policies

175
00:06:12,295 --> 00:06:14,415
themselves become, um, uh,

176
00:06:14,423 --> 00:06:16,494
uh, when they're analyzed by the, the builder team, sorry,

177
00:06:16,574 --> 00:06:18,605
by the security teams have issues, um,

178
00:06:18,733 --> 00:06:21,134
you know, the, the developers, uh, will get notified

179
00:06:21,134 --> 00:06:23,295
by the security engineers and, and there'll be

180
00:06:23,295 --> 00:06:24,545
rework that has to be done.

181
00:06:24,975 --> 00:06:25,834
So better

182
00:06:26,134 --> 00:06:27,184
but not perfect.

183
00:06:28,379 --> 00:06:30,540
And I'm not saying the next model is perfect either,

184
00:06:30,699 --> 00:06:32,699
but this is an improvement on the, the

185
00:06:32,699 --> 00:06:34,500
delegate, the, the, the gated model.

186
00:06:34,939 --> 00:06:36,980
So this is where what we're doing with our security

187
00:06:36,980 --> 00:06:39,100
engineers is we're really going to allow them

188
00:06:39,100 --> 00:06:41,178
to use their judgment and skills to

189
00:06:41,178 --> 00:06:43,540
focus on things that we can't solve automatically.

190
00:06:43,819 --> 00:06:46,329
So instead of manually reviewing all of these policies

191
00:06:46,329 --> 00:06:48,639
or creating a bunch of policies and making them available

192
00:06:48,639 --> 00:06:50,678
to, to, to the engineers, the builders,

193
00:06:51,160 --> 00:06:52,869
and what they do is they build automation,

194
00:06:53,139 --> 00:06:55,178
um, so that when the builder

195
00:06:55,178 --> 00:06:57,358
submits their IM policy.

196
00:06:57,778 --> 00:07:00,019
It will automatically get analyzed

197
00:07:00,019 --> 00:07:02,129
or assessed against a set of

198
00:07:02,129 --> 00:07:04,338
organizational standards, guard rails, best

199
00:07:04,338 --> 00:07:06,338
practices, whatever you want to call them, or whatever you want

200
00:07:06,338 --> 00:07:07,000
them to be.

201
00:07:07,579 --> 00:07:09,678
If there happens to be a

202
00:07:09,899 --> 00:07:12,019
blocking change or or a finding that's

203
00:07:12,019 --> 00:07:13,569
identified in that process,

204
00:07:14,059 --> 00:07:16,379
then the security engineer can be engaged

205
00:07:16,379 --> 00:07:18,379
either automatically or through, you know, through

206
00:07:18,379 --> 00:07:19,959
a failed build in a pipeline,

207
00:07:20,579 --> 00:07:22,579
um, they can have a look, they can

208
00:07:22,579 --> 00:07:24,720
have a conversation with the builder or

209
00:07:24,980 --> 00:07:27,100
the. Automation

210
00:07:27,439 --> 00:07:29,480
can send notifications directly back to

211
00:07:29,480 --> 00:07:30,579
the engineer to say

212
00:07:31,079 --> 00:07:32,000
it's failed,

213
00:07:32,358 --> 00:07:34,399
uh, here's, you know, here's why it's failed, and

214
00:07:34,399 --> 00:07:36,519
then the builder has to go and figure out how to, how

215
00:07:36,519 --> 00:07:37,689
to fix and resolve that problem.

216
00:07:38,000 --> 00:07:40,119
So better, definitely better, um, definitely

217
00:07:40,119 --> 00:07:42,278
removing a lot of dependency on the security

218
00:07:42,278 --> 00:07:44,319
engineer there, allowing the developer to move much

219
00:07:44,319 --> 00:07:46,559
faster, and if their policy is good and well

220
00:07:46,559 --> 00:07:48,798
within the constraints or the, the, the scope, then

221
00:07:48,798 --> 00:07:51,119
it gets, it gets pushed straight out into whatever

222
00:07:51,119 --> 00:07:52,100
environment, um,

223
00:07:52,399 --> 00:07:53,100
it needs to.

224
00:07:53,559 --> 00:07:55,480
And we're gonna, we're gonna kind of talk through.

225
00:07:55,829 --> 00:07:57,949
That process today, but an evolution of

226
00:07:57,949 --> 00:08:00,048
that process because one of the

227
00:08:00,329 --> 00:08:02,009
examples I gave there was that the builder

228
00:08:02,350 --> 00:08:04,579
gets the feedback automatically either from

229
00:08:04,579 --> 00:08:06,588
uh as part of the pipeline. I

230
00:08:06,588 --> 00:08:08,500
check it in, I've got a blocking finding,

231
00:08:08,790 --> 00:08:10,949
I get some feedback, I've got to go and figure out how

232
00:08:10,949 --> 00:08:11,670
to fix that.

233
00:08:11,988 --> 00:08:14,108
So we, we, we've enhanced the delegated model

234
00:08:14,108 --> 00:08:15,569
a little bit with what we're gonna show you today

235
00:08:16,028 --> 00:08:18,108
to provide some of that prescriptive guidance, and you'll

236
00:08:18,108 --> 00:08:19,108
see more as we go through it.

237
00:08:19,759 --> 00:08:22,040
Right, GitHub actions, what is GitHub

238
00:08:22,040 --> 00:08:24,079
actions? Uh, for those of you that haven't used

239
00:08:24,079 --> 00:08:26,160
it, which didn't seem to be too many people in the

240
00:08:26,160 --> 00:08:26,939
room at all,

241
00:08:27,278 --> 00:08:29,428
it's essentially GitHub's native, uh,

242
00:08:29,439 --> 00:08:31,480
CICD, um, automation

243
00:08:31,480 --> 00:08:33,418
platform and orchestration platform.

244
00:08:33,678 --> 00:08:35,340
It allows you to run,

245
00:08:35,639 --> 00:08:37,739
uh, actions, funnily enough.

246
00:08:38,104 --> 00:08:40,092
Or arbitrary code in some cases

247
00:08:40,582 --> 00:08:42,082
depend based on

248
00:08:42,383 --> 00:08:44,383
events that occur within a repository. This

249
00:08:44,383 --> 00:08:46,462
can be a committed change. It can be a pull

250
00:08:46,462 --> 00:08:48,322
request. It can be an issue getting logged,

251
00:08:49,254 --> 00:08:51,783
and these workflows, so the actions,

252
00:08:51,903 --> 00:08:52,484
the

253
00:08:52,783 --> 00:08:54,783
arbitrary code code if you decide to run that,

254
00:08:54,864 --> 00:08:56,563
will run on

255
00:08:57,092 --> 00:08:59,423
ephemeral runners they're called. They

256
00:08:59,423 --> 00:09:00,903
can be managed by GitHub

257
00:09:01,183 --> 00:09:03,462
or they can be self-hosted and managed within your own

258
00:09:03,462 --> 00:09:03,984
environments.

259
00:09:04,769 --> 00:09:07,038
These workflows get defined in YAML files,

260
00:09:07,099 --> 00:09:09,389
um, because everyone loves the YAML files,

261
00:09:09,899 --> 00:09:12,099
and we're gonna show you one of these workflows, in

262
00:09:12,099 --> 00:09:14,210
case you haven't seen one recently, um, in a,

263
00:09:14,239 --> 00:09:16,619
in a little bit more detail as we go through the session

264
00:09:16,619 --> 00:09:18,788
today. Access

265
00:09:18,788 --> 00:09:20,840
Analyzer, what is Access Analyzer,

266
00:09:21,000 --> 00:09:23,038
show of hands, who's using Access Analyzer?

267
00:09:23,519 --> 00:09:24,700
Few people, OK, cool.

268
00:09:25,200 --> 00:09:27,259
So this is our um.

269
00:09:28,090 --> 00:09:30,369
Our automated reasoning

270
00:09:30,369 --> 00:09:31,469
powered tool

271
00:09:31,889 --> 00:09:34,149
for analyzing your policies,

272
00:09:34,450 --> 00:09:36,668
um, be they identity policies or

273
00:09:36,668 --> 00:09:37,668
resource policies,

274
00:09:37,928 --> 00:09:39,389
to determine if certain

275
00:09:39,769 --> 00:09:41,849
properties are true or or not

276
00:09:41,849 --> 00:09:43,889
true. Um, in the case of

277
00:09:43,889 --> 00:09:45,969
the very first version of Access

278
00:09:45,969 --> 00:09:48,090
Analyzer that we deployed, um, we

279
00:09:48,090 --> 00:09:50,529
had an analyzer called External Access Analyzer,

280
00:09:50,570 --> 00:09:52,570
which is still available today. You should turn

281
00:09:52,570 --> 00:09:54,769
it on in your AWS accounts if you don't have it on

282
00:09:54,769 --> 00:09:55,548
because it's free.

283
00:09:55,869 --> 00:09:58,038
And it does a really good job of telling

284
00:09:58,038 --> 00:10:00,250
you whether or not things in your AWS account

285
00:10:00,250 --> 00:10:02,469
are accessible publicly, um,

286
00:10:02,719 --> 00:10:03,639
and it uses

287
00:10:03,960 --> 00:10:06,509
automated reasoning, so essentially mathematics,

288
00:10:06,519 --> 00:10:09,099
um, to give you mathematical mathematically

289
00:10:09,099 --> 00:10:11,349
verified answers to the question.

290
00:10:12,259 --> 00:10:14,428
Is this thing true? Is this assumed property

291
00:10:14,428 --> 00:10:16,428
true? Is it public? Yes, no. Can

292
00:10:16,428 --> 00:10:18,469
this identity policy do this or

293
00:10:18,469 --> 00:10:19,928
that, yes or no?

294
00:10:20,548 --> 00:10:22,908
Um, and we, we call this at AWS provable

295
00:10:22,908 --> 00:10:24,950
security. If you Google search provable security,

296
00:10:24,989 --> 00:10:27,139
you'll be able to dive a bit deeper into that.

297
00:10:27,389 --> 00:10:29,820
That's pretty much all I'm going to say about,

298
00:10:29,950 --> 00:10:32,000
uh, automated reasoning, uh,

299
00:10:32,009 --> 00:10:34,029
and formal logic and, and provable

300
00:10:34,029 --> 00:10:36,070
security because I don't have a PhD in that and I

301
00:10:36,070 --> 00:10:36,928
do a really bad,

302
00:10:37,349 --> 00:10:39,379
uh. Job of trying to explain the science

303
00:10:39,379 --> 00:10:41,580
behind it, but if you Google it, you'll find some really good

304
00:10:41,580 --> 00:10:43,658
examples of, of that and some really good papers that

305
00:10:43,820 --> 00:10:45,840
some of our colleagues have published in this space.

306
00:10:46,619 --> 00:10:48,808
One of the other features of Access

307
00:10:48,808 --> 00:10:51,649
Analyzer beyond external analyzer

308
00:10:51,649 --> 00:10:53,320
and the other ones I mentioned as well

309
00:10:53,580 --> 00:10:55,019
is um.

310
00:10:55,700 --> 00:10:58,099
Custom policy checks. So these are 4,

311
00:10:59,340 --> 00:11:00,460
stateless APIs

312
00:11:00,739 --> 00:11:03,129
that will use automated reasoning, um,

313
00:11:03,340 --> 00:11:03,928
to, well,

314
00:11:04,219 --> 00:11:06,580
will mostly for, for most of those actions,

315
00:11:06,700 --> 00:11:08,639
not, not validate validate policy.

316
00:11:08,899 --> 00:11:10,940
They'll use essentially use automated reasoning or

317
00:11:10,940 --> 00:11:13,048
a variation of that to, um,

318
00:11:13,058 --> 00:11:15,139
help you answer questions about policies

319
00:11:15,139 --> 00:11:16,099
that you want to check.

320
00:11:16,460 --> 00:11:18,820
So here's a policy, um, does it conform

321
00:11:18,820 --> 00:11:21,129
to AWS 100 best practices,

322
00:11:21,259 --> 00:11:23,450
uh, and is it syntactically correct?

323
00:11:23,580 --> 00:11:24,759
That's validate policy.

324
00:11:25,250 --> 00:11:27,509
Um, here's a policy. Does it allow

325
00:11:27,928 --> 00:11:30,750
a subset of my maximum allowable

326
00:11:30,750 --> 00:11:32,769
organizational permissions? That's custom policy

327
00:11:32,769 --> 00:11:34,889
checks, uh, sorry, check access, not granted.

328
00:11:35,168 --> 00:11:36,029
Here's a policy,

329
00:11:36,288 --> 00:11:38,330
um, I'm sorry, check no new

330
00:11:38,330 --> 00:11:40,369
access. Here's a policy, does it allow

331
00:11:40,369 --> 00:11:42,489
access to this resource or does it allow access

332
00:11:42,489 --> 00:11:44,558
to this action? And that's what, um,

333
00:11:44,570 --> 00:11:46,279
check, access not granted is.

334
00:11:46,609 --> 00:11:48,609
And can anyone guess what check no public

335
00:11:48,609 --> 00:11:49,308
access does?

336
00:11:51,379 --> 00:11:52,099
We'll leave it there.

337
00:11:53,080 --> 00:11:53,739
Um

338
00:11:54,509 --> 00:11:55,500
So what are we gonna build?

339
00:11:55,879 --> 00:11:57,908
Uh, what's knitting gonna build today? We're

340
00:11:57,908 --> 00:12:00,029
gonna build this, this is a bit like our delegated

341
00:12:00,029 --> 00:12:02,048
workflow you saw on the slide a bit earlier on,

342
00:12:02,428 --> 00:12:03,090
with

343
00:12:03,349 --> 00:12:05,469
the added benefit of a

344
00:12:05,469 --> 00:12:07,469
little bit of intelligence when we get

345
00:12:07,469 --> 00:12:08,408
a failure.

346
00:12:08,750 --> 00:12:10,750
So when we identify a blocking finding, and

347
00:12:10,750 --> 00:12:12,788
we're gonna use custom policy checks as part

348
00:12:12,788 --> 00:12:13,609
of this pipeline,

349
00:12:14,029 --> 00:12:16,070
so as a policy gets submitted and starts

350
00:12:16,070 --> 00:12:18,129
working its way through this flow,

351
00:12:18,710 --> 00:12:20,869
if we identify that that policy

352
00:12:20,869 --> 00:12:23,109
violates some rule that we've outlined.

353
00:12:23,710 --> 00:12:25,750
Um, we will pass that rule,

354
00:12:25,960 --> 00:12:28,320
sorry, pass that finding, um, and

355
00:12:28,320 --> 00:12:30,349
the policy that has failed

356
00:12:30,719 --> 00:12:32,099
over to Bedrock.

357
00:12:33,178 --> 00:12:35,580
And instead of just telling the engineer, nah,

358
00:12:35,639 --> 00:12:37,859
your policy's violated something,

359
00:12:38,099 --> 00:12:40,139
go figure out how to fix it, we're actually gonna

360
00:12:40,139 --> 00:12:42,178
give the engineer prescriptive guidance

361
00:12:42,178 --> 00:12:43,558
generated by Bedrock,

362
00:12:43,899 --> 00:12:46,099
um, and one of its many uh

363
00:12:46,259 --> 00:12:47,719
uh managed models,

364
00:12:48,460 --> 00:12:49,070
um,

365
00:12:49,460 --> 00:12:50,529
on how to fix that.

366
00:12:51,009 --> 00:12:51,889
And not only that,

367
00:12:52,340 --> 00:12:54,619
because we're using GitHub actions and our repository

368
00:12:54,619 --> 00:12:55,619
is GitHub, we're gonna

369
00:12:55,979 --> 00:12:58,298
generate an issue that contains that prescriptive

370
00:12:58,298 --> 00:13:00,178
guidance in a nicely formatted way.

371
00:13:00,529 --> 00:13:01,769
So the engineer goes, huh,

372
00:13:02,090 --> 00:13:04,168
great. I, I can see here exactly why it

373
00:13:04,168 --> 00:13:06,489
failed, where I violated my

374
00:13:06,489 --> 00:13:08,489
organizational policies, and what I need to do to go

375
00:13:08,489 --> 00:13:09,009
and fix that.

376
00:13:10,369 --> 00:13:11,149
That's what we're gonna build

377
00:13:12,729 --> 00:13:15,090
I'm gonna hand over to knitting now to

378
00:13:15,090 --> 00:13:16,469
show you to build.

379
00:13:17,070 --> 00:13:18,359
Let's flip to there,

380
00:13:18,649 --> 00:13:20,879
there we go. Mm, OK.

381
00:13:21,190 --> 00:13:22,149
Can everyone hear me well?

382
00:13:22,859 --> 00:13:23,399
OK, awesome.

383
00:13:23,739 --> 00:13:24,759
Thank you, Mitch. So.

384
00:13:25,788 --> 00:13:28,048
We are building automation

385
00:13:28,048 --> 00:13:28,808
in

386
00:13:29,580 --> 00:13:31,529
Uh, in our CICD pipeline,

387
00:13:32,099 --> 00:13:32,879
so that

388
00:13:33,210 --> 00:13:35,460
builder-authored or developer-authored

389
00:13:35,460 --> 00:13:37,500
policies can be validated

390
00:13:37,500 --> 00:13:39,580
against, um, your security

391
00:13:39,580 --> 00:13:40,408
baseline, right?

392
00:13:40,899 --> 00:13:43,058
So, the, the goal, and I'm reiterating

393
00:13:43,058 --> 00:13:45,058
the goal here and we'll revisit the goal

394
00:13:45,058 --> 00:13:47,320
again when we go uh towards the end of this talk.

395
00:13:47,538 --> 00:13:49,678
The goal is to enable

396
00:13:49,678 --> 00:13:50,918
developer agility

397
00:13:51,178 --> 00:13:52,500
or builder agility.

398
00:13:52,779 --> 00:13:54,820
Uh, at the same time by allowing

399
00:13:54,820 --> 00:13:56,859
developers or builders to write their own policies

400
00:13:56,859 --> 00:13:59,320
and roles, but at the same time enforce

401
00:13:59,899 --> 00:14:01,080
security team

402
00:14:01,779 --> 00:14:03,899
provided guardrails in the CICD pipeline

403
00:14:03,899 --> 00:14:06,099
itself, right? So this is kind of the overall

404
00:14:06,099 --> 00:14:08,158
goal. So let's get started now this slide,

405
00:14:08,619 --> 00:14:10,739
um, it talks about, it gives an

406
00:14:10,739 --> 00:14:11,279
overall,

407
00:14:11,808 --> 00:14:13,859
uh, view of steps that we are going to

408
00:14:13,859 --> 00:14:15,940
follow in the next 15 minutes or

409
00:14:15,940 --> 00:14:16,859
so, I will.

410
00:14:17,229 --> 00:14:19,599
Uh, I'll show you the whole build

411
00:14:19,599 --> 00:14:21,710
or the infrastructure setup, and then Mitch

412
00:14:21,710 --> 00:14:23,989
will come back and go over the actions

413
00:14:23,989 --> 00:14:26,000
code, uh, step by step, right?

414
00:14:26,629 --> 00:14:28,639
So, let's get with it. So, 1st 8

415
00:14:28,639 --> 00:14:29,250
steps here,

416
00:14:29,590 --> 00:14:31,788
um, will be, we'll be performing using

417
00:14:31,788 --> 00:14:33,989
the persona of a security engineer. Mitch talked

418
00:14:33,989 --> 00:14:34,500
about that.

419
00:14:34,869 --> 00:14:37,619
Uh, this will set the pipeline, set the automation,

420
00:14:37,869 --> 00:14:40,288
you know, set the plumbing and bells and whistles,

421
00:14:40,538 --> 00:14:41,908
uh, to, to make it happen.

422
00:14:42,308 --> 00:14:43,168
Then we'll come back

423
00:14:43,469 --> 00:14:45,469
as a developer or as a builder, we'll check

424
00:14:45,469 --> 00:14:47,710
in a policy, and then that will

425
00:14:47,710 --> 00:14:49,710
essentially test out uh what

426
00:14:49,710 --> 00:14:51,719
we have built in the 1st 8

427
00:14:51,719 --> 00:14:53,908
steps of this, of this talk, right? So, OK, let's

428
00:14:53,908 --> 00:14:54,570
get started.

429
00:14:54,859 --> 00:14:55,969
Uh, I will first

430
00:14:56,349 --> 00:14:58,389
show, this is the repository we are going

431
00:14:58,389 --> 00:14:58,950
to use.

432
00:14:59,349 --> 00:15:01,590
I have cloned this repository

433
00:15:01,590 --> 00:15:02,269
locally.

434
00:15:02,548 --> 00:15:04,548
I will be using Quiro today,

435
00:15:04,869 --> 00:15:05,649
um,

436
00:15:06,190 --> 00:15:08,239
and we'll also be using Quiro,

437
00:15:08,269 --> 00:15:10,308
uh, command line interface, which is a very nifty

438
00:15:10,308 --> 00:15:12,418
tool. Uh, it comes with, uh, a

439
00:15:12,418 --> 00:15:13,918
lot of bells and whistles, as I said,

440
00:15:14,178 --> 00:15:16,389
and we'll be using this to, to,

441
00:15:16,558 --> 00:15:18,279
over the, over the court talk.

442
00:15:18,729 --> 00:15:19,719
OK. So first,

443
00:15:21,000 --> 00:15:23,200
Let us set up authentication

444
00:15:23,200 --> 00:15:25,548
between GitHub and AWS,

445
00:15:25,639 --> 00:15:26,178
right? So,

446
00:15:26,489 --> 00:15:27,099
um,

447
00:15:27,879 --> 00:15:29,178
uh, here,

448
00:15:29,599 --> 00:15:31,298
first I'll create, we have created

449
00:15:31,558 --> 00:15:33,690
an identity provider in

450
00:15:33,808 --> 00:15:35,200
our AWS account.

451
00:15:35,739 --> 00:15:38,058
Pay attention to a couple of

452
00:15:38,399 --> 00:15:40,599
kind of configuration items here. One is

453
00:15:41,000 --> 00:15:43,119
the provider points to the OIDC

454
00:15:43,119 --> 00:15:43,960
endpoint

455
00:15:44,320 --> 00:15:45,279
of GitHub.

456
00:15:45,639 --> 00:15:47,019
Uh, we'll come to that quickly.

457
00:15:47,418 --> 00:15:49,460
And then also the audience is STS.

458
00:15:49,710 --> 00:15:51,779
Amazon AWS.com, right? So you might ask,

459
00:15:51,830 --> 00:15:53,308
OK, why are we going over this,

460
00:15:53,590 --> 00:15:55,719
uh, authentication from GitHub to AWS,

461
00:15:55,820 --> 00:15:58,058
right? We are, we are here to, here to, uh,

462
00:15:58,070 --> 00:15:59,129
do a court talk, right?

463
00:15:59,548 --> 00:16:01,710
Uh, it just, it will be

464
00:16:01,710 --> 00:16:04,019
important because this is kind of an important pillar.

465
00:16:04,308 --> 00:16:06,619
The reason we are doing this is we don't want to vend

466
00:16:06,619 --> 00:16:08,750
out, uh, long-term credentials

467
00:16:08,750 --> 00:16:09,969
or we don't want to store our

468
00:16:10,308 --> 00:16:12,190
access keys into GitHub, right?

469
00:16:12,570 --> 00:16:14,879
So for that, GitHub needs to get

470
00:16:14,879 --> 00:16:17,000
temporary credentials from AWS in order

471
00:16:17,000 --> 00:16:19,038
if GitHub has to make a call to Access Analyzer,

472
00:16:19,080 --> 00:16:21,389
as Mitch was saying, it needs to get temporary

473
00:16:21,389 --> 00:16:23,719
credentials. So the way this works

474
00:16:23,719 --> 00:16:24,340
is,

475
00:16:24,918 --> 00:16:27,229
uh, when, and we'll go over that

476
00:16:27,239 --> 00:16:29,259
process uh on in this slide.

477
00:16:30,359 --> 00:16:32,609
When the GitHub actions workflow

478
00:16:32,609 --> 00:16:34,129
runner is at a step

479
00:16:34,609 --> 00:16:36,609
where it needs to make a call to

480
00:16:36,609 --> 00:16:37,849
AWS services,

481
00:16:38,250 --> 00:16:39,788
it first reaches out

482
00:16:40,129 --> 00:16:42,320
to the GitHub OIDC endpoint.

483
00:16:42,849 --> 00:16:45,009
The GitHub OIDC endpoint returns a

484
00:16:45,009 --> 00:16:45,668
signed

485
00:16:46,009 --> 00:16:48,048
Java web token or a or

486
00:16:48,048 --> 00:16:49,729
a JWT or a JT token.

487
00:16:51,058 --> 00:16:52,389
Now, among other things, this token.

488
00:16:52,798 --> 00:16:54,960
Contains uh attributes also known

489
00:16:54,960 --> 00:16:57,080
as claims, right? So, for example, one of the

490
00:16:57,080 --> 00:16:59,080
claims in this token can be what is the

491
00:16:59,080 --> 00:17:00,158
repository name,

492
00:17:00,428 --> 00:17:02,259
uh, what is the subject

493
00:17:02,710 --> 00:17:04,880
uh or the audience. These are the claims in this

494
00:17:04,880 --> 00:17:07,118
token. Once the actions

495
00:17:07,118 --> 00:17:09,289
workflow runner gets this token,

496
00:17:09,559 --> 00:17:11,759
it then makes an assumed role with

497
00:17:11,759 --> 00:17:12,858
web identity call

498
00:17:13,118 --> 00:17:15,059
to AWS STS service.

499
00:17:15,358 --> 00:17:17,439
Now, AWS STS service will

500
00:17:17,439 --> 00:17:18,420
then use

501
00:17:18,719 --> 00:17:20,420
the identity provider setup

502
00:17:20,680 --> 00:17:21,809
that we just created.

503
00:17:22,549 --> 00:17:23,858
To, because the,

504
00:17:24,358 --> 00:17:25,670
uh, is there a question? Yeah, sorry,

505
00:17:25,959 --> 00:17:27,959
yeah, sorry, the identity provider, do you

506
00:17:27,959 --> 00:17:30,170
have to set up one per account

507
00:17:30,170 --> 00:17:32,289
that you want to do this in or can you set it up

508
00:17:32,289 --> 00:17:33,059
at the like.

509
00:17:34,410 --> 00:17:36,479
Manage an account and use it across

510
00:17:36,479 --> 00:17:38,660
your. Um, in this

511
00:17:38,660 --> 00:17:40,699
case, because you are, uh, going to

512
00:17:40,699 --> 00:17:42,769
make a call to that account, ST account, you

513
00:17:42,769 --> 00:17:44,160
will have to set it up in the account level.

514
00:17:47,269 --> 00:17:49,309
Um, the way the, the identity provider that

515
00:17:49,309 --> 00:17:51,318
you set at the org level is for

516
00:17:51,318 --> 00:17:52,469
org level actions, right?

517
00:17:52,799 --> 00:17:54,618
Uh, so for example, if you have to use IDC

518
00:17:55,640 --> 00:17:57,680
and then you want to use that identity provider

519
00:17:57,680 --> 00:17:59,959
to sync up users into the, uh, into your IDC

520
00:17:59,959 --> 00:18:02,078
and all that, right? Uh, this is a very

521
00:18:02,078 --> 00:18:03,979
specific OIDC identity provider,

522
00:18:04,239 --> 00:18:06,559
uh, that you will set up at this account level.

523
00:18:07,400 --> 00:18:08,189
Yeah, thanks.

524
00:18:08,699 --> 00:18:11,049
Uh, we have OIDC for other repositories,

525
00:18:12,239 --> 00:18:13,338
tools like bucket.

526
00:18:15,199 --> 00:18:15,939
Uh,

527
00:18:17,160 --> 00:18:19,239
so, in this case, the OIDC endpoint is

528
00:18:19,239 --> 00:18:21,279
what matters, right? So as long as you have

529
00:18:21,279 --> 00:18:23,318
access to the OIDC endpoint, you can set it

530
00:18:23,318 --> 00:18:25,818
up. The reason why we need that OIDC endpoint

531
00:18:25,818 --> 00:18:27,489
is for authentication,

532
00:18:28,039 --> 00:18:30,078
AWS will reach out to the OIDC endpoint,

533
00:18:30,209 --> 00:18:32,239
get the public key, and then use that

534
00:18:32,239 --> 00:18:34,439
public key to validate the signature of the token

535
00:18:34,439 --> 00:18:36,509
that is presented to uh AWS

536
00:18:36,509 --> 00:18:37,858
account. So, as long as

537
00:18:38,118 --> 00:18:40,199
uh any of these OIDC providers have

538
00:18:40,199 --> 00:18:42,199
an endpoint, which can, which have a

539
00:18:42,199 --> 00:18:44,279
key endpoint or which have a token endpoint, then we

540
00:18:44,279 --> 00:18:44,838
can use that.

541
00:18:45,769 --> 00:18:46,410
Makes sense, yeah.

542
00:18:47,559 --> 00:18:48,559
Yeah, great questions. OK.

543
00:18:48,920 --> 00:18:50,130
So, uh,

544
00:18:50,559 --> 00:18:51,818
STS will then

545
00:18:52,078 --> 00:18:54,078
use the connection or the IDP that we

546
00:18:54,078 --> 00:18:56,219
have created to validate the signature

547
00:18:56,219 --> 00:18:57,078
on the token.

548
00:18:57,400 --> 00:18:59,959
That essentially completes the authentication

549
00:18:59,959 --> 00:19:02,000
process, right? Now we come to the authorization

550
00:19:02,000 --> 00:19:03,420
part. Uh,

551
00:19:04,539 --> 00:19:06,088
Sorry, let me take a step back.

552
00:19:06,380 --> 00:19:08,539
STS will vary the token and then

553
00:19:08,539 --> 00:19:10,618
return temporary credentials to

554
00:19:10,618 --> 00:19:12,739
GitHub actions workflow, which are

555
00:19:12,739 --> 00:19:14,890
scoped to a role. And by the way, the role

556
00:19:14,890 --> 00:19:17,420
is also passed in the AU role with Ravanity

557
00:19:17,420 --> 00:19:18,009
call, right?

558
00:19:18,420 --> 00:19:20,539
Now, let's quickly look at the configuration

559
00:19:20,539 --> 00:19:22,799
of this role that we have set up

560
00:19:23,019 --> 00:19:24,318
in our AWS account.

561
00:19:24,949 --> 00:19:26,170
Um, so,

562
00:19:27,348 --> 00:19:29,029
in the, the role that is

563
00:19:30,029 --> 00:19:32,229
role scope credentials that that particular

564
00:19:32,229 --> 00:19:34,390
role has got two different policies. One is

565
00:19:34,390 --> 00:19:36,390
the trust policy, and then one is a

566
00:19:36,390 --> 00:19:38,930
permissions policy. The trust policy

567
00:19:40,068 --> 00:19:42,189
defines what principals are

568
00:19:42,189 --> 00:19:44,509
allowed to make an assume roll call to the role, and

569
00:19:44,509 --> 00:19:46,549
the permissions policy defines what

570
00:19:46,549 --> 00:19:47,608
permissions are given

571
00:19:48,068 --> 00:19:50,140
to the temporary credentials that are

572
00:19:50,140 --> 00:19:52,500
returned back as roll scope credentials,

573
00:19:52,650 --> 00:19:53,729
right? So in our case,

574
00:19:54,368 --> 00:19:56,519
Uh, the role trust policy, we are narrowing

575
00:19:56,519 --> 00:19:58,729
it down to our repository in

576
00:19:58,729 --> 00:20:00,729
GitHub. So these two conditions that we have

577
00:20:00,729 --> 00:20:02,969
created here, one is that, uh, this

578
00:20:02,969 --> 00:20:04,650
subject condition and the audience condition.

579
00:20:04,930 --> 00:20:05,949
The subject condition,

580
00:20:06,269 --> 00:20:08,568
uh, narrows the principles

581
00:20:08,568 --> 00:20:09,189
that can

582
00:20:09,689 --> 00:20:11,430
make an assumed roll call to this role

583
00:20:11,848 --> 00:20:13,890
just to requests originating from

584
00:20:13,890 --> 00:20:15,890
our GitHub repository. So this

585
00:20:15,890 --> 00:20:17,199
clamps it down a little bit.

586
00:20:17,529 --> 00:20:18,049
And then

587
00:20:18,348 --> 00:20:20,400
STS. Amazon AWS.com, that is the

588
00:20:20,400 --> 00:20:22,689
audience that is also one of the attributes

589
00:20:22,689 --> 00:20:23,689
in the job token.

590
00:20:24,118 --> 00:20:26,390
And that is that defines who

591
00:20:26,390 --> 00:20:29,098
this job token or what this job token is intended

592
00:20:29,098 --> 00:20:31,348
for and in this case it's STS, right? So

593
00:20:31,680 --> 00:20:34,049
this is a pretty, uh, you know, least privileged

594
00:20:34,049 --> 00:20:36,219
uh policy that we have in the trust

595
00:20:36,219 --> 00:20:36,779
relationship.

596
00:20:37,289 --> 00:20:39,568
The permissions relationship or the permissions policy

597
00:20:39,568 --> 00:20:40,989
that we have in the role,

598
00:20:41,368 --> 00:20:43,689
um, notice that we have permissions

599
00:20:43,689 --> 00:20:45,689
to 3 different AWS services.

600
00:20:46,009 --> 00:20:48,199
One is we have permissions to Bedrock. We'll

601
00:20:48,199 --> 00:20:48,868
come to that.

602
00:20:49,598 --> 00:20:51,608
Uh, we have permissions to S3 buckets.

603
00:20:51,769 --> 00:20:53,848
We'll also see that in a minute why we need that.

604
00:20:54,150 --> 00:20:56,299
And of course we have permissions for Access

605
00:20:56,299 --> 00:20:58,318
Analyzer because we are going to make calls

606
00:20:58,318 --> 00:21:00,549
to Access Analyzer APIs from our GitHub

607
00:21:00,549 --> 00:21:01,509
actions workflow.

608
00:21:02,239 --> 00:21:04,338
OK, so we'll come back to our PowerPoint

609
00:21:04,338 --> 00:21:06,088
to just get ourselves situated.

610
00:21:06,410 --> 00:21:09,130
Um, at this point, we have seen configuration

611
00:21:09,130 --> 00:21:09,709
for,

612
00:21:10,130 --> 00:21:12,239
uh, set up for the 1st 3 steps.

613
00:21:12,410 --> 00:21:14,509
And so we created the IDC, uh,

614
00:21:14,608 --> 00:21:16,890
OIDC provider, we created the permissions policy,

615
00:21:16,930 --> 00:21:19,309
we created the role, uh, within AWS.

616
00:21:19,989 --> 00:21:21,289
Next, we will

617
00:21:22,049 --> 00:21:24,509
make a configuration setup in

618
00:21:24,509 --> 00:21:25,650
GitHub. So,

619
00:21:26,068 --> 00:21:28,229
uh, GitHub Actions workflow

620
00:21:28,229 --> 00:21:29,529
runner at runtime

621
00:21:29,789 --> 00:21:31,828
needs access to some configuration parameters. We

622
00:21:31,828 --> 00:21:34,459
don't want to store those configuration parameters

623
00:21:34,459 --> 00:21:36,309
or hardcode them in the Actions workflow runner.

624
00:21:36,630 --> 00:21:38,789
So we do that at a place

625
00:21:38,789 --> 00:21:40,739
called Secrets. In GitHub, in our case,

626
00:21:41,029 --> 00:21:43,180
we have stored 3 different secrets

627
00:21:43,180 --> 00:21:45,348
in the repository. One is the AWS Region.

628
00:21:45,739 --> 00:21:47,410
Uh, pretty self-explanatory.

629
00:21:47,699 --> 00:21:49,739
One is the OIDCIM role, which needs,

630
00:21:49,858 --> 00:21:52,059
which the GitHub actions workflow runner

631
00:21:52,059 --> 00:21:54,059
needs to make the assume roll call,

632
00:21:54,420 --> 00:21:56,640
and then the S3 bucket. And we'll

633
00:21:56,640 --> 00:21:58,759
straight away come to why we need the S3 bucket here.

634
00:21:59,299 --> 00:21:59,900
OK, so,

635
00:22:00,209 --> 00:22:02,650
let's talk a little bit about, uh,

636
00:22:02,660 --> 00:22:04,588
reference policies. Now,

637
00:22:05,299 --> 00:22:07,640
access analyzer reference policies are

638
00:22:07,640 --> 00:22:09,519
a mechanism by which,

639
00:22:09,838 --> 00:22:10,420
um,

640
00:22:10,959 --> 00:22:12,219
You can express

641
00:22:13,400 --> 00:22:14,939
your control

642
00:22:15,920 --> 00:22:17,449
or the intent for control, right?

643
00:22:17,818 --> 00:22:19,920
So what that means is that Mitch talked about the

644
00:22:19,920 --> 00:22:22,229
check no new access API in Access Analyzer.

645
00:22:22,509 --> 00:22:24,640
The way that API works is that you pass

646
00:22:24,640 --> 00:22:26,640
in the check no new access flag. Uh, it's a

647
00:22:26,640 --> 00:22:28,420
CFN policy validator wrapper to that.

648
00:22:28,959 --> 00:22:31,039
You also pass in two different policies

649
00:22:31,039 --> 00:22:32,000
to that API.

650
00:22:32,259 --> 00:22:34,670
One of the policies is what is called the candidate

651
00:22:34,670 --> 00:22:36,969
policy. In our case, the candidate

652
00:22:36,969 --> 00:22:39,130
policy is going to be the policy that

653
00:22:39,130 --> 00:22:41,130
the developer or the builder checks into

654
00:22:41,130 --> 00:22:42,098
our repository,

655
00:22:42,368 --> 00:22:44,368
and the next attribute or second attribute

656
00:22:44,368 --> 00:22:46,489
we pass is the reference policy.

657
00:22:47,088 --> 00:22:49,209
The way it works is if the

658
00:22:49,209 --> 00:22:51,489
candidate policy is not

659
00:22:51,769 --> 00:22:54,309
a subset of the reference policy,

660
00:22:54,689 --> 00:22:56,868
then that API returns a finding,

661
00:22:57,049 --> 00:22:59,000
a check no new access finding, meaning it says, oh,

662
00:22:59,650 --> 00:23:01,650
you know, the candidate policy has new access,

663
00:23:01,769 --> 00:23:03,608
then what is defined in the reference policy.

664
00:23:04,108 --> 00:23:05,328
Uh, so this is a pretty

665
00:23:05,588 --> 00:23:07,709
powerful kind of, uh, API that we can

666
00:23:07,709 --> 00:23:10,068
use at runtime for a lot of automation

667
00:23:10,068 --> 00:23:11,180
that we can think about, right?

668
00:23:11,509 --> 00:23:13,549
Now, in our case, as I said, we are

669
00:23:13,549 --> 00:23:15,568
going to, uh, you know, pass the,

670
00:23:15,630 --> 00:23:17,549
uh, builder policy as a candidate policy.

671
00:23:17,868 --> 00:23:19,900
The security engineering team has already

672
00:23:20,289 --> 00:23:22,559
written these reference policies into the repository,

673
00:23:22,598 --> 00:23:24,299
and we'll see where, how that is set up.

674
00:23:24,680 --> 00:23:26,680
Now, before I go, before we

675
00:23:26,680 --> 00:23:28,838
go and look at our reference policy, I wanted to

676
00:23:28,838 --> 00:23:30,880
show a very handy kind of

677
00:23:30,880 --> 00:23:33,279
repository. It's a, it's a, our

678
00:23:33,279 --> 00:23:35,459
colleagues at uh AWS have built

679
00:23:35,459 --> 00:23:37,400
a repository. Of reference policies.

680
00:23:37,750 --> 00:23:38,449
Now this is

681
00:23:39,029 --> 00:23:41,328
amazing. There are a bunch of identity,

682
00:23:41,608 --> 00:23:43,828
uh, resource reference policies here.

683
00:23:44,068 --> 00:23:46,348
All the use cases are here in case you are,

684
00:23:46,670 --> 00:23:49,309
uh, thinking of building this kind of an automation,

685
00:23:49,670 --> 00:23:51,828
uh, strongly recommend, uh, highly suggested

686
00:23:51,828 --> 00:23:53,868
to visit this and then get all these policies

687
00:23:53,868 --> 00:23:54,400
from here.

688
00:23:54,759 --> 00:23:56,789
Um, we will, we will show

689
00:23:56,789 --> 00:23:58,949
a link to this, um, to this repository

690
00:23:58,949 --> 00:24:00,130
at the end of the talk.

691
00:24:00,519 --> 00:24:02,630
We'll show a, uh, you know, a barcode for that.

692
00:24:03,088 --> 00:24:04,140
But in fact,

693
00:24:04,489 --> 00:24:06,650
the reference policy that we are looking in our uh

694
00:24:06,650 --> 00:24:09,170
court talk today is also directly picked up from this repository.

695
00:24:09,250 --> 00:24:11,588
There are a lot of use cases also here. So,

696
00:24:11,598 --> 00:24:13,650
a very nice uh uh resource to

697
00:24:13,650 --> 00:24:15,759
visit. Uh, so let's come to our

698
00:24:15,759 --> 00:24:16,670
reference policy.

699
00:24:17,009 --> 00:24:18,309
Now, the mental model

700
00:24:18,769 --> 00:24:21,088
or the way you can think about reference policies

701
00:24:21,088 --> 00:24:22,098
is, um,

702
00:24:22,489 --> 00:24:24,828
similar to service control policies. So, how,

703
00:24:25,368 --> 00:24:27,489
uh, show of hands, uh, how many of us

704
00:24:27,489 --> 00:24:29,088
are using service control policies?

705
00:24:30,358 --> 00:24:31,559
Yeah, yeah, I'm really glad.

706
00:24:31,880 --> 00:24:33,098
Uh, yeah, this is really good.

707
00:24:33,559 --> 00:24:35,338
This is more than what we usually see.

708
00:24:36,239 --> 00:24:38,660
So the service control policies

709
00:24:38,989 --> 00:24:41,279
and reference policies, the way we start off

710
00:24:41,279 --> 00:24:42,098
by giving

711
00:24:42,519 --> 00:24:43,328
all access,

712
00:24:43,640 --> 00:24:46,239
and then we add another statement in the policy

713
00:24:46,239 --> 00:24:48,858
which defines

714
00:24:48,858 --> 00:24:49,920
what access we want to control.

715
00:24:50,318 --> 00:24:52,150
So in this case, in our use case,

716
00:24:52,439 --> 00:24:54,719
we are saying that in our reference policy

717
00:24:54,719 --> 00:24:56,719
or the reference policy that the security engineer will

718
00:24:56,719 --> 00:24:58,809
check in. Um, we are saying

719
00:24:58,809 --> 00:24:59,890
that if

720
00:25:00,348 --> 00:25:02,390
for all actions other than the

721
00:25:02,390 --> 00:25:04,469
assumed role action, right? So, which is the not

722
00:25:04,469 --> 00:25:05,250
action here,

723
00:25:05,568 --> 00:25:06,368
allow everything.

724
00:25:06,868 --> 00:25:08,868
So, we are not concerned about anything

725
00:25:08,868 --> 00:25:10,189
other than the assumed role action.

726
00:25:10,588 --> 00:25:12,789
But if the action is SDS

727
00:25:12,789 --> 00:25:13,689
assumed role,

728
00:25:14,049 --> 00:25:16,328
Then only allow principals from

729
00:25:16,328 --> 00:25:17,910
these two accounts

730
00:25:18,209 --> 00:25:20,239
um in the policy, which is,

731
00:25:20,250 --> 00:25:22,250
in this case, is going to be the candidate policy.

732
00:25:22,529 --> 00:25:24,229
Now, what,

733
00:25:24,549 --> 00:25:26,848
what would be kind of a real-life use

734
00:25:26,848 --> 00:25:27,469
case where

735
00:25:28,000 --> 00:25:30,078
Uh, one would want to have

736
00:25:30,078 --> 00:25:31,500
this kind of a reference policy,

737
00:25:32,000 --> 00:25:34,338
uh, in the CICD pipeline automation, right? So,

738
00:25:34,519 --> 00:25:36,390
we, Mitch and I, we talk to a lot of customers.

739
00:25:36,719 --> 00:25:39,130
We see customers, uh, multi-account

740
00:25:39,130 --> 00:25:39,858
strategy

741
00:25:40,199 --> 00:25:41,380
being, uh, around,

742
00:25:41,759 --> 00:25:43,019
uh, business units, right? So,

743
00:25:43,358 --> 00:25:45,519
most of the time there will be, I'm just making

744
00:25:45,519 --> 00:25:47,799
this up, sales business unit or marketing business

745
00:25:47,799 --> 00:25:50,439
unit, and each of these will be allocated 456

746
00:25:50,439 --> 00:25:51,269
different accounts.

747
00:25:51,838 --> 00:25:54,088
The development teams that are building

748
00:25:54,088 --> 00:25:55,818
applications for these business units.

749
00:25:56,380 --> 00:25:58,430
If they are given

750
00:25:58,430 --> 00:26:00,509
access or if they are given permissions to write

751
00:26:00,509 --> 00:26:01,818
their own rules and policies,

752
00:26:02,108 --> 00:26:04,390
then there's no reason for any policy

753
00:26:04,390 --> 00:26:06,670
that is checked into a particular business unit

754
00:26:06,670 --> 00:26:08,368
to have assumed role

755
00:26:09,029 --> 00:26:09,568
allowed

756
00:26:09,868 --> 00:26:12,029
from outside the 3 or 4 accounts

757
00:26:12,029 --> 00:26:14,189
or 5 or 6 accounts that are allocated to the business

758
00:26:14,189 --> 00:26:15,289
unit, right? So this is a pretty,

759
00:26:15,630 --> 00:26:17,328
you know, common use case that we see

760
00:26:17,989 --> 00:26:20,229
uh when we talk to our customers. So

761
00:26:20,229 --> 00:26:20,900
in this case,

762
00:26:21,189 --> 00:26:23,269
the security engineer is saying, OK, any

763
00:26:23,269 --> 00:26:25,630
policy that is checked into this repository.

764
00:26:26,059 --> 00:26:27,880
If it has an assumed role action,

765
00:26:28,259 --> 00:26:30,420
then the principal has to be one of these two accounts,

766
00:26:30,539 --> 00:26:32,318
right? So,

767
00:26:32,578 --> 00:26:34,259
let's now look at

768
00:26:34,660 --> 00:26:36,719
how or where this policy is stored. So,

769
00:26:36,939 --> 00:26:37,459
in,

770
00:26:37,750 --> 00:26:38,719
in our case,

771
00:26:39,059 --> 00:26:41,059
um, in our automation, we

772
00:26:41,059 --> 00:26:43,219
are the security engineering team is storing, they're

773
00:26:43,219 --> 00:26:45,259
not adding this policy to the same repository. They are

774
00:26:45,259 --> 00:26:47,239
storing this policy into an S3 bucket,

775
00:26:47,559 --> 00:26:48,979
uh, which is what we have done here.

776
00:26:49,380 --> 00:26:51,420
Uh, and at runtime, so this is now,

777
00:26:51,509 --> 00:26:53,549
that is the reason why you can make, uh,

778
00:26:53,670 --> 00:26:55,750
you know, sense of the two things that we added earlier,

779
00:26:55,868 --> 00:26:57,269
two configuration items. One is

780
00:26:57,618 --> 00:26:59,868
we added the S3 permissions in our role

781
00:26:59,868 --> 00:27:01,910
permissions policy, and we also added

782
00:27:01,910 --> 00:27:04,009
S3 bucket into the configuration

783
00:27:04,009 --> 00:27:05,939
for our, uh, GitHub secrets,

784
00:27:06,769 --> 00:27:08,989
right? For which should be accessible to the GitHub workflow runner.

785
00:27:09,729 --> 00:27:11,868
Um, now, let's come to

786
00:27:12,130 --> 00:27:12,989
the actual

787
00:27:13,809 --> 00:27:16,049
workflow code that puts everything together.

788
00:27:16,358 --> 00:27:18,390
Now, Uh, Mitch will go

789
00:27:18,390 --> 00:27:19,509
over this code, as I said,

790
00:27:19,959 --> 00:27:22,160
but one kind of configuration item

791
00:27:22,160 --> 00:27:23,059
here is that

792
00:27:23,358 --> 00:27:24,539
the way, uh,

793
00:27:24,838 --> 00:27:26,949
and I, I think for, for those who are not dealing

794
00:27:26,949 --> 00:27:28,670
with, uh, GitHub actions workflows,

795
00:27:29,039 --> 00:27:30,539
the way this works is

796
00:27:30,799 --> 00:27:33,229
any YAML file that you check in

797
00:27:33,670 --> 00:27:36,098
into a GitHub slash workflows

798
00:27:36,098 --> 00:27:38,219
directory into, in your repository

799
00:27:38,559 --> 00:27:40,880
is uh interpreted as a workflow

800
00:27:40,880 --> 00:27:42,549
or as an actions workflow by GitHub,

801
00:27:42,880 --> 00:27:45,140
and then it is, uh, you know, executed

802
00:27:45,140 --> 00:27:45,900
in a runner.

803
00:27:46,519 --> 00:27:48,598
Uh, as and when the triggers that are defined in the

804
00:27:48,598 --> 00:27:50,670
workflow are happening, right? So in our case,

805
00:27:51,078 --> 00:27:53,130
we have, uh, we have checked in this

806
00:27:53,130 --> 00:27:55,449
workflow into a .gitHub slash

807
00:27:55,449 --> 00:27:57,489
workflows directory, uh, as, as is seen

808
00:27:57,489 --> 00:27:59,539
here. So

809
00:27:59,868 --> 00:28:02,259
now let us go back and get situated

810
00:28:02,259 --> 00:28:03,920
into our steps, right? OK.

811
00:28:04,338 --> 00:28:05,078
So we.

812
00:28:06,199 --> 00:28:08,199
Finished the authentication set up

813
00:28:08,199 --> 00:28:10,239
in the 1st 3 steps. Uh, we did

814
00:28:10,239 --> 00:28:12,400
the GitHub secrets. We created the reference policy.

815
00:28:12,439 --> 00:28:13,789
We talked about reference policies.

816
00:28:14,078 --> 00:28:15,259
We uploaded the policy

817
00:28:15,598 --> 00:28:17,959
onto S3. We created the workflow directory,

818
00:28:18,199 --> 00:28:20,219
and we created the actions workflow YAML file.

819
00:28:20,479 --> 00:28:22,729
Uh, uh, I would suggest

820
00:28:22,920 --> 00:28:25,029
to just be patient, not to go through the YAL file.

821
00:28:25,039 --> 00:28:27,469
I will not go through it right now. Mitch is going to

822
00:28:27,469 --> 00:28:28,259
do that in a minute.

823
00:28:29,459 --> 00:28:31,618
Now, let's come back and as a, as a

824
00:28:31,618 --> 00:28:33,699
developer, uh, we will test this

825
00:28:33,699 --> 00:28:36,039
out. So I'm, I'm a developer,

826
00:28:36,299 --> 00:28:37,239
um,

827
00:28:37,500 --> 00:28:39,009
my code is giving me,

828
00:28:39,299 --> 00:28:39,939
um, you know,

829
00:28:40,259 --> 00:28:42,328
access denied errors, right? What else is new?

830
00:28:42,660 --> 00:28:44,739
So, I will, uh, I will

831
00:28:44,739 --> 00:28:46,739
show first the way, uh, OK,

832
00:28:46,858 --> 00:28:48,078
so this is, this is the,

833
00:28:48,459 --> 00:28:50,479
uh, uh cloud formation template

834
00:28:50,479 --> 00:28:51,759
that I'm checking in

835
00:28:52,140 --> 00:28:54,318
and I'm getting access denied errors. I have a deadline.

836
00:28:54,739 --> 00:28:56,779
What I will do is I will uh change

837
00:28:56,779 --> 00:28:58,979
the principle and make it a principal

838
00:28:58,979 --> 00:28:59,959
star here, right?

839
00:29:00,259 --> 00:29:01,559
I have saved this. Now,

840
00:29:01,890 --> 00:29:03,449
the classic troubleshooting step.

841
00:29:05,459 --> 00:29:06,039
Exactly.

842
00:29:09,529 --> 00:29:10,049
Uh.

843
00:29:10,809 --> 00:29:12,880
So, uh, I will, uh, I'm

844
00:29:12,880 --> 00:29:15,130
hoping that my CSCD pipe, I will no longer get any

845
00:29:15,130 --> 00:29:16,029
access denied errors.

846
00:29:16,328 --> 00:29:18,368
Uh, my CSCD pipeline should succeed in this

847
00:29:18,368 --> 00:29:20,650
case, but if I were, if I am a

848
00:29:20,650 --> 00:29:22,670
security engineer, this is a classic no

849
00:29:22,880 --> 00:29:25,078
no. I am hoping that the controls

850
00:29:25,078 --> 00:29:27,130
that I have put in, in the repository, uh,

851
00:29:27,209 --> 00:29:29,489
are going to, uh, not allow this to happen,

852
00:29:29,630 --> 00:29:31,430
right? So let me, uh,

853
00:29:32,009 --> 00:29:33,029
check in this code.

854
00:29:34,279 --> 00:29:35,380
Can everyone see? Yeah.

855
00:29:35,949 --> 00:29:36,939
OK, looks all right.

856
00:29:39,608 --> 00:29:41,479
I am doing a Git commit.

857
00:29:45,469 --> 00:29:47,598
And then I'll do a get push. Did that joke

858
00:29:47,598 --> 00:29:49,699
land? My daughter was telling me it will not land at

859
00:29:49,699 --> 00:29:51,759
all. She's like, OK,

860
00:29:51,858 --> 00:29:54,098
Dad, you know, this is too lame. Why are you doing this?

861
00:29:55,759 --> 00:29:59,068
Sorry. Thank

862
00:29:59,068 --> 00:30:01,209
you. OK, so I'm doing a get

863
00:30:01,209 --> 00:30:03,750
push. Um, OK, now,

864
00:30:04,959 --> 00:30:05,739
Uh, OK.

865
00:30:06,400 --> 00:30:06,939
So,

866
00:30:07,680 --> 00:30:09,890
uh, as a, as a, as a developer, I'm

867
00:30:09,890 --> 00:30:11,989
like, OK, now what else is going to give me

868
00:30:11,989 --> 00:30:14,039
an access denied? I'm, I have done, uh, you

869
00:30:14,039 --> 00:30:15,430
know, principal Star, right?

870
00:30:15,759 --> 00:30:18,019
So I should not get the access deny at all. My

871
00:30:18,019 --> 00:30:19,348
CICD pipeline should succeed.

872
00:30:19,779 --> 00:30:21,818
Let us look at the way this, uh,

873
00:30:21,890 --> 00:30:24,039
this pipeline is now getting executed,

874
00:30:24,199 --> 00:30:26,279
um. Yeah, we are going

875
00:30:26,279 --> 00:30:27,299
to our repository

876
00:30:27,598 --> 00:30:28,880
and we go to actions.

877
00:30:30,068 --> 00:30:32,108
Because I used this already yesterday, so I'm using a

878
00:30:32,108 --> 00:30:34,229
2 here. Again, a classic developer

879
00:30:34,229 --> 00:30:35,608
thing. So,

880
00:30:35,910 --> 00:30:37,910
uh, what happens, what is happening in

881
00:30:37,910 --> 00:30:39,420
these steps is GitHub

882
00:30:40,068 --> 00:30:42,309
then based on the triggers has

883
00:30:42,309 --> 00:30:43,890
loaded our YAML file

884
00:30:44,180 --> 00:30:46,180
and the steps and is executing the steps

885
00:30:46,180 --> 00:30:47,229
in our YAML file.

886
00:30:47,549 --> 00:30:49,630
Now, all this, I don't have access. I'm

887
00:30:49,630 --> 00:30:51,670
not, I, I, I, as a, as a builder, I'm

888
00:30:51,670 --> 00:30:53,130
not looking at all these things, right?

889
00:30:53,459 --> 00:30:55,848
Um, I will go back and I will show you what happens.

890
00:30:56,029 --> 00:30:56,848
In my case,

891
00:30:57,348 --> 00:30:59,029
uh, as a, as a builder persona.

892
00:30:59,500 --> 00:31:00,180
I will

893
00:31:00,739 --> 00:31:02,759
take a look at this and see

894
00:31:02,858 --> 00:31:04,939
if my CRCD pipeline succeeded, my code got

895
00:31:04,939 --> 00:31:05,759
deployed or not.

896
00:31:06,818 --> 00:31:08,400
At this point, you will see that

897
00:31:09,180 --> 00:31:11,519
we already have blocking findings,

898
00:31:11,779 --> 00:31:13,088
and we already,

899
00:31:13,380 --> 00:31:15,479
the pipeline did fail. So if I go back

900
00:31:15,479 --> 00:31:16,598
to actions here.

901
00:31:17,328 --> 00:31:19,449
Uh, my pipeline failed. I got an

902
00:31:19,449 --> 00:31:21,680
email message saying an issue has been created.

903
00:31:21,969 --> 00:31:24,108
Now, think about this. The reason I

904
00:31:24,439 --> 00:31:26,469
talked to you, this is the issue that got created,

905
00:31:26,608 --> 00:31:27,588
uh, just now.

906
00:31:28,088 --> 00:31:30,410
Now, the reason I said or

907
00:31:30,410 --> 00:31:32,469
we reiterated the goal earlier

908
00:31:32,469 --> 00:31:32,989
is

909
00:31:33,489 --> 00:31:35,199
developer agility was our kind of,

910
00:31:35,568 --> 00:31:37,199
kind of, uh, goal, right?

911
00:31:37,529 --> 00:31:39,509
Now, prior to.

912
00:31:40,930 --> 00:31:43,269
Us being able to make a call to Bedrock

913
00:31:43,368 --> 00:31:45,229
in order to give us prescriptive guidance

914
00:31:45,848 --> 00:31:47,949
as a as a builder, as a developer, what

915
00:31:48,130 --> 00:31:50,809
I just had to shift my troubleshooting

916
00:31:51,049 --> 00:31:53,170
from troubleshooting access denied error messages to

917
00:31:53,170 --> 00:31:55,608
troubleshooting why the CICD pipeline failed, right?

918
00:31:55,930 --> 00:31:58,410
Now, in this case, if you

919
00:31:58,410 --> 00:32:00,549
see the issue that is created,

920
00:32:00,769 --> 00:32:03,009
it tells me exactly what statement

921
00:32:03,009 --> 00:32:03,689
I checked in.

922
00:32:04,108 --> 00:32:06,469
It then tells me what is the reference policy

923
00:32:06,469 --> 00:32:08,500
that the security engineering team has put in here,

924
00:32:08,789 --> 00:32:10,729
has put in the repository. It tells me

925
00:32:11,029 --> 00:32:13,309
why this is a security risk, what is the intent

926
00:32:13,309 --> 00:32:15,509
of this kind of failure, and it also

927
00:32:15,509 --> 00:32:17,618
gives me the exact fix that I will

928
00:32:17,618 --> 00:32:19,979
have to do in order to fix this problem,

929
00:32:20,108 --> 00:32:22,269
right? So, this is kind of

930
00:32:22,269 --> 00:32:24,390
uh really, you know, in our mind, a game

931
00:32:24,390 --> 00:32:26,420
changer. Uh, we are really excited

932
00:32:26,420 --> 00:32:27,959
about the possibilities that we

933
00:32:28,259 --> 00:32:30,299
have here when we can make this call.

934
00:32:30,420 --> 00:32:32,539
So, for, for example, what we're talking about

935
00:32:32,539 --> 00:32:34,880
is, is it possible for us to

936
00:32:35,219 --> 00:32:35,959
maybe

937
00:32:36,420 --> 00:32:38,108
not even have, uh,

938
00:32:38,380 --> 00:32:40,420
the, the builder write the

939
00:32:40,420 --> 00:32:42,578
policy, um, you know, uh, some

940
00:32:42,578 --> 00:32:43,279
of us did,

941
00:32:43,539 --> 00:32:45,880
uh, talk about the co-pilot launch yesterday, right,

942
00:32:46,189 --> 00:32:48,219
uh, the co-pilot release. So why

943
00:32:48,219 --> 00:32:50,219
not have co-pilot craft a

944
00:32:50,219 --> 00:32:51,689
policy and then,

945
00:32:52,108 --> 00:32:53,338
uh, the pilot, sorry.

946
00:32:53,848 --> 00:32:55,969
Uh, autopilot. Oh my God, that's a

947
00:32:55,969 --> 00:32:56,608
Freudian slip.

948
00:32:56,890 --> 00:32:59,368
So autopilot, uh, uh, craft

949
00:32:59,368 --> 00:33:00,189
the policy,

950
00:33:00,650 --> 00:33:01,549
then, uh,

951
00:33:02,049 --> 00:33:03,729
call, uh, GitHub,

952
00:33:04,059 --> 00:33:06,239
uh, this, uh, you know, uh, actions workflow,

953
00:33:06,489 --> 00:33:07,588
call Access Analyzer,

954
00:33:08,130 --> 00:33:10,289
check that the crafted policy is

955
00:33:10,289 --> 00:33:10,989
also,

956
00:33:11,368 --> 00:33:13,588
um, you know, as per the boundaries.

957
00:33:13,795 --> 00:33:15,963
Find here in the guard rail and then go forward,

958
00:33:16,064 --> 00:33:18,265
right? So we're really looking forward if we can do something like that.

959
00:33:18,634 --> 00:33:20,963
We at this point we are not sure we can, we can do that. But

960
00:33:21,443 --> 00:33:23,463
so, uh, what I am saying here is

961
00:33:23,684 --> 00:33:25,684
just a year back or a couple of years

962
00:33:25,684 --> 00:33:26,884
ago, um,

963
00:33:27,164 --> 00:33:29,314
this was not really a developer agility

964
00:33:29,314 --> 00:33:31,364
kind of enabling, uh, mechanism, but now

965
00:33:31,364 --> 00:33:33,703
it is, it has taken a different kind of, uh, flavor.

966
00:33:34,364 --> 00:33:36,684
So I, as a, I, I have, I'm

967
00:33:36,684 --> 00:33:37,664
here, I got,

968
00:33:37,963 --> 00:33:39,785
um, the I got the actual,

969
00:33:40,084 --> 00:33:42,203
uh, prescriptive guidance as to why this

970
00:33:42,203 --> 00:33:43,243
CICD pipeline failed.

971
00:33:43,578 --> 00:33:45,759
I will go back and make a change to my policy,

972
00:33:46,219 --> 00:33:48,039
uh, saying, OK, I will only allow

973
00:33:48,420 --> 00:33:49,239
um

974
00:33:49,709 --> 00:33:51,799
the accounts that are allowed

975
00:33:51,799 --> 00:33:52,578
for me, right?

976
00:33:53,689 --> 00:33:55,549
I hope I typed the right number of ones.

977
00:33:56,189 --> 00:33:58,229
Uh, in this case,

978
00:33:59,059 --> 00:34:00,608
Again, I will check in this code.

979
00:34:01,828 --> 00:34:03,880
And I will just make it a 2. Only

980
00:34:03,880 --> 00:34:05,019
privilege gets allowed.

981
00:34:06,108 --> 00:34:08,260
Uh, Get push.

982
00:34:08,619 --> 00:34:09,719
So now,

983
00:34:10,340 --> 00:34:12,579
I know for sure, or I'm fairly

984
00:34:12,579 --> 00:34:14,659
certain as a, as a builder also that

985
00:34:14,659 --> 00:34:16,199
because I, I have

986
00:34:16,590 --> 00:34:18,708
um uh sort of adhere

987
00:34:18,708 --> 00:34:19,619
to what has been

988
00:34:19,898 --> 00:34:21,938
uh in the guardrails in the CSCD

989
00:34:21,938 --> 00:34:22,510
pipeline,

990
00:34:22,780 --> 00:34:24,898
this, uh, you know, actions workflow should

991
00:34:24,898 --> 00:34:25,739
succeed now.

992
00:34:26,179 --> 00:34:28,199
I guess maybe, um, I

993
00:34:28,199 --> 00:34:30,208
hand it over to Mitch and then once Mitch is done, we'll come

994
00:34:30,208 --> 00:34:31,579
back and see if the workflow succeeded.

995
00:34:32,530 --> 00:34:34,610
Cool, do you wanna bring the um the work

996
00:34:34,610 --> 00:34:36,340
flow up on your, in your.

997
00:34:39,929 --> 00:34:41,449
Cool, there we go, excellent.

998
00:34:41,849 --> 00:34:42,909
That's it. So

999
00:34:43,289 --> 00:34:45,449
the first thing I'll notice is that we're using Kro

1000
00:34:45,449 --> 00:34:46,809
because Kro's cool.

1001
00:34:47,550 --> 00:34:48,250
Um,

1002
00:34:48,938 --> 00:34:51,909
the, in case you hadn't heard of the autopilot,

1003
00:34:52,110 --> 00:34:54,148
uh, thing that, that Nitin was mentioning as

1004
00:34:54,148 --> 00:34:56,148
well, so we launched this last week, um,

1005
00:34:56,269 --> 00:34:58,829
pre-reinvent, um, and it's an MCP

1006
00:34:58,829 --> 00:34:59,409
server

1007
00:34:59,789 --> 00:35:01,869
for, uh, Quiro or any other

1008
00:35:01,869 --> 00:35:03,438
MCP client that's out there,

1009
00:35:03,750 --> 00:35:05,849
which, uh, it, it's called IAM

1010
00:35:06,030 --> 00:35:08,148
Policy Autopilot is the full name for it,

1011
00:35:08,550 --> 00:35:10,929
but it essentially will look at,

1012
00:35:10,938 --> 00:35:13,110
uh, the application code that you

1013
00:35:13,110 --> 00:35:13,668
have written.

1014
00:35:14,128 --> 00:35:14,668
Um,

1015
00:35:15,239 --> 00:35:16,750
in, and it will,

1016
00:35:17,050 --> 00:35:19,110
uh, generate an IEM policy

1017
00:35:19,409 --> 00:35:21,438
based on the different API actions

1018
00:35:21,438 --> 00:35:22,139
that you're calling.

1019
00:35:22,409 --> 00:35:24,769
If you've, if you've imported one of the SDKs

1020
00:35:24,769 --> 00:35:26,829
and you're calling S3 to list buckets,

1021
00:35:26,918 --> 00:35:29,039
and that's the only thing that your piece of

1022
00:35:29,039 --> 00:35:29,840
application code is doing,

1023
00:35:30,289 --> 00:35:31,300
then, um,

1024
00:35:31,648 --> 00:35:33,789
the IM policy autopilot

1025
00:35:33,789 --> 00:35:34,398
will create that,

1026
00:35:34,769 --> 00:35:36,168
just that policy for you.

1027
00:35:36,550 --> 00:35:38,668
Um, least privileged, it has

1028
00:35:38,668 --> 00:35:40,869
a lot of AWS knowledge and context, so

1029
00:35:40,869 --> 00:35:43,349
it will, um, make sure that the policy syntax

1030
00:35:43,349 --> 00:35:44,530
is correct and accurate.

1031
00:35:45,110 --> 00:35:47,349
Um, it will aim to do least privilege where possible

1032
00:35:47,349 --> 00:35:48,050
as well,

1033
00:35:48,389 --> 00:35:50,610
uh, and then you can commit that into

1034
00:35:50,610 --> 00:35:53,050
the, um, into the, the repo,

1035
00:35:53,110 --> 00:35:55,148
um, in the same way that we've just done with, with

1036
00:35:55,148 --> 00:35:56,250
that policy a minute ago.

1037
00:35:56,789 --> 00:35:58,789
So that's what that is worth while having a look, it's pretty

1038
00:35:58,789 --> 00:36:00,849
cool. Um, so let's go through this

1039
00:36:00,849 --> 00:36:03,300
workflow. If you've used GitHub actions

1040
00:36:03,300 --> 00:36:05,500
before, which most of you seem to have done, you'll

1041
00:36:05,500 --> 00:36:07,510
be pretty familiar with, with what we've got here. The

1042
00:36:07,510 --> 00:36:09,780
first few sections are fairly self-explanatory.

1043
00:36:09,898 --> 00:36:11,978
We're only triggering when, um, we

1044
00:36:11,978 --> 00:36:13,958
are pushing changes to a certain branch,

1045
00:36:14,289 --> 00:36:16,539
uh, anything, uh, below the, the kind of features

1046
00:36:16,539 --> 00:36:17,478
slash branch.

1047
00:36:17,769 --> 00:36:18,559
We are only

1048
00:36:18,849 --> 00:36:21,398
triggering it when there are changes to,

1049
00:36:21,458 --> 00:36:23,500
um, YAML files in

1050
00:36:23,500 --> 00:36:25,610
a particular folder within the repost.

1051
00:36:25,699 --> 00:36:27,719
This is where we're changing a roll trust policy.

1052
00:36:28,349 --> 00:36:30,349
Um, we are only triggering

1053
00:36:30,349 --> 00:36:32,329
when, uh, it's, uh,

1054
00:36:32,708 --> 00:36:34,789
a pull request as well. Um, so

1055
00:36:34,789 --> 00:36:36,340
those are the kind of conditions for triggering.

1056
00:36:36,668 --> 00:36:38,949
Then we've got the permissions. This is where we're defining

1057
00:36:38,949 --> 00:36:40,949
what the runners can do, so whether it's hosted

1058
00:36:40,949 --> 00:36:42,110
or, or self-managed.

1059
00:36:42,469 --> 00:36:44,550
Um, ID token is essentially

1060
00:36:44,550 --> 00:36:46,708
the uh the permission it will need,

1061
00:36:46,860 --> 00:36:48,929
uh, the runner will need in order to complete

1062
00:36:48,929 --> 00:36:50,949
the, um, OIDC handshake to get

1063
00:36:50,949 --> 00:36:52,949
the, the, the temporary credentials from AWS.

1064
00:36:53,530 --> 00:36:54,869
Um, the content,

1065
00:36:55,148 --> 00:36:57,208
um, commission is

1066
00:36:57,208 --> 00:36:59,469
set to right, which means that the

1067
00:36:59,478 --> 00:37:00,570
reader, the, the.

1068
00:37:01,699 --> 00:37:03,699
Runner will be able to read and write content from

1069
00:37:03,699 --> 00:37:05,860
the repository, and then the issues

1070
00:37:05,860 --> 00:37:08,179
permission um is set to write as well

1071
00:37:08,179 --> 00:37:10,179
because we want the runner to be able to create

1072
00:37:10,179 --> 00:37:12,418
issues when it identifies these blocking

1073
00:37:12,418 --> 00:37:14,539
findings. Now we get to the interesting part where

1074
00:37:14,539 --> 00:37:16,739
things are a little bit different from maybe your, your traditional

1075
00:37:16,739 --> 00:37:17,918
run and flow.

1076
00:37:18,458 --> 00:37:20,500
So we've got a job, uh, our overarching job is

1077
00:37:20,500 --> 00:37:22,320
called CFNIM policy validation.

1078
00:37:23,079 --> 00:37:25,079
Uh, the runner you'll see is just a fairly

1079
00:37:25,079 --> 00:37:27,079
generic Ubuntu latest runner at the minute,

1080
00:37:27,360 --> 00:37:29,739
one of the ones that we can get from, from GitHub's,

1081
00:37:29,789 --> 00:37:31,860
uh, Git, uh, actions environment fairly easily.

1082
00:37:32,159 --> 00:37:34,478
This is hosted or managed, um,

1083
00:37:34,599 --> 00:37:36,969
on their environment. You can do a, uh,

1084
00:37:37,039 --> 00:37:37,938
a self-hosted

1085
00:37:38,280 --> 00:37:40,438
version of this as well in your own environments.

1086
00:37:40,559 --> 00:37:42,760
Why would you want to do that? Well, maybe

1087
00:37:42,760 --> 00:37:45,398
your build process relies on some internal

1088
00:37:45,398 --> 00:37:47,958
private repository for, uh, dependencies.

1089
00:37:48,059 --> 00:37:50,139
Maybe you've got an artifactory deployment or

1090
00:37:50,418 --> 00:37:52,809
you need to talk to a database to register your

1091
00:37:52,809 --> 00:37:54,978
application with some configuration management codes, something

1092
00:37:54,978 --> 00:37:57,139
like that. So there are a few different reasons why you would

1093
00:37:57,139 --> 00:37:57,699
approach that.

1094
00:37:57,969 --> 00:37:59,978
Um, obviously if it's in GitHub's own

1095
00:37:59,978 --> 00:38:02,128
environments uh as a managed runner, then you wouldn't

1096
00:38:02,128 --> 00:38:04,199
be able to access those private resources.

1097
00:38:04,699 --> 00:38:06,019
Um, but we've got hosted for now.

1098
00:38:06,708 --> 00:38:09,119
Then we've installed the fairly standard

1099
00:38:09,119 --> 00:38:10,539
and well used um

1100
00:38:12,039 --> 00:38:14,070
action for checking out code, that's

1101
00:38:14,070 --> 00:38:14,829
fairly straightforward.

1102
00:38:15,188 --> 00:38:17,228
Now we're installing an open source

1103
00:38:17,228 --> 00:38:19,628
tool called CFN Policy Validators.

1104
00:38:19,699 --> 00:38:21,750
This is a Python tool that was created by

1105
00:38:21,750 --> 00:38:23,389
some of our colleagues at AWS

1106
00:38:23,750 --> 00:38:24,269
that will essentially.

1107
00:38:24,704 --> 00:38:26,804
grok a cloud formation template,

1108
00:38:26,905 --> 00:38:29,224
extract the IAM related

1109
00:38:29,224 --> 00:38:31,224
resources out of it, and then pass

1110
00:38:31,224 --> 00:38:33,364
them to the IAM

1111
00:38:33,364 --> 00:38:35,784
Access Analyzer APIs

1112
00:38:35,784 --> 00:38:37,905
to do the validation and

1113
00:38:37,905 --> 00:38:40,083
any of the custom policy check

1114
00:38:40,184 --> 00:38:42,063
capabilities that are brought up on the screen there.

1115
00:38:42,789 --> 00:38:45,030
Then we're configuring the credentials, which is where our

1116
00:38:45,030 --> 00:38:45,639
previous um

1117
00:38:46,469 --> 00:38:48,369
ID privilege comes into play.

1118
00:38:49,128 --> 00:38:51,179
Fairly straightforward with the exception of

1119
00:38:51,179 --> 00:38:53,260
the fact there that we are using the secrets

1120
00:38:53,260 --> 00:38:55,360
that we defined or that Nitin defined earlier on

1121
00:38:55,360 --> 00:38:57,820
to extract some of the environment specific

1122
00:38:57,820 --> 00:38:59,708
information that we need, including the role name.

1123
00:39:00,820 --> 00:39:02,898
Then we're fetching the resource policy

1124
00:39:02,898 --> 00:39:04,898
or the reference policy should I say, from S3.

1125
00:39:04,958 --> 00:39:07,300
So Knitin showed you that was already an S3

1126
00:39:07,300 --> 00:39:08,398
at the minute, um,

1127
00:39:08,699 --> 00:39:09,398
you know, you might have a,

1128
00:39:09,820 --> 00:39:11,978
a pipeline or a mechanism to, to

1129
00:39:11,978 --> 00:39:14,139
govern that process of creating those

1130
00:39:14,139 --> 00:39:15,789
and pushing them into S3.

1131
00:39:16,199 --> 00:39:18,559
I, I, I have a customer that uses Dynamo

1132
00:39:18,559 --> 00:39:20,679
DB to store these things, um, and

1133
00:39:20,679 --> 00:39:22,500
they have, based on the, the,

1134
00:39:23,239 --> 00:39:25,260
where, which team is doing the pull request or

1135
00:39:25,269 --> 00:39:27,559
or is pushing the code in, they pull down different

1136
00:39:27,559 --> 00:39:29,619
reference policies and check the,

1137
00:39:29,628 --> 00:39:31,760
the policies that the team is trying to create

1138
00:39:31,760 --> 00:39:32,378
based on.

1139
00:39:32,800 --> 00:39:34,800
The the the the persona or the

1140
00:39:34,800 --> 00:39:36,958
team that's coming in, so there's a few ways of doing that, but

1141
00:39:36,958 --> 00:39:39,320
essentially what you want to do is make sure that these reference policies

1142
00:39:39,320 --> 00:39:40,378
are centralized

1143
00:39:40,719 --> 00:39:42,760
so that you can access them as part of these

1144
00:39:42,760 --> 00:39:44,918
workflows. You don't want them to exist

1145
00:39:44,918 --> 00:39:46,918
within the context of the repo because that kind of

1146
00:39:46,918 --> 00:39:49,119
defeats the object of having these centralized

1147
00:39:49,119 --> 00:39:50,039
reference policies.

1148
00:39:50,800 --> 00:39:51,469
Um,

1149
00:39:52,559 --> 00:39:54,679
Now we're passing the cloud formation template, so

1150
00:39:54,679 --> 00:39:56,719
we're using the CFN policy validator

1151
00:39:56,719 --> 00:39:59,139
tool, uh, it has an uh an argument

1152
00:39:59,139 --> 00:40:01,519
uh or a parameter called PAS.

1153
00:40:01,840 --> 00:40:04,059
What we're doing there is we're, we're essentially doing

1154
00:40:04,059 --> 00:40:06,199
really what that tool does by default, which

1155
00:40:06,199 --> 00:40:08,510
is scrape the cloud formation

1156
00:40:08,510 --> 00:40:10,760
template, extract any resources

1157
00:40:10,760 --> 00:40:13,159
that are related to IAM users' roles,

1158
00:40:13,320 --> 00:40:15,590
um, groups, um, and policies,

1159
00:40:15,958 --> 00:40:16,840
trust policies as well,

1160
00:40:17,320 --> 00:40:19,360
uh, and drop them into a file, and we're

1161
00:40:19,360 --> 00:40:21,500
gonna come back and use that file a little bit later on.

1162
00:40:22,239 --> 00:40:22,750
Um,

1163
00:40:23,239 --> 00:40:25,398
then we're running the AWS Access

1164
00:40:25,398 --> 00:40:27,398
Analyzer check no new access

1165
00:40:27,398 --> 00:40:29,389
check. So this is where we're, we're triggering,

1166
00:40:29,648 --> 00:40:31,878
um, the access analyzer capabilities.

1167
00:40:32,438 --> 00:40:34,489
Now, what you'll notice here is where it

1168
00:40:34,489 --> 00:40:36,659
says users, we're using, uh,

1169
00:40:36,668 --> 00:40:38,889
an, a, a native action called cloud

1170
00:40:38,889 --> 00:40:41,469
formation AWS IAM policy validator,

1171
00:40:41,478 --> 00:40:43,599
which essentially is the same as the Python

1172
00:40:43,599 --> 00:40:45,539
thing that we installed a little bit earlier on.

1173
00:40:45,949 --> 00:40:48,090
And you might be going, well that doesn't seem very efficient, there's

1174
00:40:48,090 --> 00:40:50,280
a bit of duplication there, why are you doing

1175
00:40:50,280 --> 00:40:52,840
that? The reason we're doing it at the minute

1176
00:40:53,199 --> 00:40:55,550
is that the uh the native

1177
00:40:55,550 --> 00:40:58,199
action doesn't include the pass functionality.

1178
00:40:58,739 --> 00:41:00,750
Um, it, so in order for us to

1179
00:41:00,750 --> 00:41:02,789
do the thing that we're doing with Bedrock, and you'll

1180
00:41:02,789 --> 00:41:03,438
see in a minute more about that,

1181
00:41:04,550 --> 00:41:06,829
we need that pass functionality to

1182
00:41:06,829 --> 00:41:07,989
take all the resources out,

1183
00:41:08,269 --> 00:41:10,050
the, the IM resources out. So

1184
00:41:10,469 --> 00:41:12,628
if you didn't need to do the thing with Bedrock that we're gonna

1185
00:41:12,628 --> 00:41:14,659
show you in a bit, you could just use that native

1186
00:41:14,659 --> 00:41:16,668
action which is available in the, the, the

1187
00:41:16,668 --> 00:41:18,708
actions marketplace, um, you can install

1188
00:41:18,708 --> 00:41:19,489
it and use it that way.

1189
00:41:20,010 --> 00:41:22,010
Configuration is all fairly straightforward you can see

1190
00:41:22,010 --> 00:41:24,208
there, uh we've got the template path so

1191
00:41:24,208 --> 00:41:26,250
that is the the the template that we're

1192
00:41:26,250 --> 00:41:27,628
analyzing in this scenario,

1193
00:41:28,050 --> 00:41:30,208
then we've got the uh reference policy,

1194
00:41:30,250 --> 00:41:31,228
so this is the.

1195
00:41:31,909 --> 00:41:34,188
The, the gold standard, nothing, no

1196
00:41:34,188 --> 00:41:36,969
policy that gets created should have permissions

1197
00:41:36,989 --> 00:41:39,188
beyond the, the scope of that one.

1198
00:41:40,469 --> 00:41:42,610
we're defining what type of resource, sorry,

1199
00:41:42,668 --> 00:41:44,789
what type of policy this is. So this is a resource

1200
00:41:44,789 --> 00:41:46,289
policy because we're looking at,

1201
00:41:46,590 --> 00:41:48,809
um, it's uh it's a role, we're analyzing

1202
00:41:48,809 --> 00:41:49,889
a role trust policy.

1203
00:41:50,360 --> 00:41:52,530
Um, you may need to add a couple of different runs

1204
00:41:52,530 --> 00:41:54,530
of that, that particular action there or

1205
00:41:54,530 --> 00:41:56,530
that step in the flow if you wanted

1206
00:41:56,530 --> 00:41:58,610
to analyze for identity related

1207
00:41:58,610 --> 00:42:00,369
policies. In fact, you wouldn't, you may,

1208
00:42:00,648 --> 00:42:02,800
you would need to do it. It's not, you would, if you, yeah, we

1209
00:42:02,800 --> 00:42:04,809
don't unfortunately at the minute you can't just have

1210
00:42:04,809 --> 00:42:06,809
like no ref, uh,

1211
00:42:06,889 --> 00:42:07,688
no policy type.

1212
00:42:08,469 --> 00:42:09,469
Um,

1213
00:42:10,010 --> 00:42:12,039
sorry, just scroll back up there for me for a second,

1214
00:42:12,128 --> 00:42:14,128
and then we're choosing the region because you need

1215
00:42:14,128 --> 00:42:15,780
to tell, um, the API,

1216
00:42:16,250 --> 00:42:18,329
the, the, the tool which region it needs

1217
00:42:18,329 --> 00:42:20,530
to use to, to call the access analyzer APIs.

1218
00:42:20,929 --> 00:42:21,989
Uh, then we're running,

1219
00:42:22,250 --> 00:42:23,070
um,

1220
00:42:23,530 --> 00:42:25,530
uh, now some kind of arbitrary

1221
00:42:25,530 --> 00:42:27,110
code here just to try and get,

1222
00:42:27,610 --> 00:42:30,110
uh, the results of the analyzer

1223
00:42:30,250 --> 00:42:32,329
out of, uh, of, of

1224
00:42:32,329 --> 00:42:34,329
the check. So we've got the results back now, so

1225
00:42:34,329 --> 00:42:36,449
we're passing that and we're trying to determine how many

1226
00:42:36,449 --> 00:42:37,869
blocking findings there are.

1227
00:42:38,300 --> 00:42:39,599
Now we don't want to run

1228
00:42:39,860 --> 00:42:42,039
the bedrock part of this demo

1229
00:42:42,179 --> 00:42:44,378
if there are no blocking findings, we

1230
00:42:44,378 --> 00:42:46,418
only wanna do it if there's blocking findings. So we're

1231
00:42:46,418 --> 00:42:48,599
looking for blocking findings, we're analyzing that,

1232
00:42:49,260 --> 00:42:51,418
um, we go down there and what we're starting

1233
00:42:51,418 --> 00:42:53,458
to do then is we're looking, if you can see down there,

1234
00:42:53,500 --> 00:42:55,579
we're taking the, the outputs of some of these

1235
00:42:55,579 --> 00:42:57,619
steps and we're putting them into GitHub outputs so

1236
00:42:57,619 --> 00:42:59,820
that we can access them a little bit uh later

1237
00:42:59,820 --> 00:43:00,760
on down the process.

1238
00:43:01,708 --> 00:43:02,889
We are also now,

1239
00:43:03,389 --> 00:43:05,789
so if you've ever used custom policy checks

1240
00:43:05,789 --> 00:43:08,208
before, um, either

1241
00:43:08,208 --> 00:43:10,800
directly using um the SDKs

1242
00:43:10,800 --> 00:43:12,688
or using one of the CLI tools,

1243
00:43:13,070 --> 00:43:13,769
you will

1244
00:43:14,619 --> 00:43:16,829
notice that the results and response you get back

1245
00:43:16,829 --> 00:43:19,059
isn't particularly helpful,

1246
00:43:19,148 --> 00:43:20,409
other than saying

1247
00:43:20,829 --> 00:43:22,070
you've got a blocking finding.

1248
00:43:22,429 --> 00:43:24,550
And it was this policy that

1249
00:43:24,550 --> 00:43:25,369
was the problem,

1250
00:43:25,659 --> 00:43:28,059
and it was this statement index number

1251
00:43:28,269 --> 00:43:30,010
where you've got the issue. If you've got a big

1252
00:43:30,289 --> 00:43:32,719
policy that has lots of different statements

1253
00:43:32,719 --> 00:43:33,898
within it, um,

1254
00:43:34,280 --> 00:43:36,628
and it, and you know, you're and you're an engineer, a software

1255
00:43:36,628 --> 00:43:38,750
engineer for example, and, and grocking IEM

1256
00:43:38,750 --> 00:43:40,489
policies isn't something you enjoy doing.

1257
00:43:41,208 --> 00:43:43,329
Then it can be quite challenging to go through

1258
00:43:43,329 --> 00:43:45,469
that and kind of go to like 0123,

1259
00:43:45,688 --> 00:43:46,800
that statement there like

1260
00:43:47,489 --> 00:43:49,728
so what we're trying to do is we're trying to take

1261
00:43:49,728 --> 00:43:51,809
that past policy that we, we

1262
00:43:51,809 --> 00:43:53,789
passed earlier on in in the step above,

1263
00:43:54,128 --> 00:43:56,329
um, and we're taking the results from Access

1264
00:43:56,329 --> 00:43:57,628
Analyzer and it's gonna say

1265
00:43:58,090 --> 00:43:58,989
this policy name.

1266
00:43:59,929 --> 00:44:01,429
This statement index ID.

1267
00:44:01,889 --> 00:44:03,889
So we're doing the heavy lifting as part of this

1268
00:44:03,889 --> 00:44:06,010
process to get the exact statement out

1269
00:44:06,010 --> 00:44:07,969
of the policy that has the issue.

1270
00:44:09,958 --> 00:44:10,829
Quick point,

1271
00:44:11,489 --> 00:44:13,429
I've been talking about cloud formation a lot.

1272
00:44:14,208 --> 00:44:16,750
Um, the CFN policy validator

1273
00:44:16,929 --> 00:44:19,208
is specifically for cloud formation.

1274
00:44:19,329 --> 00:44:21,639
There is a TFN policy validator.

1275
00:44:21,688 --> 00:44:23,188
Can anyone guess what that's for?

1276
00:44:24,398 --> 00:44:25,300
There you go, see?

1277
00:44:25,648 --> 00:44:27,769
So that's exactly. So you can do that as well, if

1278
00:44:27,769 --> 00:44:28,969
you, if you were using terraform.

1279
00:44:29,699 --> 00:44:32,019
Um, where are we down here now? OK,

1280
00:44:32,179 --> 00:44:34,619
so then we, uh, we've got our problematic

1281
00:44:34,619 --> 00:44:37,019
statements, uh, in a, in a text file. Um,

1282
00:44:37,179 --> 00:44:39,500
we are now, uh,

1283
00:44:40,059 --> 00:44:42,139
writing the information into GitHub output so we can

1284
00:44:42,139 --> 00:44:44,619
access it down in the next step of our workflow.

1285
00:44:44,898 --> 00:44:47,099
So now we're kicking off the generate AI,

1286
00:44:47,458 --> 00:44:49,530
um, powered workflow, which is only

1287
00:44:49,530 --> 00:44:51,579
happening if, um, if we have a

1288
00:44:51,579 --> 00:44:52,539
blocking statement.

1289
00:44:52,938 --> 00:44:54,639
So what we're doing is we're taking,

1290
00:44:55,179 --> 00:44:55,769
um,

1291
00:44:56,099 --> 00:44:57,760
I'll take a step back here and.

1292
00:44:58,849 --> 00:45:01,300
I say we're building a dynamic

1293
00:45:01,300 --> 00:45:03,300
prompt as part of the next step of what you're

1294
00:45:03,300 --> 00:45:04,329
about to see here.

1295
00:45:04,938 --> 00:45:07,099
So we've got an I, we, we've we've

1296
00:45:07,099 --> 00:45:09,250
created this prompt, we know what we want Bedrock

1297
00:45:09,250 --> 00:45:11,300
to provide us, we've got some prescriptive guidance

1298
00:45:11,300 --> 00:45:13,579
so we can give it back to the developer.

1299
00:45:14,059 --> 00:45:16,320
So the next section you can see here is,

1300
00:45:16,340 --> 00:45:18,119
um, we're essentially.

1301
00:45:19,458 --> 00:45:21,469
Adding the variables that we've created,

1302
00:45:21,489 --> 00:45:23,708
which are populated based on the,

1303
00:45:23,769 --> 00:45:25,789
the output from the different stages above,

1304
00:45:26,208 --> 00:45:28,250
uh, we're putting them into variables and

1305
00:45:28,250 --> 00:45:30,409
we're constructing now this, this custom

1306
00:45:30,409 --> 00:45:31,688
prompt, this dynamic prompt,

1307
00:45:31,958 --> 00:45:33,628
and we're gonna start to inject,

1308
00:45:33,969 --> 00:45:36,159
uh, into some placeholders there which you can see

1309
00:45:36,369 --> 00:45:37,628
the reference policy,

1310
00:45:37,969 --> 00:45:39,969
the validation result, and the problematic

1311
00:45:39,969 --> 00:45:40,668
statements.

1312
00:45:41,289 --> 00:45:43,769
So, all of that now has been bundled

1313
00:45:43,769 --> 00:45:45,789
together into a into a prompt.

1314
00:45:46,188 --> 00:45:48,639
That gets dynamically generated based

1315
00:45:48,639 --> 00:45:50,878
on the specific results of that

1316
00:45:50,878 --> 00:45:51,739
particular push.

1317
00:45:52,340 --> 00:45:54,978
Um, the things that we want to be consistent

1318
00:45:54,978 --> 00:45:57,360
are with how we want the prescriptive guidance

1319
00:45:57,360 --> 00:45:59,360
to come back, what we want the model to do

1320
00:45:59,360 --> 00:46:00,860
for us, so we've kept that in there,

1321
00:46:01,119 --> 00:46:03,119
but we're just adding the dynamic bits in there as well,

1322
00:46:03,239 --> 00:46:05,320
and we're giving it some very clear instructions there on

1323
00:46:05,320 --> 00:46:07,320
what we kind of want it to do as well, how to

1324
00:46:07,320 --> 00:46:08,909
update the cloud formation template,

1325
00:46:09,239 --> 00:46:11,320
check where it aligns with the reference policy,

1326
00:46:11,398 --> 00:46:13,478
so we've been very prescriptive in for the most

1327
00:46:13,478 --> 00:46:15,750
part. Then we are taking

1328
00:46:15,750 --> 00:46:18,269
that prompt that we've just built now that's been populated

1329
00:46:18,269 --> 00:46:20,539
with all this really good information, we're writing

1330
00:46:20,539 --> 00:46:22,889
it out into a JSON file,

1331
00:46:23,510 --> 00:46:25,789
and then we are invoking the Bedrock

1332
00:46:25,789 --> 00:46:26,429
API

1333
00:46:28,329 --> 00:46:29,789
with the JSON file with the prompt in it.

1334
00:46:30,610 --> 00:46:32,128
And it's, it's doing its thing.

1335
00:46:32,878 --> 00:46:35,010
And then as we scroll down a little bit more, in fact

1336
00:46:35,010 --> 00:46:37,010
there's the invocation part there, and if we

1337
00:46:37,010 --> 00:46:39,090
scroll down a little bit more, we're gonna

1338
00:46:39,090 --> 00:46:40,860
get back then a response

1339
00:46:41,168 --> 00:46:43,250
from um from Bedrock hopefully

1340
00:46:43,250 --> 00:46:45,409
which comes with some useful

1341
00:46:45,409 --> 00:46:47,000
information that we can pass on to the developer.

1342
00:46:47,530 --> 00:46:49,590
So then we are now going

1343
00:46:49,590 --> 00:46:51,809
to generate the GitHub issue, we're

1344
00:46:51,809 --> 00:46:52,628
going to

1345
00:46:52,889 --> 00:46:55,168
populate that issue with all of that

1346
00:46:55,168 --> 00:46:57,250
information, we're gonna make it look nice, so it looks kind of

1347
00:46:57,250 --> 00:46:59,570
nice and friendly as well for the, for the developer.

1348
00:47:00,050 --> 00:47:02,128
Um, with all the kind of clarity around

1349
00:47:02,128 --> 00:47:04,128
what they need to do next and, and all the structure that

1350
00:47:04,128 --> 00:47:05,628
you saw in the example earlier on,

1351
00:47:06,128 --> 00:47:07,958
and. That's it.

1352
00:47:08,398 --> 00:47:09,179
That's how that

1353
00:47:09,559 --> 00:47:11,000
that that the mechanism works.

1354
00:47:12,510 --> 00:47:14,590
So let's go back now and see if er

1355
00:47:14,590 --> 00:47:15,590
Nitin's

1356
00:47:16,179 --> 00:47:17,688
push um with the working

1357
00:47:17,989 --> 00:47:20,300
trust policy er looks as we

1358
00:47:20,300 --> 00:47:21,090
expect it to look.

1359
00:47:22,208 --> 00:47:24,519
Which is no issue generated because

1360
00:47:24,978 --> 00:47:26,840
he was using one of the trusted accounts.

1361
00:47:27,110 --> 00:47:28,128
Yeah. Uh,

1362
00:47:28,878 --> 00:47:30,378
yeah, so in this case, you will see that

1363
00:47:31,159 --> 00:47:33,159
the next, uh, code push that we did

1364
00:47:33,159 --> 00:47:35,519
with the correct policy, uh, CSCD pipeline

1365
00:47:35,519 --> 00:47:37,679
succeeded. One thing here is that Mitch

1366
00:47:37,679 --> 00:47:38,260
did mention

1367
00:47:38,800 --> 00:47:40,958
that if the bedrock or if the

1368
00:47:40,958 --> 00:47:43,139
blocking findings are there, only then we call

1369
00:47:43,139 --> 00:47:45,239
the bedrock analysis. In this case, you will

1370
00:47:45,239 --> 00:47:47,478
see that there is no blocking findings, so that's why we

1371
00:47:47,478 --> 00:47:49,699
don't call the bedrock analysis at all, in this case.

1372
00:47:50,750 --> 00:47:52,840
So one of the interesting things about this as well that's worth

1373
00:47:52,840 --> 00:47:55,039
keeping in mind is at the minute we're building

1374
00:47:55,039 --> 00:47:57,119
these checks in on the left hand

1375
00:47:57,119 --> 00:47:58,019
side of the,

1376
00:47:58,599 --> 00:48:00,639
the policy development life cycle, software

1377
00:48:00,639 --> 00:48:02,679
development life cycle, wherever you want to, whatever term you want

1378
00:48:02,679 --> 00:48:04,329
to use. Um

1379
00:48:05,079 --> 00:48:07,119
There are going to be things

1380
00:48:07,119 --> 00:48:09,219
that that are already deployed in your environment

1381
00:48:09,219 --> 00:48:11,438
that that you don't want to happen in, in

1382
00:48:11,438 --> 00:48:13,559
uh in your AWS accounts, and you can use the

1383
00:48:13,559 --> 00:48:15,840
existing analyzers to some degree to to detect

1384
00:48:15,840 --> 00:48:18,019
some of those things, um, especially if it's

1385
00:48:18,239 --> 00:48:20,360
permissions that you don't want people to use or

1386
00:48:20,360 --> 00:48:22,679
they shouldn't be using or they're never using anyway, um,

1387
00:48:22,760 --> 00:48:25,099
Dynamo DB delete table, S3 bucket,

1388
00:48:25,478 --> 00:48:26,199
delete, um,

1389
00:48:26,478 --> 00:48:27,438
S3 delete bucket.

1390
00:48:28,340 --> 00:48:30,349
Any of the other things that you might not want them to use

1391
00:48:30,349 --> 00:48:32,708
and custom, you know, sensitive resources

1392
00:48:32,708 --> 00:48:35,188
that might have been created that you never think

1393
00:48:35,188 --> 00:48:37,309
anyone should be able to access other than maybe

1394
00:48:37,309 --> 00:48:39,750
the security team or the legal team, that

1395
00:48:39,750 --> 00:48:41,820
kind of thing. So as you,

1396
00:48:42,019 --> 00:48:44,039
so as, as you've got these the the

1397
00:48:44,090 --> 00:48:46,300
the analyzers running in your accounts

1398
00:48:46,300 --> 00:48:48,458
detecting the existing policies and the

1399
00:48:48,458 --> 00:48:50,648
things that perhaps you want to apply as

1400
00:48:50,648 --> 00:48:52,659
best practice, you can feed that

1401
00:48:52,659 --> 00:48:55,219
back out into your reference policies

1402
00:48:55,219 --> 00:48:57,530
or into a list of sensitive

1403
00:48:57,530 --> 00:48:59,938
actions and sensitive API calls.

1404
00:49:00,780 --> 00:49:03,050
Which then can be scanned for or checked

1405
00:49:03,050 --> 00:49:05,050
for using this mechanism the next

1406
00:49:05,050 --> 00:49:07,449
time an engineer checks in the

1407
00:49:07,449 --> 00:49:09,688
policy or the cloud formation template that they're checking

1408
00:49:09,688 --> 00:49:11,688
in, and this is kind of the cycle

1409
00:49:11,688 --> 00:49:13,989
that will continue to flow then this this um,

1410
00:49:15,139 --> 00:49:17,418
This cycle where you, you identify a,

1411
00:49:17,458 --> 00:49:18,199
a bad practice,

1412
00:49:18,539 --> 00:49:20,699
you feed it back into the reference policy, it gets checked

1413
00:49:20,699 --> 00:49:22,699
the next time someone builds something, great, and

1414
00:49:22,699 --> 00:49:24,820
you'll find you over time you're just refining this

1415
00:49:24,820 --> 00:49:26,820
and making sure that every new policy

1416
00:49:26,820 --> 00:49:28,628
that gets created into your environment

1417
00:49:29,168 --> 00:49:31,340
only contains the things that you, your

1418
00:49:31,340 --> 00:49:33,500
organization is, is happy for it to contain, nothing

1419
00:49:33,500 --> 00:49:34,559
more, nothing less.

1420
00:49:35,530 --> 00:49:37,750
So that's how that will work, and how we envisage

1421
00:49:37,750 --> 00:49:39,648
that would work as well. So I think that's pretty cool.

1422
00:49:40,030 --> 00:49:40,829
We think it's pretty cool.

1423
00:49:42,320 --> 00:49:44,668
So Promised QR codes.

1424
00:49:45,679 --> 00:49:46,438
Um,

1425
00:49:47,570 --> 00:49:49,599
These are massive QR codes, and

1426
00:49:49,599 --> 00:49:52,079
I'll tell you why they're massive QR codes. It's

1427
00:49:52,079 --> 00:49:52,648
because,

1428
00:49:53,159 --> 00:49:55,309
uh, in a session I ran previously, not,

1429
00:49:55,378 --> 00:49:57,478
not at this conference, at another event, I think

1430
00:49:57,478 --> 00:49:59,639
I jammed about 5 or 6 QR codes

1431
00:49:59,639 --> 00:50:00,539
onto one screen.

1432
00:50:01,090 --> 00:50:03,389
And people's phones just could not focus

1433
00:50:03,389 --> 00:50:05,449
on those QR codes. It was quite just I was

1434
00:50:05,449 --> 00:50:07,570
trying to do this and this and this, so we've gone, right, you

1435
00:50:07,570 --> 00:50:09,708
know what, we'll go one massive QR code

1436
00:50:10,099 --> 00:50:11,070
per piece of content

1437
00:50:11,449 --> 00:50:13,530
per slide. So we've got 3 huge

1438
00:50:13,530 --> 00:50:14,688
QR codes for you.

1439
00:50:15,010 --> 00:50:17,110
If anyone's phone isn't able to

1440
00:50:17,110 --> 00:50:18,110
zero in on that,

1441
00:50:18,849 --> 00:50:19,809
might be time to upgrade.

1442
00:50:21,030 --> 00:50:23,159
OK, so this workshop content will walk you

1443
00:50:23,159 --> 00:50:25,360
through kind of what we've built today, and I say

1444
00:50:25,360 --> 00:50:26,019
kind of

1445
00:50:26,570 --> 00:50:28,659
because it doesn't include the bedrock

1446
00:50:28,659 --> 00:50:29,260
part

1447
00:50:29,719 --> 00:50:30,260
yet.

1448
00:50:30,800 --> 00:50:32,958
And the only reason it doesn't include the bedrock part

1449
00:50:32,958 --> 00:50:34,820
yet is that we just haven't got round to

1450
00:50:35,119 --> 00:50:37,378
merging that new update into this.

1451
00:50:37,719 --> 00:50:38,378
We will do.

1452
00:50:38,679 --> 00:50:40,719
Um, someone asked me yesterday when we ran this

1453
00:50:40,719 --> 00:50:42,000
session, when?

1454
00:50:42,769 --> 00:50:45,050
And I said because you asked so nicely and

1455
00:50:45,050 --> 00:50:47,110
because I've got a 15 hour flight back to Australia,

1456
00:50:47,329 --> 00:50:48,889
I'll do it on that 15 hour flight.

1457
00:50:49,250 --> 00:50:51,688
So maybe the next time you check that that that

1458
00:50:51,688 --> 00:50:53,809
repo for the workshop content, it will be done.

1459
00:50:56,728 --> 00:50:58,869
Blog post, this is a blog post, uh,

1460
00:50:58,969 --> 00:51:01,039
let me do the, yeah, let me do the QR codes and then we'll we'll

1461
00:51:01,039 --> 00:51:02,010
come back to you. Sorry.

1462
00:51:02,780 --> 00:51:04,860
Um, another massive QR code, this is a blog

1463
00:51:04,860 --> 00:51:07,019
post that kind of talks about what we've just talked about

1464
00:51:07,019 --> 00:51:09,168
today as well, um, the process, why it's

1465
00:51:09,168 --> 00:51:11,179
useful, how to set it up and configure it, and

1466
00:51:11,179 --> 00:51:13,208
also links back to the workshop as well. So if

1467
00:51:13,208 --> 00:51:15,378
you didn't manage to get the last massive QR

1468
00:51:15,378 --> 00:51:17,418
code, get this one, cos you'll find your way back

1469
00:51:17,418 --> 00:51:18,878
to that workshop repository

1470
00:51:19,139 --> 00:51:21,599
anyway. OK,

1471
00:51:21,688 --> 00:51:22,780
I can't see no more cameras.

1472
00:51:23,320 --> 00:51:26,378
And then the last bit, policy samples.

1473
00:51:26,639 --> 00:51:28,918
OK, um, this is the repo

1474
00:51:28,918 --> 00:51:31,119
that K Nitin brought up earlier on. If you

1475
00:51:31,119 --> 00:51:33,159
plan to build your own reference policies, if

1476
00:51:33,159 --> 00:51:35,300
you want to do something like that we've shown you here

1477
00:51:35,300 --> 00:51:37,219
today with, with GitHub actions or even,

1478
00:51:37,599 --> 00:51:38,179
you know, whatever

1479
00:51:38,599 --> 00:51:39,918
CICD tooling you're using.

1480
00:51:40,519 --> 00:51:42,559
Uh, or if you just want to use, uh, access

1481
00:51:42,559 --> 00:51:44,869
analyzers, custom policy checks through the command

1482
00:51:44,869 --> 00:51:46,579
line tool, um, you can do it.

1483
00:51:46,918 --> 00:51:49,079
Uh, but those reference policies are a really good place to

1484
00:51:49,079 --> 00:51:51,269
start. We've got examples of reference policies

1485
00:51:51,269 --> 00:51:53,869
that are good for resource policies and

1486
00:51:53,869 --> 00:51:55,958
good for identity-based policies as well.

1487
00:51:56,119 --> 00:51:57,179
So have a look at those.

1488
00:51:57,679 --> 00:51:58,898
And then the last.

1489
00:51:59,829 --> 00:52:01,878
Slide, oops, there's it, I'm gonna skip that one,

1490
00:52:01,958 --> 00:52:02,699
that's not important.

1491
00:52:03,969 --> 00:52:04,909
Is this slide

1492
00:52:05,320 --> 00:52:07,550
with our names and our contact details,

1493
00:52:07,679 --> 00:52:09,728
of which we're very happy for you to reach out to

1494
00:52:09,728 --> 00:52:10,469
us and

1495
00:52:10,769 --> 00:52:12,889
email us, ask us questions, connect with us on

1496
00:52:12,889 --> 00:52:14,489
LinkedIn, whatever you want to do.

1497
00:52:15,219 --> 00:52:17,300
Um, because we love talking to customers about

1498
00:52:17,300 --> 00:52:18,039
this kind of thing.

1499
00:52:18,659 --> 00:52:20,699
And one really important item

1500
00:52:20,699 --> 00:52:23,099
at the bottom there in the left hand corner is

1501
00:52:23,099 --> 00:52:25,829
please complete the session survey in the mobile

1502
00:52:25,829 --> 00:52:28,179
application. And the reason that's important is because

1503
00:52:28,179 --> 00:52:30,378
we wanna know if you enjoyed this session, if

1504
00:52:30,378 --> 00:52:32,619
you got something out of it, if you learned something, and

1505
00:52:32,619 --> 00:52:34,780
if not, what could we do better next time to make sure

1506
00:52:34,780 --> 00:52:36,820
that when we come back and do something like this

1507
00:52:36,820 --> 00:52:38,878
again, it meets your expectations.

1508
00:52:38,978 --> 00:52:40,918
So please, if you have some time.

1509
00:52:41,179 --> 00:52:43,349
Uh, even before you leave today, um, please

1510
00:52:43,349 --> 00:52:45,789
fill out the session survey. It is greatly

1511
00:52:45,789 --> 00:52:46,878
appreciated. Um,

1512
00:52:47,309 --> 00:52:49,550
so that is the end of what we wanted to share

1513
00:52:49,550 --> 00:52:51,648
today. Enjoy. Thank you very much

1514
00:52:51,648 --> 00:52:53,289
for coming, really appreciate it. Thank you.

