# AWS EC2 容量管理与可用性会议总结

## 会议概述

本次AWS技术会议由Carlos Mandela(计算技术负责人)和Brian Philippy(EC2首席产品经理)主讲,重点探讨了Amazon EC2容量管理、可用性以及相关的权衡取舍。会议面向财务运营(FinOps)团队、平台工程团队和应用开发者,属于300级别的技术会议。

演讲者强调了云容量并非无限的现实,需要在容量可用性、定价模型和成本优化之间找到平衡。会议系统介绍了EC2的多种使用模式,包括按需实例、按需容量预留、容量块和Spot实例等,并分享了如何通过灵活性和智能配置来最大化资源利用率和成本效益。特别值得注意的是,演讲中介绍了多项近期发布的新功能,如可中断容量预留、容量预留共享增强功能等,为用户提供了更多优化选择。

## 详细时间线与关键要点

### 开场与背景介绍
时间戳: 会议开始
- **演讲者介绍:** Brian Philippy在AWS工作8年,曾负责Cyber Monday容量规划;Carlos Mandela是计算技术负责人,专注于优化和权衡分析
- **受众调查:** 现场包括FinOps团队、平台工程团队和应用开发者
- **会议议程:** 涵盖容量挑战、EC2使用模式、新功能介绍和关键要点总结

### 容量挑战与权衡
时间戳: 议程介绍后
- **核心挑战:** 云容量存在物理限制,需要在容量可用性和定价之间权衡
- **Spot实例示例:** 以高达90%的折扣提供备用容量,但实例可能被中断
- **权衡维度:** 容量可用性、利用率、价格和性能之间的平衡

### 按需实例(On-Demand Instances)
时间戳: 深入讨论使用模式开始
- **核心特点:** 按需付费模式,提供弹性容量
- **实例选择:** 超过1000种实例类型,建议选择最新一代以获得最佳性价比
- **可用性:** 在38个区域、120多个可用区提供服务,包括本地区域
- **适用场景:** 有状态工作负载、周期性扩展模式、临时短期工作负载、尚未准备长期承诺的测试阶段
- **容量池管理:** AWS后台进行容量预测、区域部署、池平衡(如将16xlarge拆分为4个4xlarge)
- **新实例发布:** M8g(Intel Sapphire Rapids)和M8A(AMD版本)最近发布,但新实例容量相对较少

### 灵活性策略
时间戳: 按需实例讨论中段
- **自助餐比喻:** 如果首选的"意大利饺子"没有了,灵活选择其他"意大利面"仍能获得满意的餐食
- **灵活性维度:** 不同实例系列、CPU制造商(Intel/AMD)、不同代次、不同规格
- **资格认证建议:** 挑战确定性性能需求,大多数情况下只需满足基线性能即可
- **实施工具:** EC2 Fleet和Auto Scaling Groups内置灵活性管理,集成Karpenter、AWS Batch、ECS等服务

### 基于属性的实例选择(ABIS)
时间戳: 灵活性策略讨论后
- **发布时间:** 约2.5-3年前推出
- **功能:** 通过属性定义实例选择(如vCPU数量、内存、代次、存储类型)
- **分配策略:** 
  - 优先级分配:按优先顺序列出实例,保护自己免受容量不足影响
  - 容量优化:选择最深的容量池,降低Spot中断频率
  - 价格优化:选择价格最优的实例
- **示例配置:** 8个vCPU、8GB内存、Graviton类型、EBS存储,自动生成从M8g.2xlarge到C7gn的灵活性组

### 按需容量预留(ODCR)
时间戳: 进入容量预留主题
- **定义:** 为特定实例类型和可用区组合预留容量
- **容量层级:** 按需 < 灵活性(多池) < 容量预留(最高保证)
- **计费模式:** 预留期间持续计费,运行实例时无额外费用,未使用时按运行实例费率计费
- **无承诺期:** 可随时取消,无需1年或3年承诺
- **适用场景:** 
  - 缺乏灵活性的工作负载
  - 需要特定实例类型、特定时间、特定可用区
  - 关键业务工作负载,必须能够启动实例

### 容量预留创建方式
时间戳: ODCR详细说明中
- **按需创建:** 基于当前容量池创建,适用于扩展缓慢的工作负载或覆盖已运行实例
- **未来日期创建:** 提前5-120天请求,适用于:
  - 高峰事件(如Q4购物季、Cyber Monday)
  - 大规模迁移
  - 基线容量阶梯式增长
- **创建流程:** 请求预留 → 评估状态(5天内) → 计划状态 → 容量可用

### 容量预留匹配规则
时间戳: ODCR使用说明
- **必须匹配项:** 实例类型、可用区、平台/操作系统、租赁类型(单租户/共享)
- **可选匹配:** 集群置放群组ID(用于高性能计算)
- **实例资格:** 
  - Open(开放):默认设置,作为公共容量池,任何人都可使用
  - Targeted(定向):多租户账户中保护容量,需指定预留ID或资源组

### Auto Scaling Group容量预留偏好
时间戳: 容量预留优化部分
- **发布时间:** 去年推出
- **功能:** 提高容量预留利用率
- **选项:**
  - 仅使用容量预留:有匹配预留时启动,否则报错
  - 优先使用容量预留:先尝试预留,不可用时回退到按需实例

### 容量预留共享
时间戳: 提高利用率讨论
- **使用场景:** 高优先级工作负载白天运行,夜间基线较小,可与低优先级工作负载共享
- **共享范围:** 跨账户、跨组织,甚至组织外部
- **实施工具:** 使用Resource Access Manager(RAM)设置共享
- **计费模式:** 
  - 默认:预留所有者为未使用容量付费,使用者仅为使用部分付费
  - 分配计费所有权:中央团队管理预留,但将计费责任分配给请求者
- **新功能:** 今年推出集群置放群组ODCR共享功能

### 可中断容量预留
时间戳: 容量回收讨论
- **传统方式:** 需要人工干预,呼叫值班人员,手动终止实例
- **新方式:** 2分钟通知后自动中断,无需人工干预
- **架构模式:** 
  - 父预留:高优先级工作负载的ODCR
  - 子预留:可中断ODCR,通过RAM共享给组织
- **使用要求:** 
  - 消费者需定向预留
  - 设置市场类型为"可中断容量预留"
  - 可在启动模板中配置

### Savings Plans
时间戳: 成本优化讨论
- **承诺模式:** 每小时使用承诺,1年或3年期
- **折扣:** 3年期实例Savings Plans最高可节省72%
- **类型:**
  - Compute Savings Plans:最大灵活性,适用于任何实例类型、任何区域,最高66%折扣
  - Instance Savings Plans:限定区域或实例系列,最高72%折扣

### ML容量块(Capacity Blocks for ML)
时间戳: 进入GPU实例讨论
- **目标:** GPU实例和加速计算实例(包括训练)
- **挑战:** 
  - 高需求导致稀缺性
  - 灵活性较低(CUDA优化、特定架构编译)
  - 成本高昂
- **预留期限:** 1-26周(最近扩展到半年)
- **底层机制:** 创建ODCR,可使用共享技术
- **适用场景:** 
  - 大规模训练
  - 季节性活动
  - 新产品发布
  - 实验阶段(避免长期Savings Plans承诺)
- **规模:** 最多64个实例,相当于512个P6 200 GPU
- **集成:** 支持集群置放群组,适用于Linux系统

### SageMaker训练计划
时间戳: ML容量块讨论后
- **对应关系:** SageMaker的容量块等效功能
- **差异:** 可提前30分钟申请,容量可用时立即分配
- **集成:** 与SageMaker、HyperPod、UltraCluster服务集成
- **实例支持:** 包括P6 200、Trainium 1和Trainium 2
- **访问方式:** 通过控制台和API

### Spot实例
时间戳: 会议后段
- **定义:** 数据中心的备用容量
- **折扣:** 最高90%,通常60-70%
- **适用范围:** 包括GPU实例的机会性工作负载
- **关键工具:** Spot Placement Score(用于查找最佳Spot容量)
- **主要用途:** 容器化工作负载、批处理等

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注: 会议在Spot实例讨论部分字幕截断,完整内容可能包含更多Spot实例的最佳实践和使用建议。