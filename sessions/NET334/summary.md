# AWS re:Invent 2025 负载均衡演进深度解析

## 会议概述

本次AWS re:Invent 2025分组会议深入探讨了AWS负载均衡服务的演进历程和最新功能。会议由三位演讲者共同呈现:Matt Lewis(高级首席工程师)详细讲解了支撑ELB的Nitro架构及其性能优势;Jamie介绍了ALB、NLB和Gateway Load Balancer在实际架构中的应用场景;Molen Kalc Carney(NLB和GWLB产品经理)则重点介绍了最新发布的功能特性。

会议从经典负载均衡器(CLB)的历史讲起,展示了AWS如何从基于DNS的传统架构演进到基于Hyperplane的现代化架构。Matt特别强调了AWS Nitro系统的革命性意义——通过将网络操作从软件层转移到专用硬件,实现了从2013年的10 Gbps到2021年400 Gbps的性能飞跃。Nitro v3及以上版本还提供了默认的端到端传输加密,无需应用层修改即可获得安全保障。

Jamie通过一个标准的三层Web应用架构,生动展示了各类负载均衡器的最佳使用场景。ALB适合需要L7处理、路径路由和认证卸载的场景;NLB则凭借其超低延迟和高吞吐量特性,成为游戏、金融交易和IoT应用的理想选择;Gateway Load Balancer通过集中式安全VPC架构,为多租户环境提供了灵活的安全设备部署方案。会议还深入讲解了PrivateLink、自动目标权重调整(ATW)、EKS集成等高级功能,为与会者提供了丰富的实践指导。

## 详细时间线

### 开场与议程介绍
[00:00:00 - 00:01:30]
- 会议开场,介绍三位演讲者及会议议程
- Matt Lewis将讲解Nitro架构和ELB性能原理
- Jamie将展示负载均衡器在实际架构中的应用
- Molen将介绍最新发布的功能特性

### Nitro架构深度解析
[00:01:30 - 00:03:00]
- Matt开始介绍现代负载均衡架构
- AWS负载均衡由三大产品组成:ALB、NLB和Gateway Load Balancer
- 需要先回顾经典负载均衡器(CLB)的历史背景

[00:03:00 - 00:05:30]
- 讲解传统本地负载均衡器架构
- 本地负载均衡器特点:基于ASIC的数据包处理、单一虚拟IP(VIP)、集中式设备
- 通过TCP会话同步实现主备冗余
- 物理数据中心扩展的局限性

[00:05:30 - 00:08:00]
- AWS数据中心架构:38个全球区域、可用区、VPC逻辑构造
- EC2实例在VPC中的部署模式
- 早期客户使用DNS进行负载分配的方式及其局限性

[00:08:00 - 00:10:30]
- 经典负载均衡器(CLB)架构详解
- CLB使用DNS解析到多个A记录
- 在Amazon服务VPC中运行标准EC2实例
- 通过跨VPC ENI连接实现流量转发

[00:10:30 - 00:12:00]
- CLB的扩展机制:通过增加A记录实现横向扩展
- 客户可见的扩展过程及"预热"需求
- ELB三明治架构:安全厂商监控DNS变化以适应扩展

### AWS Nitro系统革新
[00:12:00 - 00:15:00]
- ALB与CLB的关键区别:AWS Nitro系统
- Nitro将网络操作从Xen虚拟化层转移到专用网络适配器
- Nitro系统组件:Nitro卡、轻量级KVM虚拟化层、Nitro安全芯片
- 性能演进:2013年10 Gbps → 2021年50 Gbps → 最新C8GN实例400 Gbps

[00:15:00 - 00:17:00]
- Nitro v3+版本提供默认端到端传输加密
- VPC加密控制功能:账户级别强制使用支持加密的Nitro版本
- ALB、NLB和Fargate自动升级到支持VPC加密的Nitro版本

### Hyperplane架构突破
[00:17:00 - 00:19:30]
- NLB引入Hyperplane架构解决DNS扩展问题
- 每个可用区提供单一ENI,无论后端规模如何变化
- Hyperplane实现大规模可扩展基础设施,对用户透明

[00:19:30 - 00:21:00]
- Gateway Load Balancer同样基于Hyperplane构建
- L3/L4负载均衡器,专为安全设备设计
- 通过Gateway Load Balancer Endpoint实现跨VPC流量转发
- 支持集中式安全VPC和多租户服务模式

[00:21:00 - 00:22:30]
- Hyperplane作为内部负载均衡服务的定位
- 多个AWS服务使用Hyperplane:NLB、GWLB、PrivateLink、VPC Lattice等
- 新发布的RDS Proxy服务也采用Hyperplane架构

### ALB应用场景详解
[00:22:30 - 00:25:00]
- Jamie接手讲解负载均衡器实际应用
- ALB支持的目标类型:EC2实例、Lambda、容器、IP地址
- 主要功能:WAF集成、认证卸载、SSL/TLS/mTLS、慢启动模式

[00:25:00 - 00:27:30]
- 三层Web应用架构示例
- Transit Gateway连接前端和后端VPC
- ALB位于前端,使用安全组控制访问
- 后端包括EngineX服务器、数据库集群、Kubernetes和Lambda

### 目标组配置深度解析
[00:27:30 - 00:30:00]
- 目标组是ELB的"无名英雄"
- 目标组类型:实例、IP、Lambda函数、ALB
- 协议选择:HTTP、HTTPS、gRPC等
- 健康检查最佳实践:使用状态页面URL而非TCP端口检查

[00:30:00 - 00:32:00]
- 高级目标组属性:连接耗尽、最小健康目标故障转移
- 支持自动扩展集成
- 加权目标组:支持金丝雀部署和蓝绿部署(95%/5%流量分配)

[00:32:00 - 00:34:30]
- 负载均衡算法:轮询、最少未完成请求、加权目标组
- 自动目标权重(ATW)功能详解
- ATW监控5xx错误、TCP连接失败、TLS连接错误
- 检测到异常时停止发送新请求,但保持现有连接

[00:34:30 - 00:36:00]
- ATW自动恢复机制
- CloudWatch指标可见性:可监控ATW决策过程

### ALB高级功能
[00:36:00 - 00:38:30]
- WAF集成:支持Shield Advanced,提供DDoS防护和实时规则调整
- 自动阻止已知恶意行为者
- 认证卸载:与Cognito集成
- 支持用户池(IAM)、SAML连接、OIDC提供商(Okta、Auth0等)

[00:38:30 - 00:40:00]
- ALB最佳应用场景:
  - 电商零售(购物车、结账、目录路由)
  - 新闻发布(弹性扩展应对流量峰值)
  - 社交媒体平台
  - 医疗保健(HIPAA合规)
  - 金融服务(PCI合规)
  - 政府关键应用

### NLB连接负载均衡
[00:40:00 - 00:42:30]
- NLB定位为"连接负载均衡器"
- 支持目标:实例、ALB、容器、IP地址(可路由的任何IP)
- 使用场景:读数据库集群负载均衡
- 将NLB放置在独立的数据库VPC中,实现网络和数据库团队的关注点分离

[00:42:30 - 00:45:00]
- NLB核心优势:
  - 基于TCP的长连接
  - 流哈希算法均匀分配连接
  - 高吞吐量(基于Hyperplane)
  - 超低延迟
  - 支持流量突发

### PrivateLink架构
[00:45:00 - 00:48:00]
- 使用NLB和PrivateLink替代Transit Gateway连接
- PrivateLink使用本地子网IP地址,流量看起来像本地通信
- 支持最高100 Gbps(更高需求可使用NLB分片)
- TCP/UDP支持,单向有状态流
- 所有流量通过AWS骨干网,完全私有

[00:48:00 - 00:50:00]
- PrivateLink跨账户和跨区域支持
- 示例:数据库团队使用独立账户和VPC
- 新区域的容器工作负载通过PrivateLink访问读数据库
- 所有流量通过AWS自有光纤,避免"互联网天气"影响

### EKS集成
[00:50:00 - 00:53:00]
- AWS Load Balancer Controller for EKS
- 通过Kubernetes配置直接管理ALB/NLB
- ALB Ingress Controller:支持基于路径的路由和L7处理
- NLB Direct Pod模式:将Pod IP直接添加到目标组,实现更低延迟
- 需要平衡IP地址消耗和性能需求

[00:53:00 - 00:55:00]
- NLB混合连接场景
- 使用本地数据中心IP地址作为NLB目标
- 通过Direct Connect和Transit Gateway连接
- Kubernetes集群访问本地资源

### NLB最佳应用场景
[00:55:00 - 00:57:00]
- 游戏:保持低ping时间和持久连接
- 金融服务:股票行情、高频交易的低延迟需求
- 广告交易平台
- IoT设备:TCP配置数据传输
- 媒体流:无缓冲、无延迟的流畅播放体验

### 会议总结
[00:57:00 - 结束]
- 准备过渡到Molen讲解最新功能特性
- 会议涵盖了从架构演进到实际应用的完整内容