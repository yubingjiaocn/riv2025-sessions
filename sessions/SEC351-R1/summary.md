# AWS re:Invent 2025 - IAM Policy Autopilot 会议总结

## 会议概述

本次会议由AWS Identity团队的首席产品经理Kevin Lu和首席工程师Luke Kennedy主讲,重点介绍了AWS新推出的开源工具IAM Policy Autopilot。这是一个命令行工具,能够通过静态代码分析自动生成IAM策略,帮助开发者更快速、更准确地配置权限。

演讲者首先通过现场演示展示了传统IAM策略编写的痛点:使用管理员权限过于宽泛存在安全风险,使用AWS托管策略仍需手动调整且容易遗漏权限,手工编写策略耗时且容易出错,而AI编码助手生成的策略常常包含不存在的权限或遗漏隐藏依赖。为解决这些问题,IAM Policy Autopilot应运而生。

该工具的核心优势在于其确定性、实时性和可靠性。它使用AWS官方发布的服务参考数据,通过静态代码分析识别SDK操作,然后映射到正确的IAM权限。与传统方法相比,该工具生成的策略权限数量仅为实际生产环境中过度授权策略的3%,大幅提升了安全性。此外,工具还支持作为MCP服务器集成到编码助手中,实现智能化的权限管理工作流。

## 详细时间线

### 开场与背景介绍 (00:00 - 05:30)

00:00 - 会议开始,Kevin Lu和Luke Kennedy自我介绍,确认这是一个300级别的技术会议

01:15 - 通过举手调查了解听众背景:新手、有经验的开发者、能闭眼写IAM策略的专家

02:30 - 介绍今天的演示场景:构建一个为多租户服务创建和加密S3存储桶的微服务

03:45 - 架构说明:Lambda函数接收客户ID和名称,创建KMS密钥,创建S3存储桶,配置存储桶加密

### 代码演示与传统方法的问题 (05:30 - 20:00)

05:30 - 展示Python Lambda函数代码,使用boto3 SDK调用S3和KMS服务

07:00 - 在Lambda控制台创建新函数,使用默认执行角色

08:15 - 首次测试失败:因缺少KMS权限导致访问被拒绝错误

09:30 - 解释IAM基础概念:执行角色、IAM策略、权限管理

10:45 - 讨论选项一:使用管理员访问权限 - 快速但过于宽泛,存在安全风险

12:00 - 讨论选项二:使用AWS托管策略(如S3FullAccess、KMSFullAccess)

13:30 - 添加托管策略后再次测试,遇到新错误:密钥策略格式错误

14:45 - 解释隐藏依赖问题:创建密钥时传入策略需要额外的kms:PutKeyPolicy权限

16:00 - 手动创建内联策略添加缺失权限

17:30 - 演示过程中遇到实际调试问题(存储桶名称包含空格等),展示真实开发场景

### AI编码助手的局限性 (20:00 - 25:00)

20:00 - 讨论2025年使用编码助手的普遍性,现场调查使用情况

21:00 - 使用Amazon Q Developer (Curo)生成IAM策略

22:15 - 发现生成的策略包含错误:不存在的权限如s3:HeadBucket(实际应为s3:ListBucket)

23:30 - 解释AI模型的局限性:基于公开信息训练,无法理解隐藏依赖,存在命名不一致问题

24:45 - 总结四种传统方法的优缺点及其权衡

### IAM Policy Autopilot介绍 (25:00 - 32:00)

25:00 - 正式介绍IAM Policy Autopilot:开源命令行工具,于周日刚刚发布

26:15 - 工作原理第一步:使用静态代码分析在本地解析代码,提取SDK操作

27:30 - 工作原理第二步:使用AWS发布的IAM服务参考数据映射操作到权限

28:45 - 展示操作到权限的映射JSON示例,说明如何识别隐藏依赖

30:00 - 工作原理第三步:组合生成确定性的IAM策略

31:00 - 强调三大核心优势:确定性(相同代码生成相同策略)、实时性(使用最新服务数据)、可靠性(基于真实服务数据)

### 工具限制说明 (32:00 - 35:30)

32:00 - 当前仅支持身份策略,不支持跨账户资源策略

33:00 - 生成的策略不一定是最小权限,但比现有方案更接近最佳实践

33:45 - 内部数据显示:生成的权限数量仅为生产环境实际策略的3%,意味着现有策略97%过度授权

34:30 - 静态分析暂不支持自动识别资源名称,需要手动范围限定

35:00 - 某些复杂的跨服务依赖可能缺失,团队持续改进中

### 实际操作演示 - CLI安装与配置 (35:30 - 42:00)

35:30 - Luke Kennedy接手演示,删除之前的错误策略

36:15 - 使用pip安装IAM Policy Autopilot:pip install impilot

37:00 - 展示CLI基本功能和帮助信息

38:00 - 配置为MCP服务器,集成到Amazon Q Developer (Curo)

39:15 - 使用UV工具运行pip应用,确保自动更新

40:30 - 在IDE中验证MCP服务器连接成功,工具可用

### 实际操作演示 - 策略生成 (42:00 - 50:00)

42:00 - 在Curo中请求为代码生成IAM策略

43:00 - Curo询问区域和账户ID以正确范围限定资源

44:00 - 工具调用IAM Policy Autopilot生成策略

45:00 - 检查生成的策略:S3权限正确,没有不存在的HeadBucket权限

46:15 - 验证KMS权限包含所有必需的操作,资源ARN正确填充区域和账户ID

47:30 - 使用CloudFormation部署基础设施,Curo自动生成模板

49:00 - 展示生成的CloudFormation模板,包含Lambda函数和正确的IAM角色策略

### CLI直接使用演示 (50:00 - 52:30)

50:00 - 演示CLI直接使用:impolicy-autopilot generate-policies <文件名>

51:00 - 命令立即输出相同的策略,验证确定性

51:45 - 说明CLI可集成到CI/CD流程中,自动化策略生成

### 代码迭代与权限修复演示 (52:30 - 62:00)

52:30 - CloudFormation部署完成,测试Lambda函数成功执行

53:30 - 演示代码迭代场景:添加SQS通知功能

54:15 - 展示修改后的代码,新增SQS客户端和发送消息逻辑

55:00 - 请求Curo为新代码生成CloudFormation模板

56:30 - Curo自动添加SQS权限(演示中手动移除以展示修复流程)

57:45 - 部署新模板,故意不包含SQS权限

59:00 - 执行Lambda函数,遇到SQS权限拒绝错误

60:00 - 使用IAM Policy Autopilot的"修复访问拒绝"功能

61:00 - 工具分析错误消息,自动生成包含缺失权限的策略

61:45 - 部署修复策略到账户,再次测试Lambda函数成功执行

### Agent工作流与总结 (62:00 - 结束)

62:00 - 解释修复功能的重要性:支持编码助手自主解决权限问题

63:00 - 说明在无人监督的Agent工作流中,工具可自动处理多层访问拒绝错误

64:00 - 会议总结:展示了如何使用IAM Policy Autopilot生成策略、与基础设施即代码结合、修复访问拒绝错误

65:00 - 强调核心价值:无需使用过度宽泛的权限,确定性生成,仅使用真实IAM操作,保持最新

66:00 - 再次说明当前限制和未来改进方向

67:00 - 会议结束