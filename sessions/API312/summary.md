# AWS re:Invent 2025 会议总结：大规模构建实时应用

## 会议概述

本次技术分享由AWS高级深度学习架构师Brian Zambrano和他的同事Kim主讲，重点介绍了如何使用AWS服务构建可扩展的实时应用程序。演讲者通过现场演示一个实时问答游戏应用，向观众展示了处理大规模实时通信的实际解决方案。

会议的核心主题围绕实时应用开发的挑战展开。Brian指出，即使在生成式AI时代，构建应用程序仍然复杂，而构建实时应用更是难上加难。当需要支持数百万用户时，复杂度会呈指数级增长。为了让观众更直观地理解这些概念，演讲者设计了一个互动环节，让现场观众通过扫描二维码参与AWS知识问答游戏，实时体验他们所讨论的技术架构。

演讲的技术核心是AWS AppSync Events服务，这是一个完全托管的发布-订阅服务，专门用于简化实时通信API的构建。通过结合API Gateway、Lambda、DynamoDB等AWS服务，演讲者展示了一个完整的、可扩展到数千用户的实时应用架构。整个会议不仅提供了理论知识，更通过实际代码示例和架构设计决策，为开发者提供了可直接应用于生产环境的最佳实践。

## 详细时间轴与关键要点

### 开场与问题引入 (00:00 - 05:30)

00:00 - Brian Zambrano自我介绍，说明自己是AWS高级深度学习架构师，拥有无服务器和解决方案架构背景

01:15 - 提出核心问题：构建应用程序本身就很复杂，需要处理应用逻辑、数据库、缓存、监控等多个方面

02:00 - 引入实时应用概念：当事件发生时需要实时或近实时地将数据推送给其他用户

02:45 - 进一步提升难度：构建支持数百万用户的实时应用是"真的很难"的挑战

03:30 - 宣布现场互动环节：邀请观众扫描二维码参与实时问答游戏

### 实时问答游戏演示 (05:30 - 12:00)

05:30 - 观众开始扫描二维码加入游戏，等待游戏开始

06:15 - 第一题：关于Amazon Bedrock模型提供商的长上下文处理能力

06:45 - 第二题：Amazon SageMaker Pipelines提供什么功能（答案：ML工作负载的CI/CD）

07:20 - 演示过程中展示排行榜实时更新，所有答案以流式方式传入

08:00 - 第三题：Amazon Bedrock支持多轮对话的功能

08:30 - 第四题：启动Kira交互式聊天模式的命令

09:15 - 第五题至第十题：涵盖SageMaker Profiler、Hyper Pod、Kira的AWS资源管理能力、Bedrock Agents、模型评估和本地文件系统操作

11:30 - 游戏结束，显示最终排行榜，第一名得分274分

### 实时应用场景与技术挑战 (12:00 - 18:00)

12:00 - 列举实时应用实例：拼车应用的位置追踪、体育比分推送、价格变动、博彩赔率更新、游戏应用

13:15 - 介绍协作式实时应用：多用户同时看到相同的实时数据更新

14:00 - 讨论传统轮询方法的局限性：浪费计算资源和网络带宽，在规模化时会出现问题

15:30 - 引入WebSocket双向通信解决方案：客户端和服务器建立持久连接，双方可以互相推送数据

16:45 - 阐述规模化挑战：需要追踪每个用户连接、处理扇出（fanout）、管理后端基础设施扩展

17:30 - 强调这些是"无差异化的繁重工作"，不是核心业务但必须处理

### AWS AppSync Events核心概念 (18:00 - 28:00)

18:00 - Kim接手演讲，介绍AWS AppSync Events

18:45 - 定义：AppSync Events是完全托管的发布-订阅服务，降低大规模管理WebSocket的运营开销

19:30 - 核心功能：提供API授权、注入业务逻辑、低总拥有成本

20:15 - 架构说明：发布者（应用客户端或后端系统）通过Event API向订阅者推送信息

21:00 - 强调AppSync Events自动处理连接管理和扇出功能

22:30 - 介绍Channel Namespace概念：最高层级是namespace（如"game"），用于分隔不同类型的事件

24:00 - 解释Channel Segments：动态创建，无需预定义，提供灵活的信息分段能力

25:30 - 说明发布方式：应用客户端通过WebSocket发布，后端系统（如Lambda）通过HTTP POST发布

27:00 - 订阅者始终通过WebSocket连接接收实时更新

### 游戏加入流程的扩展设计 (28:00 - 40:00)

28:00 - 介绍游戏三个主要部分：管理端（使用REST API）、加入游戏、游戏进行

29:00 - 提出加入游戏的四个扩展考虑因素：
  - 如何处理大量用户同时加入
  - 用户无法加入时的体验
  - 如何关联用户与特定游戏
  - 如何识别用户（无需创建账户）

30:30 - 展示基础架构：客户端建立WebSocket连接，数据持久化到数据存储

31:45 - 识别"惊群问题"（Thundering Herd）：10,000用户同时尝试加入的场景

33:00 - 介绍AppSync Events配额：默认每秒2,000个连接请求（可调整）

34:30 - 解决方案：使用API Gateway的速率限制功能作为入口控制

35:45 - 工作流程：前2,000用户获得200响应并建立连接，其余8,000用户收到429限流错误

36:30 - 客户端内置重试逻辑和指数退避，对用户透明

38:00 - 玩家入口控制：通过API Gateway的HTTP GET路由验证游戏ID，应用速率限制

39:15 - 优化措施：使用API Gateway缓存减少对DynamoDB的读取压力

### 高级扩展技术与最佳实践 (40:00 - 48:00)

40:00 - 使用API Gateway与DynamoDB的直接集成，无需Lambda中间层，减少冷启动和成本

41:30 - 通过Usage Plan实现API Gateway速率限制，控制在2,000请求/秒以内

42:45 - 用户成功建立WebSocket连接后，订阅相关的namespace和channel

44:00 - 介绍Event Handler：在AppSync Events中运行业务逻辑的机制

45:15 - Event Handler使用AppSyncJS环境（轻量级JavaScript环境），不是Lambda函数

46:00 - Event Handler用途：事件丰富、订阅验证、数据持久化，无需引入额外计算延迟

47:00 - 用户识别方案：客户端生成随机用户ID，通过header传递，Event Handler捕获并持久化到DynamoDB

### 请求令牌与配额管理 (48:00 - 52:00)

48:00 - 介绍Request Tokens概念：每个请求（连接、发布、订阅）都消耗令牌

49:00 - CloudWatch日志会显示每个请求消耗的令牌数量

49:45 - 请求令牌速率配额：默认每秒每区域2,000个令牌

50:30 - 大多数请求只消耗约1个令牌，但复杂业务逻辑可能增加消耗

51:15 - 最佳实践：在测试期间验证不同操作类型的令牌消耗量

### 加入游戏的设计总结 (52:00 - 54:00)

52:00 - 总结三个关键考虑因素：

52:30 - 使用AppSync Events与数据源的直接集成（DynamoDB、RDS、OpenSearch、Lambda、HTTP等）

53:15 - 使用DynamoDB按需容量模式应对未知负载

53:45 - 利用内置AppSyncJS环境和实用工具进行轻量级业务逻辑处理

### 游戏进行流程 (54:00 - 结束)

54:00 - Brian继续讲解游戏进行阶段的四个关键流程

54:30 - 管理员广播问题给所有玩家

55:00 - 所有玩家提交答案回传给管理员

55:30 - 运行逻辑判断答案正确性，计算分数

56:00 - 将个人分数发送给各个玩家（非广播，针对性推送）

56:30 - 管理员界面显示累积排行榜（前五名用户）