# AWS re:Invent 2025 分会场总结

## 会议概述

本次分会场由来自 Zendesk 的 Nick Hefty 主讲，主题为"在大规模环境下发现嘈杂邻居和客户性能模式"。Nick 在 Zendesk 工作了七年半，从客户支持部门转到软件工程团队，这使他对事故响应有着独特的视角。

演讲以一个生动的场景开场：感恩节后的深夜，工程师被突如其来的告警惊醒，客户报告延迟翻倍、请求丢失。这种场景对许多工程师来说都不陌生。Nick 分享了 Zendesk 如何通过改进可观测性策略，让工程师能够更好地休息，更快地响应事故。Zendesk 作为 AWS 合作伙伴，大量使用 Aurora、ElastiCache、EC2 等服务，服务着数十万客户。这种高基数（high cardinality）环境带来了独特的挑战：如何在共享基础设施上识别影响其他客户的"嘈杂邻居"，同时控制可观测性成本。

演讲的核心是介绍了一个名为"REST"的迭代方法论，帮助团队系统性地改进可观测性实践，最终实现了更快的事故响应、更满意的客户和可控的成本。

## 详细时间线与关键要点

### 开场与问题设定 (00:00 - 05:30)

00:00 - 01:30 - 演讲开场，Nick 讲述感恩节后深夜被告警惊醒的故事，引起听众共鸣。客户报告延迟翻倍、请求丢失，工程师需要在睡眠不足的状态下快速定位问题。

01:30 - 03:00 - 介绍演讲主题：寻找嘈杂邻居和大规模客户性能模式。Nick 介绍自己在 Zendesk 的背景，从客户支持转到工程团队的独特经历。

03:00 - 05:30 - 介绍 Zendesk 的 AWS 技术栈：Aurora 数据库、ElastiCache、EC2 实例、Pod 化基础设施。强调 Zendesk 是 AWS 合作伙伴，从自托管迁移到 AWS 主要是为了可扩展性。

### 高基数挑战 (05:30 - 10:00)

05:30 - 07:00 - 展示复杂的基础设施图，询问有多少人的基础设施看起来如此复杂。解释高基数（high cardinality）概念：在同一层级有大量需要监控的对象。

07:00 - 10:00 - 讨论高基数带来的挑战：数十万客户共享基础设施，需要识别哪些客户影响了其他客户。介绍 Kubernetes 基础设施需要在分片（shards）之间平衡负载。强调管理高基数时需要考虑的因素：数据保留时间、采样率、数据敏感性。

### 成本与可观测性的平衡 (10:00 - 13:00)

10:00 - 11:30 - 展示成本与可观测性之间的跷跷板关系。越深入可观测性，有时越令人恐惧。Nick 希望通过分享 Zendesk 的经验，让这个过程不那么可怕和令人沮丧。

11:30 - 13:00 - 引用名言："明智的工程师从自己的错误中学习，愚者不从他人的错误中学习。" Nick 希望分享自己的错误，让听众避免重蹈覆辙。

### 嘈杂邻居问题定义 (13:00 - 16:30)

13:00 - 14:30 - 定义"嘈杂邻居"：就像公寓楼里播放大声音乐的邻居，影响周围所有人。在技术环境中，这是指在共享基础设施上一个客户影响其他所有客户的情况。

14:30 - 16:30 - 展示事故场景：凌晨 2 点被叫醒，查看客户流量模式，但只能看到基本的端点调用信息，无法获得足够的上下文来快速定位问题。这是可观测性的常见起点：直到需要时才知道需要看什么。

### REST 方法论介绍 (16:30 - 28:00)

16:30 - 18:00 - 介绍解决方案：跨租户（tenants）添加标签。租户类比为公寓楼里的住户。通过标签可以看到资源在哪里被耗尽，流量从哪里来。

18:00 - 20:00 - 展示添加标签后的 APM 追踪效果：使用 Datadog 的 APM 追踪，可以看到调用的每个步骤。同样的调用，现在可以看到更多信息。

20:00 - 22:00 - Recognize（识别）：识别需要看到什么。是热分区？积压？延迟峰值？可以通过 APM、日志、基础设施监控和指标来识别。

22:00 - 24:00 - Examine（检查）：检查如何看到这些信息。需要看到顶级租户吗？需要标记租户吗？是基数问题吗？还是慢数据库查询？可以通过追踪、基础设施监控和指标来检查。

24:00 - 26:00 - Shape（塑造）：这是事故复盘中容易被跳过的部分。不仅要能看到问题，还要讨论看到告警后该做什么。展示仪表板示例：限制与流量的对比。可以决定是提高限制还是降低限制（如果是失控的集成）。

26:00 - 28:00 - Test（测试）：定期检查（每月或每季度）这些设置是否有效。告警是否有意义？是否有无用的告警？可能需要调整日志摄取比例（从 100% 降低）。通过服务级别目标（SLO）或记分卡来评估。

### 成本管理策略 (28:00 - 35:00)

28:00 - 30:00 - 强调成本作为持续对话的重要性，而不是每年或每次合同续签时才讨论。如果只在财年讨论成本，会让人措手不及。

30:00 - 32:00 - 展示成本控制成果：通过持续对话，Zendesk 在过去几年保持了成本持平。改进查询性能直接降低基础设施成本；减少活跃数据集可以转移到冷存储层。

32:00 - 35:00 - 讨论预算对话的挑战：当财务团队问"你需要多少钱？"时，这对所有人都是糟糕的对话。但如果工程师持续参与成本讨论，就不会有人措手不及，也不会担心可观测性预算被削减。

### 具体实施策略 (35:00 - 45:00)

35:00 - 37:00 - 日志策略：大多数公司从这里开始。大量详细的 JSON 日志非常昂贵。需要讨论是否真的需要每条日志。成功的请求可能不需要记录，更关心 422 错误等问题。

37:00 - 39:00 - 管理摄取（ingest）和索引（index）管道：需要摄取多少？成本如何？需要索引多少？10%、20% 还是只索引错误？

39:00 - 41:00 - APM 策略：成本较低的层级，可以添加标签。展示火焰图示例。可以看到随时间变化的流量。例如，每天 10 万次帮助中心文章检索，是否需要全部追踪还是 10% 就够？

41:00 - 43:00 - 指标策略：用于基础设施层面的监控。不需要所有客户信息就能确定哪个 EC2 集群 CPU 负载高。这是指标的完美用例，成本更低。

43:00 - 45:00 - 强调成本视角的重要性，以及在整个过程中保持这种对话的必要性。承认这种对话可能不舒服，但如果看不到需要的信息，解决问题几乎是不可能的。

### 实施成果 (45:00 - 50:00)

45:00 - 47:00 - 展示实施 REST 方法论后的成果（这不是一夜之间发生的，是七年半的旅程）：响应时间大幅加快，能够快速上线、进入事故、看到正在发生的事情、知道告警触发时该做什么。

47:00 - 50:00 - 能够识别"嘈杂邻居"（21B 公寓的那个人），对其设置防护栏，防止影响其他人。还能够在更大的基础设施层面进行优化：调整云资源大小、保持一致的 EC2 实例、使摄取成本与内部和客户价值保持一致。客户明显更满意，因为能更快响应问题并提供有意义的信息。

### 常见陷阱 (50:00 - 58:00)

50:00 - 52:00 - 陷阱 1：自由格式标签：如果没有治理，不同团队可能用不同名称标记相同的东西（"cookies" vs "cookie4"），导致重复付费和虚假的高基数。解开这种混乱需要大量会议和测试。

52:00 - 54:00 - 陷阱 2：全捕获日志记录：Nick 在客户支持时喜欢这种方式，因为审计日志和工程日志在一起。但这非常昂贵，实际上不值得。会导致在多个地方重复记录相同信息（日志、APM、指标、S3），付费四次。

54:00 - 56:00 - 陷阱 3：没有所有者映射：如果不知道谁在生成大量日志，就不知道该找谁。如果直接删除，会在凌晨 2 点发现是谁，但那时客户已经很沮丧了。拥有并持续更新服务映射非常困难，但极具价值。能在一分钟内确定需要呼叫哪个团队，而不是呼叫 15 个错误的团队。

56:00 - 58:00 - 陷阱 4：告警疲劳：Slack 频道充满无人响应的告警，因为同一个告警已经触发了三周。信噪比很重要。如果一切都是关键的，那就没有什么是关键的。这不仅影响事故响应，还会导致忽略其他真正的告警。很难向客户解释"我们两小时前就看到了，但忽略了"。

### 关键要点总结 (58:00 - 63:00)

58:00 - 59:30 - 要点 1：先标签后仪表板：确定如何记录所有内容并坚持标准。有治理规则。没有规则的仪表板是形式大于实质，会迅速崩溃。

59:30 - 60:30 - 要点 2：早期投资于每租户 KPI 和热图：如果不讨论租户性能，就无法适当地集中资源。

60:30 - 61:30 - 要点 3：将成本视为一等维度：虽然反复提到成本可能令人厌烦，但没有接受这种文化会导致许多其他问题。成本是每个公司的维度，如果团队内部不愿意讨论它，如何推动盈利能力和可持续性？

61:30 - 62:30 - 要点 4：嵌入上下文（修复元数据）：如果不存在，就看不到。回到 REST 迭代过程。如果不嵌入租户上下文，就总是在被动响应而不是主动预防。客户最喜欢的是在他们发现问题之前就解决问题。

62:30 - 63:00 - 展示最终目标：延迟降低、请求保留、客户满意。所有讨论的内容都是为了实现这些目标。客户是收入来源，如果他们不满意就会离开。在推动所有可观测性决策时保持客户上下文是健康的平衡。

### 结束与致谢 (63:00 - 结束)

63:00 - 64:30 - Nick 感谢听众，表示客户体验对他来说非常重要，这是一个永远存在的问题，他喜欢解决问题。邀请听众提问，可以在大组中提问或会后私下交流。

64:30 - 结束 - 特别感谢 Datadog 的 Max 帮助准备演讲，感谢 Zendesk 给予演讲机会。提到 Datadog 在 165 号展位。演讲在掌声中结束。