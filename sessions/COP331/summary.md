# AWS re:Invent 2025 数据库性能故障排查会议总结

## 会议概述

本次会议由AWS高级解决方案架构师Joel Yodo主讲,主题为"大规模数据库性能和问题故障排查"(COP 331)。会议通过虚拟角色Alex(一位SRE负责人)的实际工作场景,展示了如何使用AWS的数据库监控和可观测性工具来解决常见的数据库性能问题。

Joel介绍了在管理大规模数据库集群时面临的典型挑战:难以快速定位问题根源、缺乏应用程序上下文、需要使用多种不同的工具来监控不同类型的数据库(PostgreSQL、MySQL、MSSQL等)。为了解决这些痛点,会议重点演示了AWS Database Insights的功能,包括集群级监控、端到端事务分析、应用性能监控集成等能力,展示了如何在单一界面中完成从问题发现到根因分析的完整故障排查流程。

会议强调了现代数据库运维的核心理念:通过统一的可观测性平台,结合数据库性能指标和应用程序追踪数据,可以大幅缩短故障排查时间,快速区分问题是源于数据库层还是应用层,从而提高整体运维效率。

## 详细时间线

### 开场与问题背景 (00:00 - 02:30)
- **00:00** - 会议开始,Joel Yodo自我介绍,职位为专注于云运维的高级解决方案架构师
- **00:45** - 提出常见场景:团队反馈服务缓慢,怀疑是数据库问题,询问现场观众是否遇到类似情况
- **01:30** - 介绍会议议程:客户挑战、集群级可观测性、端到端事务分析、常见故障排查工作流
- **02:00** - 说明会议将在48小时内上传至YouTube

### 介绍虚拟角色Alex (02:30 - 04:00)
- **02:30** - 介绍虚拟角色Alex,Octane公司的SRE负责人
- **03:00** - 列举Alex面临的挑战:管理多种数据库类型、缺乏应用上下文、工具集过于庞杂
- **03:45** - 强调不同数据库引擎需要不同的专业知识和工具

### 场景一:零售服务性能问题 (04:00 - 07:30)
- **04:00** - 销售团队报告:零售服务运行缓慢
- **04:20** - 展示集群级监控功能:跨账户和区域的统一访问(最多3个区域)
- **05:00** - 演示蜂窝图(honeycomb)视图:红色表示高负载,白色表示低负载
- **05:30** - 展示告警、平均负载、最大负载等关键指标
- **06:00** - 演示事件查看功能:重启、故障、不同严重级别
- **06:30** - 展示应用集成:发现生产零售服务有45%的故障率
- **07:00** - 展示Top 10指标:CPU、内存、磁盘、网络IO等

### 场景二:查询负载分析 (07:30 - 10:30)
- **07:30** - 进入实例详细视图,查看时间跨度数据
- **08:00** - 展示每秒级别的性能数据和整体时间跨度视图
- **08:30** - 发现"SELECT  FROM orders"查询持续运行,占用大量资源
- *09:00** - 识别出是DBA实习生在运行该查询
- **09:30** - 确定查询来自两个主机位置
- **10:00** - 识别出使用的应用程序是DB操作工具
- **10:15** - 演示如何按主机、用户、应用程序等维度切分负载数据

### 场景三:锁分析 (10:30 - 13:00)
- **10:30** - 销售团队报告:无法运行报表
- **11:00** - 发现大量锁等待问题
- **11:20** - 展示锁分析功能和锁树(lock tree)
- **11:45** - 演示不同的锁场景:记录锁等常见情况
- **12:15** - 展示多种视图:等待视图、阻塞对象视图、阻塞会话视图
- **12:45** - 演示如何选择特定时间段,以15秒增量查看详细锁树

### 场景四:执行计划分析 (13:00 - 15:30)
- **13:00** - 销售团队报告:订单处理查询订单时出现问题
- **13:30** - 发现同一查询有两个不同的执行计划
- **14:00** - 切换到执行计划视图,对比两个计划的性能差异
- **14:30** - 发现一个计划平均活跃会话数为8.5,另一个不到0.1
- **15:00** - 识别出一个计划使用全表扫描,另一个使用索引扫描
- **15:15** - 发现问题出在不同的分区上(9月19日分区)

### 场景五:自定义指标仪表板 (15:30 - 17:00)
- **15:30** - 应用开发团队报告:开发数据库运行缓慢
- **16:00** - 展示自动生成的指标仪表板:每个数据库引擎有18个内置指标
- **16:20** - 演示如何搜索和添加自定义指标(如延迟指标)
- **16:40** - 创建新的小部件显示读写延迟
- **16:50** - 强调一次配置,全集群生效

### 场景六:慢查询分析 (17:00 - 18:30)
- **17:00** - 库存管理员报告:查看库存耗时过长
- **17:20** - 展示慢查询分析功能
- **17:40** - 查看查询模式和具体查询实例
- **18:00** - 展示查询执行次数、平均持续时间、50%分位、95%分位和最大值
- **18:20** - 帮助识别长时间运行的查询及其发生时间

### 场景七:端到端应用追踪 (18:30 - 22:00)
- **18:30** - 应用开发团队坚称:零售服务问题一定是数据库导致
- **19:00** - 展示调用服务(calling services)集成:显示零售服务故障率47%
- **19:30** - 跳转到Application Signals服务视图
- **20:00** - 展示服务级别操作:可用性、延迟等SLO指标
- **20:30** - 查看服务操作:Lambda函数中的计算
- **21:00** - 查看依赖关系:发现SELECT操作故障率高
- **21:20** - 查看故障的Span(跨度)数据
- **21:40** - 展示追踪映射:客户请求 → API Gateway → Lambda → 数据库
- **21:50** - 查看追踪时间线和具体的PostgreSQL查询
- **22:00** - 发现错误实际发生在Lambda函数第96行,而非数据库

### 故障排查工作流总结 (22:00 - 24:00)
- **22:00** - 总结通用故障排查工作流程
- **22:15** - 第一步:从集群视图识别数据库实例和负载
- **22:30** - 第二步:深入查看正在运行的查询
- **22:45** - 第三步:分析锁、执行计划或上游负载
- **23:00** - 第四步:查看关键指标(每秒块数、活跃执行数等)
- **23:30** - 第五步:如果启用了应用性能监控,查看端到端事务

### 资源与结束 (24:00 - 26:30)
- **24:00** - 展示QR码:真实场景案例和Database Insights文档
- **24:30** - 推荐AWS可观测性最佳实践GitHub页面
- **25:00** - 介绍AWS Village的CloudOps展位
- **25:30** - 提到Joel将在周三12-4点在AI Ops和可观测性展位
- **26:00** - 提醒填写会议调查问卷(COP 331)
- **26:15** - 推荐体验Datadog滑梯和参观展览
- **26:30** - 会议结束,Joel表示会后可以交流