1
00:00:00,118 --> 00:00:01,110
Morning everybody.

2
00:00:01,649 --> 00:00:02,189
Um,

3
00:00:02,490 --> 00:00:05,129
we are here at a session, Dev 320

4
00:00:05,129 --> 00:00:07,238
advanced feature flags, faster releases,

5
00:00:07,488 --> 00:00:08,509
and rapid recovery.

6
00:00:09,019 --> 00:00:10,710
So if that's what you thought you're gonna hear about,

7
00:00:11,009 --> 00:00:11,970
you're in the right place.

8
00:00:12,368 --> 00:00:14,448
My name is Steve Rice. I'm general manager

9
00:00:14,448 --> 00:00:16,089
for AWS app config.

10
00:00:16,359 --> 00:00:18,548
Um, also parameter store today we're gonna

11
00:00:18,548 --> 00:00:20,589
focus on feature flags and

12
00:00:20,589 --> 00:00:22,708
actually use app config as the code talk

13
00:00:22,708 --> 00:00:24,719
example. Um, so there are other

14
00:00:24,719 --> 00:00:26,949
solutions out there for feature flagging. I was quickly

15
00:00:26,949 --> 00:00:29,309
talking to some people. A lot of people are using a homegrown

16
00:00:29,309 --> 00:00:31,670
solution. We're gonna show you app config.

17
00:00:31,829 --> 00:00:34,189
Some of the concepts are available on other services

18
00:00:34,189 --> 00:00:35,810
or other offerings as well.

19
00:00:36,408 --> 00:00:37,939
Um, first I just wanna say

20
00:00:38,240 --> 00:00:40,478
we want this to be interactive. I think code talks

21
00:00:40,478 --> 00:00:42,709
are, they're one of my favorite types of sessions

22
00:00:43,000 --> 00:00:45,520
and it's way more fun when people are interactive.

23
00:00:45,798 --> 00:00:47,908
Um, so we do want questions along the way.

24
00:00:47,969 --> 00:00:50,039
I probably will cut us off

25
00:00:50,039 --> 00:00:52,109
at some point with the questions so we can keep moving

26
00:00:52,109 --> 00:00:53,880
forward. We do have a lot of content to cover.

27
00:00:54,228 --> 00:00:55,598
Ben's got to write a lot of code,

28
00:00:55,880 --> 00:00:57,880
um, and so please raise your

29
00:00:57,880 --> 00:01:00,079
hand. I have a microphone. I might just

30
00:01:00,079 --> 00:01:02,598
repeat your question so everybody can hear this, um,

31
00:01:02,759 --> 00:01:04,870
but first, just real quick, just how many people,

32
00:01:04,939 --> 00:01:06,239
this is your first reinvent.

33
00:01:07,379 --> 00:01:08,980
OK, wow, great. Welcome.

34
00:01:09,338 --> 00:01:10,799
Hope you're having a great time. Hope you're

35
00:01:11,180 --> 00:01:13,219
getting in a lot of steps. I'm sure you are. How many

36
00:01:13,219 --> 00:01:14,338
have been did 2 reinvents?

37
00:01:15,439 --> 00:01:16,739
OK, 3.

38
00:01:18,799 --> 00:01:19,500
4

39
00:01:21,150 --> 00:01:21,790
5.

40
00:01:23,168 --> 00:01:23,948
6.

41
00:01:24,579 --> 00:01:25,808
Anybody 6 or more?

42
00:01:26,088 --> 00:01:27,769
67?

43
00:01:29,120 --> 00:01:30,778
Wow, 8,

44
00:01:31,709 --> 00:01:32,838
dang, 9.

45
00:01:34,099 --> 00:01:35,769
OK, 8, you're the record. OK, cool.

46
00:01:36,069 --> 00:01:37,250
I have swag

47
00:01:37,510 --> 00:01:39,709
that I'm going to give to you outside of

48
00:01:39,709 --> 00:01:40,549
the session,

49
00:01:40,829 --> 00:01:42,870
so I'm gonna give you, I, I didn't see who it was. Find me and

50
00:01:42,870 --> 00:01:44,870
I have a jacket for you. Um, I have some

51
00:01:44,870 --> 00:01:47,609
swag that is an incentive for participation.

52
00:01:47,859 --> 00:01:49,329
Um, I'll give it out at the end outside.

53
00:01:49,769 --> 00:01:51,849
Uh, great. So again, my name is Steve Rice.

54
00:01:52,120 --> 00:01:54,168
Um, I've been using Future Flags for a very

55
00:01:54,168 --> 00:01:56,168
long time, really excited to talk about Future

56
00:01:56,168 --> 00:01:57,790
Flags. I feel like they're the secret weapon

57
00:01:58,088 --> 00:02:00,290
of moving fast when you're developing

58
00:02:00,290 --> 00:02:02,528
software as well as responding to

59
00:02:02,528 --> 00:02:03,528
issues on production,

60
00:02:03,849 --> 00:02:05,959
flipping flags as operational flags

61
00:02:05,959 --> 00:02:08,308
to, uh, address an issue that's out there. So

62
00:02:08,419 --> 00:02:10,569
I'm gonna be, I'm joined by Ben. You wanna introduce

63
00:02:10,569 --> 00:02:12,770
yourself, please? Hey everyone, my name's Ben. I am a

64
00:02:12,770 --> 00:02:15,270
senior software development engineer at AWS

65
00:02:15,270 --> 00:02:17,368
and I work primarily on the AWS

66
00:02:17,368 --> 00:02:18,308
app config team.

67
00:02:18,618 --> 00:02:20,778
Great. Great. So, uh, in

68
00:02:20,778 --> 00:02:22,860
terms of where you are on your future flagging

69
00:02:22,860 --> 00:02:24,899
journey, I'm gonna ask how many people

70
00:02:24,899 --> 00:02:26,599
are using a homegrown solution?

71
00:02:27,360 --> 00:02:28,800
For feature flagging, OK,

72
00:02:29,429 --> 00:02:31,639
actually I should really ask how many people are not using feature

73
00:02:31,639 --> 00:02:34,058
flags at all yet? OK, a couple of people, yep,

74
00:02:34,479 --> 00:02:35,099
um,

75
00:02:35,558 --> 00:02:37,800
that's totally fine. Uh, homegrown

76
00:02:37,800 --> 00:02:40,080
usually is a lot of hands, um,

77
00:02:40,360 --> 00:02:42,508
and, and again I've worked at many companies we've

78
00:02:42,508 --> 00:02:44,599
started with a homegrown solution. What often

79
00:02:44,599 --> 00:02:45,520
happens is,

80
00:02:45,800 --> 00:02:48,399
uh, you realize that hey, there's some new capabilities

81
00:02:48,399 --> 00:02:50,439
that we need beyond just having a database or an

82
00:02:50,439 --> 00:02:52,699
S3 bucket to flip on and off things

83
00:02:52,960 --> 00:02:54,020
and should we,

84
00:02:54,278 --> 00:02:55,679
you know, move off of our homegrown.

85
00:02:56,038 --> 00:02:58,080
Uh, should we develop those features in-house,

86
00:02:58,099 --> 00:03:00,300
and you know that's a decision that you all have to make,

87
00:03:00,679 --> 00:03:02,788
um, but AC config is obviously a third party

88
00:03:02,788 --> 00:03:04,960
solution, but we're well integrated into AWS

89
00:03:04,960 --> 00:03:07,118
and have integrations with a lot of computes.

90
00:03:07,319 --> 00:03:09,439
So, um, so in order to sort of

91
00:03:09,439 --> 00:03:11,479
set the table for today we're gonna role

92
00:03:11,479 --> 00:03:12,460
play a little with me.

93
00:03:12,800 --> 00:03:14,919
Um, I'm gonna pretend that I'm a business owner

94
00:03:14,919 --> 00:03:17,038
and Ben is an engineer and he's gonna

95
00:03:17,038 --> 00:03:18,110
use feature flags.

96
00:03:18,399 --> 00:03:20,599
So the, uh, situation I'm trying to create

97
00:03:20,599 --> 00:03:22,659
here is I own a coffee shop.

98
00:03:23,419 --> 00:03:25,288
Um, it's called Lambda Latte,

99
00:03:25,580 --> 00:03:27,699
uh, which is maybe I don't know about AWS,

100
00:03:27,740 --> 00:03:30,020
but I'm a business owner. I don't know much about

101
00:03:30,020 --> 00:03:32,250
technology. Um, Ben is my brother-in-law,

102
00:03:32,258 --> 00:03:34,300
and I heard he's a good coder, so I asked him, Will you

103
00:03:34,300 --> 00:03:36,300
please make an app, and I really need this app for

104
00:03:36,300 --> 00:03:37,080
my business.

105
00:03:37,338 --> 00:03:39,338
Um, I'm really good at making coffee. I'm

106
00:03:39,338 --> 00:03:40,528
not great at technology,

107
00:03:40,819 --> 00:03:43,014
so I'm not gonna be. Like a solid business owner

108
00:03:43,014 --> 00:03:45,175
that's gonna understand the requirements process.

109
00:03:45,254 --> 00:03:47,375
I'm gonna change my mind a lot and to be honest,

110
00:03:47,455 --> 00:03:49,574
feature flags are a really good solution for some of these

111
00:03:49,574 --> 00:03:51,115
things. So, um,

112
00:03:51,463 --> 00:03:53,814
uh, Ben and I had prepared a little bit of a, uh,

113
00:03:53,854 --> 00:03:56,014
you know, preceded demo here of a

114
00:03:56,014 --> 00:03:57,064
coffee app,

115
00:03:57,493 --> 00:03:59,534
coffee shop app from a place called Lambda

116
00:03:59,534 --> 00:04:00,913
Latte. Great

117
00:04:01,933 --> 00:04:04,094
Ben actually if you wanna sort of explain the, the background

118
00:04:04,094 --> 00:04:06,175
here, go ahead, yeah, absolutely. I'll walk us through

119
00:04:06,175 --> 00:04:08,274
that application now. So as Steve mentioned.

120
00:04:09,250 --> 00:04:11,449
We're going to be using this Lambda Latte

121
00:04:11,449 --> 00:04:14,008
application as our base for our feature flag demos

122
00:04:14,008 --> 00:04:16,048
today. So the purpose of this

123
00:04:16,048 --> 00:04:18,048
application is for customers of

124
00:04:18,048 --> 00:04:20,170
the Lambda Latte Coffee Shop to

125
00:04:20,170 --> 00:04:22,250
download the app and see some information about the coffee shop,

126
00:04:22,369 --> 00:04:23,910
place orders, things of that nature.

127
00:04:25,108 --> 00:04:27,139
Give you a quick walk through the app since we're

128
00:04:27,139 --> 00:04:29,189
gonna be spending a decent amount of time on this today.

129
00:04:29,269 --> 00:04:31,350
I just wanna give a quick overview to make sure

130
00:04:31,350 --> 00:04:32,250
that we all

131
00:04:32,660 --> 00:04:34,790
understand what the, the, the context

132
00:04:34,790 --> 00:04:35,850
around these demos is.

133
00:04:36,358 --> 00:04:38,790
So I'm looking at the Lambda the Lambda latte

134
00:04:38,790 --> 00:04:40,889
app. We can see it has 3 tabs.

135
00:04:41,670 --> 00:04:43,670
On the home tab, I can see some

136
00:04:43,670 --> 00:04:45,608
information about the coffee shop, how many orders are in flight,

137
00:04:46,028 --> 00:04:48,028
uh, you know, maybe I'm rushing to the office and I want to see

138
00:04:48,028 --> 00:04:49,850
if there's a long line or not, then I could look here.

139
00:04:50,238 --> 00:04:52,559
Uh, we've got today's featured roaster, we have equipment

140
00:04:52,559 --> 00:04:53,160
status.

141
00:04:53,528 --> 00:04:55,759
No one likes showing up at the coffee shop and all the espresso

142
00:04:55,759 --> 00:04:57,389
machines are downright, so you can check that here.

143
00:04:58,139 --> 00:05:00,410
And then, of course, we have the stock of the various

144
00:05:00,410 --> 00:05:02,689
types of milk that the shop has

145
00:05:02,689 --> 00:05:04,829
left. We also have a couple of other

146
00:05:04,829 --> 00:05:06,949
tabs I'll show quickly. We have a my rewards tab

147
00:05:06,949 --> 00:05:09,230
which shows you the rewards that you currently

148
00:05:09,230 --> 00:05:11,428
have, and then finally we have an order tab,

149
00:05:11,470 --> 00:05:14,420
which is basically the full menu and the ability to

150
00:05:14,420 --> 00:05:15,009
place an order.

151
00:05:16,220 --> 00:05:18,778
And there's one more thing you'll notice about this demo

152
00:05:18,778 --> 00:05:20,829
application is that there's a selection at the top for

153
00:05:20,829 --> 00:05:22,088
the customer profile.

154
00:05:22,709 --> 00:05:23,910
So since this is a demo,

155
00:05:24,189 --> 00:05:26,689
uh, this app lets us view

156
00:05:26,689 --> 00:05:27,509
the.

157
00:05:27,829 --> 00:05:29,910
The app through the lens of different users.

158
00:05:29,988 --> 00:05:32,149
So right now we're looking at the app through the lens of Elena,

159
00:05:32,189 --> 00:05:33,230
who is our default

160
00:05:33,819 --> 00:05:36,069
user. We also have two other customer

161
00:05:36,069 --> 00:05:38,290
profiles that we'll be clicking on. So we have Marcus

162
00:05:38,509 --> 00:05:39,608
and Jasper,

163
00:05:39,920 --> 00:05:42,108
and these two users have a

164
00:05:42,108 --> 00:05:44,189
loyalty status associated with them, gold

165
00:05:44,189 --> 00:05:44,850
and platinum,

166
00:05:45,189 --> 00:05:47,230
and that will come into play in a later

167
00:05:47,230 --> 00:05:48,709
demo. So just for now

168
00:05:49,108 --> 00:05:51,350
realize this is a way that we can quickly just switch

169
00:05:51,350 --> 00:05:53,350
between different users of the application. For

170
00:05:53,350 --> 00:05:54,850
now there's no difference between.

171
00:05:55,250 --> 00:05:57,329
Any of these three views, but that will

172
00:05:57,329 --> 00:06:00,899
change. OK,

173
00:06:01,230 --> 00:06:02,850
that's the Landa Latte application

174
00:06:03,519 --> 00:06:05,449
from the customer's point of view.

175
00:06:05,949 --> 00:06:07,988
However, since this is a code talk, I want to

176
00:06:07,988 --> 00:06:10,750
spend some time upfront talking about the actual architecture

177
00:06:10,750 --> 00:06:12,988
behind this application and how it's set up, and

178
00:06:12,988 --> 00:06:14,988
where the code is that we're gonna be modifying later in the

179
00:06:14,988 --> 00:06:17,369
talk. So in order to do that,

180
00:06:17,750 --> 00:06:19,519
I'm gonna switch over to Quiro,

181
00:06:20,149 --> 00:06:22,269
and I've got some steering docs

182
00:06:22,269 --> 00:06:24,629
set up, one of which is architecture. MD

183
00:06:24,629 --> 00:06:26,699
which outlines the architecture of the

184
00:06:26,699 --> 00:06:28,970
application. Render the preview

185
00:06:28,970 --> 00:06:30,790
of that so we can take a look.

186
00:06:33,238 --> 00:06:34,009
So here's my setup.

187
00:06:34,290 --> 00:06:36,608
I have the lambda latte at the top, the

188
00:06:36,608 --> 00:06:38,470
lambda latte front-end web application,

189
00:06:39,129 --> 00:06:40,528
which is hosted at Sun Domain.

190
00:06:40,850 --> 00:06:42,970
This is making requests to my back end, which

191
00:06:42,970 --> 00:06:45,040
is really just an AWS lambda

192
00:06:45,040 --> 00:06:47,069
function. And the

193
00:06:47,069 --> 00:06:49,269
purpose of this lambda function is to

194
00:06:49,269 --> 00:06:51,309
effectively just get feature flag

195
00:06:51,309 --> 00:06:53,189
values from app config.

196
00:06:54,108 --> 00:06:56,389
Now in order to get those feature flag values

197
00:06:56,389 --> 00:06:58,009
from app config, it's actually using

198
00:06:58,470 --> 00:06:59,829
the app config agent,

199
00:07:00,170 --> 00:07:02,290
which is a sidecar process that

200
00:07:02,329 --> 00:07:04,170
that we, the app config team vend

201
00:07:04,459 --> 00:07:06,809
to simplify your integration with app config.

202
00:07:07,069 --> 00:07:09,079
Uh, it has some built-in resiliency features

203
00:07:09,079 --> 00:07:11,108
so that your flags are highly available even if

204
00:07:11,108 --> 00:07:13,048
you're having networking issues, etc.

205
00:07:13,858 --> 00:07:14,480
Um,

206
00:07:14,778 --> 00:07:16,939
in the lambda context, this is mended as a layer

207
00:07:16,939 --> 00:07:18,798
or an extension, that's why it says layer there.

208
00:07:19,178 --> 00:07:21,319
And then of course this agent or layer is talking

209
00:07:21,319 --> 00:07:23,459
to the AWS app config

210
00:07:23,459 --> 00:07:24,619
service directly.

211
00:07:25,428 --> 00:07:27,678
So this is the setup architecture for the

212
00:07:27,678 --> 00:07:28,459
application. It's

213
00:07:28,920 --> 00:07:30,920
fairly straightforward. Does anyone have any

214
00:07:30,920 --> 00:07:33,238
questions about how this is set up? Does this generally

215
00:07:33,238 --> 00:07:33,899
make sense?

216
00:07:34,358 --> 00:07:35,230
Lambda function backend,

217
00:07:36,119 --> 00:07:37,009
front end web app,

218
00:07:37,358 --> 00:07:39,298
OK. Um,

219
00:07:39,738 --> 00:07:42,079
now, since this is a live demo,

220
00:07:42,778 --> 00:07:44,899
uh, you can see here this, this

221
00:07:44,899 --> 00:07:46,858
diagram is titled Production Environment.

222
00:07:48,019 --> 00:07:50,298
Since this is a live demo, I don't wanna spend time

223
00:07:50,298 --> 00:07:52,488
every time I update my code redeploying a lambda

224
00:07:52,488 --> 00:07:54,899
function, etc. So I have a local development

225
00:07:54,899 --> 00:07:57,040
environment set up that will let me change code

226
00:07:57,178 --> 00:07:59,220
and affect those changes instantly instead of waiting for

227
00:07:59,220 --> 00:07:59,980
deployments.

228
00:08:00,540 --> 00:08:02,660
That setup is here. It's very similar to

229
00:08:02,660 --> 00:08:04,809
the production setup that we just looked at. The

230
00:08:04,809 --> 00:08:06,970
differences are that everything is running

231
00:08:06,970 --> 00:08:09,369
locally, so the Lambda latte app I have running locally,

232
00:08:09,619 --> 00:08:11,660
I have a local HTP test

233
00:08:11,660 --> 00:08:13,910
server that just directly invokes my, my lambda

234
00:08:13,910 --> 00:08:14,559
logic,

235
00:08:15,259 --> 00:08:16,420
my lambda back in logic.

236
00:08:16,730 --> 00:08:18,470
I have the app config agent running locally,

237
00:08:18,730 --> 00:08:20,809
and then we have the app config service. Now do

238
00:08:20,809 --> 00:08:22,928
note the the app config service here, I'm not running that

239
00:08:22,928 --> 00:08:24,928
locally. This is the real production app

240
00:08:24,928 --> 00:08:25,670
config service.

241
00:08:28,119 --> 00:08:30,160
OK. Any questions about architecture before I

242
00:08:30,160 --> 00:08:31,629
move on to looking at the code?

243
00:08:34,158 --> 00:08:36,200
Great. Ben, I have a question. Yeah,

244
00:08:36,500 --> 00:08:38,558
you're showing lambda. Does this future flags

245
00:08:38,558 --> 00:08:39,918
work in things beyond lambda?

246
00:08:40,279 --> 00:08:40,859
Great question.

247
00:08:41,308 --> 00:08:41,820
Uh,

248
00:08:42,119 --> 00:08:43,538
yes, app config works

249
00:08:44,519 --> 00:08:46,519
anywhere. Uh, we have, so I mentioned

250
00:08:46,519 --> 00:08:47,500
the app config agent.

251
00:08:48,029 --> 00:08:50,200
We vend the, we vend this agent

252
00:08:50,200 --> 00:08:51,750
in lambda as a layer.

253
00:08:52,029 --> 00:08:54,200
However, we also vend the agent as a container

254
00:08:54,200 --> 00:08:56,279
image, so you can use it in places like ECS,

255
00:08:56,769 --> 00:08:59,038
uh, EKS, or your own Kubernetes cluster

256
00:08:59,038 --> 00:09:01,239
or just Docker running on your, on your, uh,

257
00:09:01,308 --> 00:09:01,940
laptop.

258
00:09:02,320 --> 00:09:04,590
We also vend the agent as an

259
00:09:04,590 --> 00:09:06,629
RPM so you can download it on EC2

260
00:09:06,629 --> 00:09:08,190
instances or on-prem instances.

261
00:09:10,629 --> 00:09:12,658
OK, let's take a look at the code.

262
00:09:13,239 --> 00:09:15,639
So as the diagram mentioned, we have this

263
00:09:15,639 --> 00:09:17,678
app config.pi. I'm gonna make

264
00:09:17,678 --> 00:09:18,899
sure this is large enough.

265
00:09:19,950 --> 00:09:20,570
Um

266
00:09:21,869 --> 00:09:24,229
App config.pi file, which is our lambda

267
00:09:24,229 --> 00:09:25,908
function, uh, logic.

268
00:09:26,269 --> 00:09:28,269
So you can see we have this top level function lambda handler

269
00:09:28,269 --> 00:09:30,519
takes an event and context. If you're familiar

270
00:09:30,519 --> 00:09:32,590
with lambda functions, these are the two inputs that all

271
00:09:32,590 --> 00:09:33,570
lambda functions take.

272
00:09:34,719 --> 00:09:36,460
And in this case, we have a

273
00:09:36,879 --> 00:09:38,960
request structure that looks like

274
00:09:38,960 --> 00:09:41,279
this that we see online 17 through 22.

275
00:09:42,029 --> 00:09:44,229
I'm basically providing a dictionary

276
00:09:44,229 --> 00:09:46,298
called flags, and within that dictionary, I'm

277
00:09:46,298 --> 00:09:48,308
including the keys of the flags that I would like the

278
00:09:48,308 --> 00:09:49,330
function to retrieve.

279
00:09:49,908 --> 00:09:52,099
Now you'll notice that these keys are also pointing to

280
00:09:52,099 --> 00:09:53,288
empty dictionaries in this case.

281
00:09:53,869 --> 00:09:55,940
Um, we're ignoring those for now, they'll come into play

282
00:09:55,940 --> 00:09:58,129
later. The response

283
00:09:58,129 --> 00:09:58,750
structure

284
00:09:59,408 --> 00:10:01,389
has a flags dictionary as well,

285
00:10:01,759 --> 00:10:03,928
and then for the provided keys, it will

286
00:10:03,928 --> 00:10:05,928
populate the feature flag value

287
00:10:05,928 --> 00:10:08,070
that came from that was returned by

288
00:10:08,070 --> 00:10:09,428
the app config service.

289
00:10:09,690 --> 00:10:11,840
So in this case, the piece that's highlighted on the screen now, this

290
00:10:11,840 --> 00:10:13,889
is what the app config service said the the

291
00:10:13,889 --> 00:10:15,769
flag value was for flag one.

292
00:10:16,668 --> 00:10:18,879
We also have another top level field called errors, so if

293
00:10:18,879 --> 00:10:20,960
anything goes wrong with retrieving one or more of your

294
00:10:20,960 --> 00:10:23,129
flags, then you'll see those keys appear in this section,

295
00:10:23,399 --> 00:10:25,639
and there'll be some reasoning as to why those flags

296
00:10:25,639 --> 00:10:27,200
could not be retrieved, in this case,

297
00:10:27,479 --> 00:10:29,548
not found. OK,

298
00:10:29,750 --> 00:10:31,408
so I'm gonna just quickly give an overview.

299
00:10:32,408 --> 00:10:34,538
Of how this code is set up. We have some setup code that's reading

300
00:10:34,538 --> 00:10:36,729
some environment variables, parsing the event

301
00:10:36,729 --> 00:10:38,928
data. The main logic is here, where I'm

302
00:10:38,928 --> 00:10:41,009
going through each of the flag keys and the

303
00:10:41,009 --> 00:10:43,168
requests, and I'm getting that flag from the app

304
00:10:43,168 --> 00:10:43,769
config agent.

305
00:10:45,178 --> 00:10:47,330
Finally, I'm building my response, handling errors, and

306
00:10:47,330 --> 00:10:49,330
returning. As far as the get flag from

307
00:10:49,330 --> 00:10:51,330
agent code, this is making again

308
00:10:51,330 --> 00:10:53,369
a local host HTTP request.

309
00:10:53,658 --> 00:10:55,849
This is the same in the dev environment and in the prod environment.

310
00:10:56,048 --> 00:10:58,048
The request looks exactly like this to the app config

311
00:10:58,048 --> 00:10:59,500
agent, and I'm

312
00:10:59,808 --> 00:11:01,859
asking the agent for that particular flag

313
00:11:02,000 --> 00:11:04,070
and doing some error handling.

314
00:11:05,239 --> 00:11:05,750
OK,

315
00:11:06,129 --> 00:11:08,168
that's the overview of our back end

316
00:11:08,168 --> 00:11:10,009
code. This is the

317
00:11:10,440 --> 00:11:12,690
primary file that we're gonna be modifying throughout our

318
00:11:12,690 --> 00:11:14,750
demos in this session, so I want to make sure

319
00:11:15,129 --> 00:11:17,168
we have a high level overview, overview first before

320
00:11:17,168 --> 00:11:18,729
we dive into the changes.

321
00:11:19,830 --> 00:11:21,840
OK, the last thing I want to show, I mentioned that

322
00:11:21,840 --> 00:11:23,918
we're using the production app config service

323
00:11:23,918 --> 00:11:24,619
for these demos.

324
00:11:26,178 --> 00:11:28,489
So I'll come back to my browser and move the lambda latte

325
00:11:28,489 --> 00:11:29,428
app to the side,

326
00:11:29,859 --> 00:11:32,320
pull up the app config console,

327
00:11:33,619 --> 00:11:35,658
and in the app config console, I

328
00:11:35,658 --> 00:11:37,859
am looking at a feature flag configuration

329
00:11:37,859 --> 00:11:39,279
called lambda latte,

330
00:11:39,649 --> 00:11:41,649
and this configuration currently

331
00:11:41,649 --> 00:11:43,859
has 3 feature flags in it, which we're going to use at various

332
00:11:43,859 --> 00:11:45,700
points through our demos.

333
00:11:47,099 --> 00:11:49,279
And with that, that's an overview of the

334
00:11:49,700 --> 00:11:50,918
uh Lambda latte application,

335
00:11:51,178 --> 00:11:53,219
it's architecture, how it works, how it integrates

336
00:11:53,219 --> 00:11:54,399
with the app config service.

337
00:11:54,859 --> 00:11:57,139
So that's gonna lay the baseline for the demos

338
00:11:57,139 --> 00:11:59,119
that we're gonna be talking about during the session today.

339
00:12:00,519 --> 00:12:02,879
Any questions about how this is set up or what the

340
00:12:02,879 --> 00:12:04,928
application's purpose is or its architecture

341
00:12:04,928 --> 00:12:05,710
or anything like that?

342
00:12:09,048 --> 00:12:11,619
OK. And

343
00:12:11,619 --> 00:12:13,700
to the technical people in the room you explained

344
00:12:13,700 --> 00:12:15,840
it really well, but I'm, I'm a business owner

345
00:12:16,139 --> 00:12:18,298
and I got this coffee that I need to sell

346
00:12:18,739 --> 00:12:20,779
and uh what I

347
00:12:20,779 --> 00:12:22,940
have learned from my customers is

348
00:12:22,940 --> 00:12:24,798
around December they love to have

349
00:12:25,139 --> 00:12:26,359
a peppermint spice.

350
00:12:27,389 --> 00:12:29,469
Type of coffee like the peppermint spice latte

351
00:12:29,469 --> 00:12:31,129
is like a really hot seller

352
00:12:31,428 --> 00:12:32,960
and people talk about it and

353
00:12:33,269 --> 00:12:35,269
what I'd really love to have, I don't know how it'll work, but

354
00:12:35,269 --> 00:12:37,210
I'd like to have the app updated

355
00:12:37,469 --> 00:12:39,658
and I think I wanna have some texts about a peppermint

356
00:12:39,658 --> 00:12:42,129
spice update, but like I wanna promote

357
00:12:42,129 --> 00:12:44,190
this, uh, this drink in

358
00:12:44,190 --> 00:12:46,340
my app. So can you just make that happen? Yes,

359
00:12:46,428 --> 00:12:47,379
I can just make that happen. All right,

360
00:12:48,009 --> 00:12:50,129
great. OK, so let's talk about this

361
00:12:50,190 --> 00:12:52,269
first use case where we want to promote, promote

362
00:12:52,269 --> 00:12:53,349
a product on our website.

363
00:12:53,808 --> 00:12:55,950
In this case it's the Lambda latte app and we wanna promote

364
00:12:55,950 --> 00:12:57,609
the peppermint, uh,

365
00:12:57,918 --> 00:12:59,969
I think it's called Peppermint candy cane latte that

366
00:12:59,969 --> 00:13:02,149
we're, that we're, that we're that we're promoting here.

367
00:13:03,509 --> 00:13:04,639
OK, so to do this,

368
00:13:04,960 --> 00:13:06,619
this is really meant to be a like

369
00:13:06,960 --> 00:13:09,000
baseline just feature flags one on one type demo.

370
00:13:09,080 --> 00:13:11,239
So I already have the code that's required

371
00:13:11,239 --> 00:13:12,119
in the front end,

372
00:13:12,440 --> 00:13:14,590
uh, the front end web application and the back

373
00:13:14,590 --> 00:13:16,719
end lambda function that's required to, to do this

374
00:13:16,719 --> 00:13:18,719
simple flag retrieval and rendering this

375
00:13:18,719 --> 00:13:20,840
simple banner experience. So we're not actually gonna dive into

376
00:13:20,840 --> 00:13:21,599
the code for that

377
00:13:21,989 --> 00:13:24,080
for the sake of time. Again, this is just meant to be

378
00:13:24,080 --> 00:13:26,298
very simple feature flags one on one demo

379
00:13:26,298 --> 00:13:27,000
off the bat here.

380
00:13:28,580 --> 00:13:30,658
So, I can see in my feature flag config,

381
00:13:30,700 --> 00:13:33,000
I have this one flag called

382
00:13:33,000 --> 00:13:33,700
featured item.

383
00:13:34,509 --> 00:13:35,830
And this featured item flag,

384
00:13:36,109 --> 00:13:37,418
if I scroll down,

385
00:13:37,710 --> 00:13:39,940
here's the toggle button for my flag.

386
00:13:39,950 --> 00:13:40,849
It's currently off.

387
00:13:42,190 --> 00:13:44,190
We're gonna turn that on. You'll also notice this

388
00:13:44,190 --> 00:13:45,918
section called attribute values.

389
00:13:46,349 --> 00:13:48,469
So app config feature flags are more than

390
00:13:48,469 --> 00:13:50,509
just an on-off switch. It can just

391
00:13:50,509 --> 00:13:53,129
be an on-off switch, but we also provide this

392
00:13:53,229 --> 00:13:54,989
functionality called attributes,

393
00:13:55,389 --> 00:13:58,058
which is effectively just arbitrary, uh,

394
00:13:58,070 --> 00:14:00,269
metadata that you attach to a feature flag.

395
00:14:00,590 --> 00:14:02,570
And it, it's really powerful because it can

396
00:14:02,840 --> 00:14:04,950
drive, you can use those attributes to actually

397
00:14:04,950 --> 00:14:06,969
drive the behavior of your

398
00:14:06,969 --> 00:14:09,109
application. And so in this case,

399
00:14:09,119 --> 00:14:11,190
we have 3 attributes that are defined. We have a description, a

400
00:14:11,190 --> 00:14:12,369
name, and a price.

401
00:14:12,830 --> 00:14:15,029
And these values that are that are set

402
00:14:15,029 --> 00:14:17,489
in this feature flag are actually going to be used

403
00:14:17,489 --> 00:14:19,808
by the front-end web application to render

404
00:14:19,808 --> 00:14:20,570
the experience.

405
00:14:21,690 --> 00:14:24,009
So the turning this flag on will

406
00:14:24,009 --> 00:14:26,210
turn the banner on, and then the value of these attribute

407
00:14:26,210 --> 00:14:28,450
values determines the content of that banner.

408
00:14:29,729 --> 00:14:31,769
OK, so I've turned this flag on. What I

409
00:14:31,769 --> 00:14:32,558
need to do now.

410
00:14:33,469 --> 00:14:35,649
Is save my changes and deploy it.

411
00:14:36,200 --> 00:14:38,710
So an app config, every time you make a change, every

412
00:14:38,710 --> 00:14:40,389
config change, feature flags included,

413
00:14:40,820 --> 00:14:41,678
are versioned.

414
00:14:42,149 --> 00:14:44,190
And so when I save a new version of my config, I

415
00:14:44,190 --> 00:14:46,269
need to go deploy that new version, which is what I'm doing

416
00:14:46,269 --> 00:14:48,288
now. Since this is a demo,

417
00:14:48,369 --> 00:14:50,658
I'm gonna do what we call an instant deployment.

418
00:14:51,210 --> 00:14:53,369
We don't recommend instant deployments in any production use

419
00:14:53,369 --> 00:14:55,570
case. We'll talk more about, uh, we call this deployment

420
00:14:55,570 --> 00:14:57,428
safety. We'll talk about this a little bit more later,

421
00:14:58,090 --> 00:15:00,239
but since this is a demo, I'm gonna go ahead and do an instant

422
00:15:00,239 --> 00:15:00,908
deployment.

423
00:15:01,450 --> 00:15:03,570
Now, I will say when I click the start deployment button,

424
00:15:03,729 --> 00:15:05,808
the console, the app config console on the left-hand side

425
00:15:05,808 --> 00:15:07,808
is gonna render a new screen that's gonna look really exciting

426
00:15:07,808 --> 00:15:09,889
and you're gonna wanna see what that screen is doing.

427
00:15:10,009 --> 00:15:12,009
Don't look at that screen after I click this button. Look at

428
00:15:12,009 --> 00:15:14,009
the right-hand side. Look at the Lambda Latte app because

429
00:15:14,009 --> 00:15:15,989
that's where the, the banner is going to be appearing.

430
00:15:16,450 --> 00:15:18,489
So let's start this deployment and keep our eyes on

431
00:15:18,489 --> 00:15:19,668
the Lambda latte app,

432
00:15:20,168 --> 00:15:22,450
and there we go. Our featured item banner

433
00:15:22,450 --> 00:15:23,899
is now displayed.

434
00:15:24,210 --> 00:15:26,489
I didn't make any code changes, I didn't redeploy

435
00:15:26,489 --> 00:15:28,609
my back end, I didn't redeploy my front end. I just

436
00:15:28,609 --> 00:15:30,469
made a change in the app config console.

437
00:15:33,009 --> 00:15:34,710
I will also to highlight.

438
00:15:36,710 --> 00:15:38,269
The power of attributes.

439
00:15:39,009 --> 00:15:41,139
If I change this, I don't know, peppermint

440
00:15:41,139 --> 00:15:42,288
candy cane latte 2,

441
00:15:42,739 --> 00:15:44,500
and I save this and update it

442
00:15:44,859 --> 00:15:45,769
and deploy it.

443
00:15:51,279 --> 00:15:53,019
Then we should see the content update.

444
00:15:54,340 --> 00:15:56,849
There we go. OK.

445
00:15:57,580 --> 00:15:59,719
Steve, what do you think about that uh promotion?

446
00:16:00,178 --> 00:16:02,219
I love it. That's, that's exactly what I'm

447
00:16:02,219 --> 00:16:04,219
looking for. Can I make it go away

448
00:16:04,219 --> 00:16:05,080
after Christmas?

449
00:16:05,658 --> 00:16:06,879
Absolutely, uh cool,

450
00:16:07,190 --> 00:16:09,190
um, sorry for the corniness of the simulation

451
00:16:09,190 --> 00:16:11,190
we actually didn't practice this, uh, as

452
00:16:11,190 --> 00:16:13,308
much, so, um, OK, great, but

453
00:16:13,308 --> 00:16:15,399
my next request as a business owner

454
00:16:15,558 --> 00:16:17,918
is I do have this, uh, loyalty

455
00:16:17,918 --> 00:16:20,369
concept but really today it doesn't really

456
00:16:20,538 --> 00:16:22,710
land and I've heard that if I reward my best

457
00:16:22,710 --> 00:16:24,989
customers in certain ways and I can tailor

458
00:16:24,989 --> 00:16:25,918
those rewards

459
00:16:26,190 --> 00:16:28,250
that they'll actually spend more money

460
00:16:28,500 --> 00:16:30,548
um so is there a way that I can sort of look

461
00:16:30,548 --> 00:16:32,668
at different layers and maybe different give a different

462
00:16:32,668 --> 00:16:34,849
kind of flag to each type of user?

463
00:16:35,369 --> 00:16:36,359
Yes, absolutely.

464
00:16:37,428 --> 00:16:39,548
OK, so for this

465
00:16:39,548 --> 00:16:41,369
featured item banner

466
00:16:41,700 --> 00:16:43,879
demonstration that we just did, it's important to note

467
00:16:43,879 --> 00:16:44,538
that

468
00:16:45,029 --> 00:16:47,229
this is a, this experience that we just rendered

469
00:16:47,229 --> 00:16:49,269
is the, it's the same for everyone, right? So I'm viewing the

470
00:16:49,269 --> 00:16:50,859
app as Elena now and I see the banner.

471
00:16:51,269 --> 00:16:53,090
I view the app as Marcus, I see the same banner,

472
00:16:53,538 --> 00:16:56,509
view the app as Jasper, and I see the same banner. There's no differentiation

473
00:16:56,509 --> 00:16:58,750
between the different users and the experience

474
00:16:58,750 --> 00:16:59,450
that they're seeing.

475
00:17:00,489 --> 00:17:02,538
And so the ask now from the business owner

476
00:17:02,538 --> 00:17:04,660
is, OK, well, I wanna do something a little bit more

477
00:17:04,660 --> 00:17:05,880
sophisticated than that.

478
00:17:06,180 --> 00:17:08,338
I want to render different

479
00:17:08,338 --> 00:17:10,459
experiences for different types of customers

480
00:17:10,459 --> 00:17:12,680
or segments of customers that we, we call them.

481
00:17:13,219 --> 00:17:15,400
And in this case, the segmentation is based

482
00:17:15,400 --> 00:17:17,779
on the user's loyalty status

483
00:17:17,979 --> 00:17:19,979
and based on their loyalty status, what we wanna do

484
00:17:19,979 --> 00:17:22,259
is render different sets of

485
00:17:22,259 --> 00:17:24,338
rewards depending on loyalty

486
00:17:24,338 --> 00:17:24,858
status.

487
00:17:26,130 --> 00:17:28,199
So if I click the my rewards tab right now,

488
00:17:28,250 --> 00:17:30,328
I'll see currently I'm Jasper, who's a platinum loyalty

489
00:17:30,328 --> 00:17:32,328
member. I just have a single reward here. It's a free

490
00:17:32,328 --> 00:17:35,769
espresso. It's, it's code R-001.

491
00:17:35,930 --> 00:17:36,489
OK,

492
00:17:36,930 --> 00:17:39,229
if I go to, if I switch over to Marcus,

493
00:17:39,680 --> 00:17:42,108
he's a gold member, well, I, I see the same thing,

494
00:17:42,529 --> 00:17:44,578
and of course, Elena, as you may

495
00:17:44,578 --> 00:17:46,410
suspect, the exact same rewards.

496
00:17:47,108 --> 00:17:49,108
And so the ask is, OK, well, I, I want

497
00:17:49,108 --> 00:17:51,108
to honor my, my most valued customers, and

498
00:17:51,108 --> 00:17:53,189
I wanna, I wanna offer different sets of rewards

499
00:17:53,189 --> 00:17:55,469
to, to diff to customers that

500
00:17:55,469 --> 00:17:58,289
are in different loyalty statuses.

501
00:17:58,670 --> 00:17:59,969
So let's do that with the feature flag.

502
00:18:01,818 --> 00:18:03,660
First I'm going to go.

503
00:18:05,348 --> 00:18:06,250
Back to my

504
00:18:06,509 --> 00:18:08,588
featured item. I'm actually gonna turn this off so I can

505
00:18:08,588 --> 00:18:10,588
save some screen real estate here. We've got a

506
00:18:10,588 --> 00:18:12,118
bit of a small screen here,

507
00:18:12,549 --> 00:18:14,009
so let me just deploy this.

508
00:18:17,890 --> 00:18:19,709
And we should see that banner turn off.

509
00:18:20,660 --> 00:18:25,150
Um OK,

510
00:18:25,269 --> 00:18:28,189
it's gone. OK,

511
00:18:28,269 --> 00:18:30,170
so let's talk about how we can make this,

512
00:18:30,469 --> 00:18:32,150
this use case work with a feature flag.

513
00:18:33,039 --> 00:18:35,239
So in app config, we have two

514
00:18:35,239 --> 00:18:37,299
types of future flags which are denoted by

515
00:18:37,299 --> 00:18:39,400
this uh selector down here at the bottom.

516
00:18:39,479 --> 00:18:41,608
The previous flag that we looked at is what we call a basic

517
00:18:41,608 --> 00:18:43,789
flag. And a basic flag is really just,

518
00:18:43,838 --> 00:18:45,900
it's the same for all end users, right? I turn

519
00:18:45,900 --> 00:18:48,118
something on, I turn something off. It's the same for everyone. It's,

520
00:18:48,199 --> 00:18:49,140
it's a basic flag.

521
00:18:50,170 --> 00:18:52,170
However, if I have a more advanced use case like

522
00:18:52,170 --> 00:18:54,239
customer segmentation, like we have in in the

523
00:18:54,239 --> 00:18:56,529
coffee shop demo here, then I can create

524
00:18:56,529 --> 00:18:58,750
what's called a multi-variant flag.

525
00:18:59,130 --> 00:19:01,209
A multi-variant flag is a flag that allows

526
00:19:01,209 --> 00:19:02,309
me to create

527
00:19:02,809 --> 00:19:05,049
alternative feature flag values and therefore

528
00:19:05,049 --> 00:19:07,250
alternative user experiences

529
00:19:07,250 --> 00:19:09,568
for different sets of users based on some rules

530
00:19:09,568 --> 00:19:10,130
that I define.

531
00:19:11,170 --> 00:19:12,868
So, I actually already have this one

532
00:19:13,449 --> 00:19:15,449
set up so that we can talk through it without me having

533
00:19:15,449 --> 00:19:17,348
to click a bunch of buttons.

534
00:19:18,199 --> 00:19:20,239
So we'll see if you remember when we're looking at our

535
00:19:20,239 --> 00:19:22,279
basic flag, we're looking at the, the, it's called

536
00:19:22,279 --> 00:19:24,598
the flag value section at the bottom, we just had a single

537
00:19:24,598 --> 00:19:26,759
toggle, we had a single set of attributes,

538
00:19:26,989 --> 00:19:29,180
variance builds on that and allows you to define

539
00:19:29,180 --> 00:19:31,750
the toggle state and the attribute values

540
00:19:31,750 --> 00:19:33,598
for each what we call variant.

541
00:19:34,618 --> 00:19:36,660
And in this case I have 3 variants. I have platinum, gold,

542
00:19:36,670 --> 00:19:37,380
and default,

543
00:19:37,699 --> 00:19:39,779
and each variant has a rule that I

544
00:19:39,779 --> 00:19:41,858
define. Now this is kind of a compressed view, so I'm

545
00:19:41,858 --> 00:19:44,118
actually gonna open this in the split panel so we can get a better

546
00:19:44,699 --> 00:19:46,459
view of these variants.

547
00:19:47,348 --> 00:19:49,449
So again, I have 3 variants platinum, gold, and default.

548
00:19:49,559 --> 00:19:52,039
Taking a deeper look at the platinum variant.

549
00:19:52,848 --> 00:19:54,890
I can see that it's turned on. I want rewards enabled

550
00:19:54,890 --> 00:19:56,000
for my platinum customers,

551
00:19:56,328 --> 00:19:58,529
and I have an attribute called items which lists

552
00:19:58,529 --> 00:20:00,640
the reward codes for the rewards that I'd like

553
00:20:00,640 --> 00:20:02,789
to offer to my platinum customers.

554
00:20:04,219 --> 00:20:05,959
Also, this variant has a rule.

555
00:20:06,338 --> 00:20:08,380
This is a fairly simple rule where it's checking if

556
00:20:08,380 --> 00:20:10,420
the customer's loyalty status is equal to the

557
00:20:10,420 --> 00:20:11,578
string platinum.

558
00:20:12,390 --> 00:20:14,430
Now, you'll notice,

559
00:20:14,509 --> 00:20:16,959
or rather when you request a multi-variant

560
00:20:16,959 --> 00:20:19,029
feature flag from the app config agent,

561
00:20:19,068 --> 00:20:21,269
in this case, you pass in what we call

562
00:20:21,269 --> 00:20:22,588
request context.

563
00:20:23,000 --> 00:20:25,549
So rather than just saying I want flag ABC,

564
00:20:25,750 --> 00:20:27,989
you say I want flag ABC and

565
00:20:27,989 --> 00:20:30,068
the user type is admin and the user's

566
00:20:30,068 --> 00:20:32,108
loyalty status is none, and the

567
00:20:32,108 --> 00:20:32,989
user joined,

568
00:20:33,259 --> 00:20:35,348
you know, on whatever date, etc. etc.

569
00:20:35,430 --> 00:20:37,868
whatever type of context that's relevant

570
00:20:37,868 --> 00:20:40,029
to the rules that you author for your multi-variant feature

571
00:20:40,029 --> 00:20:42,219
flag. So in the case of the Lambda Latte

572
00:20:42,219 --> 00:20:44,588
app, we're just interested in this, this loyalty status

573
00:20:44,588 --> 00:20:46,049
piece, so we have a pretty simple

574
00:20:46,828 --> 00:20:48,309
rule that serves that use case.

575
00:20:48,618 --> 00:20:50,670
However, note that rules can get

576
00:20:50,670 --> 00:20:52,779
fairly complex with an app config,

577
00:20:53,108 --> 00:20:54,689
so I can do um.

578
00:20:57,180 --> 00:20:59,199
Some different operations. I'm just gonna clear this.

579
00:21:00,088 --> 00:21:02,088
There's a bunch of operations we support. We can talk about this

580
00:21:02,088 --> 00:21:02,630
more later.

581
00:21:02,969 --> 00:21:05,130
Um, for now, I'm just gonna continue with

582
00:21:05,130 --> 00:21:07,338
the demo. It

583
00:21:07,338 --> 00:21:09,539
also supports compound rules, so ands and orders, etc.

584
00:21:09,660 --> 00:21:10,640
so you can get fairly

585
00:21:11,059 --> 00:21:13,170
complex and specific with the types of users that you want to

586
00:21:13,170 --> 00:21:14,500
target with different experiences.

587
00:21:15,680 --> 00:21:17,920
OK, the gold variant is

588
00:21:17,920 --> 00:21:20,160
probably not very surprising. I'm checking loyalty

589
00:21:20,160 --> 00:21:22,239
status equals to equals gold for my rule,

590
00:21:22,348 --> 00:21:24,459
and I'm limiting the items to R1 and R2.

591
00:21:25,269 --> 00:21:26,469
And then my default variant.

592
00:21:27,318 --> 00:21:29,318
The default variant doesn't have a rule because this

593
00:21:29,318 --> 00:21:30,328
is kind of your fallback.

594
00:21:30,799 --> 00:21:33,000
So if you make a request to the agent and the context

595
00:21:33,000 --> 00:21:35,000
that you provide doesn't match any rules of the other variants,

596
00:21:35,088 --> 00:21:37,479
then this is the fallback default variant

597
00:21:37,479 --> 00:21:39,519
that's served to that request. So in this

598
00:21:39,519 --> 00:21:40,420
case we just have

599
00:21:40,719 --> 00:21:43,160
uh R-001 for those customers.

600
00:21:45,838 --> 00:21:47,549
OK, so this is our

601
00:21:48,250 --> 00:21:50,489
multi-variant flag that models

602
00:21:50,489 --> 00:21:52,529
how we want to display different types of rewards

603
00:21:52,529 --> 00:21:53,449
to different customers.

604
00:21:54,479 --> 00:21:56,598
Now again, since this is a demo, I've already

605
00:21:56,598 --> 00:21:58,880
got the front end code in place

606
00:21:58,880 --> 00:21:59,858
to basically

607
00:22:00,209 --> 00:22:02,799
pull this flag, parse the uh

608
00:22:02,799 --> 00:22:04,828
the items attribute value, the

609
00:22:04,828 --> 00:22:07,239
list of items, and it does like a, a

610
00:22:07,239 --> 00:22:09,469
quick look up to say, 0, R1 is is this

611
00:22:09,469 --> 00:22:10,900
reward, R2 is this sword, etc.

612
00:22:11,160 --> 00:22:12,519
So the front end code is already written.

613
00:22:13,269 --> 00:22:15,779
However, the back-end code is not sufficiently,

614
00:22:15,799 --> 00:22:16,420
uh,

615
00:22:16,880 --> 00:22:17,979
set up to

616
00:22:18,239 --> 00:22:20,239
pass this request context

617
00:22:20,239 --> 00:22:22,500
that I've been talking about to the app config agent,

618
00:22:22,868 --> 00:22:23,739
which is why,

619
00:22:24,318 --> 00:22:26,318
again, I just did a

620
00:22:26,318 --> 00:22:28,328
deployment in the previous demo which deploys all of

621
00:22:28,328 --> 00:22:29,140
my flags,

622
00:22:29,799 --> 00:22:31,880
since I have them in the same configuration, which means

623
00:22:31,880 --> 00:22:33,818
this is actually my live config right now.

624
00:22:35,059 --> 00:22:37,309
But remember when I clicked through the different

625
00:22:37,309 --> 00:22:39,309
customer profiles earlier, we were seeing the same

626
00:22:39,309 --> 00:22:40,529
experience for every customer.

627
00:22:41,539 --> 00:22:43,739
Everyone was just seeing one reward, and that's because I, I

628
00:22:43,739 --> 00:22:46,029
haven't made that back end update yet to properly

629
00:22:46,029 --> 00:22:48,150
pass in request context and get

630
00:22:48,150 --> 00:22:49,930
the proper variant for the given

631
00:22:50,229 --> 00:22:51,689
end user, uh,

632
00:22:51,949 --> 00:22:53,848
and then render that experience appropriately.

633
00:22:54,818 --> 00:22:56,868
So what we're going to do now is go into the back end and

634
00:22:56,868 --> 00:22:59,049
make that code change to properly

635
00:22:59,049 --> 00:23:01,328
retrieve a multivariant

636
00:23:01,509 --> 00:23:03,029
feature flag from the app config agent.

637
00:23:04,469 --> 00:23:05,150
So let's do that.

638
00:23:06,039 --> 00:23:07,118
Let's head back into Quiro.

639
00:23:09,250 --> 00:23:11,299
And let's open the app

640
00:23:11,299 --> 00:23:13,539
config.pi file, which is of course

641
00:23:13,539 --> 00:23:15,078
my lambda backend logic.

642
00:23:16,029 --> 00:23:18,019
And we are going to

643
00:23:18,439 --> 00:23:20,759
uh go through this code and make a couple updates

644
00:23:20,759 --> 00:23:21,900
to properly

645
00:23:22,199 --> 00:23:24,199
handle and pass request context

646
00:23:24,199 --> 00:23:25,009
to the app configuration.

647
00:23:26,299 --> 00:23:28,380
So earlier we were talking about the input event structure and we had

648
00:23:28,380 --> 00:23:30,578
the flag's dictionary, and each

649
00:23:30,578 --> 00:23:32,779
flag, uh, or each key in that dictionary

650
00:23:32,779 --> 00:23:35,479
had it in itself an empty dictionary.

651
00:23:36,380 --> 00:23:38,390
So what we're gonna do is we're gonna take advantage of that

652
00:23:38,390 --> 00:23:41,170
empty empty dictionary

653
00:23:41,630 --> 00:23:43,660
and use it as a place to put

654
00:23:43,660 --> 00:23:44,430
request context.

655
00:23:45,269 --> 00:23:47,430
And so, I would have something like, in

656
00:23:47,430 --> 00:23:49,469
the case of the Lambda Latte app, I

657
00:23:49,469 --> 00:23:51,809
would have loyalty status,

658
00:23:52,309 --> 00:23:54,009
for example, uh, gold.

659
00:23:55,670 --> 00:23:56,848
So now our request structure,

660
00:23:57,150 --> 00:23:57,689
uh,

661
00:23:58,189 --> 00:24:00,348
or with the code updates that we're about to make, our request

662
00:24:00,348 --> 00:24:01,449
structure will support

663
00:24:01,989 --> 00:24:04,059
this type of requests where

664
00:24:04,059 --> 00:24:05,068
context is included.

665
00:24:06,160 --> 00:24:07,390
So how do we do that?

666
00:24:08,598 --> 00:24:09,160
Firstly,

667
00:24:09,439 --> 00:24:11,709
let's go directly to the code that's

668
00:24:11,709 --> 00:24:13,949
that's making requests to the app config agent,

669
00:24:14,439 --> 00:24:16,709
because this is where request context is

670
00:24:16,709 --> 00:24:17,358
passed in.

671
00:24:18,229 --> 00:24:20,769
So you'll see right now, we have our,

672
00:24:21,229 --> 00:24:23,229
uh, what's called here the base URL for the app

673
00:24:23,229 --> 00:24:25,500
config agent, which again is running on localhost

674
00:24:25,500 --> 00:24:26,799
port 2772,

675
00:24:27,189 --> 00:24:29,229
happens to be the default port for the app config agent, you

676
00:24:29,229 --> 00:24:30,348
can set it to whatever you like.

677
00:24:31,650 --> 00:24:32,269
And

678
00:24:32,689 --> 00:24:34,689
the way this request is working right now is

679
00:24:34,689 --> 00:24:36,309
it's just, it's saying

680
00:24:36,969 --> 00:24:38,969
with the example I was using earlier, it's saying, hey

681
00:24:38,969 --> 00:24:40,729
app config agent, give me flag ABC.

682
00:24:41,130 --> 00:24:43,170
But we want, what we want to do is update it to say, hey, give me

683
00:24:43,170 --> 00:24:45,289
flag ABC but also pass in or use this

684
00:24:45,289 --> 00:24:45,939
context.

685
00:24:46,299 --> 00:24:46,930
So let's do that.

686
00:24:48,358 --> 00:24:49,459
So the way we do this

687
00:24:50,078 --> 00:24:52,358
Is by

688
00:24:52,358 --> 00:24:54,559
passing in a, an HTTP

689
00:24:54,559 --> 00:24:56,318
header called context.

690
00:24:57,259 --> 00:24:58,108
And so

691
00:25:00,088 --> 00:25:01,269
Let me just

692
00:25:01,660 --> 00:25:02,949
write out what I'm doing,

693
00:25:03,449 --> 00:25:05,809
a request, context in.

694
00:25:08,989 --> 00:25:10,269
Context HTP header.

695
00:25:10,969 --> 00:25:13,170
And just to give you a visual before we actually

696
00:25:13,170 --> 00:25:14,509
write this code, here's some

697
00:25:14,890 --> 00:25:16,229
examples of

698
00:25:16,769 --> 00:25:18,250
the context header.

699
00:25:23,660 --> 00:25:24,799
So the key.

700
00:25:26,088 --> 00:25:27,699
Is context and

701
00:25:29,549 --> 00:25:31,670
In the case of lambda latte, I

702
00:25:31,670 --> 00:25:33,750
might be doing something like this, loyalty status equals

703
00:25:33,750 --> 00:25:35,838
gold. That's

704
00:25:35,838 --> 00:25:37,969
of course a single context value, but we

705
00:25:37,969 --> 00:25:40,150
support an arbitrary number of context values. So you can also

706
00:25:40,150 --> 00:25:42,170
do something like this where you say the

707
00:25:42,170 --> 00:25:43,108
context is

708
00:25:43,410 --> 00:25:44,068
uh

709
00:25:44,608 --> 00:25:45,529
K1 equals V1,

710
00:25:46,239 --> 00:25:47,549
K2 equals V2.

711
00:25:48,039 --> 00:25:50,049
So you can pass in as much context as you like.

712
00:25:51,689 --> 00:25:53,660
OK, so what does this, what does the code actually look like?

713
00:25:54,019 --> 00:25:55,318
So if I have,

714
00:25:56,019 --> 00:25:58,059
well, first I need to update my function signature

715
00:25:58,059 --> 00:25:59,160
to actually accept

716
00:25:59,939 --> 00:26:01,939
request context. Right now it only accepts the flag

717
00:26:01,939 --> 00:26:02,979
key, but

718
00:26:03,848 --> 00:26:06,209
Excuse me, in addition to the flag key, we also want to

719
00:26:06,209 --> 00:26:07,789
accept request,

720
00:26:08,209 --> 00:26:08,848
context.

721
00:26:10,000 --> 00:26:12,000
What do we do with that request context? Well,

722
00:26:12,078 --> 00:26:14,578
if I have, if there is request context

723
00:26:15,160 --> 00:26:17,358
present, then I want to basically build the

724
00:26:17,358 --> 00:26:19,430
HTP header like we have in the examples

725
00:26:19,430 --> 00:26:20,279
on the lines above.

726
00:26:20,640 --> 00:26:21,699
So the first thing I'm gonna do.

727
00:26:22,549 --> 00:26:25,029
I create this variable called

728
00:26:25,029 --> 00:26:26,219
context parts.

729
00:26:27,118 --> 00:26:29,299
And this is effectively going to build my

730
00:26:29,479 --> 00:26:31,500
uh key equals value piece

731
00:26:31,500 --> 00:26:33,750
of my head. So

732
00:26:33,750 --> 00:26:35,088
I'll take the

733
00:26:38,430 --> 00:26:40,430
Just build this here and

734
00:26:40,430 --> 00:26:42,689
then for key value

735
00:26:42,689 --> 00:26:43,390
in.

736
00:26:45,000 --> 00:26:46,959
Quest context. items.

737
00:26:47,489 --> 00:26:49,529
So I'll iterate through my request context and I'll

738
00:26:49,529 --> 00:26:51,640
create this uh K equals V

739
00:26:51,890 --> 00:26:52,588
type setup,

740
00:26:52,900 --> 00:26:55,059
and then I will create the actual header

741
00:26:55,059 --> 00:26:57,130
content. Which of course

742
00:26:57,130 --> 00:26:57,910
will join

743
00:26:58,529 --> 00:27:00,410
these uh K equals V.

744
00:27:02,130 --> 00:27:04,160
Parts into a comma

745
00:27:04,160 --> 00:27:04,799
separated.

746
00:27:06,939 --> 00:27:07,618
List

747
00:27:08,858 --> 00:27:10,519
Which then, of course, we will add

748
00:27:12,239 --> 00:27:13,459
to our HTP request.

749
00:27:14,608 --> 00:27:16,618
We'll add the header called context,

750
00:27:16,769 --> 00:27:18,068
and we will pass in

751
00:27:18,410 --> 00:27:19,930
the context header.

752
00:27:22,130 --> 00:27:24,250
OK, so now when my backend code

753
00:27:24,250 --> 00:27:26,380
makes a request to the app config agent, it's gonna

754
00:27:26,380 --> 00:27:28,618
include this request context in the context

755
00:27:28,618 --> 00:27:30,650
header so that the agent can evaluate it and return the

756
00:27:30,650 --> 00:27:32,818
appropriate variant for my

757
00:27:32,818 --> 00:27:34,680
particular end user that's making the request.

758
00:27:35,219 --> 00:27:36,529
Yes, um, so

759
00:27:37,180 --> 00:27:40,529
you're facing a request to call your agent. Um,

760
00:27:40,539 --> 00:27:42,299
it's an agent named Leon McCafey.

761
00:27:43,719 --> 00:27:45,979
Yeah. That's absolutely correct. Ben,

762
00:27:46,049 --> 00:27:46,979
can you repeat the question?

763
00:27:47,750 --> 00:27:49,910
Yes, so the question is, so in this code I'm,

764
00:27:49,979 --> 00:27:52,630
I'm making requests to localhost 2772,

765
00:27:52,670 --> 00:27:53,858
which is the app config agent,

766
00:27:54,199 --> 00:27:56,309
and the question is, every time I make a

767
00:27:56,309 --> 00:27:57,289
request to the agent,

768
00:27:57,709 --> 00:27:59,910
is that making another request to AWS

769
00:27:59,910 --> 00:28:02,150
or, or is the agent handling the caching? Is that the question?

770
00:28:02,549 --> 00:28:04,709
That's right, the agent's handling the caching, so

771
00:28:04,709 --> 00:28:06,939
the way that multi-variant feature flags

772
00:28:06,939 --> 00:28:08,289
work is.

773
00:28:09,289 --> 00:28:11,289
Each time you pass in, so the the first

774
00:28:11,289 --> 00:28:13,489
time you request this flag, yes, there's

775
00:28:13,489 --> 00:28:15,608
gonna be a call to the app config service to get

776
00:28:15,890 --> 00:28:18,309
uh the, the configuration

777
00:28:18,309 --> 00:28:20,318
information, but then for each subsequent request,

778
00:28:20,529 --> 00:28:21,709
regardless of the context.

779
00:28:22,608 --> 00:28:24,809
There's no new network call being made. The

780
00:28:24,809 --> 00:28:27,009
agent is locally caching the config and locally

781
00:28:27,009 --> 00:28:27,789
evaluating

782
00:28:28,209 --> 00:28:30,209
the, uh, the rules, so that

783
00:28:30,209 --> 00:28:32,318
way you, you get the resiliency of

784
00:28:32,318 --> 00:28:33,868
not having to have all these network calls,

785
00:28:34,199 --> 00:28:36,239
uh, you get the performance improvement of not having

786
00:28:36,239 --> 00:28:38,348
to wait for the network calls, and then of course the,

787
00:28:38,489 --> 00:28:40,729
the performance of doing the actual evaluation

788
00:28:40,729 --> 00:28:42,880
locally within the agent instead of on the remote app

789
00:28:42,880 --> 00:28:44,900
config service. So you get that really performant,

790
00:28:45,250 --> 00:28:47,219
uh, rule evaluation. Does that answer your question?

791
00:28:48,410 --> 00:28:51,608
So if you have like already have like a recent instance going if there's.

792
00:28:54,939 --> 00:28:57,039
You know that you. Yeah, you would just use

793
00:28:57,039 --> 00:28:59,219
this. Yeah, so the agent works as, as, as

794
00:28:59,219 --> 00:29:01,299
your cache for app config data. Yeah, there's

795
00:29:01,299 --> 00:29:02,358
no need to insert

796
00:29:02,858 --> 00:29:03,660
a cache of your own.

797
00:29:04,680 --> 00:29:05,400
Great, thank you.

798
00:29:06,420 --> 00:29:07,049
Other questions, questions, yeah,

799
00:29:07,900 --> 00:29:09,059
uh, one here,

800
00:29:09,358 --> 00:29:11,578
uh, what happened to that cash scale,

801
00:29:11,979 --> 00:29:13,519
what is the values of cash?

802
00:29:14,309 --> 00:29:16,410
So the way the cache works is

803
00:29:16,779 --> 00:29:18,828
by default, it will never

804
00:29:18,828 --> 00:29:20,549
evict any data.

805
00:29:21,390 --> 00:29:23,390
So this is a resiliency strategy

806
00:29:23,390 --> 00:29:25,170
that, that we use.

807
00:29:25,588 --> 00:29:26,289
Um,

808
00:29:27,029 --> 00:29:28,588
for example, if you get,

809
00:29:29,348 --> 00:29:30,689
so let me, let me

810
00:29:30,989 --> 00:29:33,229
back up for a second. So the way the cache works is

811
00:29:33,229 --> 00:29:35,509
the agent will obviously make that initial

812
00:29:35,509 --> 00:29:36,848
call to app config,

813
00:29:37,170 --> 00:29:39,500
pull the configuration data, in this case the feature flags,

814
00:29:39,789 --> 00:29:41,650
and then what happens is it spins up a

815
00:29:42,150 --> 00:29:44,650
background thread within the agent that periodically

816
00:29:45,150 --> 00:29:47,189
pings the app config service asking, hey,

817
00:29:47,390 --> 00:29:48,709
do you have any updates for this config?

818
00:29:49,189 --> 00:29:51,420
And so that'll happen on a, it's a configurable cadence

819
00:29:51,420 --> 00:29:53,479
by default, it's every 45 seconds, it'll check

820
00:29:53,479 --> 00:29:55,479
in with the app config service to say, hey, do you

821
00:29:55,479 --> 00:29:56,750
have any updates for this config,

822
00:29:57,009 --> 00:29:59,019
right? And that process continues in the background

823
00:29:59,880 --> 00:30:01,799
for the life of the agent process,

824
00:30:02,118 --> 00:30:04,199
right? And so there's no, there's

825
00:30:04,199 --> 00:30:06,539
no, uh, data eviction.

826
00:30:06,880 --> 00:30:08,959
If there's some kind of network event that cuts

827
00:30:08,959 --> 00:30:10,959
off your access to app config or all of

828
00:30:10,959 --> 00:30:13,279
AWS at some point, then the agent,

829
00:30:13,479 --> 00:30:15,838
the agent will still serve the latest

830
00:30:15,838 --> 00:30:17,489
config data that it knows about

831
00:30:17,880 --> 00:30:18,559
from its cache.

832
00:30:18,989 --> 00:30:21,118
persistent is that is the light

833
00:30:21,118 --> 00:30:22,150
of the session.

834
00:30:22,910 --> 00:30:24,430
Good question. Um,

835
00:30:24,789 --> 00:30:25,729
can you repeat the question?

836
00:30:26,269 --> 00:30:28,368
How persistent is the agent cash?

837
00:30:29,509 --> 00:30:31,848
The answer is that by

838
00:30:31,848 --> 00:30:34,130
default, or I shouldn't say by default, but

839
00:30:34,410 --> 00:30:35,959
there's a few layers of

840
00:30:36,779 --> 00:30:39,269
I'd, I'll say resiliency that the agent offers.

841
00:30:39,900 --> 00:30:40,660
And so

842
00:30:41,019 --> 00:30:43,019
the first obviously is in memory, which

843
00:30:43,019 --> 00:30:45,068
I've already talked about, but that doesn't help you much if your,

844
00:30:45,140 --> 00:30:47,299
if your application restarts or if your host reboots,

845
00:30:47,368 --> 00:30:47,979
etc.

846
00:30:48,459 --> 00:30:50,598
and so we have additional features built in.

847
00:30:51,469 --> 00:30:53,709
To protect against that type of scenario, for

848
00:30:53,709 --> 00:30:55,868
example, we have an on-disc backup

849
00:30:55,868 --> 00:30:56,910
option that you can enable,

850
00:30:57,269 --> 00:30:59,348
and so that's not available in lambda, of course,

851
00:30:59,459 --> 00:31:01,588
which is what this, uh, demo is about.

852
00:31:01,910 --> 00:31:04,029
However, if you're running in a container environment

853
00:31:04,029 --> 00:31:06,150
or if you're running on EC2 or on-prem, etc.

854
00:31:06,509 --> 00:31:08,868
then we, it's a best practice to enable

855
00:31:08,868 --> 00:31:11,029
that on-disc backup mechanism so that

856
00:31:11,029 --> 00:31:13,068
in addition to the in memory caching, you get the

857
00:31:13,068 --> 00:31:14,229
on-disc caching.

858
00:31:16,259 --> 00:31:18,489
OK. Uh, there's a question here in the middle, yes.

859
00:31:19,229 --> 00:31:20,209
So, um,

860
00:31:20,680 --> 00:31:22,880
when you're showing the deployment, what exactly is

861
00:31:22,880 --> 00:31:23,750
being deployed?

862
00:31:25,009 --> 00:31:27,059
Yeah, so the question is, when I'm showing the deployment,

863
00:31:27,219 --> 00:31:28,578
what actually is being deployed?

864
00:31:29,539 --> 00:31:31,979
And the answer is that I'm deploying my

865
00:31:31,979 --> 00:31:34,239
configuration data through app config.

866
00:31:34,699 --> 00:31:36,979
So app config is a feature flagging

867
00:31:36,979 --> 00:31:37,559
service.

868
00:31:38,019 --> 00:31:40,098
Feature flags are a special

869
00:31:40,098 --> 00:31:41,680
type of configuration.

870
00:31:42,818 --> 00:31:44,828
And what app config does at its

871
00:31:44,828 --> 00:31:47,150
core is it allows you to

872
00:31:47,150 --> 00:31:49,150
create versions of your configuration

873
00:31:49,150 --> 00:31:50,809
data and then deploy

874
00:31:51,380 --> 00:31:53,549
those uh and then deploy your configuration data

875
00:31:53,549 --> 00:31:55,949
by version, right? And each version is an immutable

876
00:31:55,949 --> 00:31:57,368
set of data, you can't change it,

877
00:31:57,729 --> 00:31:58,769
right? This is one of the key,

878
00:31:59,259 --> 00:31:59,769
uh,

879
00:32:00,269 --> 00:32:02,469
value props of app config is that

880
00:32:02,469 --> 00:32:04,509
your data is immutable and when you want

881
00:32:04,509 --> 00:32:06,509
to change it, it's more than just creating it, you have to

882
00:32:06,509 --> 00:32:07,670
create it and deploy it.

883
00:32:08,469 --> 00:32:10,598
And the, the benefit of that is if

884
00:32:10,598 --> 00:32:12,759
you decide, you know, you make a deployment and then you

885
00:32:12,759 --> 00:32:14,420
decide, oh wait, this is breaking something

886
00:32:14,759 --> 00:32:16,759
or it's not working the way that I want, then you

887
00:32:16,759 --> 00:32:18,880
can roll back that deployment and you go back

888
00:32:18,880 --> 00:32:20,959
to the last known state of the config,

889
00:32:21,239 --> 00:32:22,059
right? Does that make sense?

890
00:32:23,769 --> 00:32:24,489
Is an occupation.

891
00:32:27,059 --> 00:32:29,348
Exactly, yeah, so you saw the

892
00:32:29,348 --> 00:32:31,709
app config deployments that I was doing earlier.

893
00:32:32,108 --> 00:32:34,189
Those of course were instant deployments, so

894
00:32:34,189 --> 00:32:35,750
they, they happen instantly.

895
00:32:36,469 --> 00:32:38,680
And so you saw how our application updated after

896
00:32:38,680 --> 00:32:40,338
I did that deployment.

897
00:32:40,719 --> 00:32:42,868
It's just a, it's, it's a, uh,

898
00:32:43,078 --> 00:32:45,078
kind of app config as a control plane

899
00:32:45,078 --> 00:32:47,078
kind of concept. It's, it's not, it's not taking

900
00:32:47,078 --> 00:32:49,199
hosts out of servers, it's not deploying software, it's

901
00:32:49,199 --> 00:32:50,140
just deploying

902
00:32:50,479 --> 00:32:52,420
the new newest version of my configuration

903
00:32:52,799 --> 00:32:53,880
in the app config service.

904
00:32:55,539 --> 00:32:57,739
One of the things that we do and we can get to other

905
00:32:57,739 --> 00:32:59,779
questions in a second, but is that's really important for AP

906
00:32:59,779 --> 00:33:02,098
config is the idea that you should deploy

907
00:33:02,098 --> 00:33:04,500
slowly and gradually. Um, every

908
00:33:04,500 --> 00:33:06,618
change that you make, including a configuration

909
00:33:06,618 --> 00:33:08,269
change, could break your

910
00:33:08,539 --> 00:33:10,618
production environment and if you think back to the last

911
00:33:10,618 --> 00:33:12,779
18 months, a lot of the major outages

912
00:33:12,779 --> 00:33:14,818
of providers have been related to configuration

913
00:33:14,818 --> 00:33:15,358
changes

914
00:33:15,618 --> 00:33:17,358
that were deployed everywhere all at once,

915
00:33:17,779 --> 00:33:19,809
um, so Ben's demo showed an

916
00:33:19,809 --> 00:33:21,920
instant deployment that's

917
00:33:22,059 --> 00:33:24,275
a bit of an. Type pattern he's doing a demo, so

918
00:33:24,275 --> 00:33:26,604
it would be boring for you to wait 15 minutes, but I'll

919
00:33:26,604 --> 00:33:28,814
say we use app config inside of

920
00:33:28,814 --> 00:33:31,025
AWS and Amazon and we have a policy that

921
00:33:31,203 --> 00:33:33,203
it has to be at least 30 minutes

922
00:33:33,203 --> 00:33:34,045
of a deployment,

923
00:33:34,354 --> 00:33:36,483
um, and bake time, uh, for any change

924
00:33:36,483 --> 00:33:38,525
of configuration unless you're

925
00:33:38,525 --> 00:33:40,723
breaking glass and you need to address something right away. You can

926
00:33:40,723 --> 00:33:43,084
do that with hap config, but yeah, this idea of it's

927
00:33:43,084 --> 00:33:45,084
just similar to like a code, it's the metaphor of a

928
00:33:45,084 --> 00:33:47,703
code pipeline, right? It is I'm deploying configuration

929
00:33:47,805 --> 00:33:50,125
in a way similar that I deploy code gradually.

930
00:33:51,680 --> 00:33:53,680
OK, we'll take one more question in this section, then

931
00:33:53,680 --> 00:33:55,338
we'll move on with the demo here up front.

932
00:33:55,799 --> 00:33:58,068
Um, is it possible to have the agent

933
00:33:58,068 --> 00:33:58,939
evaluate

934
00:33:59,318 --> 00:34:01,890
differently based on whether or not they can reach the

935
00:34:01,890 --> 00:34:02,949
applicant service? I'm thinking about

936
00:34:03,640 --> 00:34:06,199
cases where there might be a security sensitive configuration

937
00:34:06,199 --> 00:34:07,900
that you might want to be closed on,

938
00:34:08,280 --> 00:34:09,750
um, in case the service.

939
00:34:10,860 --> 00:34:12,878
Um, the agent doesn't have anything like that.

940
00:34:12,889 --> 00:34:13,570
Can you repeat the question?

941
00:34:13,849 --> 00:34:15,969
Oh, sorry, the question is, can I

942
00:34:15,969 --> 00:34:18,489
change effectively the, the

943
00:34:18,489 --> 00:34:20,929
response that the agent returns based on the availability

944
00:34:20,929 --> 00:34:22,030
of the app config service

945
00:34:22,289 --> 00:34:24,369
or the reachability of the app config service, I should

946
00:34:24,369 --> 00:34:25,519
say. Is that correct?

947
00:34:25,800 --> 00:34:28,128
Yes, the answer is no. There's no built-in

948
00:34:28,128 --> 00:34:29,389
way in the agent to do that right now.

949
00:34:29,820 --> 00:34:32,050
Uh, so if you want, if you want functionality

950
00:34:32,050 --> 00:34:34,059
like that, then you would have a thin, a thin

951
00:34:34,059 --> 00:34:36,148
wrapper around your agent calls that say, you know, for this

952
00:34:36,148 --> 00:34:37,090
set of flags or whatever,

953
00:34:37,469 --> 00:34:39,469
uh, use this default value if I can't, if I

954
00:34:39,469 --> 00:34:41,929
can't retrieve it, right? Does that make sense? OK.

955
00:34:42,590 --> 00:34:44,668
OK, let's move on with this demo. We will get

956
00:34:44,668 --> 00:34:45,869
to more questions later.

957
00:34:46,739 --> 00:34:49,500
So again, what are we doing? We're trying to update the

958
00:34:49,500 --> 00:34:51,780
content of our my rewards

959
00:34:51,780 --> 00:34:53,539
tab on the Lambda Latte app

960
00:34:53,820 --> 00:34:55,039
to uh.

961
00:34:56,117 --> 00:34:58,599
Be different based on customers' loyalty status.

962
00:34:58,918 --> 00:35:00,599
And so what we did is we made some code changes.

963
00:35:01,398 --> 00:35:02,119
And I actually,

964
00:35:02,398 --> 00:35:04,438
there's one more change that I need to make. So

965
00:35:04,438 --> 00:35:06,079
this function get flagged from agent.

966
00:35:07,000 --> 00:35:08,699
I've added request context.

967
00:35:09,590 --> 00:35:11,708
I need to actually pass that context in up in

968
00:35:11,708 --> 00:35:12,289
my main

969
00:35:12,989 --> 00:35:14,668
uh handler functions, let's do that.

970
00:35:16,599 --> 00:35:18,679
So, now, when I look

971
00:35:18,679 --> 00:35:20,809
through my request object, instead of just looking at the keys,

972
00:35:20,840 --> 00:35:22,219
I'm going to look at the entire item.

973
00:35:23,659 --> 00:35:24,599
And I'm gonna do

974
00:35:25,139 --> 00:35:27,139
a flag key request context, and then when

975
00:35:27,139 --> 00:35:29,260
I call get flagged from agent, I will pass

976
00:35:29,260 --> 00:35:31,719
in. Request context.

977
00:35:33,260 --> 00:35:35,398
OK, and I believe that's all the changes

978
00:35:35,398 --> 00:35:36,969
I need. Let me take a quick

979
00:35:37,309 --> 00:35:37,969
peek.

980
00:35:39,559 --> 00:35:42,000
OK. So

981
00:35:42,000 --> 00:35:44,000
I made some changes to my backend code, so now I have

982
00:35:44,000 --> 00:35:45,199
to restart my back end.

983
00:35:45,519 --> 00:35:46,269
So let's do that.

984
00:35:47,639 --> 00:35:48,820
OK, it's running again.

985
00:35:50,579 --> 00:35:53,159
Now let's head back to

986
00:35:55,360 --> 00:35:56,659
The application.

987
00:36:00,659 --> 00:36:02,780
And the rewards tab should

988
00:36:02,780 --> 00:36:03,360
be

989
00:36:03,978 --> 00:36:05,958
working, but it's not, of course.

990
00:36:06,489 --> 00:36:08,239
I check on a couple other users.

991
00:36:11,639 --> 00:36:12,458
OK.

992
00:36:13,300 --> 00:36:14,570
So something is broken.

993
00:36:16,159 --> 00:36:17,300
Let me try.

994
00:36:17,878 --> 00:36:20,039
Like I said, live demos are fun. Live coding is even

995
00:36:20,039 --> 00:36:21,300
better, so let me

996
00:36:21,918 --> 00:36:23,030
restart things.

997
00:36:28,418 --> 00:36:30,300
And we will give this a shot.

998
00:36:33,800 --> 00:36:35,269
OK, I'm not sure where the bug is here.

999
00:36:36,878 --> 00:36:38,909
Um, what I was expecting to see

1000
00:36:38,909 --> 00:36:41,168
is for Elena, who doesn't have loyalty status,

1001
00:36:41,208 --> 00:36:42,739
I was expecting to see reward one,

1002
00:36:43,050 --> 00:36:44,110
and then for

1003
00:36:44,989 --> 00:36:47,110
Marcus, who has gold status rewards 1 and 2,

1004
00:36:47,228 --> 00:36:48,969
and then Jasper with

1005
00:36:49,469 --> 00:36:51,489
status platinum to see 4 rewards.

1006
00:36:52,760 --> 00:36:54,909
I think doing live debugging is

1007
00:36:54,909 --> 00:36:55,699
gonna take

1008
00:36:56,000 --> 00:36:56,978
too long.

1009
00:36:57,519 --> 00:36:59,539
I've heard the audience loves it when it doesn't go perfectly,

1010
00:36:59,688 --> 00:37:01,708
Ben, so you, you nailed it. I don't, I don't

1011
00:37:01,708 --> 00:37:03,099
love it when it doesn't go perfectly, but.

1012
00:37:03,800 --> 00:37:07,378
Do you have? We

1013
00:37:07,378 --> 00:37:09,449
have, sorry, what was that? It's gonna debug for you, Ben. Oh,

1014
00:37:09,500 --> 00:37:10,570
we have a debugger in the ground.

1015
00:37:12,110 --> 00:37:12,978
Uh, you did request that header.

1016
00:37:15,010 --> 00:37:15,659
Yes, I.

1017
00:37:19,228 --> 00:37:21,030
You can find down in the fire block.

1018
00:37:24,179 --> 00:37:26,208
Oh Yeah, that's

1019
00:37:26,208 --> 00:37:26,860
a good call.

1020
00:37:29,168 --> 00:37:31,599
How about we put this block of code after this variable

1021
00:37:31,599 --> 00:37:33,668
exists? The

1022
00:37:35,050 --> 00:37:35,829
All right,

1023
00:37:36,208 --> 00:37:38,378
good eye. Thank

1024
00:37:38,378 --> 00:37:46,199
you. OK,

1025
00:37:46,449 --> 00:37:48,039
wow, thank you.

1026
00:37:49,929 --> 00:37:50,438
OK.

1027
00:37:50,769 --> 00:37:52,840
Uh, so again, Jasper, a platinum

1028
00:37:52,840 --> 00:37:54,110
member, has 4 rewards.

1029
00:37:54,869 --> 00:37:55,510
Uh,

1030
00:37:55,918 --> 00:37:58,309
Marcus, our gold member, has 2 rewards,

1031
00:37:58,679 --> 00:38:00,679
and Elena, our default

1032
00:38:00,679 --> 00:38:02,760
status member, has a single reward.

1033
00:38:03,039 --> 00:38:05,110
So again, what, what's the point of this? The point is that

1034
00:38:05,110 --> 00:38:07,159
we can use a feature flag to render dynamic

1035
00:38:07,159 --> 00:38:09,320
experiences for different segments of customers.

1036
00:38:09,599 --> 00:38:11,800
In this case, for the lambda latte uh demo

1037
00:38:11,800 --> 00:38:13,840
example, the segment is based on

1038
00:38:13,840 --> 00:38:15,679
the user's loyalty status.

1039
00:38:17,128 --> 00:38:17,708
OK,

1040
00:38:18,219 --> 00:38:20,340
um, Steve, does that fulfill your, your

1041
00:38:20,340 --> 00:38:22,418
business requirements? Absolutely. That

1042
00:38:22,418 --> 00:38:24,760
gives me a lot of flexibility and allows me to customize,

1043
00:38:25,260 --> 00:38:27,458
and that's a more advanced type of feature flag,

1044
00:38:27,878 --> 00:38:29,938
uh, this multi-variant flag. Again,

1045
00:38:30,128 --> 00:38:32,800
a lot of customers think of feature flags as

1046
00:38:33,250 --> 00:38:35,398
a gate to releasing new capability,

1047
00:38:35,860 --> 00:38:38,099
um, but you can use it for a lot more than that.

1048
00:38:38,579 --> 00:38:40,978
Um, I'm gonna take off the hat of the

1049
00:38:40,989 --> 00:38:43,030
Lambda latte, uh, uh, coffee

1050
00:38:43,030 --> 00:38:45,059
shop owner and talk to you a little bit about some other

1051
00:38:45,059 --> 00:38:46,300
feature flag use cases.

1052
00:38:46,719 --> 00:38:48,869
Um, so again, the idea of

1053
00:38:48,869 --> 00:38:50,878
a release flag is mostly what people think

1054
00:38:50,878 --> 00:38:53,090
about feature flags. I'm going to have my code

1055
00:38:53,438 --> 00:38:55,590
hide the functionality behind some sort of a

1056
00:38:55,590 --> 00:38:56,179
toggle,

1057
00:38:56,519 --> 00:38:58,739
um, and then I'm going to deploy the code,

1058
00:38:58,918 --> 00:39:00,918
but nobody can get to it because the toggle is off.

1059
00:39:01,239 --> 00:39:03,369
Then I'm gonna turn it on slowly. That's

1060
00:39:03,369 --> 00:39:05,398
really important that I'm gonna turn on for 1% of

1061
00:39:05,398 --> 00:39:07,510
my fleet or 1% of my audience. You have

1062
00:39:07,510 --> 00:39:08,840
configurable options for that.

1063
00:39:09,228 --> 00:39:11,510
And over time I'm going to increase that

1064
00:39:11,750 --> 00:39:14,260
10%, everything's going well, 20%

1065
00:39:14,260 --> 00:39:16,429
everything's going well, 40%, 0 my gosh, something

1066
00:39:16,429 --> 00:39:19,070
went wrong and we do see this inside of AWS

1067
00:39:19,070 --> 00:39:21,199
sometimes that you don't see these problems until you really

1068
00:39:21,199 --> 00:39:22,369
start to hit a scale

1069
00:39:23,070 --> 00:39:25,070
so again the idea of just a

1070
00:39:25,070 --> 00:39:27,070
culture of I'm going to develop

1071
00:39:27,070 --> 00:39:29,228
quickly but release slowly is really

1072
00:39:29,228 --> 00:39:30,889
important when you're using feature flags.

1073
00:39:31,599 --> 00:39:32,789
So that's sort of a release thing

1074
00:39:33,059 --> 00:39:35,110
um I'll tell you one of the big, I I think I

1075
00:39:35,110 --> 00:39:37,139
said app config is the feature flagging

1076
00:39:37,139 --> 00:39:37,969
solution for

1077
00:39:38,228 --> 00:39:40,309
Amazon and AWS. It's how we think

1078
00:39:40,309 --> 00:39:41,760
you should use feature flags.

1079
00:39:42,019 --> 00:39:44,110
Um, one of the big weeks, uh, this

1080
00:39:44,110 --> 00:39:46,168
week is a really big week for app config

1081
00:39:46,429 --> 00:39:48,764
when. People are on stage announcing something announcing

1082
00:39:48,764 --> 00:39:50,804
this new capability that coders actually

1083
00:39:50,804 --> 00:39:52,253
pushed to production a couple weeks ago,

1084
00:39:52,644 --> 00:39:54,574
but it was all hidden so you couldn't access it.

1085
00:39:55,114 --> 00:39:57,273
Then feature flags are being flipped as Matt Garman

1086
00:39:57,273 --> 00:39:59,503
is on stage and Peter DeSantis is on stage

1087
00:39:59,885 --> 00:40:01,625
to make sure that that thing lights up,

1088
00:40:02,003 --> 00:40:04,204
um, so it's a, it's a great tool,

1089
00:40:04,474 --> 00:40:06,523
uh, to, to sort of control and you

1090
00:40:06,523 --> 00:40:08,603
know the engineers are not like sitting there trying to do

1091
00:40:08,603 --> 00:40:10,813
CICD deployments while Matt Garman's talking.

1092
00:40:11,244 --> 00:40:13,405
The code's already out there and all they do is a small feature

1093
00:40:13,405 --> 00:40:14,304
flag deployment.

1094
00:40:15,300 --> 00:40:16,958
Um, the other

1095
00:40:17,300 --> 00:40:19,458
big thing, a big week for us is actually

1096
00:40:19,458 --> 00:40:20,239
last week.

1097
00:40:20,699 --> 00:40:22,860
Last week was Black Thursday in the United States. It's

1098
00:40:22,860 --> 00:40:25,539
a really big shopping week, and on Amazon.com,

1099
00:40:25,780 --> 00:40:27,199
what's that? Black Friday, sorry, the,

1100
00:40:27,978 --> 00:40:30,139
the day after Thanksgiving, Black Friday is a really

1101
00:40:30,139 --> 00:40:31,090
big shopping day,

1102
00:40:31,378 --> 00:40:33,760
and Amazon.com uses app config

1103
00:40:34,090 --> 00:40:36,599
to, uh, control during peak events.

1104
00:40:37,059 --> 00:40:38,329
So if you bought something,

1105
00:40:38,619 --> 00:40:40,728
sometimes who's bought something on Amazon.com, most people

1106
00:40:40,728 --> 00:40:41,239
will raise their hand.

1107
00:40:41,579 --> 00:40:43,579
Um, if you bought something, you always

1108
00:40:43,579 --> 00:40:45,780
see people that bought this also

1109
00:40:45,780 --> 00:40:48,050
bought this, and it's a really cool suggestion,

1110
00:40:48,059 --> 00:40:49,519
and most of the time it's appreciated.

1111
00:40:49,889 --> 00:40:51,929
Well, if you're on Black Friday,

1112
00:40:52,168 --> 00:40:54,280
you're gonna still notice that, but you might

1113
00:40:54,280 --> 00:40:56,610
only see 3 suggestions of

1114
00:40:56,610 --> 00:40:57,809
things that you might wanna buy

1115
00:40:58,139 --> 00:41:00,289
instead of the normal 5 to 7 things

1116
00:41:00,489 --> 00:41:02,570
and you can imagine why that might be on a peak event

1117
00:41:02,570 --> 00:41:04,610
when people are using the website a lot we

1118
00:41:04,610 --> 00:41:07,030
wanna actually have less expensive queries

1119
00:41:07,250 --> 00:41:09,269
to the back end and get 3 different things. So that's

1120
00:41:09,409 --> 00:41:11,849
more what we call an operational flag.

1121
00:41:12,090 --> 00:41:14,269
So the first one is that release flag and,

1122
00:41:14,289 --> 00:41:15,610
and, and Ben demo that.

1123
00:41:15,918 --> 00:41:18,000
There's something that we use app config all the time for

1124
00:41:18,000 --> 00:41:19,398
called an operational flag

1125
00:41:19,679 --> 00:41:21,719
that allows you to respond quickly

1126
00:41:21,719 --> 00:41:22,719
to things on production.

1127
00:41:23,039 --> 00:41:25,320
I can have something like a throttling

1128
00:41:25,320 --> 00:41:27,469
limit. So if you have

1129
00:41:27,469 --> 00:41:29,179
an application that's a bad actor.

1130
00:41:30,208 --> 00:41:32,289
Um, and you, sorry, you,

1131
00:41:32,389 --> 00:41:34,648
you have, you have an application where you have a bad actor

1132
00:41:34,648 --> 00:41:36,668
that's messing around with your infrastructure or whatever

1133
00:41:36,668 --> 00:41:38,329
and you wanna just block that account ID.

1134
00:41:38,610 --> 00:41:40,750
You don't wanna have to push out a code change

1135
00:41:40,929 --> 00:41:43,000
to block that, let that go through your CIC. That could

1136
00:41:43,000 --> 00:41:45,010
take minutes or hours for it to go

1137
00:41:45,010 --> 00:41:47,090
through, um, a code deployment.

1138
00:41:47,329 --> 00:41:49,228
You wanna be able to respond to that immediately.

1139
00:41:49,530 --> 00:41:51,550
And so using configuration data and

1140
00:41:51,550 --> 00:41:53,610
then ops flag to allow

1141
00:41:53,610 --> 00:41:55,849
certain customers or block certain customers is a common

1142
00:41:55,849 --> 00:41:58,128
use case as well, and you can just push that out immediately

1143
00:41:58,128 --> 00:41:58,889
block that person.

1144
00:41:59,760 --> 00:42:01,809
Um, another, uh, use case

1145
00:42:01,809 --> 00:42:04,570
we see is like you might want to throttle the number of

1146
00:42:04,570 --> 00:42:06,918
background processes that are operating at peak time.

1147
00:42:07,289 --> 00:42:08,869
I used to work at a company where

1148
00:42:09,329 --> 00:42:11,519
at the end of every quarter there needed to be a lot of

1149
00:42:11,519 --> 00:42:13,599
reports generated for our customers so the customer

1150
00:42:13,599 --> 00:42:15,360
could click a button and generate reports,

1151
00:42:15,659 --> 00:42:17,769
and we wanted that report to be as

1152
00:42:17,769 --> 00:42:19,889
quickly as possible in the customer's hands, but

1153
00:42:19,889 --> 00:42:22,139
since it was the end of the quarter, every quarter

1154
00:42:22,360 --> 00:42:22,909
people

1155
00:42:23,289 --> 00:42:25,668
all on the same day would be requesting

1156
00:42:25,889 --> 00:42:28,188
that and so we basically had a queuing system.

1157
00:42:28,688 --> 00:42:30,708
That we would turn on with a feature flag that says, hey, I

1158
00:42:30,708 --> 00:42:32,809
want to queue these requests and then I'll email them a copy

1159
00:42:32,809 --> 00:42:34,889
of the report rather than generate it real time for them.

1160
00:42:35,159 --> 00:42:37,949
So again, a great way to operationally handle

1161
00:42:38,760 --> 00:42:39,590
what's going on.

1162
00:42:40,010 --> 00:42:42,010
Um, from, I think we have

1163
00:42:42,010 --> 00:42:44,019
something about in our abstract about like

1164
00:42:44,030 --> 00:42:45,809
responding to security events quickly.

1165
00:42:46,090 --> 00:42:48,489
So another use case we see a lot by our customers

1166
00:42:48,489 --> 00:42:50,668
and inside of Amazon is the

1167
00:42:50,889 --> 00:42:53,349
uh toggling of the verbosity

1168
00:42:53,728 --> 00:42:54,489
of your logging.

1169
00:42:55,070 --> 00:42:57,260
So you normally are going to be running your login

1170
00:42:57,260 --> 00:42:59,550
of course at at info level, but something

1171
00:42:59,550 --> 00:43:01,628
might be going wrong. You're not sure and

1172
00:43:01,628 --> 00:43:03,739
you want to get a lot more information so you can

1173
00:43:03,739 --> 00:43:06,188
actually flip with a feature flag or an

1174
00:43:06,188 --> 00:43:06,909
operational flag,

1175
00:43:07,269 --> 00:43:09,329
uh, the verbosity from info

1176
00:43:09,329 --> 00:43:10,010
to debug,

1177
00:43:10,309 --> 00:43:12,378
and Ben, I know you have a demo on that, right?

1178
00:43:12,539 --> 00:43:14,590
Yep, OK, great. We can take a look at that. Great, thanks. All

1179
00:43:14,590 --> 00:43:15,918
right, um.

1180
00:43:16,719 --> 00:43:18,769
OK, again, so the, the previous two

1181
00:43:18,769 --> 00:43:20,809
demos were about what we call release flags,

1182
00:43:20,849 --> 00:43:22,949
where you're controlling the release of some kind of feature,

1183
00:43:23,250 --> 00:43:24,628
uh, question, yeah, go ahead.

1184
00:43:26,820 --> 00:43:27,409
You might end up on a lot of that,

1185
00:43:30,780 --> 00:43:32,000
so say some of the problem with that.

1186
00:43:41,239 --> 00:43:45,469
people I'm

1187
00:43:45,469 --> 00:43:47,050
having a little bit of trouble hearing you.

1188
00:43:48,628 --> 00:43:50,639
So say there might be a

1189
00:43:50,639 --> 00:43:51,840
situation we might end up with a lot of

1190
00:43:54,188 --> 00:43:54,809
release flags,

1191
00:43:55,070 --> 00:43:56,648
stale release flags and clean up,

1192
00:43:57,429 --> 00:43:58,148
yeah, yeah, yeah, yeah.

1193
00:43:59,320 --> 00:44:01,559
That's the case. If I have to do a cleanup,

1194
00:44:01,800 --> 00:44:03,300
I mean, I can turn it off here.

1195
00:44:03,659 --> 00:44:05,070
Maybe there is a feature here,

1196
00:44:05,360 --> 00:44:07,398
but should I make code changes to

1197
00:44:07,398 --> 00:44:09,570
clean it up there as well for a specific,

1198
00:44:09,800 --> 00:44:10,668
say, in this case it's la.

1199
00:44:12,398 --> 00:44:14,360
Yeah, a lot of that,

1200
00:44:14,760 --> 00:44:16,429
but I won't use it in future for him really.

1201
00:44:17,000 --> 00:44:19,039
I just need one specific feature. I turn it

1202
00:44:19,039 --> 00:44:19,929
on. That's all,

1203
00:44:20,719 --> 00:44:21,340
right? So

1204
00:44:21,668 --> 00:44:22,688
if I have to do a cleanup,

1205
00:44:23,398 --> 00:44:25,398
do I have to do a clean up in the code because I

1206
00:44:25,398 --> 00:44:26,418
was not sure

1207
00:44:27,849 --> 00:44:28,789
the end point. Right,

1208
00:44:32,019 --> 00:44:34,019
right, so the question is if I have these flags that

1209
00:44:34,019 --> 00:44:35,878
I have been around for a while and I'm not using them anymore,

1210
00:44:36,300 --> 00:44:38,449
sure I can delete them from app config, but do I also need to go

1211
00:44:38,449 --> 00:44:39,809
clean up my code? Is that the question?

1212
00:44:40,378 --> 00:44:41,688
Yes, um, the answer,

1213
00:44:41,978 --> 00:44:44,019
do you have to clean up the code? Technically

1214
00:44:44,019 --> 00:44:46,179
no, but it is highly, highly recommended, right,

1215
00:44:46,340 --> 00:44:47,519
because over the course of time

1216
00:44:48,059 --> 00:44:50,219
you're, you know, fundamentally when you're adding a feature

1217
00:44:50,219 --> 00:44:51,719
flag to your code, you're adding a branch.

1218
00:44:52,090 --> 00:44:54,289
In your logic, right? And so if you, if

1219
00:44:54,289 --> 00:44:56,329
time goes on and you end up with hundreds or in some

1220
00:44:56,329 --> 00:44:58,329
cases thousands of feature flags and you have thousands

1221
00:44:58,329 --> 00:45:00,369
of unnecessary branches in your code, it's

1222
00:45:00,369 --> 00:45:02,409
just, it's ripe for disaster someday, right?

1223
00:45:02,550 --> 00:45:04,648
Developers gonna come in and they think they're changing something

1224
00:45:04,648 --> 00:45:06,668
unrelated, but really they change how

1225
00:45:06,668 --> 00:45:08,809
feature flags evaluated and then your application just starts

1226
00:45:08,809 --> 00:45:10,039
behaving unexpectedly.

1227
00:45:10,449 --> 00:45:12,909
So yes, as far as the cleanup story goes,

1228
00:45:13,329 --> 00:45:15,369
yes, you can delete them from app config. We also

1229
00:45:15,369 --> 00:45:16,070
recommend deleting,

1230
00:45:16,478 --> 00:45:18,478
uh, or cleaning up rather your code where

1231
00:45:18,478 --> 00:45:20,208
you introduced that branch,

1232
00:45:20,570 --> 00:45:22,708
right? And do you mind showing

1233
00:45:22,708 --> 00:45:24,769
the little short term flag as we have a

1234
00:45:24,769 --> 00:45:26,889
little mechanism in the console here that you can

1235
00:45:26,889 --> 00:45:29,309
see. So if I create a new.

1236
00:45:30,219 --> 00:45:32,260
Feature flag by clicking this add new flag

1237
00:45:32,260 --> 00:45:34,360
button. I'll do a basic flag

1238
00:45:34,360 --> 00:45:36,398
and we have this box here that's called this is a

1239
00:45:36,398 --> 00:45:37,219
short term flag

1240
00:45:37,679 --> 00:45:39,708
and so when I do this, you know, at the time that I'm creating

1241
00:45:39,708 --> 00:45:41,978
my future flag, I can say hey this is a short term flag.

1242
00:45:42,760 --> 00:45:44,918
And I have a target deprecation

1243
00:45:44,918 --> 00:45:47,199
date of, uh, let's say end of Q1.

1244
00:45:48,349 --> 00:45:50,360
And so now when I, you know, I'm

1245
00:45:50,360 --> 00:45:52,438
looking at my list of flags in my app config account, I

1246
00:45:52,438 --> 00:45:54,519
can sort by deprecation date and I can see, oh,

1247
00:45:54,559 --> 00:45:55,708
these are the ones that I,

1248
00:45:56,000 --> 00:45:58,030
I don't, I shouldn't be using anymore. I said I wouldn't be

1249
00:45:58,030 --> 00:46:00,119
using it by this date, so let me go check on that and see if I

1250
00:46:00,119 --> 00:46:00,860
should clean that up.

1251
00:46:02,239 --> 00:46:04,349
Yeah, app config won't delete that flag

1252
00:46:04,349 --> 00:46:06,360
on your behalf. That'd be really risky for the

1253
00:46:06,360 --> 00:46:07,070
service to do,

1254
00:46:07,478 --> 00:46:09,478
but it will remind you that you have

1255
00:46:09,478 --> 00:46:11,699
quote unquote overdue flags that you wanna go look at.

1256
00:46:12,039 --> 00:46:14,039
We know that when an engineer creates a flag, they

1257
00:46:14,039 --> 00:46:16,280
have a guess about when it will be deprecated,

1258
00:46:16,329 --> 00:46:18,469
but it's not a super reliable, so it just

1259
00:46:18,469 --> 00:46:20,099
uses a kind of a reminder system,

1260
00:46:21,878 --> 00:46:23,898
yeah. I don't know if you have this set up in your

1261
00:46:23,898 --> 00:46:25,909
demo, but basically in the console,

1262
00:46:26,208 --> 00:46:28,340
you, if you're using the console, you can see overdue

1263
00:46:28,340 --> 00:46:30,378
flags. You can filter for overdue flags. You

1264
00:46:30,378 --> 00:46:32,449
can also do that on your own, uh, you know, everything you

1265
00:46:32,449 --> 00:46:33,958
see in the console is obviously available

1266
00:46:34,300 --> 00:46:36,619
via API and cloud formation and terraform, etc.

1267
00:46:36,769 --> 00:46:38,000
so you can look at that data too.

1268
00:46:38,539 --> 00:46:40,769
So the, the logging value is an

1269
00:46:40,769 --> 00:46:42,530
interesting one, and this is a problem that we've had where

1270
00:46:43,019 --> 00:46:45,039
developers have turned on debug logs

1271
00:46:45,260 --> 00:46:46,719
and we forgot

1272
00:46:47,019 --> 00:46:49,019
and then it ends up blowing up like our,

1273
00:46:49,099 --> 00:46:50,128
our logging, our logging, yeah,

1274
00:46:51,418 --> 00:46:53,418
so. If this

1275
00:46:53,418 --> 00:46:55,708
is a solution for that and you set this,

1276
00:46:55,898 --> 00:46:57,579
they won't necessarily turn it back off.

1277
00:46:58,559 --> 00:47:00,590
Correct. I mean, depending on the, depending on the

1278
00:47:00,590 --> 00:47:02,398
use case, you hear that a lot at AWS,

1279
00:47:02,800 --> 00:47:03,978
um, depending on the use case,

1280
00:47:04,280 --> 00:47:06,309
if you wanna have logging on for, you know,

1281
00:47:06,599 --> 00:47:07,340
a couple of months,

1282
00:47:07,610 --> 00:47:09,679
then I think this could be kind of helpful to remind

1283
00:47:09,679 --> 00:47:11,639
you, hey, you, you should update this flag.

1284
00:47:11,958 --> 00:47:14,079
If you are just turning on for a couple of hours, I

1285
00:47:14,079 --> 00:47:16,188
don't think this would be a good application. You probably need a

1286
00:47:16,188 --> 00:47:17,280
different mechanism for,

1287
00:47:17,760 --> 00:47:18,898
um, for flipping that.

1288
00:47:19,349 --> 00:47:20,199
Another question over there, sir.

1289
00:47:21,610 --> 00:47:25,378
by welcome you. When

1290
00:47:25,378 --> 00:47:27,378
you create a flag, can you create a what? Yeah, that's,

1291
00:47:27,539 --> 00:47:29,699
that's part of the metadata here on this creation screen,

1292
00:47:29,898 --> 00:47:32,780
yeah. for

1293
00:47:32,780 --> 00:47:34,789
that. Your code does

1294
00:47:34,789 --> 00:47:36,228
not have access to this value.

1295
00:47:36,918 --> 00:47:39,000
It's just in the app config control plane where

1296
00:47:39,000 --> 00:47:40,579
you can see this, yeah.

1297
00:47:42,398 --> 00:47:44,550
That's correct. You could of course add an attribute

1298
00:47:44,550 --> 00:47:46,289
that we talked about earlier and just put it in there too,

1299
00:47:46,668 --> 00:47:48,889
but yes, the, the deprecation date, this field strictly

1300
00:47:48,889 --> 00:47:50,070
is not included in the response,

1301
00:47:50,489 --> 00:47:52,500
yeah. Yeah, we,

1302
00:47:52,550 --> 00:47:54,628
we talked about it quite a bit as a service team

1303
00:47:54,628 --> 00:47:56,699
about how we would want to have customers

1304
00:47:56,699 --> 00:47:58,789
use it and it's it's just it's

1305
00:47:58,789 --> 00:48:00,978
too risky to have uh people just

1306
00:48:00,978 --> 00:48:03,019
automatically are putting a process in to delete a

1307
00:48:03,019 --> 00:48:05,010
flag. Um, so we

1308
00:48:05,309 --> 00:48:07,309
purposely chose to not expose that down into the

1309
00:48:07,309 --> 00:48:09,128
agent. Yeah, we actually have a

1310
00:48:09,469 --> 00:48:11,708
somewhat new feature that we released that we call deletion

1311
00:48:11,708 --> 00:48:13,949
protection. So if you go try to delete, you know, any

1312
00:48:13,949 --> 00:48:15,949
kind of config, app config obviously supports feature

1313
00:48:15,949 --> 00:48:17,989
flags. We also support what we call free form

1314
00:48:17,989 --> 00:48:20,110
config, which is bring your own config data. We

1315
00:48:20,110 --> 00:48:22,110
don't care what the format is. You just give us the data and we

1316
00:48:22,110 --> 00:48:23,769
manage the versioning and the deployments,

1317
00:48:24,208 --> 00:48:26,469
um. In that case,

1318
00:48:26,728 --> 00:48:28,809
we, if you go try, you know, we track your

1319
00:48:28,809 --> 00:48:31,128
usage of it or track the requests that you're making

1320
00:48:31,128 --> 00:48:33,360
for it, and if, if you try to delete that config

1321
00:48:33,360 --> 00:48:35,610
and we say, oh we actually you hadn't, you have live traffic

1322
00:48:35,610 --> 00:48:37,728
on this thing, then by default we'll say, hey, you can't delete

1323
00:48:37,728 --> 00:48:39,809
this unless you click the I know what I'm doing button.

1324
00:48:40,128 --> 00:48:42,208
For example, we don't have that for individual flags at this

1325
00:48:42,208 --> 00:48:44,039
point in time, we do have it at the config level,

1326
00:48:44,369 --> 00:48:46,469
right? OK, let's

1327
00:48:46,469 --> 00:48:48,619
do the logging verbosity demo and then we'll come back

1328
00:48:48,840 --> 00:48:50,918
to uh more questions if there are any.

1329
00:48:51,750 --> 00:48:53,829
So I'm going back to my lambda latte config and we're

1330
00:48:53,829 --> 00:48:55,860
going to take a look at our 3rd and final flag,

1331
00:48:55,878 --> 00:48:57,300
which is called log level.

1332
00:48:58,188 --> 00:49:00,280
This flag has an attribute

1333
00:49:00,280 --> 00:49:02,639
called level, and

1334
00:49:02,878 --> 00:49:04,500
of course right now it's set to info.

1335
00:49:04,918 --> 00:49:07,110
Actually, before I change this, I'm going to go back to the lambda

1336
00:49:07,110 --> 00:49:08,820
latte application and pull up

1337
00:49:09,159 --> 00:49:10,860
the uh logs.

1338
00:49:12,409 --> 00:49:13,909
So let's take a look at the

1339
00:49:15,398 --> 00:49:17,469
JavaScript console here, there's, I just cleared

1340
00:49:17,469 --> 00:49:19,469
it out, so there's nothing here. You can see it's not printing

1341
00:49:19,469 --> 00:49:21,409
anything right now, nothing interesting is happening.

1342
00:49:22,688 --> 00:49:25,000
What I want to do is go in and edit my flag

1343
00:49:25,500 --> 00:49:27,019
and change this to.

1344
00:49:27,878 --> 00:49:28,579
Debug

1345
00:49:29,079 --> 00:49:31,599
and you'll notice another thing about app config

1346
00:49:31,599 --> 00:49:33,599
feature flag attributes is that they

1347
00:49:33,599 --> 00:49:35,019
allow you to add constraints to them.

1348
00:49:35,438 --> 00:49:37,478
So in this case, I've said, hey, this is a string.

1349
00:49:38,349 --> 00:49:40,398
And I don't want any values

1350
00:49:40,398 --> 00:49:42,559
to be allowed except the ones that I'm that I've defined

1351
00:49:42,559 --> 00:49:43,820
here, so we call an enum.

1352
00:49:44,360 --> 00:49:45,938
It also supports regular expressions.

1353
00:49:46,320 --> 00:49:47,898
So if I come in here, you know, and I'm,

1354
00:49:48,159 --> 00:49:50,199
I'm, I'm, uh, debugging

1355
00:49:50,199 --> 00:49:52,228
something at 3 in the morning and I want to flip the logs and

1356
00:49:52,228 --> 00:49:54,590
I'm just trying to do this quickly and I'm half awake and I accidentally

1357
00:49:54,590 --> 00:49:56,909
put a space in here, and the app can make is gonna tell me, hey, you,

1358
00:49:57,000 --> 00:49:59,119
you can't do that because it doesn't match the enum, right? So it's

1359
00:49:59,119 --> 00:50:00,039
another convenient,

1360
00:50:00,309 --> 00:50:02,590
uh, or powerful feature of, uh,

1361
00:50:02,599 --> 00:50:03,820
attributes or constraints.

1362
00:50:04,878 --> 00:50:06,938
So let's turn on debug logging. I'm gonna update my future

1363
00:50:06,938 --> 00:50:08,829
flag and deploy it.

1364
00:50:13,309 --> 00:50:15,349
So we'll start that deployment and then I'll come over

1365
00:50:15,349 --> 00:50:16,728
to my console and I'll expect

1366
00:50:17,429 --> 00:50:19,500
in the next couple of seconds for my debug logs to

1367
00:50:19,500 --> 00:50:21,878
come in, which are gonna show like, hey, I'm

1368
00:50:21,878 --> 00:50:23,250
about to make a request for this user

1369
00:50:23,708 --> 00:50:24,289
to the back end.

1370
00:50:24,628 --> 00:50:26,739
Here's how the back end responded. I'm about to make a request for this

1371
00:50:26,739 --> 00:50:28,750
user to the back end, here's how the backend responded. This is

1372
00:50:28,750 --> 00:50:30,849
happening, I think it's every 5 seconds that this is happening,

1373
00:50:31,269 --> 00:50:33,050
and you can see these are my, my debug logs.

1374
00:50:34,159 --> 00:50:36,250
And then of course when I'm done I can go turn it back off.

1375
00:50:36,438 --> 00:50:38,639
Um, if you're worried about forgetting about turning debug logs

1376
00:50:38,639 --> 00:50:40,639
off because it can get quite expensive over the course of

1377
00:50:40,639 --> 00:50:42,769
time. Something that you could do is

1378
00:50:42,769 --> 00:50:44,250
set up like a a

1379
00:50:44,519 --> 00:50:45,389
cloud watch

1380
00:50:45,849 --> 00:50:47,829
alarm so you could emit a metric on your log level,

1381
00:50:48,128 --> 00:50:50,329
and then you could set up an alarm that, you know, if, if

1382
00:50:50,329 --> 00:50:52,409
your log level stays uh something

1383
00:50:52,409 --> 00:50:54,449
more granular than info for, I don't know,

1384
00:50:54,559 --> 00:50:56,809
12345 hours, whatever it is, then

1385
00:50:56,809 --> 00:50:58,889
that alarm can go red to alert you're on call so

1386
00:50:58,889 --> 00:51:00,969
you know, oh, we forgot to turn that thing off. So that could

1387
00:51:00,969 --> 00:51:02,148
be one strategy for

1388
00:51:02,489 --> 00:51:03,989
remembering to turn this back off.

1389
00:51:06,119 --> 00:51:08,449
OK, great. That's the ops flag

1390
00:51:08,789 --> 00:51:10,889
demo with a logging level use

1391
00:51:10,889 --> 00:51:12,969
case. We have about 10 minutes

1392
00:51:12,969 --> 00:51:15,250
left. We're gonna cover just the

1393
00:51:15,250 --> 00:51:17,329
idea if I can spend 2 minutes and we'll just have

1394
00:51:17,329 --> 00:51:19,489
questions, um, 2 minutes covering a couple of other things.

1395
00:51:19,769 --> 00:51:20,929
I said this before, but,

1396
00:51:21,188 --> 00:51:23,599
um, feature flags are very seductive.

1397
00:51:23,929 --> 00:51:25,969
People think it's no big deal just to flip a feature

1398
00:51:25,969 --> 00:51:28,148
flag. If something goes wrong, I'm gonna flip it back.

1399
00:51:28,489 --> 00:51:30,635
But you can see from. How we have set up our

1400
00:51:30,635 --> 00:51:32,304
service, they're very dangerous.

1401
00:51:32,635 --> 00:51:34,664
99.9% of the time, no problems,

1402
00:51:34,753 --> 00:51:36,914
but when they go wrong, things can go really wrong. If

1403
00:51:36,914 --> 00:51:39,034
you were around for 2017

1404
00:51:39,244 --> 00:51:41,394
S3 outage in US East One,

1405
00:51:41,514 --> 00:51:43,715
that was an extra semicolon

1406
00:51:43,715 --> 00:51:46,114
in a configuration change, and that was

1407
00:51:46,114 --> 00:51:47,394
before AP Config existed,

1408
00:51:48,063 --> 00:51:50,414
um, and that was part of the reason we, we launched AP Config internally.

1409
00:51:50,909 --> 00:51:52,179
Um, so these things

1410
00:51:52,438 --> 00:51:54,559
do require a kind of a culture change. It

1411
00:51:54,559 --> 00:51:57,179
requires caution. You should treat your configuration

1412
00:51:57,179 --> 00:51:59,438
like it's code and make sure that you're not just

1413
00:51:59,438 --> 00:52:01,579
willy-nilly pushing things to production just like you would

1414
00:52:01,579 --> 00:52:03,159
push untested code to production,

1415
00:52:03,438 --> 00:52:05,478
but they're super powerful too. Again, they allow you to

1416
00:52:05,478 --> 00:52:06,539
respond to things very quickly.

1417
00:52:07,039 --> 00:52:08,188
So, um,

1418
00:52:08,909 --> 00:52:11,019
two quick PSA in or one quick, um.

1419
00:52:11,519 --> 00:52:13,559
Uh, I do have some stickers over there and

1420
00:52:13,559 --> 00:52:15,639
then out in the hallway we're happy to answer questions

1421
00:52:15,639 --> 00:52:17,659
afterwards. Why don't we spend about 5 minutes,

1422
00:52:17,929 --> 00:52:19,340
uh, answering questions here

1423
00:52:19,800 --> 00:52:21,878
in the room in case you have some shared questions, and then Ben and

1424
00:52:21,878 --> 00:52:22,760
I will be outside,

1425
00:52:23,039 --> 00:52:25,079
uh, uh, answering questions too. So I'll also

1426
00:52:25,079 --> 00:52:27,110
say before we take the first question, I'm just gonna. Pull up our

1427
00:52:27,110 --> 00:52:29,110
final slide, which is if you want to

1428
00:52:29,110 --> 00:52:30,409
head out during the question section,

1429
00:52:30,820 --> 00:52:32,909
um, thank you for attending first of all. Second

1430
00:52:32,909 --> 00:52:34,599
of all, we have some resources up on the screen.

1431
00:52:34,869 --> 00:52:37,110
Uh, the top one is the app config user guide. So

1432
00:52:37,110 --> 00:52:39,188
this is what your your resource for learning about

1433
00:52:39,188 --> 00:52:41,269
all things app config, including the concepts that we talked

1434
00:52:41,269 --> 00:52:43,269
today. And then the bottom QR code

1435
00:52:43,269 --> 00:52:45,449
is requesting a meeting. So if you have a more, uh,

1436
00:52:45,469 --> 00:52:47,489
detailed use case that you'd like to talk through with us

1437
00:52:47,489 --> 00:52:48,208
and our team,

1438
00:52:48,469 --> 00:52:50,628
then feel free to use that link to request

1439
00:52:50,628 --> 00:52:51,760
a meeting with us.

1440
00:52:52,800 --> 00:52:54,800
Um, OK, I'm looking at the clock. I wanna make sure

1441
00:52:54,800 --> 00:52:56,800
you all have time to get to your next session or lunch or

1442
00:52:56,800 --> 00:52:58,878
whatever is next for you all. Um, Ben and

1443
00:52:58,878 --> 00:52:59,898
I will be right outside.

1444
00:53:00,320 --> 00:53:02,478
Um, I, I was gonna do like trivia

1445
00:53:02,478 --> 00:53:04,519
and give out, so I, I have some

1446
00:53:04,519 --> 00:53:06,760
jackets, and, uh, I don't know how I'm gonna allocate

1447
00:53:06,760 --> 00:53:09,079
them. Maybe first come, first served. We do have stickers

1448
00:53:09,079 --> 00:53:11,159
sitting over there, so grab those. There should be enough for everybody.

1449
00:53:11,320 --> 00:53:13,719
Also, don't forget the survey. Yeah, do the survey

1450
00:53:13,719 --> 00:53:14,539
and thank you all for coming.

1451
00:53:14,958 --> 00:53:16,360
Thank you. Enjoy the rest of your reinvent. Thank you.

