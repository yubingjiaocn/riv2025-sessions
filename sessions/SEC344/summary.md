# AWS re:Invent 2025 会议总结：使用 IAM Identity Center 和可信身份传播简化数据湖访问

## 会议概述

本次会议由 AWS 身份解决方案团队的解决方案架构师 Laura Wright 主讲，重点介绍了如何通过 IAM Identity Center 和可信身份传播（Trusted Identity Propagation）功能来简化数据湖的访问控制。会议深入探讨了传统 IAM 角色在数据访问管理中面临的挑战，以及新的身份传播机制如何解决这些问题。

传统的 AWS 数据湖架构中，数据从多个来源（传统数据库、流数据、本地文件系统等）通过 AWS Glue 进行摄取和转换，最终存储在 S3 或 Redshift 中。然而，当应用程序需要根据不同用户角色提供精细化的数据访问控制时，传统的 IAM 角色方式会导致角色和策略的激增，管理复杂度急剧上升，且难以追踪具体用户的操作行为。可信身份传播通过将用户身份上下文传递到整个服务调用链中，实现了基于真实用户身份的访问控制，而不是基于共享的 IAM 角色。

这种新方法的核心优势在于：建立了跨 AWS 生态系统的统一用户身份，所有集成服务（如 QuickSight、Redshift、Athena、Lake Formation）都能识别同一个用户 ID；在 CloudTrail 日志中可以追踪到每个 API 调用背后的真实用户；大幅减少了需要管理的 IAM 角色数量，仅保留服务角色而非用户角色；支持自定义应用程序集成，将企业身份提供商的身份一直传播到 AWS 服务层。

## 详细时间线

开场介绍 (0:00-1:30)
- 演讲者 Laura Wright 自我介绍，来自 AWS 身份解决方案团队
- 会议主题：简化数据湖访问控制

AWS 数据湖架构概述 (1:30-4:00)
- 介绍典型的数据湖架构：数据源 → AWS Glue 摄取和转换 → 存储（S3/Redshift）
- 强调会议重点不在数据摄取，而在数据准备就绪后的访问控制问题
- 举例：AI 聊天机器人通过 Athena 查询数据并用 LLM 增强回答

传统 IAM 角色的挑战 (4:00-7:00)
- 问题：如何让 Athena 知道终端用户有权访问哪些数据？
- 传统方案：为每个访问模式创建 IAM 角色（销售经理角色、营销团队角色、数据科学团队角色等）
- 挑战：
  - 角色和策略数量激增，管理复杂
  - 策略容易达到大小限制
  - 存在过度授权风险
  - 难以追踪具体用户操作（多个用户共享同一角色）

可信身份传播解决方案 (7:00-10:30)
- 可信身份传播是 IAM Identity Center 的功能
- 允许管理员基于真实用户身份或用户组分配权限
- 前提条件：启用 IAM Identity Center 并集成身份提供商（Okta、Entra、Active Directory 等）
- 核心概念：在 AWS 生态系统中建立单一通用身份，具有唯一用户 ID

集成应用程序的工作机制 (10:30-13:00)
- AWS 托管应用程序（QuickSight、Redshift、Athena 等）需要先注册到 Identity Center
- 这些应用程序可以查询 Identity Center 获取用户信息和组成员关系
- 实现统一访问控制模型：例如在 Redshift 中直接为 Identity Center 用户或组授予 schema 访问权限
- 支持跨账户委托管理

身份传播流程演示 (13:00-15:30)
- 步骤 1：将应用程序注册到 Identity Center
- 步骤 2：在应用程序中为用户（如 Alice）分配访问权限
- 步骤 3：用户登录并通过 Identity Center 认证
- 步骤 4：应用程序查询 Identity Center 获取用户身份和组信息
- 步骤 5：基于用户身份授权数据访问（schema、行级别等）

前后对比：角色模型 vs 身份传播 (15:30-18:00)
- 传统模型：多个用户（Alice、Bob）共享同一个 IAM 角色，CloudTrail 只记录角色名称
- 新模型：每个用户保持独立身份，无需假定角色，应用程序直接基于用户身份授权
- 关键区别：终端用户不再需要角色，只有服务需要角色

服务角色与身份上下文 (18:00-21:00)
- 澄清：AWS 服务仍然使用服务角色进行相互通信
- 创新点：服务角色被"增强"了用户身份上下文
- 示例流程：
  - Alice 登录 QuickSight → QuickSight 假定其服务角色并附加 Alice 的身份上下文
  - QuickSight 调用 Athena → 传递 Alice 的身份上下文
  - Athena 调用 Lake Formation → 继续传递 Alice 的身份上下文
  - 每个服务都知道操作是代表 Alice 执行的

CloudTrail 日志增强 (21:00-24:00)
- 展示 CloudTrail 日志结构的变化
- 新增"on behalf of"部分，包含真实用户 ID
- 用户身份在所有服务日志中保持一致（QuickSight、Athena、Lake Formation、S3）
- 用户 ID 在整个 AWS 组织中唯一，甚至跨组织唯一
- 可以查询特定用户执行的所有操作

用户身份的核心价值 (24:00-26:30)
- 用户 ID 包含目录 ID 和 Identity Center ARN
- 可以精确识别用户来自哪个 Identity Center 实例（支持多实例场景）
- 实现了跨 AWS 生态系统的中心化身份管理
- 支持用户级别的细粒度权限控制
- 大幅减少需要管理的角色数量

身份感知的服务链传递 (26:30-28:00)
- 身份上下文在整个下游服务链中传递
- 需要一个面向客户的入口应用程序（如 QuickSight）
- 支持自定义应用程序集成（例如员工门户）
- 强大之处：不仅限于 AWS 服务，自定义应用也可以使用相同的身份传播机制
- 实现从企业身份提供商到 AWS 环境的端到端身份传递

总结 (28:00-结束)
- 感谢听众参与
- 强调可信身份传播为数据湖访问控制带来的革命性改进