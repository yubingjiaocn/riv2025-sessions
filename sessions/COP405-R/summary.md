# AWS re:Invent 2025 会议总结：使用 AI Agent 改善可观测性

## 会议概述

本次会议探讨了如何利用 AWS 的 AI Agent 工具来改善应用程序的可观测性态势，避免凌晨 3 点被生产环境故障叫醒的困境。演讲者 Kevin 和 Andrea 通过实际代码演示，展示了如何构建一个自然语言可观测性 Agent，该 Agent 能够自动分析 AWS 基础设施、发现问题、创建告警，并生成可操作的建议报告。

会议的核心观点是：可观测性领域的问题已经从"数据不足"转变为"数据过多"。随着 OpenTelemetry 和 CloudWatch 等工具的普及，生成可观测性数据变得前所未有的简单，但快速解决问题的能力却没有跟上。AI Agent 正是解决这一问题的理想方案，它能够处理海量的结构化数据（指标、日志、追踪），并将其转化为人类可理解的自然语言输出和可执行的操作建议。

演讲者使用了一个宠物领养网站（Pet Adoption Clinic）作为演示案例，这是一个基于 EKS 的分布式应用。通过 Strands Agent SDK 和 MCP（Model Context Protocol）工具，他们构建的 Agent 能够自动发现资源、分析健康状况、识别安全扫描攻击、创建关键告警，并生成包含执行摘要、关键指标、操作建议的 HTML 报告。整个实现过程代码简洁，核心逻辑仅需少量代码即可完成。

## 详细时间线与关键要点

### 开场与问题定义 (00:00 - 03:30)
- **00:00** - 演讲者通过提问引入话题：有多少人曾在凌晨 3 点被叫醒查看生产环境日志？
- **01:15** - 介绍会议主题：使用 agentic 工具改善可观测性态势，这是一个代码实战会议
- **02:00** - Kevin 分享在 AWS 从事可观测性工作 7 年的经验，指出行业问题已发生转变
- **02:45** - 过去的问题：客户缺少必要的指标、日志和追踪数据
- **03:15** - 现在的问题：数据过多导致无法快速解决问题

### AI Agent 在可观测性中的应用 (03:30 - 06:00)
- **03:45** - 强调 AI 是可观测性领域的理想用例
- **04:20** - Agent 的工作原理：接收自然语言查询，处理大量上下文，执行程序化工作（SQL 查询、Metric Insights 查询），返回自然语言响应
- **05:10** - Agent 需要访问正确的数据才能有效工作
- **05:40** - 介绍 MCP（Model Context Protocol）工具的重要性

### MCP 工具与安全边界 (06:00 - 08:30)
- **06:15** - 询问现场有多少人使用 MCP 工具（大多数人举手）
- **06:45** - MCP 的作用：让 Agent 访问 CloudWatch、Prometheus 等工具
- **07:20** - MCP 的两个关键功能：告知 Agent 可用的 API、提供安全边界
- **08:00** - 安全考虑：不希望每台电脑上的 Agent 都直接拥有查询权限

### 演示案例介绍 (08:30 - 11:00)
- **08:45** - 介绍 Pet Adoption Clinic 演示网站，包含真实宠物照片
- **09:30** - 这是一个虚拟的 Web 应用，用户可以领养宠物、带宠物看兽医、购买宠物食品
- **10:15** - 随着应用变得更加分布式，每个服务都会产生可观测性数据
- **10:45** - 数据爆炸问题：从单体应用的一个数据源扩展到可能 50 个数据源

### Agent 构建策略 (11:00 - 13:30)
- **11:20** - 所有数据发送到 CloudWatch（也可以是其他可观测性工具）
- **11:50** - 构建 Agent 的最重要原则：提供尽可能多的上下文
- **12:15** - 定义 SLO（服务级别目标）：告诉 Agent 什么对组织重要
- **12:45** - SLO 示例：期望应用在过去 30 天内 99% 的请求延迟低于 30ms
- **13:10** - 分析趋势：不仅看当前状态，还要预测潜在问题

### Agent 改进机制 (13:30 - 15:00)
- **13:45** - 让 Agent 随时间改进：将每次成功运行的发现反馈给 Agent
- **14:20** - 系统架构：自然语言查询 → LLM → Strands Agent SDK
- **14:50** - Strands Agent 是开源 SDK，可以用约 10 行代码构建 Agent

### 系统组件与输出 (15:00 - 17:30)
- **15:15** - 提供操作原则、SLO、明确的目的和工作方式
- **15:45** - 提供 MCP 访问权限以便查询数据
- **16:20** - 期望的输出：可用的报告（HTML 格式发送给利益相关者）
- **16:50** - Agent 可以发现缺口并自动创建告警
- **17:10** - 目标：将结构化数据的程序化查询转化为人类可理解的输出

### Andrea 开始代码演示 (17:30 - 20:00)
- **17:45** - Andrea 接手演示，强调所有代码都是开源的
- **18:10** - 重要提醒：代码会实际执行操作并创建资源，建议在预生产环境测试
- **18:45** - 展示可观测性报告的结构
- **19:20** - Agent 在后台开始运行分析

### 报告分析：执行摘要 (20:00 - 23:00)
- **20:15** - 报告包含执行摘要：识别出基于 EKS 的宠物领养系统
- **20:45** - 发现 Lambda 函数和全面的日志记录
- **21:20** - 关键发现：Pet Site 部署服务存在活跃流量和安全扫描
- **22:00** - Agent 决定创建关键监控告警
- **22:30** - 这是报告的 TL;DR（太长不看）版本

### 报告分析：告警部分 (23:00 - 25:30)
- **23:15** - 告警部分：系统原本没有任何告警
- **23:45** - Agent 创建了 4 个关键告警：Pet Site 高延迟、高故障率、错误率、Lambda 持续时间告警
- **24:30** - 强调 Agent 理解账户内容并创建必要告警的能力令人印象深刻
- **25:00** - 确认发现安全扫描活动

### 报告分析：关键指标 (25:30 - 28:30)
- **25:45** - 关键指标部分：Pet Site 错误率、请求率、延迟
- **26:20** - 故障率分析：0.07% 的低故障率，不令人担忧但需要注意
- **27:00** - 重要发现：错误率时间序列显示有故障但没有相关错误
- **27:45** - 推断：可能存在 500 错误但没有 400 错误
- **28:10** - 延迟问题：平均 400 毫秒的延迟，不太理想

### 报告分析：操作审计 (28:30 - 31:00)
- **28:45** - 操作审计树视图：EKS 应用平均延迟 42 毫秒
- **29:20** - 提供控制台链接以便自行检查
- **29:50** - 500 服务器错误处于可接受水平（0.06%）
- **30:30** - 确认存在活跃流量

### 报告分析：Lambda 和 Synthetic 监控 (31:00 - 33:30)
- **31:15** - Lambda 函数分析：状态更新函数、Step Functions
- **31:45** - Synthetic 监控介绍：CloudWatch 服务，用于运行 Canary 测试
- **32:20** - Synthetic 监控允许端到端测试，调用 API 并验证响应
- **32:50** - 发现 4 个端到端测试（基于 Lambda）
- **33:10** - EKS 基础设施：集群有 2GB 存储

### 报告分析：日志和成本优化 (33:30 - 35:30)
- **33:45** - CloudWatch 日志分析：2GB 存储中有 1.36GB 是应用日志
- **34:15** - 识别出成本优化机会
- **34:45** - 操作发现：详细描述安全扫描活动
- **35:10** - 发现针对所有操作的大量扫描（100+ 次）

### 报告分析：安全威胁识别 (35:30 - 37:30)
- **35:45** - 识别出常见攻击路径：PHP 漏洞利用、管理面板探测、WordPress 漏洞
- **36:30** - Agent 提供建议：应该采取什么措施
- **37:00** - 建议分为三个层级：立即行动、中期改进、长期改进

### 报告分析：可操作建议 (37:30 - 40:30)
- **37:45** - 立即行动：在 Pet Site 上启用 Web 应用防火墙（WAF）以阻止扫描
- **38:20** - 监控方面：Agent 已创建告警（因为之前没有）
- **39:00** - 注意：Agent 没有创建 SLO，因为没有提供相应工具（留作练习）
- **39:40** - 中期改进：解决 400 毫秒延迟问题
- **40:10** - 长期改进：服务利用率接近 3%，可以使用自动扩展策略改进

### 报告分析：行业最佳实践关联 (40:30 - 43:00)
- **40:45** - 与行业已知事件关联：这是一个重要功能
- **41:20** - 凌晨 3 点被叫醒时，想知道这是否是行业已知问题
- **42:00** - 安全扫描关联到 2022 年 WordPress 安全漏洞
- **42:30** - Agent 解释漏洞内容、背景、应用的解决方案（AWS WAF）
- **42:50** - 提供具体实施步骤：部署 WAF、使用 OWASP Top 10 规则集、启用 CloudTrail

### 代码演示开始 (43:00 - 45:30)
- **43:20** - 询问观众是否准备好看代码（观众举手）
- **43:50** - 开玩笑让观众拿出笔记本电脑
- **44:15** - 说明由于时间限制（1 小时），将展示最有趣的代码部分
- **44:45** - 再次强调代码是开源的，可以下载、修改和尝试
- **45:10** - 在讲解的同时，Agent 在终端中开始运行

### 代码结构：主文件 (45:30 - 48:00)
- **45:45** - 展示 observability-agent 文件夹，这是一个 Python Agent
- **46:15** - 主文件包含设置和参数：区域、报告格式（Markdown/HTML）、详细程度
- **47:00** - 最重要的代码：第 52-53 行，创建自然语言可观测性 Agent 并运行分析
- **47:40** - 进入 observability_agent 查看详细实现

### 代码结构：Strands Agent (48:00 - 50:00)
- **48:15** - 整个代码使用 Strands Agent
- **48:45** - Strands Agent 用于创建工具、使用 MCP 服务器和工具、创建实际 Agent
- **49:20** - 强调使用的简便性
- **49:50** - __init__ 方法加载应用设置（如区域）

### 代码结构：MCP Client Manager (50:00 - 53:30)
- **50:15** - 初始化 MCP Client Manager（稍后详细介绍）
- **50:45** - 报告生成器负责创建 HTML 或 Markdown
- **51:20** - 进入 MCP Client Manager 查看详情
- **51:50** - 为不熟悉 MCP 的观众解释：MCP 代表 Model Context Protocol
- **52:30** - MCP 服务器是工具，通常由 AWS 等公司提供
- **53:00** - 将 MCP 工具想象为 LLM 的 API

### MCP 工具详解 (53:30 - 56:30)
- **53:45** - API 对 LLM 不够友好，因为参数众多
- **54:20** - MCP 工具是 LLM 和 Agent 可以实际使用的用例
- **54:50** - 稍后会展示如何构建自定义工具
- **55:20** - 使用三个 MCP 工具：CloudWatch（指标、日志、告警）、Application Signals、CloudTrail
- **56:00** - 不想让 Agent 直接使用客户端尝试各种 API，而是提供上下文

### 创建 MCP Client (56:30 - 59:00)
- **56:45** - 使用 Strands Agent 创建 MCP Client 非常简单
- **57:15** - 创建 MCP Client 并传入 GitHub 公共仓库句柄
- **57:50** - 三个仓库：aws-labs/cloud-mcp-server、aws-labs/application-signals-mcp-server、aws-labs/cloudtrail-mcp-server
- **58:30** - 可以在 AWS Labs 仓库中找到更多 MCP 服务器

### MCP Manager 实现 (59:00 - 61:30)
- **59:15** - MCP Manager 为所需客户端创建 MCP Client
- **59:45** - 通过 get_all_tool_functions 暴露工具供 Agent 使用
- **60:20** - 返回到 Agent 代码
- **60:50** - 初始化组件：要求 MCP Manager 设置客户端
- **61:10** - 使用 AWS Labs 仓库创建客户端

### 创建 Agent (61:30 - 64:00)
- **61:45** - 然后创建 Agent
- **62:10** - 在展示创建 Agent 的两行代码之前，先解释周围的内容
- **62:45** - 重要概念：创建 Agent 需要提供大量上下文并与之交互
- **63:20** - 两步过程：1) 创建 Agent 并设置上下文，2) 准备良好的提示词来调用它
- **63:50** - 经验教训：为 Agent 编写高质量提示词与代码本身同样重要

### 提示词工程的重要性 (64:00 - 66:30)
- **64:15** - LLM 具有通用知识，需要引导它
- **64:45** - 不希望 Agent 每次运行都给出完全不同的结果
- **65:20** - 需要为 Agent 创建"隧道视野"
- **65:50** - 告诉 Agent："你了解世界上的一切，但我们现在只谈监控"
- **66:15** - 限制 Agent 的焦点到监控并准确执行要求的任务

### 系统提示词 (66:30 - 69:00)
- **66:45** - 从系统提示词开始（稍后详细查看）
- **67:15** - 展示创建 Agent 的简便性
- **67:45** - 创建 Agent：实例化 Agent 类，传入系统提示词
- **68:20** - 传入工具列表：HTTP 请求（用于事后分析搜索）、创建 CloudWatch 告警（自定义工具）
- **68:50** - MCP 工具：来自 MCP Manager 的 CloudWatch、CloudTrail、Application Signals

### 系统提示词详解 (69:00 - 72:00)
- **69:15** - 查看提示词内容，这非常值得关注
- **69:45** - 第一句："你是一个可观测性专家"——设定角色
- **70:20** - 描述能力：发现和分析资源、查询 CloudWatch 指标、CloudTrail 事件、关联数据
- **71:00** - 使用我们创建的工具创建 CloudWatch 告警
- **71:30** - 生成报告

### 分析策略提示词 (72:00 - 75:00)
- **72:15** - 如果提示词过于通用（"去找东西"），LLM 不知道具体含义
- **72:50** - 需要精确：告诉 Agent 如何分析 AWS 基础设施
- **73:25** - 发现资源：通过获取基础设施和应用指标来发现资源
- **74:00** - 不要调用 250 个服务的所有 API（那会花费数天）
- **74:35** - 快捷方式：查看可观测性工件（指标和日志）来反向工程资源

### 告警创建策略 (75:00 - 78:00)
- **75:15** - 检查现有告警，寻找模式和异常
- **75:45** - 生成可操作的建议
- **76:20** - 重要上下文："对告警创建保持保守"
- **76:50** - Agent 会执行我们告诉它的操作，如果不精确，每次运行都会创建告警
- **77:30** - 只在真正的缺口处创建告警，不创建重复或近似重复的告警

### 关注重点提示词 (78:00 - 80:30)
- **78:15** - 要求关注资源类型、关键指标、深度链接（一键跳转到 AWS 控制台）
- **78:50** - 关注领域：性能监控、客户体验、客户影响
- **79:25** - 成本优化、安全性（这是如何发现安全扫描的）
- **79:55** - 卓越运营改进（如 2GB 日志的优化建议）

### 工具使用指导 (80:30 - 82:30)
- **80:45** - 提供 create_cloudwatch_alarm 工具
- **81:15** - 明确告诉 Agent：需要创建告警时使用这个工具
- **81:45** - 不要自己尝试使用 Boto 客户端或任何 API
- **82:10** - 要求："彻底但简洁"

### Agent 准备完成 (82:30 - 84:00)
- **82:45** - 此时 Agent 已准备好上下文
- **83:15** - Agent 拥有可用的工具（MCP 工具）
- **83:45** - 下一步：运行分析

### 运行分析方法 (84:00 - 86:30)
- **84:15** - 查看如何运行分析
- **84:45** - 两个步骤：1) 发现和分析资源，2) 生成报告
- **85:20** - 进入资源发现方法
- **85:50** - 这是与 Agent 交互的第二步
- **86:15** - 先跳过查询内容，稍后查看

### 调用 Agent (86:30 - 89:00)
- **86:45** - 调用 Agent 非常简单：使用 agent 作为方法
- **87:20** - 传入编写的查询/提示词
- **87:50** - 这会启动 Agent，发送提示词，LLM 开始工作
- **88:25** - 使用工具查找内容，返回自然语言结果
- **88:55** - 解析结果并进行一些修改

### MCP Client 执行 (89:00 - 92:00)
- **89:15** - 两个重要注意事项
- **89:45** - mcp_manager.execute_with_clients：回到 MCP Manager 代码
- **90:20** - 上下文管理器：将客户端连接到 MCP 服务器
- **90:55** - Agent 创建（步骤 1）和 Agent 调用（步骤 2）
- **91:30** - 不希望客户端在 Agent 整个生命周期内都保持连接
- **91:55** - 只在调用 Agent 时连接客户端

### 客户端连接时机 (92:00 - 94:30)
- **92:15** - 创建 Agent 时调用 get_all_tools：准备 Agent 和客户端初始化
- **92:50** - 但没有实际连接到 MCP 服务器
- **93:25** - 调用 Agent 时（agent_query），才执行 execute_with_clients
- **94:00** - 告诉初始化的客户端："现在连接到 MCP 服务器，因为我需要使用 LLM"

### 终端输出 (94:30 - 96:00)
- **94:45** - 终端中看到的所有内容都是因为 Agent 被调用
- **95:15** - 之后从响应中提取指标
- **95:45** - 返回 Markdown 和指标数据

### 查询提示词分析 (96:00 - 99:00)
- **96:15** - 回到提示词，因为它非常详细
- **96:50** - 提示词是我们要求 Agent 做的事情，这是核心
- **97:25** - 查询："分析我的基础设施并创建报告"
- **98:00** - 重要强调：Agent 是无状态的，除非提供之前运行的信息
- **98:35** - 每次运行都会重新执行，需要确保报告对人类有意义且不随机

### 提示词结构化的必要性 (99:00 - 101:30)
- **99:15** - 如果不查看此代码就尝试创建 Agent，会很快发现问题
- **99:50** - LLM 会犯一些错误和产生幻觉
- **100:25** - 例如：生成它认为正确的指标，或创建随机的部分
- **101:00** - 不以人类可读或可解析的方式结构化
- **101:25** - 需要通过提示词修复所有这些问题

### 多步骤任务提示词 (101:30 - 104:00)
- **101:45** - 这是一个多步骤任务
- **102:15** - 第一步：发现资源，找到所有资源及其相关指标
- **102:50** - 资源类型：计算资源、数据库、无服务器、负载均衡器、存储、服务等
- **103:25** - 第二步：分析每个资源的健康状况
- **103:55** - 查看指标值、趋势、健康状态、活跃告警、最近事件、性能等

### 深度链接和报告格式 (104:00 - 结束)
- **104:15** - 生成深度链接，因为报告需要允许跳转到 AWS 控制台
- **104:45** - 会话在此处字幕截断，但演示继续进行代码的其他部分

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意：本总结基于提供的字幕文本生成。由于字幕在约 104 分钟处截断，完整会议可能包含更多内容，特别是关于自定义工具创建、报告生成和最终演示的部分。