# AWS re:Invent 2025 - CMP 359 会议总结

## 会议概述

本次会议主题为"介绍 Nitro 隔离引擎：通过数学实现透明性"（Introducing the Nitro Isolation Engine: Transparency Through Mathematics）。演讲者包括 AWS 计算和机器学习服务组织的首席架构师 JD Bean、Nitro 虚拟化管理程序组织的高级首席工程师 Kareem Raslan，以及自动推理团队的首席应用科学家 Nathan Chong。

Nitro 隔离引擎代表了自 Nitro 系统首次推出以来最重大的架构变革之一。这是一个全新的组件，它将 Nitro 虚拟化管理程序中所有与隔离和机密性相关的功能进行了分离和重构，形成了独立的代码库。该引擎采用 Rust 语言从零开始构建，并从设计之初就融入了形式化验证（formal verification），通过数学证明的方式确保客户工作负载之间以及客户工作负载与 AWS 运营人员之间的完全隔离。这使得 AWS Nitro 系统成为全球首个经过形式化验证的云计算虚拟化管理程序。

AWS 承诺将向客户开放 Nitro 隔离引擎的源代码和相关的形式化验证证明，使客户能够自行评估实现方案和数学证明，从而提供前所未有的透明度和保证水平。这标志着云计算机密计算保护达到了最高级别的保障。

## 详细时间线与关键要点

### 开场介绍 (0:00-2:30)
- **0:00** - 会议开始，欢迎参会者参加 CMP 359 会议
- **0:15** - 介绍演讲团队：JD Bean（首席架构师）、Kareem Raslan（高级首席工程师）、Nathan Chong（首席应用科学家）
- **0:45** - 宣布 Nitro 隔离引擎是 Nitro 系统设计自推出以来最重大的变革之一

### Nitro 系统背景介绍 (2:30-8:00)
- **2:30** - 开始介绍 AWS Nitro 系统的历史背景
- **3:00** - Nitro 系统是 AWS 运行虚拟化的基础平台，为 2018 年以来发布的所有虚拟化服务器提供支持
- **3:30** - Nitro 系统于 2017 年向全球发布，但开发过程始于 2012 年
- **4:00** - 介绍 Nitro 系统之前的 EC2 架构：基于 Xen 虚拟化管理程序和 DOM0 组件
- **5:00** - 解释 AWS 如何逐步将功能从 DOM0 迁移到专用的 Nitro 加速卡
- **5:30** - 首先迁移 VPC 网络功能到 Nitro 卡
- **6:00** - 随后迁移 EBS 远程块存储服务
- **6:30** - 接着迁移本地存储功能
- **7:00** - 最终移除 DOM0，引入基于 KVM 的 Nitro 虚拟化管理程序
- **7:30** - Nitro 虚拟化管理程序经过特别精简和定制，专为 AWS 云需求和高安全标准设计

### Nitro 系统的核心特性 (8:00-12:00)
- **8:00** - Nitro 系统是 AWS 的基础，所有 2018 年以来发布的 EC2 实例类型都由 Nitro 系统支持
- **8:30** - 系统具有基于硬件信任根的安全启动流程
- **9:00** - 能够对系统关键组件进行实时更新，不影响客户性能
- **9:30** - 提供存储、网络和内存的透明加密
- **10:00** - 革命性安全特性：从设计之初就确保 AWS 运营人员无法访问客户 EC2 实例内存、加密存储卷或加密流量
- **10:30** - 没有 SSH 访问底层 EC2 虚拟化服务器的能力
- **11:00** - 所有外部交互通过预验证的安全 API 进行，这些 API 经过授权、认证、记录和监控
- **11:30** - 每个 API 都经过预验证，确保无法访问客户实例内存

### Nitro 系统的透明度举措 (12:00-14:00)
- **12:00** - 发布深度白皮书，详细介绍系统设计
- **12:30** - 聘请第三方安全公司 NCC Group 进行独立验证
- **13:00** - 在 AWS 服务条款中做出关于"无运营人员访问"的合同承诺
- **13:30** - 强调这些措施为客户提供了信心保障

### Nitro 虚拟化管理程序深入解析 (14:00-18:00)
- **14:00** - 聚焦 Nitro 虚拟化管理程序，基于 KVM 并经过精简和定制
- **14:30** - 虚拟化管理程序主要仅在特定实例请求时执行，然后退出，实现接近裸机的性能
- **15:00** - 精简化特点：没有网络栈、通用文件系统、外设驱动支持、SSH 服务器或 shell
- **15:30** - 虚拟化管理程序更像固件而非传统软件
- **16:00** - 主要功能：接收来自 Nitro 控制器卡的管理指令、分配内存和 CPU 资源、启动/停止实例
- **16:30** - 分配 PCIe 设备（如 Nitro 卡或加速器连接）
- **17:00** - 核心职责：确保共享物理硬件的租户之间的隔离
- **17:30** - 介绍"秘密隐藏"（secret hiding）技术：虚拟化管理程序无法访问客户数据，因为客户数据不在虚拟化管理程序的虚拟地址空间中

### Nitro 隔离引擎介绍 (18:00-22:00)
- **18:00** - 正式发布 AWS Nitro 隔离引擎
- **18:30** - 利用形式化验证提供数学确定性，证明客户工作负载彼此隔离且与 AWS 运营人员隔离
- **19:00** - 将 Nitro 虚拟化管理程序中所有与隔离和机密性相关的功能分离到独立代码库
- **19:30** - 隔离引擎承担监督角色，控制系统中的所有机密性
- **20:00** - 负责客户实例之间以及客户实例与 Nitro 虚拟化管理程序之间的所有隔离
- **20:30** - 三大关键特性：
  - 分区化（Compartmentalization）：通过查看隔离引擎代码库即可理解整个系统的机密性
  - 形式化验证（Formally Verified）：从第一天起就将自动推理融入设计和实现过程
  - 透明性（Transparency）：AWS 将允许客户访问隔离引擎代码和形式化验证证明
- **21:30** - 成为全球首个经过形式化验证的云计算虚拟化管理程序

### 工程实现过程 - Kareem Raslan (22:00-35:00)
- **22:00** - Kareem Raslan 开始介绍工程实现过程
- **22:30** - 介绍三个基础概念：内存隔离、异常级别、最小权限原则
- **23:00** - 内存隔离：虚拟化管理程序通过虚拟内存分配物理内存，使用 CPU MMU 进行地址映射
- **24:00** - 异常级别：CPU 硬件抽象，不同级别具有不同权限，Nitro 虚拟化管理程序位于 EL2
- **25:00** - 最小权限原则：仅允许应用程序运行所需的最小资源和权限，默认阻止所有其他资源
- **26:00** - 解释隔离的对象：客户数据存在于 CPU 状态（寄存器）、主机内存和主机设备中
- **27:00** - 展示 Nitro 虚拟化管理程序的任务列表，并筛选出与内存隔离相关的任务子集
- **28:00** - 架构重构：将隔离相关功能从虚拟化管理程序中分离到独立组件
- **29:00** - 应用最小权限原则：将 Nitro 虚拟化管理程序从 EL2 降级，因为不再需要 EL2 的特权
- **30:00** - Nitro 隔离引擎位于系统底层的 EL2，保护其上的所有组件
- **31:00** - 通过超级调用（hyper calls）实现虚拟化管理程序与隔离引擎之间的通信
- **32:00** - 从零开始设计：使用 Rust 编程语言构建，获得内存安全特性
- **33:00** - 形式化验证集成：从第一天起就与自动推理团队合作
- **34:00** - 将形式化证明完全集成到开发流程的每个步骤：设计、实现、代码审查、测试
- **34:30** - 形式化证明不是替代传统软件开发流程，而是额外的工具，显著提高正确性保证

### 自动推理与形式化验证 - Nathan Chong (35:00-55:00)
- **35:00** - Nathan Chong 开始介绍自动推理
- **35:30** - 自动推理定义：应用数学逻辑对系统进行推理，精确捕获系统行为的边界
- **36:00** - 考虑所有可能的输入和所有可达状态
- **36:30** - 挑战示例：一个接受三个 U64 参数的函数，穷举测试需要 2^192 个测试用例
- **37:00** - 即使每秒执行 10 亿个测试用例，使用 10 亿个处理器，仍需要超过宇宙年龄的时间
- **37:30** - 自动推理是测试的补充技术，用于建立普遍成立的属性
- **38:00** - 四个关键证明属性（比作攀登山峰）：
  - 基础：Rust 语言的内存安全保证
  - 第一层：证明安全和不安全 Rust 代码的内存安全
  - 第二层：证明不存在运行时错误
  - 第三层：证明功能正确性（计算正确结果）
  - 顶峰：证明信息流的机密性和完整性
- **40:00** - 目前证明覆盖 Nitro 隔离引擎的核心实现：创建、运行和销毁虚拟机的生命周期
- **41:00** - 承诺继续扩展证明范围，直到覆盖所有实现方面
- **42:00** - 自动推理的两个关键要求：形式化规范和数学证明
- **43:00** - 承认自动推理的局限性：无法证明规范本身正确，实现是物理过程的抽象
- **44:00** - 规范的价值：类似建筑蓝图，捕获系统应有的行为而不规定实现方式
- **45:00** - 编写规范的过程本身就很有价值，迫使深入理解要构建的系统
- **46:00** - 示例：map 超级调用，用于转移物理页面的所有权
- **47:00** - 编写规范时会发现各种边界情况：页面对齐、地址空间大小、页面状态等
- **48:00** - 引入**转换关系**（transition relation）的数学概念
- **49:00** - 用 Rust 代码示例说明状态转换
- **50:00** - 将转换关系应用于 map 超级调用，捕获事务性行为规范
- **51:00** - 错误情况下不改变状态，成功时执行页面转移
- **52:00** - 强调数学规范的精确性和清晰性
- **53:00** - 形式化验证提供的深层次和持久价值
- **54:00** - 证明是系统基础，随时间推移只会加强

### 总结与展望 (55:00-结束)
- **55:00** - 回顾 Nitro 隔离引擎的三大支柱：分区化、形式化验证、透明性
- **56:00** - 强调这是云计算领域的重大突破
- **57:00** - 重申对客户的承诺：提供可验证的数学保证
- **58:00** - 会议结束，感谢参会者