# AWS re:Invent 2025 Bedrock Agent Core 安全控制会议总结

## 会议概述

本次会议由 AWS Bedrock Agent Core 团队的首席产品经理 Sara Kandanda 和首席工程师 Vive Badurya 主讲,主题聚焦于如何确保 AI 代理在生产环境中的安全运行。随着 AI 代理技术的快速发展,企业正在构建能够理解用户意图并跨工具执行多步骤工作流的智能应用。然而,当代理获得调用 API、更新记录或执行交易等真实世界操作的能力时,每一个错误都可能产生实际后果。

会议深入探讨了 AI 代理安全控制的分层架构,包括运行时隔离、工具访问控制、身份认证授权、可观测性和策略执行等多个层面。演讲者通过保险代理的实际案例演示了如何使用 Agent Core 的各项功能实现细粒度的安全控制,特别是新发布的策略引擎和评估功能。整个框架旨在让企业能够在最有价值的工作流中部署代理,并赋予其更高级别的自主性,同时确保它们在预定边界内安全运行。

## 详细时间线

### 开场与背景介绍
- **00:00:00** - Sara Kandanda 介绍自己是 Bedrock Agent Core 团队的首席产品经理,与首席工程师 Vive Badurya 共同主讲
- **00:00:30** - 会议主题:如何让 AI 代理远离麻烦(How to keep your agents out of trouble)
- **00:01:00** - 讨论软件构建和使用方式的快速演变,企业正在构建全新的智能应用

### AI 代理的价值与风险
- **00:02:00** - 强调一旦代理能够执行真实世界操作,每个失误都会产生实际后果
- **00:02:30** - 会议目标:探索如何确保代理在预定边界内安全行动
- **00:03:00** - 介绍会议结构:为什么重要、安全控制层级、使用 Agent Core 的实现方法
- **00:03:30** - 定义 AI 代理:能够理解用户意图、规划行动并执行多步骤工作流的软件系统
- **00:04:00** - 与传统程序的区别:代理动态决定如何实现目标,更具适应性和灵活性
- **00:04:30** - 展示代理在各行业的应用:IT 工单自动化、结构化内容生成、决策支持

### 代理面临的安全挑战
- **00:05:30** - 核心问题:代理的强大能力也带来高风险
- **00:06:00** - 第一个挑战:运行时行为不可预测,代理决策依赖于不断变化的上下文
- **00:06:30** - 第二个挑战:代理可能尝试执行超出预定范围的操作
- **00:07:00** - 第三个挑战:代理可能访问和修改敏感数据,或误解业务规则
- **00:07:30** - 核心问题:如何在给予代理行动自由的同时确保其遵守预定边界

### 分层安全架构
- **00:08:00** - 介绍分层保护的思维模型:控制代理如何运行、允许做什么、验证实际做了什么
- **00:08:30** - 第一层:运行时层 - 确保代理在完全隔离的环境中执行,防止用户工作负载相互干扰
- **00:09:30** - 第二层:工具访问层 - 通过网关控制代理对工具、API 和服务的访问
- **00:10:00** - 在网关边界实施策略,定义和执行细粒度规则(例如:不批准超过特定阈值的索赔)
- **00:10:30** - 第三层:可观测性和评估层 - 追踪每个代理决策,查看工具调用、策略允许/拒绝和最终结果

### Vive 的技术深入讲解
- **00:11:30** - Vive Badurya 接手演讲,进行现场调查:多少人构建过 AI 代理、部署到生产、对安全控制有信心
- **00:12:00** - 讨论开发者面临的权衡:代理自主性与安全控制之间的平衡
- **00:12:30** - Agent Core Runtime 的目标:通过分层方法解决安全保障问题
- **00:13:00** - 运行时隔离 - 定义代理为"循环中的 LLM",使用 LLM 进行推理并通过工具执行操作
- **00:13:30** - Agent Core Runtime 为每个用户会话提供强隔离边界:独立的内存、文件系统和 CPU 资源
- **00:14:00** - 会话结束后所有数据被清除,防止跨会话数据泄露
- **00:14:30** - 使用 AWS Firecracker microVM 技术实现隔离

### 工具管理与访问控制
- **00:15:00** - 工具策划 - 代理通过工具与外部环境交互,需要精心策划工具集
- **00:15:30** - 最小权限原则:不提供代理不应使用的工具(例如:聊天机器人不应有退款工具)
- **00:16:00** - Agent Core Gateway - 提供 API 资源、Lambda 目标或 MCP 目标的抽象层
- **00:16:30** - 介绍 MCP(Model Context Protocol):允许代理发现和调用工具的统一协议
- **00:17:00** - Agent Core Gateway 完全兼容 MCP 服务器规范
- **00:17:30** - Lambda 拦截器 - 在每次工具调用前后执行细粒度访问控制
- **00:18:00** - 可以基于身份、业务规则实施策略(例如:只有预订机票的用户才能退款)

### 身份与认证
- **00:18:30** - Agent Core Identity - 解决代理代表用户工作时的身份传播问题
- **00:19:00** - 三个功能:为代理提供身份、入站认证(用户身份验证)、出站认证(访问外部资源)
- **00:19:30** - 管理凭证和令牌交换,代理代码本身无法访问凭证

### 可观测性与评估
- **00:20:00** - 可观测性的重要性 - 代理调试困难,没有固定工作流,每个请求可能采取不同路径
- **00:20:30** - 可以查看所有会话追踪,包括工具调用、LLM 调用、Agent Core 组件
- **00:21:00** - 通过 CloudWatch 日志查询或使用预制仪表板查看令牌使用、工具失败率、错误统计
- **00:21:30** - Agent Core Evaluation(今日发布) - 解决"如何判断代理行为正确"的问题
- **00:22:00** - 所有追踪通过一个会话 ID 关联,可以看到完整执行链路
- **00:22:30** - 代理所有者可以定义评估标准,使用自动验证器或评分器
- **00:23:00** - 提供 13 个预构建评估器,也可以自定义(通常使用"LLM as a judge"方法)
- **00:23:30** - 评估结果返回到可观测性系统,可以查看会话是否有帮助、准确等维度
- **00:24:00** - 支持在线持续评估,可以对一定比例的请求进行采样评估
- **00:24:30** - 也可用于测试阶段,无需依赖 CloudWatch

### 策略引擎详解
- **00:25:00** - 策略执行 - 需要更确定性的控制,而不仅仅是事后评估
- **00:25:30** - 策略在 Gateway 层工作,拦截所有工具调用
- **00:26:00** - 无策略流程:代理调用工具 → Gateway → 工具执行
- **00:26:30** - 有策略流程:代理调用工具 → Gateway 策略拦截 → 允许/拒绝决策 → 工具执行(如果允许)
- **00:27:00** - 策略不依赖代理代码或工具实现,由 Gateway 确定性执行
- **00:27:30** - 策略管理员预先定义策略,关联到 Gateway 后对所有工具调用生效
- **00:28:00** - 所有策略允许/拒绝决策记录到可观测性系统

### 策略引擎的优势
- **00:28:30** - 统一保护:拦截和管理所有代理到工具的交互
- **00:29:00** - 操作简单:无需为每个工具单独集成,在 Gateway 层统一应用
- **00:29:30** - 可审计性:所有执行决策被记录和追踪
- **00:30:00** - 高性能:毫秒级延迟开销,适用于在线事务路径

### 保险代理用例演示
- **00:30:30** - 使用保险代理作为示例,展示策略如何工作
- **00:31:00** - 代理架构:用户发送提示 → Agent Runtime(包含指令、工具、上下文)→ 模型调用 → 工具调用(通过 Gateway)
- **00:31:30** - 三个工具:创建申请(application)、调用风险模型(risk model)、批准(approval)
- **00:32:00** - 策略示例 1:只允许保额低于 500 万美元的申请
- **00:32:30** - 策略示例 2:只有部门属性为"finance"的用户才能访问风险模型工具
- **00:33:00** - 介绍 Cedar 策略语言:AWS 开发的开源策略授权语言,已用于 API Gateway、Lambda 等服务

### Cedar 策略语言
- **00:33:30** - Cedar 类似 Kubernetes 的 Rego,提供形式化的策略授权
- **00:34:00** - 虽然有自然语言定义,但通过 Cedar 形式化,提供性能和确定性
- **00:34:30** - Cedar 策略四个部分:Principal(谁)、Action(工具)、Resource(Gateway)、When(条件)
- **00:35:00** - 自然语言帮助非专家编写策略,系统会验证并转换为 Cedar

### 实际演示流程
- **00:35:30** - 步骤 1:策略编写 - 在控制台创建策略引擎,定义自然语言策略
- **00:36:00** - 步骤 2:策略关联 - 将策略关联到 Gateway,选择执行模式(仅日志或强制执行)
- **00:36:30** - 步骤 3:可观测性 - 查看策略允许/拒绝决策,查看会话追踪和仪表板

### 控制台演示开始
- **00:37:00** - 展示 Agent Core 控制台,已创建的 Gateway
- **00:37:30** - Gateway 配置:关联 Cognito 身份提供商,配置三个工具
- **00:38:00** - 工具定义包含输入参数(保额、地区),这些定义传递给模型
- **00:38:30** - 配置日志传输和追踪,启用可观测性
- **00:39:00** - 运行代理,显示四个工具(三个配置的 + 一个搜索工具)
- **00:39:30** - 解释第四个工具:Gateway 提供的搜索功能,用于上下文相关的工具发现

### 无策略测试
- **00:40:00** - 测试创建保额 1000 万美元的申请,成功创建(无策略限制)
- **00:40:30** - 返回控制台创建策略引擎

### 创建策略
- **00:41:00** - 创建策略引擎,命名为"underwriting use case"
- **00:41:30** - 选择资源(Gateway),输入自然语言策略
- **00:42:00** - 实时显示生成的 Cedar 策略,验证策略有效性
- **00:42:30** - 策略验证通过,创建策略
- **00:43:00** - 选择验证模式:宽松模式(测试)或强制模式
- **00:43:30** - 将策略关联到 Gateway,选择"强制执行"模式

### 有策略测试
- **00:44:00** - 重新运行代理,无自定义声明(custom claims)
- **00:44:30** - 关键发现:可用工具从 4 个减少到 1 个
- **00:45:00** - 解释原因:Cedar 默认拒绝所有,只有明确允许的工具才可见
- **00:45:30** - 搜索工具、批准工具、风险模型工具都被拒绝,只有创建申请工具可用
- **00:46:00** - 测试创建 100 万美元申请,成功(低于 500 万限制)
- **00:46:30** - 测试创建 1000 万美元申请,失败(超过限制)

### 可观测性查看
- **00:47:00** - 通过"查看追踪"进入可观测性界面
- **00:47:30** - 自动过滤显示策略引擎相关的交互
- **00:48:00** - 显示一次拒绝交互,可以查看详细信息
- **00:48:30** - 显示策略执行元数据,可用于配置指标和告警

### 基于身份的策略测试
- **00:49:00** - 添加自定义声明:部门=finance、员工级别=senior、成本中心=XYZ
- **00:49:30** - 这些属性来自 IDP,在 JWT 令牌中传递到 Gateway
- **00:50:00** - 关键发现:可用工具从 1 个增加到 2 个(创建申请 + 风险模型)
- **00:50:30** - 因为满足了"部门=finance"条件,风险模型工具现在可用
- **00:51:00** - 测试调用风险模型,成功执行
- **00:51:30** - 反例:将部门改为"engineering",风险模型工具再次不可用
- **00:52:00** - 列表工具只显示创建申请工具,风险模型工具被隐藏

### 总结安全框架
- **00:52:30** - 回顾分层安全架构
- **00:53:00** - Runtime:控制可能发生的事情
- **00:53:30** - Identity:控制谁被允许行动以及可以采取什么行动
- **00:54:00** - Gateway:控制提供给代理的工具
- **00:54:30** - Observability:了解发生了什么
- **00:55:00** - Policy:通过 Gateway 和可观测性增强,实现细粒度访问控制
- **00:55:30** - Lambda 拦截器:另一种实现细粒度访问控制的方式

### 会议结束
- **00:56:00** - 演示结束,展示了完整的策略执行流程和可观测性功能