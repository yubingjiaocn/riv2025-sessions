# AWS re:Invent 2025 会议总结：使用 Amazon Bedrock Agent Core 实现多智能体安全运营协作

## 会议概述

本次会议主要介绍了如何利用 Amazon Bedrock Agent Core 平台构建多智能体系统，以自动化和优化安全运营流程。演讲者 Veena（AWS 高级解决方案架构师，专注于机器学习和弹性）和 Eric Cordson（AWS 解决方案架构师，专注于机器学习和智能体解决方案）详细讲解了如何将传统的手动安全运营工作流程转变为由多个专业智能体协同工作的自动化系统。

会议重点解决了安全运营团队面临的核心挑战：重复性任务占用大量时间，包括安全告警调查、问题修复和报告生成。这些重复性工作使得安全团队难以专注于战略性工作。通过 Bedrock Agent Core 平台，可以构建三类专业智能体：调查智能体（Investigation Agent）、遏制智能体（Containment Agent）和报告智能体（Reporting Agent），它们在编排智能体（Orchestration Agent）的协调下自动完成整个安全事件响应流程。

演讲还深入探讨了技术实现细节，包括如何使用 Strands Agent 框架构建智能体、如何通过 Agent Core Gateway 连接内部工具（如 CMDB 数据库）、如何使用基于属性的访问控制（ABAC）策略确保智能体权限安全、以及如何使用图模式（Graph Pattern）编排多个智能体协同工作。最后展示了如何将智能体部署到生产环境并实现异步自动化运行。

## 详细时间线与关键要点

### 开场与背景介绍（0:00 - 5:30）
- **0:00** - 会议开始，演讲者介绍会议主题：使用 Amazon Bedrock Agent Core 实现高级安全运营的多智能体协作
- **0:45** - 现场调查：部分听众来自安全运营团队，部分为开发人员，少数使用过 Agent Core
- **1:30** - Veena 自我介绍：AWS 高级解决方案架构师，拥有 6 年以上经验，专注于机器学习和弹性领域，来自新泽西
- **2:00** - Eric Cordson 自我介绍：来自亚特兰大的解决方案架构师，专注于机器学习和智能体解决方案，负责代码演示部分

### 安全运营挑战分析（5:30 - 10:00）
- **5:30** - 会议议程概览：挑战分析、Agent Core 介绍、解决方案架构、代码演示和实际演示
- **6:15** - 客户痛点：安全团队主要关注两方面 - 战略性工作和运营性工作
- **7:00** - 重复性任务问题：安全团队需要处理大量来自不同安全服务的告警，花费大量时间进行调查、修复和报告
- **8:00** - 手动工作负担：调查、修复和报告生成都需要人工完成，过程复杂且耗时
- **8:45** - 自动化需求：由于任务具有重复性，适合使用智能体进行自动化处理

### 安全运营工作流程（10:00 - 13:00）
- **10:00** - 标准三步流程：调查（Investigation）、修复（Remediation）、报告（Reporting）
- **10:30** - 调查阶段：确定告警内容和影响范围
- **11:00** - 修复阶段分两步：战术性修复（立即解决问题）和长期修复（防止问题再次发生）
- **12:00** - 报告阶段：生成端到端的 RCA（根因分析）报告，记录告警、处理过程和解决方案
- **12:30** - 工作流程的重复性：这三个步骤对任何告警都是相同的，适合构建专业智能体来处理

### Amazon Bedrock Agent Core 平台介绍（13:00 - 17:00）
- **13:00** - Agent Core 定位：完全托管的平台，用于安全地构建、部署和运行多智能体系统
- **13:45** - Agent Runtime：支持多种模型和框架，包括 LangChain、LangFuse、CrewAI 和 AWS Strands SDK
- **14:30** - Agent Core Gateway：提供智能体与内部系统的连接能力，类似人类访问 CMDB 数据库获取服务器信息
- **15:15** - Agent Core Browser：提供浏览器交互能力（本次演示未使用）
- **15:45** - Agent Core Identity：提供身份验证和授权机制，控制智能体对内部系统的访问权限
- **16:30** - Agent Core Observability：记录和跟踪智能体执行的所有操作

### 解决方案架构（17:00 - 22:00）
- **17:00** - 整体架构展示：Amazon Inspector 和 GuardDuty 发布告警到 EventBridge，Lambda 函数接收事件并传递给 Agent Core Runtime
- **18:00** - 编排智能体：在 Runtime 中运行，负责协调其他专业智能体
- **18:45** - 三类专业智能体：调查智能体、遏制智能体和报告智能体，通过 Gateway 连接 CMDB 和 Playbook 等内部工具
- **19:30** - 调查智能体功能：分析告警、查询 CMDB 获取服务器信息（操作系统、软件、补丁计划等）、生成调查报告
- **20:30** - 遏制智能体分两类：Playbook 生成器（为生产系统创建操作手册）和执行器（自动执行修复操作）
- **21:15** - 报告智能体：生成端到端的事件总结报告，包括告警时间、调查过程、修复方案等

### 代码演示：真实场景案例（22:00 - 26:00）
- **22:00** - Eric 分享真实经历：在制造公司工作时，AWS 账户因可疑活动被隔离
- **22:45** - 事件详情：短时间内启动了多个超大型 EC2 实例，需要紧急调查
- **23:30** - 调查结果：DevOps 工程师启动了 Jenkins 服务器但未更改默认密码，端口对外开放，被用于比特币挖矿
- **24:15** - 演示目标：展示如何使用 Bedrock Agent Core 在无人工干预的情况下自动处理此类事件
- **25:00** - 演示内容预告：智能体设置、工具配置、使用 Strands Agent 创建安全分析智能体、图模式编排、扩展和部署

### 智能体基础概念（26:00 - 29:00）
- **26:00** - 自主智能体定义：能够处理不同类型告警，工作流程保持一致，可自主决策
- **26:45** - Strands Agent 循环机制：输入（系统提示词、工具规格、查询任务、对话历史）→ 推理 → 工具选择 → 工具执行 → 反馈循环 → 响应
- **27:45** - 框架选择：支持 Strands Agent、LangChain、CrewAI、LangFuse 等多种智能体框架
- **28:30** - 基础设置和导入：展示代码中的 Strands 和 MCP 工具导入

### 工具配置（29:00 - 35:00）
- **29:00** - 工具需求：CMDB 访问、日志文件访问、取证数据存储
- **29:45** - 使用 Agent Core Gateway 的原因：最大化工具复用，多个智能体可共享相同工具
- **30:30** - Gateway 功能：提供 MCP（模型上下文协议）接口，连接智能体和工具
- **31:15** - Gateway 权限配置：授予调用三个 Lambda 函数的权限（CMDB、Artifacts、Notification）
- **32:00** - 创建 Gateway：需要名称、角色和协议类型（MCP）
- **32:45** - 添加 Target：定义工具规格，包括 Lambda 函数 ARN 和 JSON Schema
- **33:30** - 工具规格示例：save_artifact、list_artifacts、get_artifact 等操作
- **34:15** - Agent Core Identity：使用 OAuth 令牌安全访问外部服务（如 ServiceNow 中的 CMDB）
- **34:45** - 工具加载完成：CMDB 工具、取证工具和通知工具已就绪

### 创建调查智能体（35:00 - 40:00）
- **35:00** - 智能体组成：名称、工具（use_aws 和已加载的工具）、系统提示词（工作描述）
- **36:00** - 系统提示词内容：定义智能体为安全分析师，接收 GuardDuty 告警并收集详细信息填写报告
- **36:45** - 退出条件：当收集到完成报告所需的所有信息时停止分析
- **37:30** - 报告模板：包括资源详情、VPC 配置、安全组等信息
- **38:00** - 实际场景补充：真实环境中还需要从 CloudWatch、CloudTrail 等服务获取取证日志
- **38:45** - 执行调查：加载 GuardDuty 告警 ID，告警内容为 EC2 实例查询恶意域名
- **39:15** - 智能体执行过程：获取实例详情、安全组详情、子网详情，编译成报告并保存到 S3
- **39:45** - 报告生成：仅需几秒钟，包含安全运营报告、详细信息和执行摘要

### 多智能体编排（40:00 - 45:00）
- **40:00** - 人工流程对比：需要登录不同服务、检查 EC2 实例、查看 CloudTrail 和 CloudWatch 日志
- **40:45** - 智能体优势：代表用户连接不同资源，自动提取告警相关信息并生成风险报告
- **41:30** - 其他智能体需求：遏制智能体（修复）和报告智能体
- **42:00** - 图模式编排：调查 → 两个分支（立即遏制或生成 Playbook）→ 最终报告
- **42:45** - 分支逻辑：非生产系统允许立即自动修复，生产系统生成操作脚本供人工执行
- **43:30** - 权限控制问题：如何控制具有 AWS 访问权限的智能体只在特定环境执行操作

### 基于属性的访问控制（45:00 - 49:00）
- **45:00** - ABAC 策略：使用标签实现选择性加入模式
- **45:45** - 策略配置：智能体角色策略允许停止/启动 EC2 实例等操作，但有条件限制
- **46:30** - 标签匹配机制：资源必须有 "allow_mutative_actions_by_role" 标签，且值匹配智能体角色名称
- **47:15** - 实现方式：EC2 资源标签值设为 "secops_agent"，IAM 角色也有相同的 agent_role_name 标签
- **48:00** - 安全保障：如果标签不匹配或资源没有标签，智能体无法执行变更操作
- **48:45** - 选择性加入：DevOps 工程师根据系统敏感性决定是否添加标签

### 图模式实现（49:00 - 53:00）
- **49:00** - 加载预构建智能体：调查、遏制助手、遏制执行器、报告智能体
- **49:45** - Strands Graph Builder：两个组件 - 节点（智能体）和边（遍历路径）
- **50:30** - 添加节点和边：调查 → 遏制执行器和遏制助手（条件：allow_mutative_action）→ 报告
- **51:15** - 条件判断：检查资源标签或 CloudFormation 堆栈标签，也可查询 CMDB 数据库
- **52:00** - 控制参数：设置最大执行次数和超时时间，防止智能体无限循环
- **52:45** - 构建编排智能体：使用 Graph Builder 构建，输出用于调用编排器

### 执行结果展示（53:00 - 56:00）
- **53:00** - 执行演示：将 GuardDuty 告警作为提示词输入
- **53:30** - 事件响应报告：包含执行摘要、受影响资源、采取的行动
- **54:00** - 调查结果：详细的调查发现和遏制行动
- **54:30** - 自动执行的操作：创建取证快照、隔离安全组、撤销 IAM 权限、关闭实例、阻止 DNS 通信
- **55:15** - 无人工干预：所有操作由智能体自动完成，无需手动工作

### 生产部署（56:00 - 62:00）
- **56:00** - 扩展需求：如何让智能体自主工作并部署到生产环境
- **56:45** - 入口点装饰器：使用 @app.entry_point 装饰编排器
- **57:30** - 动作模式：定义两种动作 - chat（与智能体对话）和 orchestrate_graph（自动化工作流）
- **58:15** - Chat 动作用途：安全分析专家可与智能体对话，查询特定事件或执行额外研究
- **58:45** - Orchestrate Graph 动作：自动化工作流，接收 GuardDuty 或 Inspector 告警
- **59:30** - 异步调用：Lambda 函数调用智能体后立即返回，不等待完成（避免长时间运行）
- **60:15** - 后台执行：智能体在 Bedrock Agent Core 上继续运行，完成修复工作
- **61:00** - Bedrock Agent Core Toolkit：提供 CLI 工具简化部署流程

### 部署配置演示（62:00 - 67:00）
- **62:00** - Configure 命令：指定入口点，启动配置向导
- **62:45** - 配置选项：默认名称、requirements 文件、部署方式（直接代码或容器）
- **63:30** - Python 版本和执行角色：选择 Python 版本，配置具有变更权限的角色
- **64:00** - S3 存储桶：用于代码托管
- **64:30** - 授权配置：默认使用 IAM 授权
- **65:00** - Header 白名单：用于从第三方系统调用智能体时传递 OAuth 令牌
- **65:45** - 内存配置：可选配置（演示中跳过）
- **66:15** - Launch 命令：执行 "agent core launch" 部署智能体到生产环境
- **66:45** - 自动化部署：上传代码并完成所有准备工作，简化测试和运行流程

### 总结
本次会议全面展示了如何利用 Amazon Bedrock Agent Core 构建企业级多智能体安全运营系统，从概念到实现再到生产部署，提供了完整的技术路径和最佳实践。