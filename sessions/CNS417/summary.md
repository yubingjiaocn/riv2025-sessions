# AWS re:Invent 2025 - CNS 417 网络可观测性策略会议总结

## 会议概述

本次会议(CNS 417)聚焦于Kubernetes环境中的网络可观测性和安全策略。演讲者Rodrigo Gbera(AWS容器专家解决方案架构师)和Luke(Amazon EKS产品经理)详细介绍了如何通过简化运维操作来实现可观测性并提升整体安全态势。

会议的核心主题围绕着解决现代微服务架构带来的复杂性挑战。随着企业越来越多地采用Kubernetes和微服务架构,东西向流量(pod间通信)、与AWS服务的集成以及与本地或互联网系统的连接变得日益复杂。缺乏可见性会导致数据不精确、决策缓慢和次优行动,最终影响业务。演讲者重点介绍了EKS Auto Mode如何简化基础设施管理,以及新推出的容器网络可观测性功能如何帮助平台工程师在保持安全性的同时实现团队自主性和快速迭代。

会议通过实际演示展示了如何在几分钟内创建生产就绪的EKS集群,启用网络策略,以及如何应对从过度宽松到过度限制环境之间的平衡挑战。最终强调,可观测性是实现安全优化、性能优化和成本优化的关键缺失层。

## 详细时间线

### 开场与问题定义 (00:00 - 08:00)

- **00:00** - 会议开始,欢迎参会者,提醒这是静音会议室需佩戴耳机
- **00:30** - 介绍会议主题:CNS 417网络可观测性和策略,目标是简化Kubernetes环境的运维和应用生命周期
- **01:15** - 演讲者自我介绍:Rodrigo Gbera(容器专家SA)和Luke(EKS产品经理)
- **01:45** - 现场调查:几乎所有参会者都在生产环境使用Kubernetes,部分了解EKS Auto Mode
- **02:30** - 展示典型架构图:EKS作为平台基础,微服务间通信(东西向流量),与AWS服务(S3、DynamoDB、RDS等)集成
- **04:00** - 强调网络是连接分布式环境的核心结构,理解网络安全、性能和行为至关重要
- **05:30** - 指出EKS环境的挑战:需要同时管理VPC网络平面和Kubernetes网络平面,增加运维复杂性
- **06:45** - 问题核心:缺乏可见性导致数据不精确→结论不准确→决策缓慢→行动次优,最终影响业务

### 业务挑战与技术影响 (08:00 - 15:00)

- **08:15** - 网络问题场景:pod层拥塞、ENI问题、节点带宽问题等,需要快速检测和解决
- **09:30** - 成本优化挑战:如何验证流量优化策略(如拓扑感知路由、Istio本地路由)是否按预期工作
- **10:45** - 安全影响:如何快速验证网络策略是否符合设计,工作负载A是否按预期与工作负载B通信
- **12:00** - 微服务架构趋势:虽然带来挑战,但不应因此放弃,需要简化运维以支持这种模式
- **13:30** - 多租户演进:从单体应用→容器化单租户集群→软多租户(命名空间隔离)→同命名空间多应用

### EKS Auto Mode与基础设施简化 (15:00 - 25:00)

- **15:00** - 引入分层解决方案:底层简化基础设施管理,中层提供网络可见性,顶层改善安全态势
- **16:00** - EKS Auto Mode介绍:一键创建集群,生产就绪的最佳实践开箱即用
- **17:00** - Karpenter介绍:基于资源请求的节点自动扩缩容器,几秒内启动计算资源,持续优化成本
- **18:30** - 核心网络组件:CoreDNS(名称解析)、Kube-proxy(流量路由)、VPC CNI(最重要的网络组件)
- **19:45** - 2023年发布VPC CNI原生网络策略支持,无需第三方CNI
- **21:00** - 现场调查:只有少数参会者使用网络策略,因为实施困难且缺乏可见性

### 网络策略实战演示 (25:00 - 40:00)

- **25:00** - 实时演示:通过AWS控制台创建EKS Auto Mode集群
- **25:30** - 创建集群角色和节点角色,几次点击即可完成,遵循最小权限原则
- **26:30** - 配置VPC网络:选择3个可用区,启用区域NAT网关,自动将pod部署到私有子网
- **28:00** - 集群激活,唯一的附加组件是Metrics Server,其他组件(Karpenter、Pod Identity等)已嵌入
- **29:00** - 启用网络策略:通过ConfigMap告知集群启用网络策略功能
- **30:00** - 查看EC2NodeClass配置:默认网络策略为allow,事件日志默认禁用
- **32:00** - 网络策略工作原理:使用eBPF(扩展伯克利包过滤器)在内核层面检查系统调用,实现高性能安全过滤

### 网络策略挑战演示 (40:00 - 50:00)

- **40:00** - 部署示例应用:包含多个命名空间和部署的电商应用(UI、目录、购物车、订单)
- **41:30** - 验证应用运行:在默认allow策略下,所有服务正常通信,应用可访问
- **43:00** - 应用默认拒绝策略:修改NodeClass配置为default deny并启用事件日志
- **44:00** - 观察Karpenter滚动更新:根据NodePool的disruption配置(如10%)逐步更新节点
- **45:30** - 应用失败:切换到default deny后,应用无法启动,存活探针和就绪探针全部失败
- **46:30** - 典型场景:接到CEO或财务人员电话称应用离线,要求回滚更改
- **47:30** - 问题根源:没有可见性无法追踪pod间通信,不知道需要创建哪些网络策略
- **48:30** - 网络策略复杂性示例:需要为UI→订单、UI→结账、DNS解析等创建多个策略,平台团队难以掌握全貌

### 容器网络可观测性解决方案 (50:00 - 结束)

- **50:00** - Luke接手:指出缺失的关键层是可观测性
- **51:00** - 宣布新功能:EKS容器网络可观测性(Container Network Observability)
- **52:00** - 核心价值:使EKS网络环境更可观测,成功扩展分布式环境的关键
- **53:00** - 主要用例:测量网络性能,快速定位问题源头(pod级拥塞、节点带宽耗尽、流量计数等)
- **54:30** - 与现有可观测性栈集成:支持CloudWatch、Amazon Managed Prometheus/Grafana或自管理的开源方案
- **55:30** - 提供pod级和工作节点级的细粒度网络指标,包括关联的ENI信息
- **56:30** - 降低平均检测时间(MTTD)和平均解决时间(MTTR),支持主动响应(阈值告警)
- **57:00** - 会议继续深入探讨可观测性功能的具体特性(字幕在此处截断)