# AWS re:Invent 2025 技术会议总结

## 会议概述

本次会议是一场关于构建智能事件代理(Event Agent)的深度技术分享,由AWS解决方案架构师Danny和数据科学家Akasha Seag共同主讲。会议聚焦于如何使用Amazon Bedrock的知识库(Knowledge Bases)和代理核心内存(Agent Core Memory)功能来构建具有超个性化体验的AI代理系统。

演讲者通过实际代码演示,展示了如何从零开始构建一个能够检索AWS re:Invent会议信息并记住用户偏好的智能代理。这个代理不仅能够回答关于会议的问题,还能根据用户的历史对话和偏好提供个性化的会议推荐。整个实现过程采用了Agentic RAG(检索增强生成)架构,结合了知识库检索、工具调用和记忆管理等多个核心组件,为构建生产级AI代理系统提供了完整的技术方案。

会议采用400级别的深度技术讲解,主要面向有一定基础的开发者,通过Jupyter Notebook进行现场编码演示,详细讲解了每个API调用和配置参数的作用,使参会者能够理解并复现整个构建过程。

## 详细时间线与关键要点

00:00 - 会议开场与讲师介绍
- Danny介绍自己是专注于生成式AI的解决方案架构师,负责Amazon Bedrock知识库和代理核心内存团队
- Akasha Seag介绍自己是代理核心内存团队的生成式AI数据科学家
- 说明这是一场400级别的代码实战会议,将深入探讨API和代码细节

02:30 - RAG基础概念回顾
- 回顾检索增强生成(RAG)的基本工作流程:查询→检索→增强→生成响应
- 强调RAG已经发展了2-3年,是当前AI应用的重要技术

03:45 - Agentic RAG概念引入
- Akasha解释代理本质上是无状态的,需要通过上下文工程(Context Engineering)来提升能力
- 上下文不仅包括传统的文档检索,还包括工具选择和记忆组件
- 引入"上下文工程"这一新术语,强调精确策划上下文信息的重要性

05:20 - Agentic RAG工作流程
- 展示Agentic RAG的循环工作流程:查询→检索→增强→模型判断是否需要更多信息→可能再次检索或返回响应
- 强调模型具有自主决策能力,可以判断是否需要获取更多信息

06:15 - 今日构建目标:事件代理
- 目标是构建一个AWS re:Invent事件代理,提供超个性化体验
- 代理具备两大核心能力:从知识库检索会议信息、存储和检索对话历史及用户偏好
- 能够回答如"推荐哪些会议"、"上次讨论了哪个会议"、"周一有哪些会议"等问题

08:00 - 进入代码演示环节
- 切换到Jupyter Notebook进行实际代码演示
- 强调所有代码将在本周发布到AWS示例代码仓库

08:45 - 环境设置与依赖安装
- 安装必要的Python依赖包
- 导入所需库文件
- 配置使用Claude Haiku 4.5作为基础模型
- 配置Amazon Titan Text Embeddings v2作为嵌入模型
- 创建唯一ID以确保资源命名不冲突

10:30 - 创建简单代理
- 使用Trans Agents框架创建基础代理
- Akasha解释选择Trans Agents的原因:这是一个开源框架,能够利用模型自身的规划、执行和反思能力
- 说明也可以使用LangGraph、LangChain、CrewAI等其他框架
- 仅用一行代码创建代理:定义模型和系统提示词"你是一个智能事件助手"

12:00 - 测试简单代理的局限性
- 向代理提问"哪个会议适合学习安全和AI代理"
- 代理回应没有足够的会议信息,这是预期结果
- 说明需要为代理提供上下文信息

13:15 - Amazon Bedrock知识库介绍
- 详细介绍Amazon Bedrock Knowledge Bases是一个完全托管的RAG工作流服务
- 支持两种数据连接器:S3和直接注入
- 提供四种分块策略供选择
- 工作流程:文档→解析→分块→嵌入向量→存储到向量数据库
- 提供两种API:Retrieve(仅检索)和Retrieve & Generate(检索并生成)

15:30 - 知识库创建步骤概览
- 下载2024年re:Invent会议数据
- 创建S3存储桶并上传文档
- 创建S3向量存储和索引
- 创建知识库并执行数据摄取任务
- 测试知识库
- 为代理创建工具

16:45 - 准备会议数据
- 下载包含会议信息的单个文件
- 将单个文件拆分为580个独立文件,每个文件对应一个会议
- 创建本地目录存储这些文件

18:20 - 创建S3存储桶并上传数据
- 使用Boto3创建唯一命名的S3存储桶
- 上传所有580个文档文件到S3
- 上传过程耗时约1分钟

19:30 - 创建IAM角色
- 为知识库创建IAM角色
- 配置权限以访问嵌入模型和S3存储桶
- 说明也可以通过AWS控制台完成这些操作

20:45 - 创建S3向量存储和索引
- 使用S3 Tables(S3的新向量存储能力)
- 创建向量存储桶
- 创建向量索引,配置维度为1024(对应Titan Embeddings v2的输出维度)
- 设置距离度量、数据类型和元数据配置

23:00 - 创建知识库
- 调用API创建知识库
- 配置知识库名称和描述:"AWS re:Invent 2024会议知识库"
- 关联之前创建的IAM角色
- 配置嵌入模型为Titan Text Embeddings v2,维度1024
- 配置存储为之前创建的S3向量索引

25:15 - 数据摄取任务
- 创建S3类型的数据源
- 配置分块策略:固定大小,最大300个token,20%重叠
- 说明还支持语义分块、层次分块和自定义Lambda分块
- 启动数据摄取任务并等待完成
- 摄取过程耗时约2分钟,处理了583个文件

27:30 - 测试知识库检索
- 使用Retrieve API测试知识库
- 查询"关于生成式AI和安全的会议有哪些"
- 成功返回3个最相关的会议结果
- 验证语义搜索功能正常工作

28:45 - 创建知识库搜索工具
- 使用Trans Agents的@tool装饰器创建工具
- 定义工具描述:"使用语义搜索从知识库检索re:Invent会议的工具,当用户询问re:Invent会议推荐时使用"
- 工具接受查询和最大结果数作为参数
- 内部调用Bedrock Knowledge Bases的Retrieve API

30:00 - 记忆组件概念介绍(Akasha讲解)
- 解释为什么需要记忆:代理本质上是无状态的
- 记忆是Agentic RAG的第二个核心组件
- 记忆使代理能够提供个性化体验

31:30 - 短期记忆与长期记忆架构
- 用户与代理的对话作为事件存储在短期记忆中
- 短期记忆将原始对话消息存储在数据存储中
- 根据配置的策略从短期记忆中提取洞察
- 支持三种预定义策略:用户偏好、语义、摘要
- 也可以自定义策略或创建全新的提取管道

33:15 - Danny补充记忆的价值
- 如果将一周的对话历史全部发送给LLM会导致三个问题:
  - 成本高昂(上下文窗口大)
  - 延迟增加(处理时间长)
  - 准确性下降(信息过载)
- 长期记忆通过提取重要信息解决这些问题
- 可以提取用户偏好、语义事实、会话摘要等

35:00 - 观众提问:短期记忆如何决定相关性
- Akasha解释短期记忆确定性地存储所有消息
- 通过actor ID、session ID和memory ID进行分离
- Actor ID标识记忆归属(可以是用户、项目、团队等)
- Session ID标识会话
- 这些标识符用于分隔不同的记忆

36:30 - 观众提问:会议反馈是否应存储在记忆中
- 确认用户对参加过的会议的反馈应该存储在记忆中
- 可用于未来的个性化推荐

37:15 - 观众提问:关于DynamoDB和数据检索
- 讨论短期记忆存储在DynamoDB中
- 强调这是托管服务,无需关注基础设施、扩展等问题
- 表示将在长期记忆部分详细解释检索机制

38:30 - 长期记忆提取流程详解
- 提取模块包含两个步骤:
  1. 提取步骤:从对话中仅提取相关信息(如用户偏好)
  2. 整合步骤:与现有向量存储中的记忆比较,检索最相似的记忆,然后决定添加新记忆、更新现有记忆或跳过(如果冗余)
- 这种机制避免了记忆存储中的重复

40:45 - 长期记忆存储与检索
- 长期记忆保存在向量存储中
- 可以语义检索相似的记忆
- 可以同时检索长期记忆(提取的洞察)和短期记忆(原始事件)
- 例如:检索最近5条消息加上会话摘要,压缩上下文窗口

42:00 - 使用Trans Agents创建记忆
- 创建Memory Manager以访问控制平面API
- 调用get_or_create_memory方法
- 配置记忆名称和策略
- 策略配置包括:策略类型、命名空间(使用路径结构分离关注点)
- 命名空间可以包含actor ID、strategy ID、session ID等变量
- 配置事件过期天数(7-365天)
- API返回memory ID供后续使用

44:30 - 记忆与代理的关系
- Danny强调:代理需要将事件写入记忆资源
- 需要memory ID、actor ID和session ID
- 将信息发送到Agent Core Memory服务

45:15 - 使用Hooks集成记忆
- 介绍第二种方法:Hooks(与工具方法不同)
- Hooks允许在代理生命周期的不同点执行操作
- 可以在代理初始化、消息添加、工具调用、请求结束等时刻挂钩

46:30 - 实现记忆Hooks
- 在代理初始化时:从长期记忆检索用户偏好,加载用户档案
- 在消息添加时:将用户和代理的消息存储到短期记忆
- 短期记忆会自动传播到长期记忆,无需额外操作

47:45 - 工具与Hooks的对比
- 会议数据检索使用工具方法(RAG组件)
- 记忆管理使用Hooks方法
- 两种方法适用于不同场景...

(会议在此处字幕截断)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


关键技术要点总结:
- 使用Amazon Bedrock Knowledge Bases实现托管RAG
- 使用Agent Core Memory实现会话持久化和个性化
- 使用Trans Agents框架简化代理开发
- 采用S3 Tables作为向量存储
- 使用Claude Haiku 4.5和Titan Embeddings v2
- 通过工具和Hooks两种方式扩展代理能力