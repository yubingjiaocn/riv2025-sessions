1
00:00:00,210 --> 00:00:01,260
- [Dani] Hi everyone.

2
00:00:03,090 --> 00:00:06,120
Great people doing a
code talk after lunch.

3
00:00:06,120 --> 00:00:07,590
And (chuckles)

4
00:00:07,590 --> 00:00:12,269
my name is Dani, I'm
a solutions architect.

5
00:00:12,269 --> 00:00:13,590
I'm focused on GenAI.

6
00:00:13,590 --> 00:00:16,290
I work in the Amazon Bedrock team,

7
00:00:16,290 --> 00:00:19,200
focusing on knowledge
base and AgentCore memory.

8
00:00:19,200 --> 00:00:20,370
And I'm here today with Akarsha.

9
00:00:20,370 --> 00:00:21,780
Akarsha, do you wanna?

10
00:00:21,780 --> 00:00:22,613
- [Akarsha] Hi, everyone.

11
00:00:22,613 --> 00:00:24,445
My name is Akarsha Sehwag,

12
00:00:24,445 --> 00:00:25,278
I'm a GenAI data scientist

13
00:00:25,278 --> 00:00:27,033
with AgentCore memory team.

14
00:00:28,140 --> 00:00:28,973
- [Dani] Yep.

15
00:00:29,940 --> 00:00:33,270
So today, let me just go back a second,

16
00:00:33,270 --> 00:00:34,140
but we're gonna be talking,

17
00:00:34,140 --> 00:00:35,220
we're gonna be doing a code talk.

18
00:00:35,220 --> 00:00:39,330
So it's gonna be basically
us going through some code.

19
00:00:39,330 --> 00:00:41,280
So it's gonna be like a level 400 session.

20
00:00:41,280 --> 00:00:44,280
So we'll go, we'll dive deep
into the details of the,

21
00:00:44,280 --> 00:00:45,720
you know, different APIs

22
00:00:45,720 --> 00:00:49,200
and the code that we're
gonna be using today.

23
00:00:49,200 --> 00:00:51,000
So we're gonna be diving deep

24
00:00:51,000 --> 00:00:53,763
into agentic RAG systems, right?

25
00:00:55,050 --> 00:00:56,820
So we'll just start out,

26
00:00:56,820 --> 00:00:59,610
we'll set the layers to the foundation,

27
00:00:59,610 --> 00:01:01,833
let's talk about what agentic RAG is,

28
00:01:02,730 --> 00:01:04,500
and then we'll see what
we are building today.

29
00:01:04,500 --> 00:01:06,180
And then I promise I'll
go out of the slides

30
00:01:06,180 --> 00:01:08,280
and go into the code, right?

31
00:01:08,280 --> 00:01:10,320
I won't be an hour with slides.

32
00:01:10,320 --> 00:01:12,570
And at the end we'll
give you some resources

33
00:01:12,570 --> 00:01:14,493
that we put together to get started.

34
00:01:15,930 --> 00:01:18,840
So let's start with the basics.

35
00:01:18,840 --> 00:01:20,610
Retrieval-Augmented Generation.

36
00:01:20,610 --> 00:01:22,980
I hope everyone in the
room has heard about this.

37
00:01:22,980 --> 00:01:24,060
We've been talking about this

38
00:01:24,060 --> 00:01:25,660
for the past two or three years.

39
00:01:26,730 --> 00:01:28,380
So I just wanna go quickly over

40
00:01:28,380 --> 00:01:30,723
what retrieval-augmented-generation
is, right?

41
00:01:31,680 --> 00:01:33,510
Or how the workflow goes.

42
00:01:33,510 --> 00:01:35,070
The very, very high level,

43
00:01:35,070 --> 00:01:38,010
we have our query that we
send into our model, right?

44
00:01:38,010 --> 00:01:39,450
But before we send that into a model,

45
00:01:39,450 --> 00:01:40,800
we're gonna augment that query, right?

46
00:01:40,800 --> 00:01:42,720
We're gonna give it
additional information.

47
00:01:42,720 --> 00:01:46,170
This can come from our, you
know, internal data sources.

48
00:01:46,170 --> 00:01:49,170
So you just wanna provide
external information to the model

49
00:01:49,170 --> 00:01:50,470
so it doesn't hallucinate,

50
00:01:51,420 --> 00:01:53,790
and then it will have the
full context to, you know,

51
00:01:53,790 --> 00:01:57,693
generate an answer and
give you back the response.

52
00:02:00,180 --> 00:02:03,450
But, Akarsha, is that correct or not?

53
00:02:03,450 --> 00:02:05,190
- [Akarsha] I mean,
it's partially correct.

54
00:02:05,190 --> 00:02:06,023
- Yeah.
- So,

55
00:02:06,023 --> 00:02:07,410
when we think about agents, right?

56
00:02:07,410 --> 00:02:09,960
We have the LLM that has
a lot of capabilities,

57
00:02:09,960 --> 00:02:12,810
but agents themselves are
fundamentally stateless.

58
00:02:12,810 --> 00:02:17,400
So all we can provide from
our side to make them better,

59
00:02:17,400 --> 00:02:20,790
to make them smarter,
is in this retrieval,

60
00:02:20,790 --> 00:02:22,740
in this RAG component.

61
00:02:22,740 --> 00:02:25,920
So today, we don't just consider RAG

62
00:02:25,920 --> 00:02:30,090
to be retrieving from a
knowledge base or a data source,

63
00:02:30,090 --> 00:02:34,590
we talk about more in a generalized way,

64
00:02:34,590 --> 00:02:36,000
which is called context.

65
00:02:36,000 --> 00:02:37,560
So today you must have heard these,

66
00:02:37,560 --> 00:02:39,270
this new term popping up everywhere,

67
00:02:39,270 --> 00:02:41,430
which is called context engineering.

68
00:02:41,430 --> 00:02:43,560
So essentially what it
does, and what it means is

69
00:02:43,560 --> 00:02:46,800
we are curating our context

70
00:02:46,800 --> 00:02:51,150
in a way that we are providing
very precise information

71
00:02:51,150 --> 00:02:53,700
that the agent needs to give smart

72
00:02:53,700 --> 00:02:56,160
and more accurate responses, right?

73
00:02:56,160 --> 00:02:59,160
So that includes information
from the documents,

74
00:02:59,160 --> 00:03:01,083
so the traditional RAG component.

75
00:03:02,040 --> 00:03:04,980
Then it also includes curating our tools.

76
00:03:04,980 --> 00:03:08,550
So figuring out which
tools to are relevant

77
00:03:08,550 --> 00:03:12,180
for this current query
or this current use case.

78
00:03:12,180 --> 00:03:13,800
So finalizing those

79
00:03:13,800 --> 00:03:16,140
and also making sure
that whatever information

80
00:03:16,140 --> 00:03:20,220
we have provided in those
tools is very accurate

81
00:03:20,220 --> 00:03:23,490
for the agent to know when to use it.

82
00:03:23,490 --> 00:03:26,010
And then we have the memory component.

83
00:03:26,010 --> 00:03:28,620
So memory component is
where we are providing it

84
00:03:28,620 --> 00:03:31,260
with more information about the user

85
00:03:31,260 --> 00:03:35,190
to make it more personalized,
to make the experience

86
00:03:35,190 --> 00:03:38,310
for the user much better, right?

87
00:03:38,310 --> 00:03:40,500
So that's where the
memory component comes in.

88
00:03:40,500 --> 00:03:43,683
And all of this combined is
what defines the context.

89
00:03:45,120 --> 00:03:46,890
- [Dani] Yeah, that
sounds right. (chuckles)

90
00:03:46,890 --> 00:03:48,540
So now we have, then we have,

91
00:03:48,540 --> 00:03:51,750
now we, you know, we have
all this context coming in

92
00:03:51,750 --> 00:03:53,490
and we have a new way

93
00:03:53,490 --> 00:03:56,040
of retrieving our information, right?

94
00:03:56,040 --> 00:03:57,330
So we have our query,

95
00:03:57,330 --> 00:04:00,810
we have a retrieval that retrieve we can,

96
00:04:00,810 --> 00:04:03,690
you know, import information
from different sources

97
00:04:03,690 --> 00:04:05,730
as Akarsha just mentioned.

98
00:04:05,730 --> 00:04:08,790
Then we will augment that query

99
00:04:08,790 --> 00:04:09,787
and then the model will decide,

100
00:04:09,787 --> 00:04:12,000
"hey, am I able to answer

101
00:04:12,000 --> 00:04:13,602
with the information I retrieve it,

102
00:04:13,602 --> 00:04:14,880
do I have to go back again and, you know,

103
00:04:14,880 --> 00:04:17,220
look for a bit more information?"

104
00:04:17,220 --> 00:04:19,143
If not, we can get back the response.

105
00:04:20,129 --> 00:04:22,110
(coughs) Apologies.

106
00:04:22,110 --> 00:04:27,003
So this is agentic RAG at a
high level, (coughs) apologies.

107
00:04:28,080 --> 00:04:30,810
So what are we building today, okay?

108
00:04:30,810 --> 00:04:32,430
Why are we here today?

109
00:04:32,430 --> 00:04:36,543
We are gonna be building
an event agent, okay?

110
00:04:37,470 --> 00:04:42,470
As I imagine you have your AWS
event application right now.

111
00:04:42,900 --> 00:04:44,820
And at the bottom there was a,

112
00:04:44,820 --> 00:04:48,480
I saw before there was a
small text box which said,

113
00:04:48,480 --> 00:04:50,790
so ask me something or
something like that, right?

114
00:04:50,790 --> 00:04:53,250
And you'll have your common,

115
00:04:53,250 --> 00:04:55,350
you'll have your common agent now

116
00:04:55,350 --> 00:04:56,850
or your common chatbot implemented

117
00:04:56,850 --> 00:04:59,190
into all of these applications.

118
00:04:59,190 --> 00:05:02,280
But we want to not only be able

119
00:05:02,280 --> 00:05:06,576
to search across the
sessions informations,

120
00:05:06,576 --> 00:05:10,530
but we want to deliver truly
hyper personalized experience

121
00:05:10,530 --> 00:05:12,060
to our users, right?

122
00:05:12,060 --> 00:05:15,240
So I can say, hey, what
sessions do you recommend me?

123
00:05:15,240 --> 00:05:18,210
And I expect, or we normally
expect nowadays these agents

124
00:05:18,210 --> 00:05:19,800
to have information about this, right?

125
00:05:19,800 --> 00:05:21,060
Remember some stuff about this

126
00:05:21,060 --> 00:05:23,100
and being able to recommend the stuff

127
00:05:23,100 --> 00:05:25,020
based on our preferences, right?

128
00:05:25,020 --> 00:05:26,940
Or questions like, which
session did we talk

129
00:05:26,940 --> 00:05:28,020
about last time, right?

130
00:05:28,020 --> 00:05:29,610
Having some kind of history

131
00:05:29,610 --> 00:05:31,770
or what sessions are
there on Monday, right?

132
00:05:31,770 --> 00:05:34,470
These kind of common event
questions that show up.

133
00:05:34,470 --> 00:05:35,460
And if you don't ask the app,

134
00:05:35,460 --> 00:05:38,250
you ask someone who is,
who's there to help.

135
00:05:38,250 --> 00:05:40,230
We want to have it all in a single place.

136
00:05:40,230 --> 00:05:41,190
So we are gonna be building

137
00:05:41,190 --> 00:05:45,750
this AWSome event agent, okay?

138
00:05:45,750 --> 00:05:48,123
And this is gonna be basically an agent

139
00:05:48,123 --> 00:05:49,920
that has two capabilities.

140
00:05:49,920 --> 00:05:53,100
So our users are gonna be able
to interact with our agent,

141
00:05:53,100 --> 00:05:56,070
and that agent is gonna
be able to do two things.

142
00:05:56,070 --> 00:05:58,440
One of them is, as I mentioned before,

143
00:05:58,440 --> 00:06:03,150
retrieve session information
from a knowledge base.

144
00:06:03,150 --> 00:06:06,150
And secondly, it's gonna be able to store

145
00:06:06,150 --> 00:06:09,210
and retrieve the conversation
history that we had, right?

146
00:06:09,210 --> 00:06:12,870
And it's gonna be able to
learn from our conversation,

147
00:06:12,870 --> 00:06:15,390
our user preferences.

148
00:06:15,390 --> 00:06:20,190
Okay, so yeah, I think that's
enough slides at the moment.

149
00:06:20,190 --> 00:06:22,530
Let me go and show you all this

150
00:06:22,530 --> 00:06:24,720
looks from a code perspective.

151
00:06:24,720 --> 00:06:26,610
If there are any questions,
put your hand up.

152
00:06:26,610 --> 00:06:28,353
It's a small room today.

153
00:06:29,250 --> 00:06:31,020
We'll try to answer the questions along.

154
00:06:31,020 --> 00:06:33,120
If not, we are happy to
answer the questions,

155
00:06:33,120 --> 00:06:37,350
so when we are outside, right? Cool.

156
00:06:37,350 --> 00:06:41,910
So I'll go through the,
I've got the notebook ready

157
00:06:41,910 --> 00:06:44,070
with this event agent.

158
00:06:44,070 --> 00:06:47,400
We'll make this available
this week in our repo

159
00:06:47,400 --> 00:06:48,810
for AgentCore samples.

160
00:06:48,810 --> 00:06:51,060
We'll give you the
resources for that later.

161
00:06:51,060 --> 00:06:52,410
So just bear with me

162
00:06:52,410 --> 00:06:54,000
and let's figure out

163
00:06:54,000 --> 00:06:56,220
what's going on in this notebook, okay?

164
00:06:56,220 --> 00:06:59,400
So can everyone see this, right?

165
00:06:59,400 --> 00:07:01,440
Let me just go to the text

166
00:07:01,440 --> 00:07:03,780
and see if we need to make
it a bit bigger or not.

167
00:07:03,780 --> 00:07:05,200
- [Akarsha] Yeah, okay. Good.

168
00:07:05,200 --> 00:07:06,033
- Good?
- Yeah.

169
00:07:06,033 --> 00:07:06,866
- [Dani] I don't see anything 'cause

170
00:07:06,866 --> 00:07:09,720
I've got this big lights here. (laughs)

171
00:07:09,720 --> 00:07:14,160
But anyway, so this was
the same slide that before.

172
00:07:14,160 --> 00:07:15,420
This is the high level picture of

173
00:07:15,420 --> 00:07:17,100
what we are building today.

174
00:07:17,100 --> 00:07:19,440
And we are gonna go through
what we call different chapters

175
00:07:19,440 --> 00:07:21,180
and it's gonna be creating the agent.

176
00:07:21,180 --> 00:07:22,710
We create the simple agent,

177
00:07:22,710 --> 00:07:23,880
we create the knowledge base,

178
00:07:23,880 --> 00:07:25,980
that's where the session information is.

179
00:07:25,980 --> 00:07:30,720
We create the memory for agent
to have that persistence,

180
00:07:30,720 --> 00:07:32,880
and then we are gonna see how
we can move this to production

181
00:07:32,880 --> 00:07:36,350
and do it in a secure way
using AgentCore runtime

182
00:07:36,350 --> 00:07:38,250
or AgentCore identity.

183
00:07:38,250 --> 00:07:42,183
So if I start here with my notebook,

184
00:07:44,160 --> 00:07:46,410
pretty simple, just
installing some dependencies

185
00:07:46,410 --> 00:07:48,660
I need this to work with.

186
00:07:48,660 --> 00:07:51,040
I'll import some libraries that I need

187
00:07:51,894 --> 00:07:52,727
for the notebook to work

188
00:07:52,727 --> 00:07:55,130
and important things here
is that I'm gonna be using

189
00:07:56,760 --> 00:07:58,533
Claude Haiku 4.5.

190
00:07:59,700 --> 00:08:03,000
I'm gonna be using Amazon
Titan text embedding v2

191
00:08:03,000 --> 00:08:05,760
for my knowledge base, and I'll
talk about that a bit later.

192
00:08:05,760 --> 00:08:07,560
I just want you to understand
what's going on here.

193
00:08:07,560 --> 00:08:09,510
I'm just setting those
and creating a unique idea

194
00:08:09,510 --> 00:08:11,970
to have unique resources, okay?

195
00:08:11,970 --> 00:08:12,803
Pretty simple.

196
00:08:14,460 --> 00:08:17,910
For every code, I will
show you the outputs.

197
00:08:17,910 --> 00:08:19,590
It makes much more sense.

198
00:08:19,590 --> 00:08:21,363
So let's start with the agent.

199
00:08:23,730 --> 00:08:25,830
What are we going to, yeah,

200
00:08:25,830 --> 00:08:28,740
- [Audience Member] what is
it like the database here?

201
00:08:28,740 --> 00:08:29,840
- [Dani] Sorry, the...

202
00:08:30,970 --> 00:08:31,803
- [Akarsha] We'll get to that.

203
00:08:31,803 --> 00:08:34,353
- [Dani] Yeah, give me one
chapter and I'll get to that.

204
00:08:35,970 --> 00:08:37,800
So, let's start with the agent, right?

205
00:08:37,800 --> 00:08:39,540
Let's start with the most simple step.

206
00:08:39,540 --> 00:08:42,300
We are gonna be building
a simple agent, right?

207
00:08:42,300 --> 00:08:44,430
And that agent is gonna have a context.

208
00:08:44,430 --> 00:08:45,960
And that context is just gonna be,

209
00:08:45,960 --> 00:08:49,200
you are an intelligent
event assistant, right?

210
00:08:49,200 --> 00:08:51,690
So I'm gonna be using Strands Agents,

211
00:08:51,690 --> 00:08:54,390
Akarsha, did use any
other framework here, or?

212
00:08:54,390 --> 00:08:55,950
- [Akarsha] You can use
any framework you want.

213
00:08:55,950 --> 00:08:58,710
So you can use LangGraph,
LangChain, CrewAI,

214
00:08:58,710 --> 00:09:00,300
any framework that you're currently using.

215
00:09:00,300 --> 00:09:01,320
We use Strands Agents

216
00:09:01,320 --> 00:09:05,520
because it makes it very easy for us

217
00:09:05,520 --> 00:09:08,760
to build agents and Strands Agents is a,

218
00:09:08,760 --> 00:09:10,410
I would say fairly new framework

219
00:09:10,410 --> 00:09:11,880
that has been out in the market.

220
00:09:11,880 --> 00:09:14,340
It's an open source
framework that allows us

221
00:09:14,340 --> 00:09:17,910
to leverage the capabilities
of the model itself,

222
00:09:17,910 --> 00:09:21,000
to be able to plan, to take actions

223
00:09:21,000 --> 00:09:25,170
and also to revisit whatever has occurred,

224
00:09:25,170 --> 00:09:27,360
if it actually achieves the goal or not,

225
00:09:27,360 --> 00:09:29,460
to be able to reflect on that.

226
00:09:29,460 --> 00:09:32,520
- [Dani] Okay, then I'll
go with Strands. (chuckles)

227
00:09:32,520 --> 00:09:36,193
So what do I need to do to
create my agent with Strands?

228
00:09:36,193 --> 00:09:38,460
I just create, I just
import my agent class

229
00:09:38,460 --> 00:09:40,200
and then I import my model class.

230
00:09:40,200 --> 00:09:41,970
I'm gonna be using model,

231
00:09:41,970 --> 00:09:43,920
which is available in Amazon Bedrock,

232
00:09:43,920 --> 00:09:47,280
that's the Haiku 4.5, right?

233
00:09:47,280 --> 00:09:50,130
And to create an agent
with Strands Agents,

234
00:09:50,130 --> 00:09:53,913
is just simple as, let me
just get my pointer out here.

235
00:09:54,930 --> 00:09:56,520
I'm gonna create my simple agent.

236
00:09:56,520 --> 00:09:58,980
This is gonna be my class
that I brought before.

237
00:09:58,980 --> 00:10:00,210
I'm gonna be defining a model,

238
00:10:00,210 --> 00:10:02,910
the model that's underneath this agent,

239
00:10:02,910 --> 00:10:05,310
and I'm gonna be giving
it a system from, right?

240
00:10:05,310 --> 00:10:06,570
So I'm gonna give it a bit of context

241
00:10:06,570 --> 00:10:07,650
on what it's supposed to be doing.

242
00:10:07,650 --> 00:10:08,880
So it's simple as saying,

243
00:10:08,880 --> 00:10:12,453
hey, you are an intelligent
event assistant, okay?

244
00:10:13,650 --> 00:10:14,850
Simple as that.

245
00:10:14,850 --> 00:10:17,910
You create your first
agent, one line of code,

246
00:10:17,910 --> 00:10:20,493
if I take out the white space.

247
00:10:23,730 --> 00:10:25,683
So when I go and interact with this agent,

248
00:10:25,683 --> 00:10:30,300
I'll say, "Hey, simple agent,
which is a good session

249
00:10:30,300 --> 00:10:33,960
to learn about security
and AI agents, right?"

250
00:10:33,960 --> 00:10:36,997
And we see that the agent will respond,

251
00:10:36,997 --> 00:10:39,390
"Hey, I don't have enough information

252
00:10:39,390 --> 00:10:42,030
about specific sessions or
events in your current context."

253
00:10:42,030 --> 00:10:43,260
And that makes completely sense

254
00:10:43,260 --> 00:10:45,720
because I haven't told
it I'm at (indistinct)

255
00:10:45,720 --> 00:10:48,600
I haven't given any
information about the sessions.

256
00:10:48,600 --> 00:10:49,860
It's just a blank agent

257
00:10:49,860 --> 00:10:52,410
and it's just, you know, using the model

258
00:10:52,410 --> 00:10:54,900
on the hood with the information
that it's been trained on.

259
00:10:54,900 --> 00:10:57,240
So that's completely normal, right?

260
00:10:57,240 --> 00:11:01,290
So how do we start giving
context to our agent?

261
00:11:01,290 --> 00:11:06,270
So one way is via knowledge base, right?

262
00:11:06,270 --> 00:11:08,280
And with knowledge base,
what we're gonna be doing

263
00:11:08,280 --> 00:11:11,820
is we are gonna be
providing the re:Invent.

264
00:11:11,820 --> 00:11:12,653
So in this case,

265
00:11:12,653 --> 00:11:15,930
I'm using the re:Invent 2024 sessions

266
00:11:15,930 --> 00:11:17,640
I found around, (chuckles)

267
00:11:17,640 --> 00:11:20,190
and I'm gonna be providing
that to agent. okay?

268
00:11:20,190 --> 00:11:22,800
So for anyone who
doesn't know in the room,

269
00:11:22,800 --> 00:11:26,890
Amazon Bedrock Knowledge
Base is a fully managed

270
00:11:28,380 --> 00:11:32,850
service inside the Amazon Bedrock.

271
00:11:32,850 --> 00:11:37,170
And it helps you create
fully managed workflows

272
00:11:37,170 --> 00:11:38,190
for RAG, right?

273
00:11:38,190 --> 00:11:42,870
So we are gonna be able
to create a knowledge base

274
00:11:42,870 --> 00:11:44,940
where we are gonna say,

275
00:11:44,940 --> 00:11:48,630
we're gonna be able to
define our data source layer

276
00:11:48,630 --> 00:11:50,670
and a data storage layer, right?

277
00:11:50,670 --> 00:11:53,670
So when I'm talking
about data source layer,

278
00:11:53,670 --> 00:11:55,350
I have right now, NGA,

279
00:11:55,350 --> 00:11:57,150
we have two available data connectors.

280
00:11:57,150 --> 00:12:01,000
So I can basically
bring in my data from S3

281
00:12:01,890 --> 00:12:06,210
or I can directly send in the information

282
00:12:06,210 --> 00:12:08,250
into the Bedrock knowledge base.

283
00:12:08,250 --> 00:12:10,560
I have four different
chunking strategies, right?

284
00:12:10,560 --> 00:12:12,900
So when we are talking about RAG,

285
00:12:12,900 --> 00:12:16,080
the flow is normally
you have your documents,

286
00:12:16,080 --> 00:12:17,100
you get those documents

287
00:12:17,100 --> 00:12:18,390
and you parse them to understand

288
00:12:18,390 --> 00:12:20,850
what's inside those documents, right?

289
00:12:20,850 --> 00:12:23,280
And once you have that, you're
gonna split those documents

290
00:12:23,280 --> 00:12:26,040
into smaller chunks, okay?

291
00:12:26,040 --> 00:12:28,277
Then using an embedding model,

292
00:12:28,277 --> 00:12:32,670
we are gonna transform
those chunks into vectors

293
00:12:32,670 --> 00:12:36,330
and those vectors end up in
a vector database, right?

294
00:12:36,330 --> 00:12:40,980
Pretty simple RAG knowledge base helps you

295
00:12:40,980 --> 00:12:44,280
with this whole process
in a managed way, right?

296
00:12:44,280 --> 00:12:47,700
You only have to configure
where your data is coming from,

297
00:12:47,700 --> 00:12:50,040
what kind of chunking
strategy you want to use,

298
00:12:50,040 --> 00:12:52,020
what kind of parsing
strategy you want to use,

299
00:12:52,020 --> 00:12:55,200
and then define what
embedding model I'm using

300
00:12:55,200 --> 00:12:57,420
and the underlying vector store, okay?

301
00:12:57,420 --> 00:12:59,490
So all that information is gonna end up

302
00:12:59,490 --> 00:13:02,940
in my knowledge base, and
then I can use retrieve API

303
00:13:02,940 --> 00:13:04,020
to retrieve the chunks.

304
00:13:04,020 --> 00:13:06,030
So basically doing a semantic search

305
00:13:06,030 --> 00:13:07,800
against the vector database,

306
00:13:07,800 --> 00:13:10,200
or I can use retrieve and generate,

307
00:13:10,200 --> 00:13:13,290
which will combine that process

308
00:13:13,290 --> 00:13:15,090
of retrieve my chunks

309
00:13:15,090 --> 00:13:19,500
and automatically sending it
to the foundation model, right?

310
00:13:19,500 --> 00:13:21,750
And getting back a response.

311
00:13:21,750 --> 00:13:23,910
So I have those two options there.

312
00:13:23,910 --> 00:13:26,040
So what am I gonna be doing?

313
00:13:26,040 --> 00:13:29,850
I'm gonna be creating a tool for my agent

314
00:13:29,850 --> 00:13:33,120
and that tool is gonna be able
to call knowledge base, okay?

315
00:13:33,120 --> 00:13:36,270
So here my code, I will, let me see,

316
00:13:36,270 --> 00:13:38,790
I'm going with time, I'm going good.

317
00:13:38,790 --> 00:13:40,530
What I'll do is these are the steps

318
00:13:40,530 --> 00:13:41,940
that I'm gonna go through.

319
00:13:41,940 --> 00:13:45,270
I'm gonna download my 2024 session data.

320
00:13:45,270 --> 00:13:47,220
I'm gonna create my S3 bucket.

321
00:13:47,220 --> 00:13:49,858
That's where those
documents are gonna end up.

322
00:13:49,858 --> 00:13:51,663
And I'm gonna upload them.

323
00:13:52,620 --> 00:13:55,110
I'm gonna create an S3 vector store index.

324
00:13:55,110 --> 00:13:58,293
So for this use case, I'm gonna
be using S3 vectors, right?

325
00:13:58,293 --> 00:14:01,020
This is a fairly new capability from S3,

326
00:14:01,020 --> 00:14:06,020
which gives support for
vector storage, okay?

327
00:14:08,700 --> 00:14:12,180
Then I'm gonna go and
create my knowledge base

328
00:14:12,180 --> 00:14:14,670
and do the ingestion job, okay?

329
00:14:14,670 --> 00:14:16,800
Finally, I will test that knowledge base

330
00:14:16,800 --> 00:14:19,620
and final, then I will create
that tool for the agent

331
00:14:19,620 --> 00:14:21,570
to consume.

332
00:14:21,570 --> 00:14:23,973
So pretty simple steps here.

333
00:14:25,281 --> 00:14:27,330
I don't want to spend
too much time on this.

334
00:14:27,330 --> 00:14:30,390
The other one is more catchy I think.

335
00:14:30,390 --> 00:14:31,380
But basically here,

336
00:14:31,380 --> 00:14:32,430
first is what I'm doing

337
00:14:32,430 --> 00:14:34,320
is I'm basically
downloading my data, right?

338
00:14:34,320 --> 00:14:35,750
I'm downloading,

339
00:14:35,750 --> 00:14:38,100
it's basically a single file
which contains information

340
00:14:38,100 --> 00:14:41,790
about 583, if I remember
correctly, sessions.

341
00:14:41,790 --> 00:14:42,660
- 88.
- Exactly.

342
00:14:42,660 --> 00:14:44,190
It downloads that file.

343
00:14:44,190 --> 00:14:47,250
I am just understanding
what's going on on that file.

344
00:14:47,250 --> 00:14:48,600
Then I'll prepare those documents.

345
00:14:48,600 --> 00:14:50,130
So instead of having a single file,

346
00:14:50,130 --> 00:14:53,640
I'm gonna split it 580 different files,

347
00:14:53,640 --> 00:14:55,470
which will go into the knowledge base.

348
00:14:55,470 --> 00:14:57,307
So that's just basically

349
00:14:57,307 --> 00:14:58,140
what I'm doing here, right?

350
00:14:58,140 --> 00:14:59,850
I'm creating my directory

351
00:14:59,850 --> 00:15:02,580
and I will split that single file

352
00:15:02,580 --> 00:15:04,770
into multiple files, okay?

353
00:15:04,770 --> 00:15:05,870
Pretty, pretty simple.

354
00:15:06,960 --> 00:15:08,550
So I'm gonna be preparing those documents,

355
00:15:08,550 --> 00:15:12,180
as you can see here,
creating those 500 documents

356
00:15:12,180 --> 00:15:14,100
and putting it into a folder.

357
00:15:14,100 --> 00:15:15,380
Then what I'm gonna do

358
00:15:15,380 --> 00:15:19,830
is I'm gonna send those
documents to my S3 bucket, okay.

359
00:15:19,830 --> 00:15:23,040
So here I'm just creating my S3 bucket.

360
00:15:23,040 --> 00:15:24,930
I'm gonna give it a unique name,

361
00:15:24,930 --> 00:15:26,730
that's where I'm gonna
be sending my files to.

362
00:15:26,730 --> 00:15:29,190
And once I have created that bucket

363
00:15:29,190 --> 00:15:32,190
I will upload the documents, right?

364
00:15:32,190 --> 00:15:34,770
Using, in this case,
we're using (indistinct)

365
00:15:34,770 --> 00:15:36,750
to send the documents to the bucket.

366
00:15:36,750 --> 00:15:37,850
Pretty, pretty simple.

367
00:15:39,540 --> 00:15:43,110
Right, so as you can see
here, I'm creating my bucket

368
00:15:43,110 --> 00:15:46,320
and then I'm uploading all the files.

369
00:15:46,320 --> 00:15:49,387
This took like six, this
took one minute, it's okay.

370
00:15:49,387 --> 00:15:50,853
It wasn't that much.

371
00:15:51,810 --> 00:15:52,830
Next, what do I need to do?

372
00:15:52,830 --> 00:15:55,800
I need to create my IAM role
for my knowledge base, right?

373
00:15:55,800 --> 00:15:59,190
My knowledge base needs
access to an embedding model

374
00:15:59,190 --> 00:16:02,460
and it needs access to
the S3 bucket, right?

375
00:16:02,460 --> 00:16:04,770
In order to do all of its tasks.

376
00:16:04,770 --> 00:16:07,560
So I'm just creating a simple IAM role

377
00:16:07,560 --> 00:16:10,067
where I'm gonna be creating it

378
00:16:10,067 --> 00:16:12,510
and I'll use it later, okay?

379
00:16:12,510 --> 00:16:15,210
All of this, we can do it via code,

380
00:16:15,210 --> 00:16:16,317
which what I'm doing right now,

381
00:16:16,317 --> 00:16:19,740
but you can also do this
via the console, right?

382
00:16:19,740 --> 00:16:23,913
Maybe a bit nicer, but
I have my notebook here.

383
00:16:24,840 --> 00:16:28,560
So just creating my
knowledge base role there.

384
00:16:28,560 --> 00:16:29,910
Pretty simple.

385
00:16:29,910 --> 00:16:32,757
And then I go and create
my S3 vector store

386
00:16:32,757 --> 00:16:33,810
and index, right?

387
00:16:33,810 --> 00:16:35,730
These is where knowledge base

388
00:16:35,730 --> 00:16:38,760
is gonna do the whole ingestion job

389
00:16:38,760 --> 00:16:43,290
and the resulting vectors from
the chunks that we created,

390
00:16:43,290 --> 00:16:45,857
they're gonna end up in
that vector store, okay?

391
00:16:45,857 --> 00:16:50,790
And as it's as simple as
saying, hey, S3 vectors,

392
00:16:50,790 --> 00:16:53,670
I'm using the (indistinct)
clients for s3vectors,

393
00:16:53,670 --> 00:16:55,140
create the vector bucket

394
00:16:55,140 --> 00:16:57,480
and I give it the name, easy.

395
00:16:57,480 --> 00:17:02,310
And then I go and create
vector index. Okay?

396
00:17:02,310 --> 00:17:03,810
So here in the vector index,

397
00:17:03,810 --> 00:17:06,180
what I'm saying is I'm
gonna give it, you know,

398
00:17:06,180 --> 00:17:07,980
where it's supposed to
be, that index in that,

399
00:17:07,980 --> 00:17:10,050
in the vector bucket I created before,

400
00:17:10,050 --> 00:17:11,760
I'm gonna give it an index name

401
00:17:11,760 --> 00:17:13,650
and I'm gonna give it a dimension, right?

402
00:17:13,650 --> 00:17:18,390
And this dimension that I'm
using here, which is 1024,

403
00:17:18,390 --> 00:17:19,410
I'm stating that there

404
00:17:19,410 --> 00:17:22,800
because that's what tightening
embeddings V2 is gonna be

405
00:17:22,800 --> 00:17:25,140
giving us back when we do that comparison

406
00:17:25,140 --> 00:17:27,570
from text to embeddings, right?

407
00:17:27,570 --> 00:17:32,220
Then we set other topics like
distance metric, data type,

408
00:17:32,220 --> 00:17:34,653
and some metadata configuration, okay?

409
00:17:35,700 --> 00:17:39,540
So here we just creating our
S3 vector store and index.

410
00:17:39,540 --> 00:17:43,470
As you can see here, we get
an ARN for both of them.

411
00:17:43,470 --> 00:17:46,680
And now I can go ahead and
create my knowledge base. Okay?

412
00:17:46,680 --> 00:17:49,320
So I'm creating my knowledge
base, simple API call,

413
00:17:49,320 --> 00:17:53,253
I'm creating my knowledge base
here, use my pointer better.

414
00:17:55,560 --> 00:17:58,143
I'm creating my knowledge base,

415
00:17:59,970 --> 00:18:02,010
giving it the name and
giving it a description.

416
00:18:02,010 --> 00:18:05,670
So it's my AWS re:Invent
2024 sessions knowledge base

417
00:18:05,670 --> 00:18:08,160
and giving it the role
that I created before.

418
00:18:08,160 --> 00:18:10,650
And then I'm filling in the configuration

419
00:18:10,650 --> 00:18:13,020
for that knowledge base, right?

420
00:18:13,020 --> 00:18:14,640
So basically here what I'm doing is,

421
00:18:14,640 --> 00:18:15,960
I'm saying you're gonna be using

422
00:18:15,960 --> 00:18:18,360
the Titan text V2 embedding models

423
00:18:18,360 --> 00:18:20,613
that I defined at the
start of the session.

424
00:18:21,750 --> 00:18:23,610
And this is the configuration

425
00:18:23,610 --> 00:18:25,590
for that embedding model, okay?

426
00:18:25,590 --> 00:18:30,357
Here's the 1024 that I used
before for my index, okay?

427
00:18:30,357 --> 00:18:32,700
And then for my storage configuration,

428
00:18:32,700 --> 00:18:35,673
it's gonna be using that index
store that I set up before.

429
00:18:37,050 --> 00:18:38,790
Pretty simple. (chuckles)

430
00:18:38,790 --> 00:18:40,040
Any questions up to here?

431
00:18:42,570 --> 00:18:45,720
I explained it very good,
or I confused you even more.

432
00:18:45,720 --> 00:18:47,643
Okay, I'll take it as the first one.

433
00:18:48,720 --> 00:18:50,247
So I just created my knowledge base

434
00:18:50,247 --> 00:18:51,990
and now I can go ahead

435
00:18:51,990 --> 00:18:53,520
and import and you know,

436
00:18:53,520 --> 00:18:55,410
ingest the data from S3, right?

437
00:18:55,410 --> 00:18:57,390
So I created my knowledge base

438
00:18:57,390 --> 00:18:58,483
and I'll go and ingest my data

439
00:18:58,483 --> 00:19:01,380
and create my knowledge source.

440
00:19:01,380 --> 00:19:04,260
It's an S3 type, knowledge source,

441
00:19:04,260 --> 00:19:07,860
data source, sorry,
with my S3 configuration

442
00:19:07,860 --> 00:19:10,050
and giving it my bucket name.

443
00:19:10,050 --> 00:19:13,200
And here I'm giving the
chunking configuration.

444
00:19:13,200 --> 00:19:16,650
I'm using a fixed size strategy.

445
00:19:16,650 --> 00:19:21,240
We have fixed size, we have no chunking.

446
00:19:21,240 --> 00:19:23,040
We can do semantic chunking,

447
00:19:23,040 --> 00:19:24,870
we can do hierarchical chunking.

448
00:19:24,870 --> 00:19:26,280
You can even bring your own lambda

449
00:19:26,280 --> 00:19:29,790
to do your own chunking
configuration, right?

450
00:19:29,790 --> 00:19:31,950
So there's quite a lot
of flexibility there

451
00:19:31,950 --> 00:19:34,110
depending on your use case, okay?

452
00:19:34,110 --> 00:19:35,520
But in this case, pretty simple.

453
00:19:35,520 --> 00:19:37,660
Fixed size max 300 tokens

454
00:19:39,090 --> 00:19:42,060
and then 20% overlap.

455
00:19:42,060 --> 00:19:45,540
20 overlap percentage, right?

456
00:19:45,540 --> 00:19:48,490
So from there I can go and
start ingesting my data

457
00:19:49,500 --> 00:19:51,120
and I'll wait for that to finish.

458
00:19:51,120 --> 00:19:54,930
That took me around two
minutes, that's good.

459
00:19:54,930 --> 00:19:58,410
It processed my 583 files
and I can go and ahead

460
00:19:58,410 --> 00:20:00,810
and test my knowledge
base retrieval, right?

461
00:20:00,810 --> 00:20:02,940
So if I ask a question, "Hey,

462
00:20:02,940 --> 00:20:05,970
what other sessions about
generative AI and security,"

463
00:20:05,970 --> 00:20:08,040
I will go and use the retrieve API,

464
00:20:08,040 --> 00:20:09,030
which I mentioned before.

465
00:20:09,030 --> 00:20:10,530
So I'm just retrieving the chunks,

466
00:20:10,530 --> 00:20:12,270
I'm just doing a semantic search

467
00:20:12,270 --> 00:20:16,440
and it will give me back the
three most relevant results

468
00:20:16,440 --> 00:20:17,763
for that query, right?

469
00:20:19,080 --> 00:20:21,907
So if I ask that question, it'll say,

470
00:20:21,907 --> 00:20:23,790
"Hey, I found these three results."

471
00:20:23,790 --> 00:20:26,820
And these are the three
chunks it got back, right?

472
00:20:26,820 --> 00:20:29,670
These three sessions that I have here.

473
00:20:29,670 --> 00:20:30,703
Okay, pretty simple.

474
00:20:30,703 --> 00:20:32,940
I just created knowledge
base, ingested my data

475
00:20:32,940 --> 00:20:34,830
and I did that all programmatically.

476
00:20:34,830 --> 00:20:38,400
Now fun bit, I'm gonna create
my knowledge based search tool

477
00:20:38,400 --> 00:20:41,310
and this is what the
agent is gonna be using.

478
00:20:41,310 --> 00:20:45,120
So how tool works with Strands

479
00:20:45,120 --> 00:20:47,640
is that you're gonna take your Python code

480
00:20:47,640 --> 00:20:50,610
with your, you know, typical function

481
00:20:50,610 --> 00:20:54,717
and you're going to put in
here this tool decorator, okay?

482
00:20:54,717 --> 00:20:57,300
And with that tool decorator,

483
00:20:57,300 --> 00:20:58,968
then you can pass it on to the agent

484
00:20:58,968 --> 00:21:01,290
and the agent will make use of that tool.

485
00:21:01,290 --> 00:21:02,550
So the nice thing about this tool

486
00:21:02,550 --> 00:21:05,820
is that I'm gonna be
passing in description

487
00:21:05,820 --> 00:21:09,976
and that's what the agent
is gonna first read, right?

488
00:21:09,976 --> 00:21:12,030
And see if it needs to
use that tool or not

489
00:21:12,030 --> 00:21:13,620
for the task it need.

490
00:21:13,620 --> 00:21:15,990
So as you can see here, I'm saying,

491
00:21:15,990 --> 00:21:20,610
hey, this is a tool to
search re:Invent sessions

492
00:21:20,610 --> 00:21:22,810
from a knowledge base
using semantic search.

493
00:21:23,850 --> 00:21:25,500
Use this tool whenever a user asks

494
00:21:25,500 --> 00:21:27,700
for recommendation about
re:Invent sessions, right?

495
00:21:27,700 --> 00:21:30,840
And I can pass in a query
and max results, right?

496
00:21:30,840 --> 00:21:34,410
And this is just a plain
API called to bedrock

497
00:21:34,410 --> 00:21:36,480
and knowledge base,
which is retrieve, okay?

498
00:21:36,480 --> 00:21:38,490
And I'm passing in my knowledge base ID,

499
00:21:38,490 --> 00:21:42,270
my retrieval query and a
retrieval configuration, okay?

500
00:21:42,270 --> 00:21:47,270
So with that I have my knowledge
base search tool created

501
00:21:47,790 --> 00:21:50,730
and I think Akarsha you
can take it on from here.

502
00:21:50,730 --> 00:21:51,563
Yeah.

503
00:21:52,447 --> 00:21:53,280
- [Akarsha] Okay,

504
00:21:53,280 --> 00:21:57,150
so we have one of the
competence of the agentic RAG

505
00:21:57,150 --> 00:21:58,320
that we were talking about.

506
00:21:58,320 --> 00:22:00,030
We have that ready.

507
00:22:00,030 --> 00:22:02,220
And we have that ready
for consumption as well

508
00:22:02,220 --> 00:22:04,650
because you have created
it as a tool, right?

509
00:22:04,650 --> 00:22:08,940
So one key difference why you
would use something as a tool

510
00:22:08,940 --> 00:22:11,130
would be when you want
the agent to decide,

511
00:22:11,130 --> 00:22:11,963
you want to have it,

512
00:22:11,963 --> 00:22:15,780
the flexibility to choose
when does it want to call it,

513
00:22:15,780 --> 00:22:18,600
when does it feel it's relevant to call

514
00:22:18,600 --> 00:22:19,710
the knowledge base, right?

515
00:22:19,710 --> 00:22:21,692
So that's when we are using the tool.

516
00:22:21,692 --> 00:22:25,800
We could take another
approach with the hooks.

517
00:22:25,800 --> 00:22:28,890
This is what we are gonna
see a bit later here,

518
00:22:28,890 --> 00:22:32,400
but it's dependent on how dynamic

519
00:22:32,400 --> 00:22:34,860
or how deterministic do you want it to be.

520
00:22:34,860 --> 00:22:36,560
You would choose one or the other.

521
00:22:37,650 --> 00:22:39,700
So now let's add the second component

522
00:22:40,781 --> 00:22:43,200
of context into our agent.

523
00:22:43,200 --> 00:22:45,570
So let's look at the memory, right?

524
00:22:45,570 --> 00:22:50,220
So what memory does to persist
our agent conversation,

525
00:22:50,220 --> 00:22:52,020
so we added the RAG so far

526
00:22:52,020 --> 00:22:54,960
with some generic information, right?

527
00:22:54,960 --> 00:22:56,640
Now, we are adding memory

528
00:22:56,640 --> 00:23:01,470
to have more personalized
context about the users.

529
00:23:01,470 --> 00:23:03,780
So how that works is our users,

530
00:23:03,780 --> 00:23:05,970
when they're interacting with the agent,

531
00:23:05,970 --> 00:23:08,400
they have this conversation

532
00:23:08,400 --> 00:23:10,650
that they build up over time, right?

533
00:23:10,650 --> 00:23:13,950
So that information goes
into the AgentCore Memory

534
00:23:13,950 --> 00:23:15,990
as events.

535
00:23:15,990 --> 00:23:18,993
So those events we term
as short-term memory,

536
00:23:22,230 --> 00:23:23,063
yeah.

537
00:23:23,063 --> 00:23:25,320
Those events we send
into short-term memory

538
00:23:25,320 --> 00:23:27,240
which stores those events

539
00:23:27,240 --> 00:23:31,350
into a data store as raw
conversational messages.

540
00:23:31,350 --> 00:23:34,740
Now those messages based
on how you configure it,

541
00:23:34,740 --> 00:23:38,850
so you can choose to have
more extracted insights

542
00:23:38,850 --> 00:23:42,540
from those events and
say that for example,

543
00:23:42,540 --> 00:23:45,630
hey I wanna create user
preferences strategy.

544
00:23:45,630 --> 00:23:49,110
So I want to extract from all
the conversations you've had,

545
00:23:49,110 --> 00:23:53,550
I wanna extract user preferences
from that conversation.

546
00:23:53,550 --> 00:23:57,510
Or you can choose something
between semantic or summary.

547
00:23:57,510 --> 00:23:59,880
So these are some predefined strategies

548
00:23:59,880 --> 00:24:01,800
that we have in AgentCore Memory

549
00:24:01,800 --> 00:24:04,020
or you can customize those as well.

550
00:24:04,020 --> 00:24:06,090
So you can either customize the prompts

551
00:24:06,090 --> 00:24:07,470
of those inbuilt strategies

552
00:24:07,470 --> 00:24:10,740
or create a completely
new pipeline of your own.

553
00:24:10,740 --> 00:24:13,350
So that's completely dependent on you.

554
00:24:13,350 --> 00:24:15,381
- [Dani] Yeah, and if I
can just add onto that

555
00:24:15,381 --> 00:24:18,470
just for a second, just to
give you a use case, right?

556
00:24:18,470 --> 00:24:20,640
We have our agent, which
we are speaking with

557
00:24:20,640 --> 00:24:22,050
for a whole week.

558
00:24:22,050 --> 00:24:26,040
If I am stacking up the
conversation history of over week

559
00:24:26,040 --> 00:24:28,020
and sending it over to the agent

560
00:24:28,020 --> 00:24:30,090
and for the LLM to process,

561
00:24:30,090 --> 00:24:32,550
whoever's paying for the
bill is not gonna be happy

562
00:24:32,550 --> 00:24:35,100
because you have this really big context

563
00:24:35,100 --> 00:24:37,320
and it's gonna be affecting the price.

564
00:24:37,320 --> 00:24:38,880
'cause it's a huge context.

565
00:24:38,880 --> 00:24:40,590
It's gonna be affecting the latency

566
00:24:40,590 --> 00:24:42,660
because you know, it's got to process more

567
00:24:42,660 --> 00:24:45,150
and then it can even have
problems with accuracy, right?

568
00:24:45,150 --> 00:24:47,443
If I've got this huge
amount of information

569
00:24:47,443 --> 00:24:48,905
I have to process,

570
00:24:48,905 --> 00:24:50,020
it should be better

571
00:24:51,180 --> 00:24:52,503
if it was smaller, right?

572
00:24:53,430 --> 00:24:58,080
So instead of taking that big context

573
00:24:58,080 --> 00:25:02,070
and passing it onto the
agent, it makes more sense

574
00:25:02,070 --> 00:25:04,020
to extract what's actually important

575
00:25:04,020 --> 00:25:05,730
from that conversation, right?

576
00:25:05,730 --> 00:25:07,230
And that's where the long term comes in,

577
00:25:07,230 --> 00:25:10,920
where you're defining, hey,
from all of these messages

578
00:25:10,920 --> 00:25:13,230
that are going in between
my users and my agent,

579
00:25:13,230 --> 00:25:15,840
I want to extract specific things, right?

580
00:25:15,840 --> 00:25:20,840
And extract user
preferences, semantic facts,

581
00:25:21,030 --> 00:25:24,240
session summaries, or you can
even find your own, you know,

582
00:25:24,240 --> 00:25:26,310
workflow of what you wanna extract.

583
00:25:26,310 --> 00:25:28,434
And I shut up with that. (chuckles)

584
00:25:28,434 --> 00:25:30,348
- Yeah.
- And so question here.

585
00:25:30,348 --> 00:25:33,453
- Yeah.
- For the short memory,

586
00:25:34,410 --> 00:25:37,520
what use an editing
decide what is relevant

587
00:25:38,454 --> 00:25:39,287
based on the context or?

588
00:25:39,287 --> 00:25:40,680
- [Akarsha] For the short-term memory,

589
00:25:40,680 --> 00:25:44,880
you store deterministically,
you send those messages

590
00:25:44,880 --> 00:25:47,160
in the AgentCore Memory.

591
00:25:47,160 --> 00:25:49,295
So they're-
- Which ones do I send?

592
00:25:49,295 --> 00:25:53,213
Have a conversation (faintly speaks).

593
00:25:53,213 --> 00:25:55,263
- [Akarsha] Ideally you send all of them,

594
00:25:56,111 --> 00:25:59,700
- [Audience Member] I just
(faintly speaks), you can repeat

595
00:25:59,700 --> 00:26:01,080
the voice (faintly speaks).

596
00:26:01,080 --> 00:26:02,670
- Oh yeah.
- Okay. Sorry.

597
00:26:02,670 --> 00:26:03,820
Sorry about that. Yeah.

598
00:26:04,830 --> 00:26:05,815
- [Audience Member] So is this based

599
00:26:05,815 --> 00:26:08,046
on (faintly speaks) of user,

600
00:26:08,046 --> 00:26:13,046
this short-term core memory
has (faintly speaks).

601
00:26:13,288 --> 00:26:17,717
- [Akarsha] So AgentCore Memory

602
00:26:19,500 --> 00:26:22,890
is defining the separation
based on the actor ID,

603
00:26:22,890 --> 00:26:25,680
the session ID and the memory ID.

604
00:26:25,680 --> 00:26:28,050
So when you're creating a memory,

605
00:26:28,050 --> 00:26:31,050
it takes in two more identifiers from you,

606
00:26:31,050 --> 00:26:33,270
which is the actor ID and the session ID.

607
00:26:33,270 --> 00:26:37,860
So the actor is usually the
user, but it doesn't have to be.

608
00:26:37,860 --> 00:26:40,530
So it takes in a string that defines

609
00:26:40,530 --> 00:26:43,110
who do these memories belong to, right?

610
00:26:43,110 --> 00:26:44,310
So it can be the agent,

611
00:26:44,310 --> 00:26:45,390
it can be a project,

612
00:26:45,390 --> 00:26:47,070
it can be a team,

613
00:26:47,070 --> 00:26:50,703
it can be a combination of these.

614
00:26:51,540 --> 00:26:52,500
You have flexibility

615
00:26:52,500 --> 00:26:54,120
of what you wanna define in that actor ID

616
00:26:54,120 --> 00:26:55,260
and same for session ID,

617
00:26:55,260 --> 00:26:56,910
but those would be the identifiers

618
00:26:56,910 --> 00:26:59,130
based on which it'll separate the memories

619
00:26:59,130 --> 00:27:00,080
one from the other.

620
00:27:01,830 --> 00:27:03,360
Yeah.

621
00:27:03,360 --> 00:27:04,703
- [Audience Member] I want, for example,

622
00:27:05,588 --> 00:27:07,800
take the feedback that user has given

623
00:27:07,800 --> 00:27:10,900
the sessions that they
have attended, the survey.

624
00:27:10,900 --> 00:27:12,360
- Yeah.
- We hope for this session,

625
00:27:12,360 --> 00:27:15,300
it's a five star, just saying. (chuckles)

626
00:27:15,300 --> 00:27:17,400
- [Audience Member] So give
recommendations of the next day

627
00:27:17,400 --> 00:27:19,419
when they ask, would that be a memory?

628
00:27:19,419 --> 00:27:20,880
Would there be another tool?

629
00:27:20,880 --> 00:27:23,280
- [Akarsha] That should
be stored in the memory?

630
00:27:24,240 --> 00:27:25,940
That should be in the memory. Yes.

631
00:27:28,514 --> 00:27:30,694
- [Audience Member] So customer,

632
00:27:30,694 --> 00:27:33,002
like what we wanna to store?

633
00:27:33,002 --> 00:27:33,930
- We will, we-
- Yeah, we'll get to that.

634
00:27:33,930 --> 00:27:34,920
- [Akarsha] We will look at the code.

635
00:27:34,920 --> 00:27:38,130
So I think code should
clarify how to use it,

636
00:27:38,130 --> 00:27:41,460
but this is just more on the
conceptual level right now.

637
00:27:41,460 --> 00:27:43,240
Should we proceed? Yeah.

638
00:27:44,909 --> 00:27:46,959
- [Audience Member] One last question.

639
00:27:46,959 --> 00:27:49,650
Still not getting a hang of
it, to be honest, properly,

640
00:27:49,650 --> 00:27:52,650
because more the content,

641
00:27:52,650 --> 00:27:53,780
better the accuracy...

642
00:27:54,630 --> 00:27:56,220
- [Dani] Right, so
you're storing everything

643
00:27:56,220 --> 00:27:57,630
into Dynamo.
- Yes.

644
00:27:57,630 --> 00:27:59,610
- [Dani] And then when
you have to get back,

645
00:27:59,610 --> 00:28:00,720
you know, information,

646
00:28:00,720 --> 00:28:02,640
you're getting back everything
that's from Dynamo, right?

647
00:28:02,640 --> 00:28:04,960
- Correct.
- That dynamo would be

648
00:28:05,820 --> 00:28:08,640
corresponding the
short-term memory, right?

649
00:28:08,640 --> 00:28:10,860
But what the, first of all,

650
00:28:10,860 --> 00:28:13,020
this is managed service, so you don't have

651
00:28:13,020 --> 00:28:15,510
to focus on building a
memory storage solution.

652
00:28:15,510 --> 00:28:18,610
We give that for you taking
care of infrastructure

653
00:28:20,160 --> 00:28:22,275
scale and all the other things

654
00:28:22,275 --> 00:28:24,900
that normally come with
managed services with AWS.

655
00:28:24,900 --> 00:28:27,150
But then we don't stop there.

656
00:28:27,150 --> 00:28:29,910
We don't stop at that
dynamo that you're building.

657
00:28:29,910 --> 00:28:31,110
We are...
- They should come.

658
00:28:31,110 --> 00:28:33,906
- Yeah. Sorry, just
- We'll explain the long

659
00:28:33,906 --> 00:28:34,739
- Okay.

660
00:28:34,739 --> 00:28:35,572
Yeah, I'll her explain it.

661
00:28:35,572 --> 00:28:38,033
Yeah, I'll let it say what
comes after. (chuckles)

662
00:28:38,033 --> 00:28:39,360
- [Akarsha] I think we will explain

663
00:28:39,360 --> 00:28:41,853
with the long term of
what you're describing.

664
00:28:42,810 --> 00:28:44,130
So maybe that that helps.

665
00:28:44,130 --> 00:28:45,677
- It'll make sense.
- If not,

666
00:28:45,677 --> 00:28:46,920
then we can take this question again.

667
00:28:46,920 --> 00:28:49,080
- Yeah.
- Alright. Okay.

668
00:28:49,080 --> 00:28:53,010
So based on how you've
configured the memory,

669
00:28:53,010 --> 00:28:54,960
when you created the resource,

670
00:28:54,960 --> 00:28:57,510
you can define one or more strategies

671
00:28:57,510 --> 00:29:01,110
for smart insight extraction, right?

672
00:29:01,110 --> 00:29:02,340
And you can say,

673
00:29:02,340 --> 00:29:04,830
you can define one or
more of these strategies,

674
00:29:04,830 --> 00:29:09,830
summary semantic or user
preferences or create your own.

675
00:29:10,650 --> 00:29:13,740
And based on that it goes
through an extraction module.

676
00:29:13,740 --> 00:29:15,480
Say it goes through an
extraction pipeline,

677
00:29:15,480 --> 00:29:18,360
which essentially consists of two steps.

678
00:29:18,360 --> 00:29:20,340
So one is the extraction step,

679
00:29:20,340 --> 00:29:23,280
which is gonna look at
all the conversation

680
00:29:23,280 --> 00:29:26,070
and extract only the relevant
piece of information.

681
00:29:26,070 --> 00:29:28,770
So for example, if you're
talking about user preferences,

682
00:29:28,770 --> 00:29:30,600
not everything that the user talks about

683
00:29:30,600 --> 00:29:32,970
is talking about user preferences, right?

684
00:29:32,970 --> 00:29:34,770
So from all of that context,

685
00:29:34,770 --> 00:29:38,310
it's gonna only retrieve
wherever user mentions something

686
00:29:38,310 --> 00:29:40,510
that they preferred,
they like, they dislike

687
00:29:41,730 --> 00:29:43,620
or you know, whatever they prefer.

688
00:29:43,620 --> 00:29:46,500
So it only extracts that information.

689
00:29:46,500 --> 00:29:49,410
Now the second step in
this extraction module

690
00:29:49,410 --> 00:29:51,900
is the consolidation step.

691
00:29:51,900 --> 00:29:56,160
So now it looks at the
existing vector store.

692
00:29:56,160 --> 00:29:59,370
So whatever memories it has
existing about that user,

693
00:29:59,370 --> 00:30:00,840
it looks at those,

694
00:30:00,840 --> 00:30:03,570
retrieves the most similar ones.

695
00:30:03,570 --> 00:30:07,740
And it compares the new memories
that it has tried to create

696
00:30:07,740 --> 00:30:09,210
and the existing memories.

697
00:30:09,210 --> 00:30:12,060
And based on that, it consolidates that

698
00:30:12,060 --> 00:30:13,920
and takes one of the steps.

699
00:30:13,920 --> 00:30:18,210
So it either can add a new
memory into the vector store

700
00:30:18,210 --> 00:30:21,180
or it can update an existing memory

701
00:30:21,180 --> 00:30:24,480
with more complete piece of information.

702
00:30:24,480 --> 00:30:26,640
Or the third one, if it's redundant,

703
00:30:26,640 --> 00:30:28,373
if it's not adding any
new piece of information,

704
00:30:28,373 --> 00:30:29,883
then it just skips it.

705
00:30:30,990 --> 00:30:33,180
So this way we do not have any duplication

706
00:30:33,180 --> 00:30:36,360
in the memory store that we create.

707
00:30:36,360 --> 00:30:38,820
So once those memories are ready,

708
00:30:38,820 --> 00:30:42,120
we save them into the
long-term memory store,

709
00:30:42,120 --> 00:30:44,400
which essentially is a vector store

710
00:30:44,400 --> 00:30:48,180
from which you can semantically retrieve

711
00:30:48,180 --> 00:30:49,750
the similar memories

712
00:30:50,640 --> 00:30:53,140
as in when the user asks something similar

713
00:30:54,720 --> 00:30:56,130
from the agent.

714
00:30:56,130 --> 00:31:00,210
So you can retrieve
the long-term memories,

715
00:31:00,210 --> 00:31:02,100
which are more extracted insights,

716
00:31:02,100 --> 00:31:05,250
but you can also retrieve the raw events.

717
00:31:05,250 --> 00:31:08,040
So you can list, let's
say the last five messages

718
00:31:08,040 --> 00:31:09,630
from that particular session,

719
00:31:09,630 --> 00:31:13,890
plus perhaps the summary of that session

720
00:31:13,890 --> 00:31:15,720
to compress the context

721
00:31:15,720 --> 00:31:18,060
so that we do not have to deal

722
00:31:18,060 --> 00:31:19,860
with the entire conversation window,

723
00:31:20,730 --> 00:31:23,370
sorry, the entire context window

724
00:31:23,370 --> 00:31:27,430
so we can make our agent more, more...

725
00:31:29,040 --> 00:31:30,750
- Aware.
- Yes. (chuckles)

726
00:31:30,750 --> 00:31:31,583
- Speaking to.

727
00:31:33,005 --> 00:31:34,950
= [Akarsha] Alright, so how do we do that?

728
00:31:34,950 --> 00:31:39,900
So with Strands, first of all,
we create a memory manager,

729
00:31:39,900 --> 00:31:43,143
which provides us with
the control plane API,

730
00:31:44,070 --> 00:31:47,130
where we can call get or create memory

731
00:31:47,130 --> 00:31:50,880
and we provide in a name of the memory

732
00:31:50,880 --> 00:31:53,460
and the strategy that we wanna create.

733
00:31:53,460 --> 00:31:56,190
So these strategies, we don't
always have to provide one,

734
00:31:56,190 --> 00:31:58,270
but we can provide

735
00:31:59,130 --> 00:32:03,540
no or more strategies
that we can add in here.

736
00:32:03,540 --> 00:32:05,220
So it takes in a list of a dictionary,

737
00:32:05,220 --> 00:32:07,050
which takes in what type,

738
00:32:07,050 --> 00:32:09,300
what strategy type do you wanna define,

739
00:32:09,300 --> 00:32:11,000
what namespace do you wanna have?

740
00:32:11,000 --> 00:32:12,660
So namespace in this case

741
00:32:12,660 --> 00:32:15,540
is gonna take in a pot like structure,

742
00:32:15,540 --> 00:32:17,490
which allows you to create that separation

743
00:32:17,490 --> 00:32:19,050
of concern in the long term.

744
00:32:19,050 --> 00:32:20,910
So in short term, we did that by actor ID

745
00:32:20,910 --> 00:32:22,050
and session ID,

746
00:32:22,050 --> 00:32:25,830
in long term, we are gonna
do that by name spaces.

747
00:32:25,830 --> 00:32:29,490
So here, based on, you know, how do you,

748
00:32:29,490 --> 00:32:34,440
how granular or how global do
you want your memories to be?

749
00:32:34,440 --> 00:32:39,440
You can define a longer
path with more variables.

750
00:32:39,690 --> 00:32:43,470
So you can add one, yeah, you can add zero

751
00:32:43,470 --> 00:32:44,580
or more of these variables.

752
00:32:44,580 --> 00:32:47,970
So you can add actor ID,
you can add a strategy ID

753
00:32:47,970 --> 00:32:50,670
or you can add a session ID as well.

754
00:32:50,670 --> 00:32:53,880
So based on that, it'll create a path

755
00:32:53,880 --> 00:32:56,550
for you which you can then retrieve from.

756
00:32:56,550 --> 00:32:58,117
- [Dani] So basically
instead of just having

757
00:32:58,117 --> 00:33:01,350
a very big vector database

758
00:33:01,350 --> 00:33:03,390
where you just throw in the new memories

759
00:33:03,390 --> 00:33:05,520
that are being generated automatically,

760
00:33:05,520 --> 00:33:09,630
you're able to create your own separation.

761
00:33:09,630 --> 00:33:10,860
You know, you create your own structure

762
00:33:10,860 --> 00:33:12,180
and how you're saving those memories

763
00:33:12,180 --> 00:33:14,190
so that when you have to go
and retrieve those memories,

764
00:33:14,190 --> 00:33:16,634
you have it in a logical way.

765
00:33:16,634 --> 00:33:18,600
- [Akarsha] Yeah, and then you can define

766
00:33:18,600 --> 00:33:20,250
also an event expiry day,

767
00:33:20,250 --> 00:33:21,720
which defines how long

768
00:33:21,720 --> 00:33:24,450
do you want the short-term memory to stay?

769
00:33:24,450 --> 00:33:29,400
And that's, so in this
case it can be anything

770
00:33:29,400 --> 00:33:31,720
between seven days to 365 days

771
00:33:32,610 --> 00:33:35,790
and then you call that
API that returns you back

772
00:33:35,790 --> 00:33:37,440
with a memory ID, right?

773
00:33:37,440 --> 00:33:39,810
So this memory ID now
you can store somewhere

774
00:33:39,810 --> 00:33:42,850
and kind of use it to
every time you wanna store

775
00:33:44,040 --> 00:33:47,313
the memory information for your users.

776
00:33:48,180 --> 00:33:50,310
So it takes on about one to two minutes.

777
00:33:50,310 --> 00:33:52,401
- [Dani] Yeah, imagine
you'll have your agent

778
00:33:52,401 --> 00:33:53,859
and you will have your, you know,

779
00:33:53,859 --> 00:33:54,692
you have your agent

780
00:33:54,692 --> 00:33:56,220
and you have your memory resource.

781
00:33:56,220 --> 00:33:59,670
That agent will have to write
those events to those memory,

782
00:33:59,670 --> 00:34:01,097
to that memory resource, right?

783
00:34:01,097 --> 00:34:03,330
So you have that memory
id, you have your actor ID

784
00:34:03,330 --> 00:34:04,163
and you have your session ID

785
00:34:04,163 --> 00:34:06,120
and you just have to send information

786
00:34:06,120 --> 00:34:08,610
over to AgentCore Memory.

787
00:34:08,610 --> 00:34:09,510
- Exactly.
- And,

788
00:34:10,440 --> 00:34:11,483
I won't say anything else.

789
00:34:12,690 --> 00:34:16,268
- Okay. (chuckles) You should, you should.

790
00:34:16,268 --> 00:34:17,443
(Dani chuckling)

791
00:34:17,443 --> 00:34:21,450
All right, so how do we add
that to the agent, right?

792
00:34:21,450 --> 00:34:23,670
So we have created a memory resource.

793
00:34:23,670 --> 00:34:25,070
Now how do we write to that?

794
00:34:26,250 --> 00:34:29,400
So first approach was a tool
approach that we saw for RAG.

795
00:34:29,400 --> 00:34:30,407
The second approach

796
00:34:30,407 --> 00:34:32,940
that I was talking about was hooks, right?

797
00:34:32,940 --> 00:34:35,770
Here we are taking control

798
00:34:36,990 --> 00:34:38,970
of different parts of the agent lifecycle.

799
00:34:38,970 --> 00:34:43,020
So how it does is it enables us to write

800
00:34:43,020 --> 00:34:46,050
or to take an action at different points

801
00:34:46,050 --> 00:34:47,430
off the agent lifecycle.

802
00:34:47,430 --> 00:34:49,770
Meaning I can define that

803
00:34:49,770 --> 00:34:52,443
whenever the agent is
initialized, for example,

804
00:34:54,480 --> 00:34:56,430
run a certain action, right?

805
00:34:56,430 --> 00:34:59,430
So that will, I can hook something

806
00:34:59,430 --> 00:35:01,050
in that part of the agent lifecycle.

807
00:35:01,050 --> 00:35:03,030
So I can say every time
the agent is initialized,

808
00:35:03,030 --> 00:35:06,180
call the agent initialized event, right?

809
00:35:06,180 --> 00:35:09,540
Similarly, whenever the
user sends a request,

810
00:35:09,540 --> 00:35:11,580
call the message at an event.

811
00:35:11,580 --> 00:35:14,760
So this is then another
hook that you can add.

812
00:35:14,760 --> 00:35:17,760
So we are gonna use this
capability, which, you know,

813
00:35:17,760 --> 00:35:20,400
you can hook at different points in time.

814
00:35:20,400 --> 00:35:22,170
So when the tool is being called

815
00:35:22,170 --> 00:35:25,070
or when the request ends, so
when the agent responds back.

816
00:35:26,190 --> 00:35:28,890
So we are gonna use two of these hooks

817
00:35:28,890 --> 00:35:30,870
to create and to add our memory

818
00:35:30,870 --> 00:35:32,470
and to retrieve from our memory.

819
00:35:34,140 --> 00:35:35,510
So how does it look like?

820
00:35:35,510 --> 00:35:37,620
So what we do here is first of all,

821
00:35:37,620 --> 00:35:40,770
whenever the agent is being initialized,

822
00:35:40,770 --> 00:35:42,480
we are asking our agent

823
00:35:42,480 --> 00:35:45,873
to retrieve the user preferences
from the long-term memory.

824
00:35:47,460 --> 00:35:49,290
So every time the agent is initialized,

825
00:35:49,290 --> 00:35:52,680
we essentially load a profile of the user

826
00:35:52,680 --> 00:35:56,130
to know what their preferences are, right?

827
00:35:56,130 --> 00:35:58,800
And then every time a
new message is added,

828
00:35:58,800 --> 00:36:02,520
we are storing the
message that the user sent

829
00:36:02,520 --> 00:36:05,290
and also the messages
that the agent has sent

830
00:36:06,300 --> 00:36:08,160
to our short-term memory.

831
00:36:08,160 --> 00:36:09,810
Now behind the scenes
it should automatically

832
00:36:09,810 --> 00:36:11,070
propagate to long-term memory.

833
00:36:11,070 --> 00:36:12,900
So you don't have to do anything there,

834
00:36:12,900 --> 00:36:14,580
but that's how we'll do.

835
00:36:14,580 --> 00:36:17,130
And the second aspect was
we already created a tool

836
00:36:17,130 --> 00:36:20,640
for the session data retrieval,
which was a RAG aspect.

837
00:36:20,640 --> 00:36:21,990
So that's what we are doing

838
00:36:23,478 --> 00:36:27,030
for retrieving the event
information from knowledge base.

839
00:36:27,030 --> 00:36:28,263
So now let's see that.

840
00:36:30,000 --> 00:36:33,750
So here we are creating a class
called memory hook provider,

841
00:36:33,750 --> 00:36:35,610
which inherits from
the hook provider class

842
00:36:35,610 --> 00:36:38,490
provided by Strands Agents.

843
00:36:38,490 --> 00:36:41,850
So here what we do is we're
defining mainly two functions.

844
00:36:41,850 --> 00:36:43,590
One is on agent initialized.

845
00:36:43,590 --> 00:36:44,940
So here I say that

846
00:36:44,940 --> 00:36:46,770
whenever the agent is initialized,

847
00:36:46,770 --> 00:36:51,060
search the long-term
memories from this namespace.

848
00:36:51,060 --> 00:36:52,710
So this was a namespace that I defined

849
00:36:52,710 --> 00:36:54,033
when I created the memory.

850
00:36:55,140 --> 00:36:56,730
and with this query,

851
00:36:56,730 --> 00:36:59,250
so this way it can find
similar information.

852
00:36:59,250 --> 00:37:01,860
So I already like hard code that hey,

853
00:37:01,860 --> 00:37:03,900
give me the user preferences,
interests and background

854
00:37:03,900 --> 00:37:08,370
so that I can personalize
my agent based on that.

855
00:37:08,370 --> 00:37:11,940
So give me five of those preferences.

856
00:37:11,940 --> 00:37:15,030
And those preferences I will then load

857
00:37:15,030 --> 00:37:18,780
and append into the messages.

858
00:37:18,780 --> 00:37:21,210
And this way now my agent knows

859
00:37:21,210 --> 00:37:25,053
or has some context about what
does the user prefer, right?

860
00:37:26,022 --> 00:37:27,960
And the second event that I'm gonna add

861
00:37:27,960 --> 00:37:29,460
is on the message added event.

862
00:37:29,460 --> 00:37:31,350
So every time a new message is added,

863
00:37:31,350 --> 00:37:32,183
be it tool message,

864
00:37:32,183 --> 00:37:33,240
be it user message,

865
00:37:33,240 --> 00:37:34,680
be it agent message,

866
00:37:34,680 --> 00:37:38,190
anytime a new message
is added to the state,

867
00:37:38,190 --> 00:37:40,150
it is gonna load the last message

868
00:37:41,280 --> 00:37:45,330
and it's gonna add that message,

869
00:37:45,330 --> 00:37:46,750
it's gonna add that message

870
00:37:50,329 --> 00:37:51,162
into the memory session manager.

871
00:37:51,162 --> 00:37:52,960
So it's gonna send it to AgentCore Memory

872
00:37:54,030 --> 00:37:55,530
as a conversational message.

873
00:37:55,530 --> 00:37:57,480
So it's gonna take in a message content,

874
00:37:57,480 --> 00:37:59,970
which is gonna be the string, the question

875
00:37:59,970 --> 00:38:03,240
or the content that the user provides.

876
00:38:03,240 --> 00:38:05,793
And along with the message role.

877
00:38:07,290 --> 00:38:10,740
So that's what we are
sending to short-term memory

878
00:38:10,740 --> 00:38:12,590
for it to be processed for long term.

879
00:38:14,191 --> 00:38:15,024
- [Audience Member] How does it parse

880
00:38:15,024 --> 00:38:17,495
or differentiate the user preferences

881
00:38:17,495 --> 00:38:21,030
versus the conversation (faintly speaks).

882
00:38:21,030 --> 00:38:23,280
- [Akarsha] So this you have
to define, so for example,

883
00:38:23,280 --> 00:38:26,940
here what we are doing is in this case,

884
00:38:26,940 --> 00:38:30,120
we are adding it into
the system prompt, right?

885
00:38:30,120 --> 00:38:31,460
The user preferences we are adding

886
00:38:31,460 --> 00:38:32,850
in the system prompt.

887
00:38:32,850 --> 00:38:34,850
You can add it as a new message as well.

888
00:38:35,910 --> 00:38:39,300
And there you can write like literally

889
00:38:39,300 --> 00:38:40,380
in a string message,

890
00:38:40,380 --> 00:38:42,870
you can say these are my user preferences.

891
00:38:42,870 --> 00:38:44,910
So it cannot literally separate between,

892
00:38:44,910 --> 00:38:47,670
oh this is memory or
this is a user message.

893
00:38:47,670 --> 00:38:49,650
But you have to define that,

894
00:38:49,650 --> 00:38:53,086
on how you want to send it to the agent.

895
00:38:53,086 --> 00:38:53,919
- [Dani] A nice thing about this

896
00:38:53,919 --> 00:38:55,868
is that we give you the tools

897
00:38:55,868 --> 00:38:58,200
and we give you the flexibility
on using those tools

898
00:38:58,200 --> 00:39:00,184
for your use case, right?
- Yeah.

899
00:39:00,184 --> 00:39:02,430
Every, I'm pretty sure everyone,

900
00:39:02,430 --> 00:39:04,470
everyone here has a different use case

901
00:39:04,470 --> 00:39:06,423
and they're gonna be able
to interact with memory

902
00:39:06,423 --> 00:39:07,680
in a different way

903
00:39:07,680 --> 00:39:10,044
than the person that's
sitting next to you, right?

904
00:39:10,044 --> 00:39:12,615
- [Audience Member] There's
a lot of sensitive data.

905
00:39:12,615 --> 00:39:14,238
- Yeah.
- Customer data,

906
00:39:14,238 --> 00:39:18,821
talk privacy section (faintly speaks).

907
00:39:21,947 --> 00:39:24,090
- [Dani] So are you worried
that some people have access

908
00:39:24,090 --> 00:39:25,470
to other people's information?

909
00:39:25,470 --> 00:39:26,703
- Yeah.
- We'll get to that.

910
00:39:26,703 --> 00:39:28,277
We'll get to that, yeah.

911
00:39:28,277 --> 00:39:29,820
- [Audience Member]
(faintly speaks) Preferences

912
00:39:29,820 --> 00:39:30,780
in their sessions.

913
00:39:30,780 --> 00:39:32,040
- [Dani] So right now,

914
00:39:32,040 --> 00:39:33,570
when you're sending messages

915
00:39:33,570 --> 00:39:36,330
to the short-term memory,

916
00:39:36,330 --> 00:39:38,640
you're defining an actor ID

917
00:39:38,640 --> 00:39:40,860
and a session ID, right?

918
00:39:40,860 --> 00:39:44,760
So with that actor id, you can
actually define who is that,

919
00:39:44,760 --> 00:39:47,640
who does that event belong to, right?

920
00:39:47,640 --> 00:39:50,910
So you have that logical
separation in that way.

921
00:39:50,910 --> 00:39:52,800
And also you have IAM policies

922
00:39:52,800 --> 00:39:56,190
that you can apply which
contain conditions.

923
00:39:56,190 --> 00:40:00,300
So then you can give, you
know, permissions to an agent

924
00:40:00,300 --> 00:40:03,060
to only access a memory resource

925
00:40:03,060 --> 00:40:06,960
if the actor ID is corresponding
to whatever you say, right?

926
00:40:06,960 --> 00:40:09,810
So you have multiple ways of securities,

927
00:40:09,810 --> 00:40:11,343
but I'll cover it later.

928
00:40:15,263 --> 00:40:18,420
- [Akarsha] Alright, so now
we have created the hooks

929
00:40:18,420 --> 00:40:20,430
and now the only thing we have to do

930
00:40:20,430 --> 00:40:22,470
is to register those hooks
with the hook registry

931
00:40:22,470 --> 00:40:25,290
so that the agent knows
that these are the callbacks

932
00:40:25,290 --> 00:40:29,430
that I have to do every
time an agent is initialized

933
00:40:29,430 --> 00:40:31,170
or a message is added, right?

934
00:40:31,170 --> 00:40:35,130
So you add that into the hook registry.

935
00:40:35,130 --> 00:40:36,120
So now that is done.

936
00:40:36,120 --> 00:40:40,950
So we have now a way to
call our memory, right?

937
00:40:40,950 --> 00:40:42,630
And we've also already defined a way

938
00:40:42,630 --> 00:40:44,493
to call our knowledge base.

939
00:40:45,390 --> 00:40:46,980
So now we are gonna initialize the class

940
00:40:46,980 --> 00:40:48,450
for the hook provider

941
00:40:48,450 --> 00:40:50,910
and you're gonna add that to the agent.

942
00:40:50,910 --> 00:40:54,280
So we have defined the memory hooks

943
00:40:55,410 --> 00:40:57,150
and we are gonna add that to the agent

944
00:40:57,150 --> 00:40:59,670
along with the tool that we created

945
00:40:59,670 --> 00:41:01,470
for searching the re:Invent sessions

946
00:41:01,470 --> 00:41:04,860
for the knowledge base, right?

947
00:41:04,860 --> 00:41:07,530
And on top of that, we provide a state.

948
00:41:07,530 --> 00:41:10,620
So this is where we are giving it

949
00:41:10,620 --> 00:41:12,150
in a more deterministic way.

950
00:41:12,150 --> 00:41:15,090
We are giving it the actor
ID and the session ID.

951
00:41:15,090 --> 00:41:17,940
So this ideally should
come from the application.

952
00:41:17,940 --> 00:41:20,250
Once the user has been authenticated,

953
00:41:20,250 --> 00:41:24,930
you get the user information
from that session

954
00:41:24,930 --> 00:41:27,990
and provide the actor ID based on that.

955
00:41:27,990 --> 00:41:30,690
And similarly create a new session ID

956
00:41:30,690 --> 00:41:33,993
or get it from whichever
environment it's running in,

957
00:41:35,100 --> 00:41:37,110
but that you pass in as a state.

958
00:41:37,110 --> 00:41:38,850
So to make it more deterministic

959
00:41:38,850 --> 00:41:41,850
and to make sure that
it's the same information

960
00:41:41,850 --> 00:41:44,550
that is propagated within the agent.

961
00:41:44,550 --> 00:41:45,960
- [Dani] Yeah, you
basically don't want to say

962
00:41:45,960 --> 00:41:47,490
date to agent, hey,

963
00:41:47,490 --> 00:41:49,830
this is the user, blah blah blah,

964
00:41:49,830 --> 00:41:51,000
this is just certain blah blah blah.

965
00:41:51,000 --> 00:41:53,700
Because it'll probably
hallucinate and evoke away, right?

966
00:41:53,700 --> 00:41:56,670
You wanna pass that as part
of the application code.

967
00:41:56,670 --> 00:41:58,500
- [Akarsha] Exactly.

968
00:41:58,500 --> 00:42:01,713
Alright, so now we have the agent ready,

969
00:42:02,640 --> 00:42:04,680
now we can test it, right?

970
00:42:04,680 --> 00:42:07,980
So first thing we do is to
give it some information

971
00:42:07,980 --> 00:42:10,530
because right now we
haven't talked to the agent,

972
00:42:10,530 --> 00:42:12,780
so it doesn't know anything about me.

973
00:42:12,780 --> 00:42:14,370
So I give some,

974
00:42:14,370 --> 00:42:16,950
I see it in some information about myself,

975
00:42:16,950 --> 00:42:17,880
saying my name is Alice,

976
00:42:17,880 --> 00:42:20,850
I'm a software engineer at TechCorp.

977
00:42:20,850 --> 00:42:24,090
And this ideally should be

978
00:42:24,090 --> 00:42:27,660
loaded in a more gradual way.

979
00:42:27,660 --> 00:42:29,580
So when you are actually
building an application,

980
00:42:29,580 --> 00:42:32,580
this will be built over time, right?

981
00:42:32,580 --> 00:42:34,290
But in this case, for demo purposes,

982
00:42:34,290 --> 00:42:38,070
we are kind of loading
in information at once.

983
00:42:38,070 --> 00:42:40,950
So now we send that event,

984
00:42:40,950 --> 00:42:43,530
we call the agent with this information

985
00:42:43,530 --> 00:42:44,910
and the agent responds us back with,

986
00:42:44,910 --> 00:42:47,790
okay, you know, thank
nice to meet you Alice,

987
00:42:47,790 --> 00:42:50,550
thank you for telling me about yourself.

988
00:42:50,550 --> 00:42:53,940
And then behind the
scenes using the hooks,

989
00:42:53,940 --> 00:42:55,170
it should be able to store

990
00:42:55,170 --> 00:42:58,290
that information in the short-term memory.

991
00:42:58,290 --> 00:43:01,350
And then roundabout 30 seconds later,

992
00:43:01,350 --> 00:43:06,350
it should also be available in
the long-term memory, right?

993
00:43:06,900 --> 00:43:07,733
So the next time

994
00:43:07,733 --> 00:43:10,680
we are calling the
long-term memory records,

995
00:43:10,680 --> 00:43:13,800
we should be able to see
what we have already fed in.

996
00:43:13,800 --> 00:43:15,520
So if we list

997
00:43:16,716 --> 00:43:21,000
now the long-term memory records
from that certain prefix,

998
00:43:21,000 --> 00:43:24,120
it should be able to retrieve
certain our preferences

999
00:43:24,120 --> 00:43:25,950
that we just sent in.

1000
00:43:25,950 --> 00:43:28,440
So now the interesting thing to note here

1001
00:43:28,440 --> 00:43:31,830
is it not just stores the preference,

1002
00:43:31,830 --> 00:43:34,020
but it also stores the context

1003
00:43:34,020 --> 00:43:36,420
how it extracted that preference.

1004
00:43:36,420 --> 00:43:39,750
So it says the context is that
the user explicitly stated

1005
00:43:39,750 --> 00:43:42,300
that they work as a software
engineer at Tech Corp.

1006
00:43:42,300 --> 00:43:45,780
And that's why I extracted
the preference that

1007
00:43:45,780 --> 00:43:47,430
they work as a software engineer.

1008
00:43:49,650 --> 00:43:53,700
So it kind of defines a more explicit,

1009
00:43:53,700 --> 00:43:55,800
defines more proper reason

1010
00:43:55,800 --> 00:43:59,040
of why this preference has been extracted.

1011
00:43:59,040 --> 00:44:04,040
And based on that it also
creates a preference.

1012
00:44:04,860 --> 00:44:08,043
And now you can use this
information across sessions.

1013
00:44:09,510 --> 00:44:13,293
So if you create a new
agent with a new session ID,

1014
00:44:14,670 --> 00:44:16,680
- Same actor
- With the same actor,

1015
00:44:16,680 --> 00:44:18,360
but different session ID,

1016
00:44:18,360 --> 00:44:23,100
you are able to retrieve
the same information

1017
00:44:23,100 --> 00:44:24,210
about the actor

1018
00:44:24,210 --> 00:44:27,543
and you're able to use
it within the question.

1019
00:44:29,183 --> 00:44:31,267
So I asked this question saying,

1020
00:44:31,267 --> 00:44:34,290
"Hey, which sessions should I
attend at re:Invent," right?

1021
00:44:34,290 --> 00:44:35,340
And I already mentioned

1022
00:44:35,340 --> 00:44:38,040
that I'm interested in AI and security,

1023
00:44:38,040 --> 00:44:40,743
so it responds me back with,

1024
00:44:42,990 --> 00:44:45,030
based on it, "I'm happy to help you

1025
00:44:45,030 --> 00:44:47,130
with the perfect re:Invent session.

1026
00:44:47,130 --> 00:44:48,330
And based on your profile,

1027
00:44:48,330 --> 00:44:49,230
I can see you're interested

1028
00:44:49,230 --> 00:44:51,330
in cloud architecture, AI, and security,

1029
00:44:51,330 --> 00:44:53,880
and that you prefer
hands-on technical sessions.

1030
00:44:53,880 --> 00:44:56,280
So let me give you some sessions," right?

1031
00:44:56,280 --> 00:44:58,020
So based on that it gives me,

1032
00:44:58,020 --> 00:45:00,360
it searches the re:Invent sessions

1033
00:45:00,360 --> 00:45:03,630
and gives me that based on your interest.

1034
00:45:03,630 --> 00:45:05,700
These are the top
recommendations that I'll say.

1035
00:45:05,700 --> 00:45:09,250
So it gives me some GenAI,
some cloud operations

1036
00:45:10,371 --> 00:45:13,443
and some security recommendations, right?

1037
00:45:14,970 --> 00:45:18,030
So it makes it more personalized for me

1038
00:45:18,030 --> 00:45:19,140
of what I'm interested in,

1039
00:45:19,140 --> 00:45:23,043
what's my profile and
based on that it response.

1040
00:45:24,210 --> 00:45:27,300
So now we know that our memory is working,

1041
00:45:27,300 --> 00:45:29,400
let's move to runtime, right?

1042
00:45:29,400 --> 00:45:33,310
So what, I mean we now
have the agent running

1043
00:45:35,186 --> 00:45:36,900
in our local environment,

1044
00:45:36,900 --> 00:45:39,720
how do we move this to production?

1045
00:45:39,720 --> 00:45:40,890
So we need something

1046
00:45:40,890 --> 00:45:44,440
that is giving us a
session level isolation

1047
00:45:45,300 --> 00:45:46,920
because as you said, we are dealing

1048
00:45:46,920 --> 00:45:48,210
with user data here, right?

1049
00:45:48,210 --> 00:45:50,850
So we have to be highly vigilant

1050
00:45:50,850 --> 00:45:53,700
on how we are deploying this.

1051
00:45:53,700 --> 00:45:55,950
So the session not just has to be isolated

1052
00:45:55,950 --> 00:45:57,030
on the compute level,

1053
00:45:57,030 --> 00:46:01,830
but on the memory and the storage level.

1054
00:46:01,830 --> 00:46:03,540
So this provides us,

1055
00:46:03,540 --> 00:46:04,830
AgentCore runtime provides us

1056
00:46:04,830 --> 00:46:07,200
with true session isolation,

1057
00:46:07,200 --> 00:46:12,200
so with the compute memory and storage.

1058
00:46:12,990 --> 00:46:16,290
And it provides us with a fully

1059
00:46:16,290 --> 00:46:18,423
enterprise ready production workload,

1060
00:46:19,740 --> 00:46:21,780
workload ready system.

1061
00:46:21,780 --> 00:46:25,050
And it is automatically scalable.

1062
00:46:25,050 --> 00:46:29,460
So it's a serverless setup
which allows us to run hundreds

1063
00:46:29,460 --> 00:46:33,300
of sessions in a parallel manner.

1064
00:46:33,300 --> 00:46:36,300
So now how do we add this
to the solution, right?

1065
00:46:36,300 --> 00:46:38,880
So we had the endpoint that we created.

1066
00:46:38,880 --> 00:46:40,350
So everything else remains the same.

1067
00:46:40,350 --> 00:46:43,980
We are gonna deploy this to
AgentCore runtime, right?

1068
00:46:43,980 --> 00:46:46,860
So this is gonna be our way

1069
00:46:46,860 --> 00:46:51,000
to run this in production.

1070
00:46:51,000 --> 00:46:52,113
So how does that work?

1071
00:46:53,430 --> 00:46:54,600
So first of all,

1072
00:46:54,600 --> 00:46:56,010
what we have created right now

1073
00:46:56,010 --> 00:46:59,490
is we have an agent with
any model, any framework.

1074
00:46:59,490 --> 00:47:03,090
So we chose our bets.

1075
00:47:03,090 --> 00:47:05,550
But you can bring in
any model, any framework

1076
00:47:05,550 --> 00:47:07,410
of your preference.

1077
00:47:07,410 --> 00:47:12,180
And then what we are gonna
do is to create two endpoints

1078
00:47:12,180 --> 00:47:14,460
for Ping and for invocations.

1079
00:47:14,460 --> 00:47:16,260
Ping, we use for health checks

1080
00:47:16,260 --> 00:47:18,930
and invocations, we would use to know

1081
00:47:18,930 --> 00:47:20,370
where the entry point is.

1082
00:47:20,370 --> 00:47:21,873
So how do I invoke.

1083
00:47:22,950 --> 00:47:25,770
And then we add a requirements
file which defines

1084
00:47:25,770 --> 00:47:28,470
what dependencies do we have to install.

1085
00:47:28,470 --> 00:47:32,460
Now that will be what defines our agent.

1086
00:47:32,460 --> 00:47:34,830
So the first thing we have
to do is to deploy that

1087
00:47:34,830 --> 00:47:39,270
or to push that in a more packaged way

1088
00:47:39,270 --> 00:47:41,463
to the ECR.

1089
00:47:42,480 --> 00:47:47,370
So ECR, once we have
pushed the code to ECR,

1090
00:47:47,370 --> 00:47:49,560
we will have our container image ready

1091
00:47:49,560 --> 00:47:51,630
and we will provide some
more configurations.

1092
00:47:51,630 --> 00:47:53,850
Like we will provide the protocol settings

1093
00:47:53,850 --> 00:47:56,160
like which protocol do I wanna use?

1094
00:47:56,160 --> 00:47:58,950
HTTP, A-A, MCP,

1095
00:47:58,950 --> 00:48:01,593
how do I want to configure that agent.

1096
00:48:02,520 --> 00:48:04,830
And we provide some network settings

1097
00:48:04,830 --> 00:48:07,830
and that's what completes
our configuration set up.

1098
00:48:07,830 --> 00:48:09,210
Now once we have that,

1099
00:48:09,210 --> 00:48:12,090
they're gonna deploy that
to agent for runtime.

1100
00:48:12,090 --> 00:48:15,240
and then we have our agent
ready for invocation.

1101
00:48:15,240 --> 00:48:17,430
So then we can, in a concurrent way,

1102
00:48:17,430 --> 00:48:19,180
we can invoke multiple sessions

1103
00:48:20,100 --> 00:48:21,733
from the application that we build.

1104
00:48:21,733 --> 00:48:24,300
- [Dani] And it's session is a micro VM

1105
00:48:24,300 --> 00:48:25,560
that spins up,

1106
00:48:25,560 --> 00:48:28,920
loads that agent code and you have a user

1107
00:48:28,920 --> 00:48:30,180
that's gonna be interacting with

1108
00:48:30,180 --> 00:48:33,570
that specific agent here, session ID.

1109
00:48:33,570 --> 00:48:36,240
And when that session finishes,

1110
00:48:36,240 --> 00:48:40,083
the micro VM gets shut down
and everything gets deleted.

1111
00:48:40,950 --> 00:48:41,880
So that's why we have

1112
00:48:41,880 --> 00:48:44,670
to persist the information somewhere else

1113
00:48:44,670 --> 00:48:47,610
because when the AgentCore
runtime session finishes,

1114
00:48:47,610 --> 00:48:50,103
the context that the agent has is gone.

1115
00:48:51,570 --> 00:48:56,280
- [Akarsha] Yeah. Alright,
so how do we prepare it

1116
00:48:56,280 --> 00:48:57,930
for AgentCore runtime?

1117
00:48:57,930 --> 00:49:00,840
How do we prepare the agent
that we created right now

1118
00:49:00,840 --> 00:49:03,210
to deploy it on agent core runtime?

1119
00:49:03,210 --> 00:49:06,510
So we literally have to add
four extra lines of code.

1120
00:49:06,510 --> 00:49:09,510
So accept the structuring of the code,

1121
00:49:09,510 --> 00:49:14,190
we have to add four lines to
make it ready for runtime.

1122
00:49:14,190 --> 00:49:15,060
So first thing we add

1123
00:49:15,060 --> 00:49:18,630
is importing the AgentCore
application, right?

1124
00:49:18,630 --> 00:49:21,153
And the second thing,
we initialize the app.

1125
00:49:22,620 --> 00:49:25,320
Now the rest of the code is more about,

1126
00:49:25,320 --> 00:49:26,430
it's the same things

1127
00:49:26,430 --> 00:49:29,130
that we already created in
the notebook previously.

1128
00:49:29,130 --> 00:49:30,630
So we created a hook provider,

1129
00:49:30,630 --> 00:49:35,130
we created a tool for searching
the re:Invent session.

1130
00:49:35,130 --> 00:49:37,770
We create an initialized agent,

1131
00:49:37,770 --> 00:49:41,160
which is doing the exact
same thing as we did above.

1132
00:49:41,160 --> 00:49:43,980
So it's importing the tools, hooks,

1133
00:49:43,980 --> 00:49:46,890
and adding the actor
ID, session ID, state.

1134
00:49:46,890 --> 00:49:49,230
So we just package it into a function

1135
00:49:49,230 --> 00:49:52,530
and then we create a entry point.

1136
00:49:52,530 --> 00:49:54,300
So this is the line number three

1137
00:49:54,300 --> 00:49:56,160
of the code that we have to add.

1138
00:49:56,160 --> 00:50:01,140
So we add, we create
this decorator to define

1139
00:50:01,140 --> 00:50:03,990
that this is gonna be the
entry point of the application.

1140
00:50:05,130 --> 00:50:07,470
And here we've taken a payload

1141
00:50:07,470 --> 00:50:09,840
of whatever the user passes in,

1142
00:50:09,840 --> 00:50:12,603
from the application from the front end.

1143
00:50:13,530 --> 00:50:16,440
So that takes it, that
let's say gets in a prompt

1144
00:50:16,440 --> 00:50:17,550
and the actual ID,

1145
00:50:17,550 --> 00:50:20,343
which is gonna be done
after authentication.

1146
00:50:21,990 --> 00:50:26,700
And then that is what goes
in initializes the agent.

1147
00:50:26,700 --> 00:50:31,410
Takes the user input and
gives a response, right?

1148
00:50:31,410 --> 00:50:35,520
And then finally you have
to run the application.

1149
00:50:35,520 --> 00:50:37,560
So this is line number four.

1150
00:50:37,560 --> 00:50:38,400
So that is it.

1151
00:50:38,400 --> 00:50:40,680
So this is what you have
to add to make it ready.

1152
00:50:40,680 --> 00:50:43,770
So essentially creating
something like a fast API server

1153
00:50:43,770 --> 00:50:46,863
that allows us to run this piece of code.

1154
00:50:47,820 --> 00:50:50,220
Then we create an execution role

1155
00:50:50,220 --> 00:50:54,240
and we are then we configure and launch.

1156
00:50:54,240 --> 00:50:57,870
So these are the two things
we have to do to get it ready

1157
00:50:57,870 --> 00:51:00,570
as an endpoint that is
ready for consumption,

1158
00:51:00,570 --> 00:51:04,230
essentially for different users.

1159
00:51:04,230 --> 00:51:08,580
So we have this AgentCore starter toolkit

1160
00:51:08,580 --> 00:51:13,140
provides us with some tools to do that.

1161
00:51:13,140 --> 00:51:14,640
So we have a .configure.

1162
00:51:14,640 --> 00:51:16,860
So first of all, we
configure the application

1163
00:51:16,860 --> 00:51:19,140
with an execution role.

1164
00:51:19,140 --> 00:51:20,940
We allow it to auto create the ECR,

1165
00:51:20,940 --> 00:51:23,010
provide a requirements file

1166
00:51:23,010 --> 00:51:27,400
and ask it to take in the agent

1167
00:51:28,470 --> 00:51:31,590
and basically configure based on that.

1168
00:51:31,590 --> 00:51:33,660
Now once it has configured it,

1169
00:51:33,660 --> 00:51:35,610
it creates a docker file for you.

1170
00:51:35,610 --> 00:51:37,230
If you want to customize that,

1171
00:51:37,230 --> 00:51:38,610
you can create your own docker file

1172
00:51:38,610 --> 00:51:41,550
or you can also provide your own endpoint

1173
00:51:41,550 --> 00:51:45,543
from a different registry essentially.

1174
00:51:46,740 --> 00:51:50,460
Then once you have that,
then you can call .launch,

1175
00:51:50,460 --> 00:51:53,350
which is gonna launch the application

1176
00:51:54,690 --> 00:51:58,890
and put it for you to warm start, right?

1177
00:51:58,890 --> 00:52:01,690
And here you can also provide
some environment variables

1178
00:52:02,550 --> 00:52:05,790
which takes in your memory ID,

1179
00:52:05,790 --> 00:52:08,190
knowledge base ID, model ID and region.

1180
00:52:08,190 --> 00:52:10,230
And now we have it up and running.

1181
00:52:10,230 --> 00:52:13,230
So this will take around
about a couple of minutes

1182
00:52:13,230 --> 00:52:15,540
for you to get started.

1183
00:52:15,540 --> 00:52:18,060
So now I think the only
thing missing here, Dani,

1184
00:52:18,060 --> 00:52:19,380
is the identity.

1185
00:52:19,380 --> 00:52:20,948
- Yeah.
- Do you wanna add?

1186
00:52:20,948 --> 00:52:23,674
- [Dani] So just show
the small location to see

1187
00:52:23,674 --> 00:52:24,507
how it looks like.

1188
00:52:24,507 --> 00:52:25,340
- Okay,
- Yeah.

1189
00:52:25,340 --> 00:52:26,310
- [Akarsha] Makes sense.

1190
00:52:26,310 --> 00:52:30,209
- [Dani] So basically we just
pass from our local notebook,

1191
00:52:30,209 --> 00:52:34,080
(indistinct) POC working,
we route our managers

1192
00:52:34,080 --> 00:52:36,150
and now we need to get this
into production, right?

1193
00:52:36,150 --> 00:52:38,460
So that's where we use AgentCore runtime.

1194
00:52:38,460 --> 00:52:39,660
We pass from a notebook

1195
00:52:39,660 --> 00:52:43,773
to actually having our agents
running at scale securely.

1196
00:52:45,480 --> 00:52:49,770
And you wanna show the how
the location looks like.

1197
00:52:49,770 --> 00:52:53,310
You can see there it's says
agentcore.runtime.invoke.

1198
00:52:53,310 --> 00:52:55,057
I'm passing in my prompt,

1199
00:52:55,057 --> 00:52:57,000
"what sessions would you recommend?"

1200
00:52:57,000 --> 00:52:59,040
And in this case, I'm
passing my actor ID, right?

1201
00:52:59,040 --> 00:53:01,500
This remember right now is hardcoded,

1202
00:53:01,500 --> 00:53:03,020
the goal is not to have this hardcoded,

1203
00:53:03,020 --> 00:53:04,110
it should actually know

1204
00:53:04,110 --> 00:53:07,050
who the actor is based on our login, okay?

1205
00:53:07,050 --> 00:53:10,117
So if you see there, will, yeah.

1206
00:53:10,117 --> 00:53:11,610
- [Akarsha] So we ask the same question,

1207
00:53:11,610 --> 00:53:12,780
what sessions would you recommend?

1208
00:53:12,780 --> 00:53:14,520
- [Dani] Exactly. And I already, or-

1209
00:53:14,520 --> 00:53:16,320
- [Akarsha] Personalized
recommendations to us.

1210
00:53:16,320 --> 00:53:17,610
- [Dani] Yeah, okay.

1211
00:53:17,610 --> 00:53:20,310
So that's basically our agent running

1212
00:53:20,310 --> 00:53:23,310
in AgentCore runtime.

1213
00:53:23,310 --> 00:53:28,310
Last bit of the architecture
is identity, right?

1214
00:53:28,560 --> 00:53:31,620
So here's where we use AgentCore identity,

1215
00:53:31,620 --> 00:53:32,920
how is this gonna help us?

1216
00:53:33,960 --> 00:53:36,780
But initially we're gonna have our user,

1217
00:53:36,780 --> 00:53:39,600
which interacts with
our application, right?

1218
00:53:39,600 --> 00:53:42,600
First step, our user logs into application

1219
00:53:42,600 --> 00:53:45,180
using our IDP of choice, right?

1220
00:53:45,180 --> 00:53:48,390
We support multiple IDPs, right?

1221
00:53:48,390 --> 00:53:52,830
Our user logs in, gets back
an IP token from that IDP

1222
00:53:52,830 --> 00:53:56,730
and then I can go and invoke
AgentCore runtime, right?

1223
00:53:56,730 --> 00:53:58,980
So to that call that Akarsha had before,

1224
00:53:58,980 --> 00:54:00,993
I will have a new variable

1225
00:54:00,993 --> 00:54:03,090
that will say they were token, right?

1226
00:54:03,090 --> 00:54:05,220
And there I will include their IDP token

1227
00:54:05,220 --> 00:54:07,110
that I got back from my IDP.

1228
00:54:07,110 --> 00:54:12,110
Now, thanks to AgentCore
identity inbound authentication.

1229
00:54:13,200 --> 00:54:15,360
So basically it determines who the user is

1230
00:54:15,360 --> 00:54:17,970
and if it's allowed to call the agent

1231
00:54:17,970 --> 00:54:21,180
every time we call AgentCore runtime,

1232
00:54:21,180 --> 00:54:23,520
before it's actually just invocation,

1233
00:54:23,520 --> 00:54:27,480
it will go call AgentCore identity.

1234
00:54:27,480 --> 00:54:30,030
Identity will go back to the IDP

1235
00:54:30,030 --> 00:54:32,820
and validate that IDP token, okay?

1236
00:54:32,820 --> 00:54:34,327
And if that's valid it will say,

1237
00:54:34,327 --> 00:54:38,760
"Hey, you're allowed to go
ahead and do that invocation."

1238
00:54:38,760 --> 00:54:42,480
Okay, pretty simple steps here.

1239
00:54:42,480 --> 00:54:46,590
So how does that change at the code level?

1240
00:54:46,590 --> 00:54:50,010
When we are doing in the
AgentCore runtime configuration,

1241
00:54:50,010 --> 00:54:51,690
we are gonna add two different things.

1242
00:54:51,690 --> 00:54:54,270
One is the authorized configuration.

1243
00:54:54,270 --> 00:54:56,700
That's where we are
configuring our JWT authorizer.

1244
00:54:56,700 --> 00:54:58,470
In this case I'm using Cognito.

1245
00:54:58,470 --> 00:55:01,200
So I'm passing in my discovery URL

1246
00:55:01,200 --> 00:55:03,300
and my allowed clients, right?

1247
00:55:03,300 --> 00:55:05,670
And also very important bit here

1248
00:55:05,670 --> 00:55:08,580
is my request header allow list.

1249
00:55:08,580 --> 00:55:09,960
And what I'm doing here

1250
00:55:09,960 --> 00:55:14,960
is that I'm allowing
AgentCore runtime to propagate

1251
00:55:15,300 --> 00:55:19,800
to the AgentCore, the
authorization token, right?

1252
00:55:19,800 --> 00:55:24,143
So what's gonna happen
next inside the agent,

1253
00:55:25,770 --> 00:55:28,203
if I show this here,

1254
00:55:29,160 --> 00:55:34,160
is that when my user locks it, huh?

1255
00:55:34,470 --> 00:55:36,180
- It's here.
- Okay.

1256
00:55:36,180 --> 00:55:39,570
When my user log into the application,

1257
00:55:39,570 --> 00:55:40,800
it will retrieve

1258
00:55:40,800 --> 00:55:44,657
that identity token from Cognito.

1259
00:55:44,657 --> 00:55:46,650
It will do the agent invocation passing in

1260
00:55:46,650 --> 00:55:48,780
that Cognito identity token

1261
00:55:48,780 --> 00:55:52,500
and from inside the
agent I'm calling Cognito

1262
00:55:52,500 --> 00:55:57,000
with that token to retrieve
the user information, right?

1263
00:55:57,000 --> 00:55:58,790
And that's what the
Akarsha is showing there.

1264
00:55:58,790 --> 00:56:01,110
- So the same code that I showed before,

1265
00:56:01,110 --> 00:56:03,180
it's exact same functionality.

1266
00:56:03,180 --> 00:56:04,260
The only thing that different

1267
00:56:04,260 --> 00:56:08,340
is instead of passing
the actual ID directly,

1268
00:56:08,340 --> 00:56:10,770
we are getting the user identity

1269
00:56:10,770 --> 00:56:13,440
from the authorization header.

1270
00:56:13,440 --> 00:56:16,120
So this is what is being propagated

1271
00:56:17,471 --> 00:56:19,650
from the AgentCore runtime.

1272
00:56:19,650 --> 00:56:24,630
And this is being authorized
from AgentCore identity

1273
00:56:24,630 --> 00:56:26,220
by Cognito.

1274
00:56:26,220 --> 00:56:27,053
- [Dani] Exactly.

1275
00:56:27,053 --> 00:56:30,333
So no more hard coding
either sessions or actor ID.

1276
00:56:30,333 --> 00:56:32,733
That ID is coming straight
from the identity token

1277
00:56:32,733 --> 00:56:34,140
from Cognito,

1278
00:56:34,140 --> 00:56:36,780
session ID, we're using the same session

1279
00:56:36,780 --> 00:56:39,330
that AgentCore runtime is running, right?

1280
00:56:39,330 --> 00:56:41,340
So as you remember before
it works with sessions.

1281
00:56:41,340 --> 00:56:43,650
Each session is a micro VM that's one up,

1282
00:56:43,650 --> 00:56:48,650
loads the (indistinct) code
and runs that session has an ID

1283
00:56:49,170 --> 00:56:51,420
and that's what we are using as an ID

1284
00:56:51,420 --> 00:56:55,377
for our session inside
AgentCore memory, right?

1285
00:56:55,377 --> 00:56:56,970
And I think...

1286
00:56:56,970 --> 00:56:58,440
- That is it,
- Four minutes left.

1287
00:56:58,440 --> 00:57:00,840
That's it, and... (chuckles)

1288
00:57:00,840 --> 00:57:02,310
- [Akarsha] Exactly what Dani showed,

1289
00:57:02,310 --> 00:57:03,750
- Yeah.
- on the screen,

1290
00:57:03,750 --> 00:57:05,220
so when we are configuring it,

1291
00:57:05,220 --> 00:57:09,960
we added these two
configuration for JWT authorizer

1292
00:57:09,960 --> 00:57:12,330
and the header configurations.

1293
00:57:12,330 --> 00:57:15,780
So we have them here
that allows it to know

1294
00:57:15,780 --> 00:57:18,990
what is the discovery URL
from where to authorize from

1295
00:57:18,990 --> 00:57:20,910
and what would be the client ID.

1296
00:57:20,910 --> 00:57:23,973
So what would be the
allowed clients for me.

1297
00:57:25,650 --> 00:57:26,493
And that is it.

1298
00:57:27,660 --> 00:57:30,264
Keeps it track.
- So lemme just go back to my,

1299
00:57:30,264 --> 00:57:31,170
- [Akarsha] We have five
minutes to take this.

1300
00:57:31,170 --> 00:57:34,233
- [Dani] Yeah. Resources and questions.

1301
00:57:35,130 --> 00:57:35,963
Put your resources here.

1302
00:57:35,963 --> 00:57:39,663
We have some authentic AI
resources to get started.

1303
00:57:42,090 --> 00:57:43,080
Agentic AI.

1304
00:57:43,080 --> 00:57:47,370
We have GitHub, Bedrock,
AgentCore samples.

1305
00:57:47,370 --> 00:57:49,290
We'll be pushing the
code that we saw today,

1306
00:57:49,290 --> 00:57:50,123
this week there.

1307
00:57:50,123 --> 00:57:51,000
So if you go to GitHub

1308
00:57:51,000 --> 00:57:55,710
and say Amazon Bedrock AgentCore
samples on their memory,

1309
00:57:55,710 --> 00:57:57,183
it should be there.

1310
00:57:58,680 --> 00:58:00,270
And yeah, follow me on LinkedIn

1311
00:58:00,270 --> 00:58:02,643
and Akarsha will probably
post it there also.

1312
00:58:04,590 --> 00:58:05,423
Very important,

1313
00:58:05,423 --> 00:58:07,830
please complete the session survey.

1314
00:58:07,830 --> 00:58:10,440
Five stars recommended, other optional.

1315
00:58:10,440 --> 00:58:12,183
And yeah, (chuckles)

1316
00:58:12,183 --> 00:58:14,160
I'll take any questions now.

1317
00:58:14,160 --> 00:58:15,210
- Yeah.
- Thank you.

