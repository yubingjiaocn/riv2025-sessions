# AWS re:Invent 2025 - Agent Core 可观测性实战会议总结

## 会议概述

本次技术会议由来自哥伦比亚的两位AWS解决方案架构师Gabriel Perez和Luis Torres主讲，他们专注于金融服务行业，在AWS工作了6-7年时间。会议的核心主题是如何使用Amazon Bedrock Agent Core的可观测性功能来监控、调试和优化生产环境中的AI代理系统。

演讲者通过一个实际的金融顾问代理案例，展示了如何解决生产环境中常见的问题，包括高延迟、多语言配置错误、模型选择不当等。会议采用代码实操的形式，现场演示了如何利用Agent Core的日志、指标和追踪功能来识别和修复问题。整个演示基于一个多代理架构（Swarm架构），包括贷款利率检查、贷款计算、资格审查和编排等多个专业代理。

通过本次会议，参会者学习到了如何将AI代理从概念验证阶段自信地推向生产环境，如何使用AWS原生工具进行全面的可观测性监控，以及如何通过系统化的方法持续优化代理性能。会议强调了可观测性在控制大语言模型非确定性行为、实现业务目标和管理复杂系统方面的重要性。

## 详细时间线

### 开场与背景介绍 (00:00 - 05:30)
- **00:00** - Gabriel Perez自我介绍，来自哥伦比亚波哥大，AWS金融服务行业解决方案架构师，在AWS工作7年
- **01:15** - Luis Torres自我介绍，哥伦比亚金融行业解决方案架构师经理，在AWS工作近6年，专注于分析和生成式AI
- **02:00** - 开始现场调查，通过二维码收集参会者背景信息

### 现场调查结果 (05:30 - 08:45)
- **05:30** - 调查问题1：50%的参会者已在生产环境部署AI代理
- **06:15** - 调查问题2：主要挑战是精确度和集成问题
- **06:45** - 调查问题3：约25%的参会者使用过Strands框架
- **07:20** - 调查问题4：29%的参会者了解Agent Core
- **07:50** - 调查问题5：只有2人使用Agent Core可观测性，多数使用Langsmith、Landfuse等工具
- **08:30** - 地理知识问答：确认哥伦比亚位于南美洲北部

### 会议议程与目标 (08:45 - 12:00)
- **08:45** - 介绍会议议程：Agent Core介绍、可观测性重要性、构建代理、资源分享
- **09:30** - 说明会议目标：帮助更多人了解如何使用AWS服务提高生产环境代理的可见性
- **10:15** - 强调可观测性的三大目标：控制非确定性行为、实现业务目标、管理复杂系统

### 案例场景介绍 (12:00 - 15:30)
- **12:00** - 介绍演示案例：为哥伦比亚客户构建的金融顾问代理
- **12:45** - 案例功能：客户可以咨询新贷款、检查资格、查询信用评分和利率信息
- **13:30** - Gabriel列举当前代理存在的问题：架构演进困难、提示词冲突、工具使用不清晰、决策路径不透明
- **14:45** - Luis询问当前代理的具体问题

### Agent Core价值介绍 (15:30 - 19:00)
- **15:30** - 解释Agent Core的核心价值：让客户自信地从POC迁移到生产环境
- **16:15** - Agent Core特点：专注于代理构建而非基础设施、模块化组件设计、缩短上市时间
- **17:00** - 介绍Agent Core组件：运行时、可观测性等，可独立使用
- **17:45** - 说明Agent Core支持多种框架，使用OpenTelemetry标准
- **18:30** - 展示架构图：聊天界面 → Strands代理 → 多代理系统 → 工具集成 → Agent Core运行时 → 可观测性

### 代码演示准备 (19:00 - 24:00)
- **19:00** - Gabriel开始代码演示，询问屏幕可见性
- **19:30** - 调整字体大小以便观看
- **20:00** - 介绍代码结构：导入模块、环境变量配置、工具定义（贷款计算、知识库检索）
- **21:15** - 展示四个代理的创建模式：模型声明、代理创建、工具提供
- **22:00** - 解释Swarm架构：全网状通信，编排器负责自主切换代理
- **23:00** - 列举四个代理：利率检查、贷款计算、资格审查、编排器

### Agent Core部署展示 (24:00 - 28:30)
- **24:00** - 展示Agent Core快速启动配置
- **24:45** - 运行agent core status命令查看部署状态
- **25:30** - 介绍AWS CLI的tail命令用于实时查看CloudWatch日志
- **26:15** - 解释该命令适用于所有CloudWatch日志组，类似Unix的tail命令
- **27:00** - 复制日志tail命令准备监控
- **27:45** - 说明当前没有调用因此看不到日志

### 首次代理调用与性能问题 (28:30 - 33:00)
- **28:30** - 切换到Streamlit构建的用户界面
- **29:00** - 选择Agent Core运行时版本27
- **29:30** - 提问："30年固定贷款的当前抵押贷款利率是多少？"
- **30:00** - Gabriel询问：是否遇到过响应时间过长的问题
- **30:30** - Luis询问：正常代理响应时间应该是多少？讨论认为10-20秒合理
- **31:15** - 响应完成，耗时13.5秒
- **31:45** - 查看CloudWatch日志，显示Agent Core接收请求、代理推理过程、切换到专业代理、最终响应
- **32:30** - 强调这些日志在使用Agent Core快速启动时默认启用

### 问题诊断与优化策略 (33:00 - 38:30)
- **33:00** - Luis询问：延迟问题可能的原因是什么？提示可以检查提示词或变量
- **33:45** - Gabriel指出第一个问题：温度参数设置过高（接近1.0）
- **34:30** - 解释高温度导致模型更有创造性，概率分布更广
- **35:00** - 建议将温度降至0.5或0.2以获得更确定的输出
- **35:45** - 提到某些场景（如提示词路由、文本转YAML）应设置温度为0
- **36:15** - 指出第二个问题：最大令牌数设置为400，可以降低
- **37:00** - Gabriel询问模型选择问题
- **37:30** - 指出使用Anthropic Claude 3.7是"旧模型"，建议升级到Nova 2或Sonnet 4.5
- **38:00** - 提出多代理优化模式：编排器使用轻量模型，专业代理使用更强模型

### 代码修改与重新部署 (38:30 - 45:00)
- **38:30** - 开始修改代码，将所有温度参数设置为0.5
- **39:00** - 将编排器温度设置为0.1（更低的创造性）
- **39:45** - 修改环境变量以使用新模型
- **40:15** - 运行AWS CLI命令查询可用的推理配置文件
- **41:00** - 解释推理配置文件：支持跨区域调用，提高弹性和容量
- **41:45** - 选择Haiku 4.5模型的推理配置文件
- **42:30** - 在环境变量文件中添加编排器模型配置
- **43:15** - 在代码中添加编排器模型环境变量
- **44:00** - 总结修改：编排器使用Haiku（轻量模型），其他代理升级到Sonnet 4.5

### 部署新版本 (45:00 - 49:00)
- **45:00** - 准备使用Agent Core工具包重新部署
- **45:30** - 介绍使用Makefile简化部署流程
- **46:00** - 提到Agent Core工具包可在5分钟内部署代理
- **46:45** - 部署过程中提醒：需要逐个传递环境变量，不会自动读取.env文件
- **47:30** - 部署完成，显示项目被打包、上传到S3、创建部署包、启用OpenTelemetry
- **48:15** - 刷新用户界面，显示新版本28
- **48:45** - 强调部署速度非常快

### 性能改进验证 (49:00 - 52:30)
- **49:00** - 使用相同问题测试新版本
- **49:30** - 等待响应时承诺会更快
- **50:00** - 查看CloudWatch日志显示成功调用和代理切换
- **50:45** - 响应时间从13.5秒降至约12秒
- **51:15** - Gabriel表示可以通过优化提示词进一步改进
- **51:45** - 询问是否有问题，无人提问
- **52:00** - Luis提议展示CloudWatch中的Agent Core指标

### CloudWatch指标展示 (52:30 - 56:30)
- **52:30** - 切换到CloudWatch控制台
- **53:00** - 展示Agent Core可观测性仪表板
- **53:30** - 显示关键指标：2个代理、2个端点、25个会话（部分来自负载测试）
- **54:00** - 展示会话、追踪、错误的趋势图
- **54:30** - 介绍运行时特定指标：调用次数、每小时vCPU使用量（计费单位）、内存消耗（GB）
- **55:00** - 展示代理级别指标：令牌使用量（容量规划重要指标）
- **55:30** - 显示会话数、追踪数、错误数（系统错误和客户端错误）
- **56:00** - 展示入站和出站授权请求计数

### Agent Core运行时特性 (56:30 - 58:00)
- **56:30** - 强调Agent Core运行时的无服务器特性
- **57:00** - 说明无需担心vCPU或内存分配，服务自动管理
- **57:30** - 介绍可以从Agent Core控制台直接测试代理

### 多语言问题演示 (58:00 - 63:00)
- **58:00** - 展示Agent Sandbox测试功能
- **58:30** - 选择默认端点版本28
- **59:00** - 解释可以传递JSON结构的提示词和额外参数（如用户上下文的headers）
- **59:45** - 创建新提示词："我是否有资格获得贷款？信用评分680，年收入6万"
- **60:30** - 解释金融公司用例：验证客户资格、检查用户历史、确定可批准的贷款类型
- **61:00** - 发送提示词并等待响应
- **61:45** - 响应以西班牙语返回
- **62:15** - Luis询问有多少人会说西班牙语
- **62:45** - Gabriel解释这是多语言代理的常见问题

### 多语言问题诊断 (63:00 - 68:00)
- **63:00** - 解释多语言代理最佳实践：为每种语言使用专门的提示词
- **63:45** - 说明西班牙语中词汇有多重含义，需要更精确的提示词
- **64:15** - 回到代码查找问题根源
- **64:45** - 查找资格代理的提示词配置
- **65:15** - 发现使用Amazon Bedrock Prompt Management服务
- **65:45** - 解释该服务用于存储、版本控制和管理提示词生命周期
- **66:30** - 切换到Amazon Bedrock控制台
- **67:00** - 列出所有提示词：利率检查、贷款顾问、西班牙语代理、资格代理、贷款计算器
- **67:45** - 检查环境变量中的代理ID配置

### 修复多语言配置 (68:00 - 72:00)
- **68:00** - 发现配置错误：使用了西班牙语代理的提示词ID
- **68:30** - 查看正确的英语提示词："你是贷款顾问专家，评估客户资格并推荐..."
- **69:00** - 调整字体大小以便查看
- **69:30** - 复制正确的提示词ID（以98结尾）
- **70:00** - 在环境变量文件中修改配置
- **70:45** - 解释问题原因：有人修改了参数并留下了西班牙语提示词
- **71:15** - Luis补充：多语言代理实现方式，以及将提示词作为参数而非硬编码的优势
- **71:45** - 强调提示词版本控制的重要性

### 端点与版本管理 (72:00 - 75:00)
- **72:00** - 准备重新部署版本29
- **72:30** - 介绍Agent Core的端点和版本概念
- **73:00** - 解释版本不可变性：部署后无法修改
- **73:30** - 说明可以创建多个端点：默认、生产、预生产、西班牙语、拉丁美洲、美国、欧洲、西班牙、葡萄牙等
- **74:00** - 强调应用程序可以选择调用特定版本的代理
- **74:30** - 版本29部署完成

### 修复验证与追踪功能 (75:00 - 80:00)
- **75:00** - 在Agent Sandbox中测试版本29
- **75:30** - 切换到日志查看，准备展示追踪功能
- **76:00** - 响应以英语返回："好消息！根据您的资料和当前资格，您有资格获得个人贷款"
- **76:45** - 显示调用成功完成
- **77:15** - 介绍会话ID：由客户端创建的36字符唯一标识符
- **77:45** - 复制会话ID用于追踪查询
- **78:15** - 说明可以自定义会话ID
- **78:45** - 切换到可观测性控制台进行深入分析
- **79:30** - 解释需要启用X-ray追踪功能

### X-ray追踪配置说明 (80:00 - 82:00)
- **80:00** - 说明需要为OpenTelemetry spans启用事务搜索
- **80:30** - 强调使用OpenTelemetry开放标准格式记录日志
- **81:00** - 导航到可观测性控制台的会话列表
- **81:30** - Luis确认：每个新用户创建一个新会话

### 会话追踪详细分析 (82:00 - 88:00)
- **82:00** - Gabriel确认会话可持续15分钟到8小时
- **82:30** - 使用会话ID搜索特定会话
- **83:00** - 找到会话，显示有一个追踪记录
- **83:30** - 打开追踪详情，关闭不需要的窗口
- **84:00** - 展示追踪控制台的树状视图和时间线视图
- **84:45** - 详细说明追踪步骤：POST调用 → 获取4个提示词 → 调用Swarm → 调用FSI贷款顾问
- **85:30** - 展示代理切换循环
- **86:00** - 显示调用Anthropic Haiku 4.5模型
- **86:30** - 展示每个模型的事件循环执行
- **87:00** - 深入模型调用详情：完成时间2秒、输入193令牌、输出100令牌
- **87:45** - 显示系统提示词："你是主要的FSI贷款顾问，与专业代理合作帮助客户..."

### 会议总结与后续内容预告 (88:00 - 结束)
- **88:00** - 追踪分析继续展示更多技术细节
- **88:30** - 演示如何通过追踪识别性能瓶颈和问题根源
- **89:00** - 强调可观测性在生产环境中的关键作用
- **89:30** - 预告将分享更多资源和最佳实践

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注： 本总结基于会议字幕转录，涵盖了从开场介绍到深入技术演示的完整内容，重点展示了如何使用AWS Agent Core和相关可观测性工具来构建、部署和优化生产级AI代理系统。