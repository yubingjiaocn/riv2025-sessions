# AWS re:Invent 2025 Step Functions 观察性神秘解析会议总结

## 会议概述

本次技术会议由AWS首席无服务器专家Pawan和AWS Step Functions团队首席工程师Diego共同主讲，重点探讨了Step Functions的观察性挑战和解决方案。会议通过四个实际演示，展示了如何构建、调试和监控Step Functions工作流，特别关注分布式映射、状态转换限制和跨账户集成等复杂场景。

演讲者介绍了最近发布的新监控指标，帮助客户更好地理解异步执行过程中的性能瓶颈和故障排查。会议内容涵盖了从基础构建到生产环境最佳实践的完整流程，为使用Step Functions的开发者提供了宝贵的观察性洞察。

## 详细时间线与关键要点

### 00:00-05:00 会议开场与议程介绍
- Pawan和Diego自我介绍，确定听众对Step Functions的使用情况
- 介绍会议议程：四个演示，从基础构建到复杂观察性概念
- 确定演示重点：风速数据分析用例，处理大规模数据集

### 05:00-15:00 演示1：分布式映射构建风速分析工作流
- 展示开源风速数据集，包含从1929年到2025年的全球气象站数据
- 数据规模：约600,000个对象，70GB数据，按年份和气象站ID分区
- 在Step Functions控制台创建windspeed-analysis状态机
- 配置分布式映射：批处理大小500个对象，并发限制1000，容错阈值5%
- 演示拖拽式界面配置Lambda函数进行数据处理和结果聚合

### 15:00-25:00 分布式映射执行与新监控指标
- 执行工作流，处理600,000个对象用时约2分15秒
- Diego介绍新发布的三个关键指标：
  - OpenMapRunLimit：账户最大并发Map Run限制
  - OpenMapRunCount：当前运行的Map Run数量
  - MapRunBacklogSize：积压队列大小
- 演示负载测试场景，展示指标在CloudWatch中的实时变化

### 25:00-35:00 状态转换限制与监控
- Diego解释状态转换概念：执行开始、完成、节点间转换
- 默认限制：大区域5000次/秒，小区域800次/秒（软限制）
- 使用桶模型类比：每秒补充5000个令牌，状态转换消耗令牌
- 演示状态转换配额监控指标：BucketSize、RefillRate、ConsumedCapacity、ThrottledEvents
- 展示如何识别导致节流的具体状态机

### 35:00-45:00 跨账户集成挑战与解决方案
- Diego解释跨账户调用的工作原理：角色链和轮询机制
- 演示产品评论分析的跨账户场景：父工作流调用子工作流
- 展示信任策略配置和角色链设置的重要性
- 演示常见问题：子执行完成但父执行仍在等待状态

### 45:00-51:00 故障排查与权限修复
- 使用CloudTrail排查AccessDenied错误
- 识别缺失的DescribeExecution和StopExecution权限
- 修复权限后，之前等待的执行自动恢复并完成
- 解释轮询机制：前10分钟每分钟轮询一次，之后采用退避策略
- 总结跨账户集成所需的关键权限和最佳实践