# AWS re:Invent 2025 技术分享会总结

## 会议概述

本次分享会由AWS首席工程师David Kilman和高级解决方案架构师Sephi Abra共同主讲,主题聚焦于基础设施即代码(Infrastructure as Code, IaC)的治理与安全控制。会议在re:Invent的最后一天(周四)举行,两位讲师以轻松幽默的方式向观众展示了如何使用主动控制(Proactive Controls)来防止不安全或不合规的基础设施部署。

David分享了多个真实案例,包括他自己因创建不安全的Lambda函数端点而被安全团队告警的经历,以及实习生意外修改生产环境配置的故事。这些案例生动地说明了为什么需要在部署前就阻止错误配置,而不是依赖事后检测。会议重点介绍了CloudFormation Hooks功能,这是一种可以在资源创建前进行策略验证的机制,能够确保所有部署都符合组织的安全、合规和成本优化要求。

讲师们通过大量现场演示展示了如何使用CloudFormation Guard编写策略规则,如何配置Hooks,以及如何在CloudFormation和Terraform中应用这些控制。整个分享会强调了"左移"(Shift Left)的理念——在开发早期就发现并修复问题,而不是等到生产环境出现故障后再补救。

## 详细时间线与关键要点

### 开场与背景介绍 (00:00 - 05:30)
- **00:00** - 会议开始,David Kilman进行开场互动,调动现场气氛
- **01:20** - 介绍演讲者背景:David是AWS CloudFormation团队的首席工程师,Sephi专注于治理、合规和安全领域
- **02:15** - 现场调查:询问观众使用IaC工具的情况(CloudFormation、Terraform、Pulumi等)
- **03:30** - 展示典型的IaC工作流程:编写代码 → 推送到Git → CI/CD流水线 → 部署到AWS账户
- **04:45** - 提出核心问题:如何在这个流程中实施安全防护措施?

### 主动控制的价值与用例 (05:30 - 15:00)
- **05:30** - 演示CloudFormation Hooks的基本概念:在资源创建前进行策略检查
- **06:45** - 用例一:安全与治理 - David分享Lambda函数端点事件:创建了一个公开可访问的Lambda端点,被安全团队检测到并要求删除
- **09:20** - 强调主动控制的优势:在问题发生前阻止,而不是事后补救
- **10:30** - 用例二:防止意外错误 - 实习生案例:意外将生产环境的Auto Scaling组从100个实例改为10个,被Hook及时拦截
- **12:15** - 介绍COE(Correction of Errors)文化:从错误中学习并建立机制防止重复发生
- **13:45** - 用例三:成本优化 - 限制EC2实例类型,确保使用有折扣的实例类型

### CloudFormation Guard与Hooks实战演示 (15:00 - 35:00)
- **15:00** - 开始现场编码演示环节
- **16:00** - 介绍CloudFormation Guard:AWS的策略即代码DSL(领域特定语言)
- **17:30** - 访问GitHub上的Guard规则注册表,展示社区预编写的规则库
- **18:45** - 演示如何从规则库中选择S3、IAM、Lambda、DynamoDB相关的安全规则
- **20:00** - 在CloudFormation控制台创建Hook:命名为"Gotcha Hook",上传Guard规则到S3
- **21:30** - 配置Hook触发条件:在资源创建和更新时运行,失败模式设置为"阻止"
- **23:00** - 展示AI生成的CloudFormation模板:包含Lambda函数、DynamoDB表和S3存储桶
- **24:15** - 第一次部署尝试失败:S3存储桶因缺少对象锁定(Object Lock)和公共访问阻止配置而被Hook拦截
- **26:30** - 查看Hook失败详情:详细的错误消息指出缺少哪些配置
- **27:45** - 修复S3存储桶配置:添加ObjectLockEnabled和PublicAccessBlockConfiguration属性
- **29:00** - 第二次部署尝试:仍然失败,DynamoDB表缺少加密配置,IAM角色包含管理员权限
- **31:00** - 介绍Change Set功能:类似Terraform Plan,在实际部署前预览变更
- **32:30** - 演示Change Set与Hook结合:在Change Set阶段就能看到所有策略违规,无需等待实际部署
- **34:00** - 展示修复后的成功部署:所有资源通过Hook验证

### CloudFormation Guard规则详解 (35:00 - 40:00)
- **35:00** - 深入讲解Guard规则语法结构
- **36:15** - 展示S3对象锁定规则示例:检查资源类型,断言属性存在且为true
- **37:30** - 说明如何在规则中添加自定义错误消息,帮助开发者快速定位问题
- **38:45** - 强调Guard规则的可读性和可维护性

### AWS Control Catalog简化Hook创建 (40:00 - 48:00)
- **40:00** - 介绍AWS Control Catalog:预构建的合规控制库
- **41:30** - 演示如何通过Control Catalog快速创建Hook,无需手写Guard规则
- **43:00** - 展示Control Catalog中的各种预定义控制:S3加密、IAM权限、VPC配置等
- **44:30** - 一键部署控制到账户:选择控制 → 配置参数 → 激活
- **46:00** - 对比手动编写Guard规则与使用Control Catalog的效率差异
- **47:15** - 说明Control Catalog支持多种合规框架:PCI-DSS、NIST、FedRAMP等

### Terraform集成演示 (48:00 - 55:00)
- **48:00** - Sephi接手演示,展示Hooks如何与Terraform配合使用
- **49:15** - 介绍Terraform与CloudFormation的集成机制
- **50:30** - 演示Terraform配置文件中的资源定义
- **51:45** - 执行terraform plan,展示Hook在计划阶段的验证
- **53:00** - 演示terraform apply被Hook拦截的场景
- **54:15** - 强调跨IaC工具的统一治理策略

### 高级功能与最佳实践 (55:00 - 65:00)
- **55:00** - 介绍Hook的警告模式(Warn Mode):不阻止部署,仅记录违规
- **56:30** - 讨论Hook的作用域:账户级别、组织级别、特定资源类型
- **58:00** - 演示如何查看Hook执行历史和审计日志
- **59:30** - 分享Hook性能优化建议:规则复杂度、执行时间限制
- **61:00** - 讨论异常处理:如何为特定场景创建豁免机制
- **62:30** - 介绍与AWS Config、Security Hub的集成
- **64:00** - 强调文档化的重要性:让开发者理解为什么某些配置被要求

### 组织级部署与治理 (65:00 - 72:00)
- **65:00** - 介绍AWS Organizations中的Hook部署策略
- **66:30** - 演示如何使用StackSets在多账户中部署Hook
- **68:00** - 讨论集中式治理与分布式开发的平衡
- **69:30** - 分享大型组织的Hook管理最佳实践
- **71:00** - 介绍Hook版本管理和更新策略

### 问答与总结 (72:00 - 结束)
- **72:00** - 开放问答环节
- **73:30** - 观众提问:如何处理遗留资源的合规性?
- **75:00** - 观众提问:Hook的性能影响有多大?
- **76:30** - 观众提问:是否支持自定义编程语言编写Hook?
- **78:00** - 总结核心要点:主动控制优于被动检测,左移安全理念,自动化合规验证
- **79:30** - 鼓励观众访问GitHub规则库和AWS文档
- **80:00** - 会议结束,感谢观众参与

## 关键技术要点

- **CloudFormation Hooks**: 在资源创建前执行策略验证的机制
- **CloudFormation Guard**: AWS的策略即代码语言,用于定义合规规则
- **Change Sets**: 在实际部署前预览和验证变更
- **AWS Control Catalog**: 预构建的合规控制库,简化Hook创建
- **跨工具支持**: Hooks可用于CloudFormation和Terraform
- **失败模式**: 支持阻止(Fail)和警告(Warn)两种模式
- **组织级部署**: 通过AWS Organizations实现多账户治理