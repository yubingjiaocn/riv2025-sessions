# AWS re:Invent 2025 会议总结：Ripple 的 AI 驱动运维平台

## 会议概述

本次会议介绍了 Ripple 如何构建基于 AI 的运维平台来转型其区块链平台运营。会议由 AWS 解决方案架构师 Aman Tiari 主持，Ripple 团队成员 Vijay 和 Hari Vignesh Rajendran 共同演讲。这是一场 300 级别的技术分享会，重点讲述了 Ripple 如何利用 AWS 服务解决 XRPL（XRP Ledger）区块链网络运维中的复杂挑战。

Ripple 是一家金融科技公司，专注于构建企业级区块链解决方案，而 XRPL 是其底层的第一层区块链网络。该网络自 2012 年运行至今，拥有超过 900 个节点，处理了超过 1 亿个账本，具有 3-5 秒的确定性终结时间。然而，在去中心化网络环境中监控和诊断问题极具挑战性，传统方法需要依赖 C++ 专家分析海量日志（单个节点可达 30-35GB），问题诊断可能需要 2 天时间。为此，Ripple 开发了一个多智能体 AI 平台，利用自然语言处理和代码-日志关联分析，将问题诊断时间大幅缩短。

该解决方案采用了 AWS 的多项服务，包括 Amazon Bedrock、Lambda、Neptune Analytics、CloudWatch、DynamoDB 等，构建了包含编排代理、代码分析代理、日志分析代理和查询生成代理在内的四个 AI 智能体系统。通过图 RAG（检索增强生成）技术和重排序机制，系统能够准确理解代码依赖关系和日志模式，为运维团队提供快速、准确的问题分析和解决方案。

## 详细时间线与关键要点

00:00:00 - 会议开场与介绍
- Aman Tiari 介绍会议主题：Ripple 如何构建 AI 驱动的运维平台
- 说明这是 300 级别的技术会议，假设观众熟悉核心 AWS 服务
- 概述会议议程：Ripple 背景、面临的挑战、解决方案架构、实际演示和未来规划

00:01:30 - Ripple 与 XRP 的区别说明
- Vijay 澄清常见误解：XRP 是 XRPL 区块链的原生数字资产（类似比特币的 BTC）
- Ripple 是一家金融科技公司，构建企业级区块链解决方案
- Ripple 的产品包括跨境支付解决方案、数字资产托管服务和稳定币 RLUSD

00:03:00 - XRPL 区块链介绍
- XRPL 是专为商业应用设计的第一层区块链
- 采用能源高效的共识证明机制，而非比特币的工作量证明
- 具有 3-5 秒的确定性终结时间，交易费用极低（约 0.4 美分）
- 自 2012 年运行至今，已关闭超过 1 亿个账本

00:04:30 - XRPL 网络架构
- 点对点去中心化网络，无中央服务器
- 包含多种节点类型：验证节点（共识层核心）、中继节点、集线器节点
- 拥有约 900 个节点和 180 个独立验证节点
- 节点分布全球，由大学、区块链机构、钱包提供商和金融机构运营

00:06:00 - 运维挑战说明
- 去中心化网络的监控比中心化系统复杂得多
- 传统方法依赖 C++ 专家分析海量调试日志
- 单个节点日志可达 30-35GB，Ripple 运营的 40 多台主网机器产生 2-2.5 PB 数据
- 实际案例：红海海底电缆中断导致亚太地区节点可靠性问题，诊断需要 2 天时间

00:08:00 - AI 解决方案的动机
- 传统方法需要 C++ 专家交叉比对日志和代码
- 日志包含大量信号、加密细节、提案和对等连接信息
- 团队决定探索 AI 如何实现日志与代码的关联分析
- 目标：将英语作为自然编程语言，减少对专家的依赖

00:09:30 - 高层架构概览
- 三个核心组件：多智能体平台、代码分析管道、日志处理管道
- 多智能体平台是编排层，包含多个代理协同工作
- 代码分析管道：每日从 GitHub 仓库检索代码，存储在图数据库中
- 日志处理管道：处理海量日志数据，为智能体框架准备数据

00:11:00 - 日志处理管道详解（Hari 讲解）
- 原始日志通过 GitHub 工作流和 SSM 从验证节点、集线器和客户端处理器传输到 S3
- S3 事件触发 Lambda 函数，将日志分块并尊重日志行边界
- 消息放入 SQS 进行分布式处理
- 日志处理器 Lambda 函数从 S3 检索相关块，提取元数据并发送到 CloudWatch

00:13:00 - 代码分析管道详解
- 两个主要代码仓库：rippled（XRPL 服务器软件）和 standards（规范文档）
- 使用 Amazon EventBridge 调度器自动触发仓库同步
- Git 仓库处理器从 GitHub 拉取最新代码和文档，版本化后存储到 S3
- 知识库注入作业将数据导入 Amazon Neptune Analytics 向量存储

00:15:00 - 图 RAG 能力深入讲解
- 选择图数据库而非 OpenSearch，因为图数据库擅长存储代码库中的关系
- 文件从 S3 读取后转换为可管理的小块
- 使用固定大小分块策略，适合结构化内容如代码和文档
- Titan Text Embeddings v2 模型生成嵌入向量（文本的语义含义）

00:17:00 - 实体提取与词汇图构建
- 从代码块中提取实体：函数名、代码调用、类、模块等
- Claude IQ v1 模型执行实体提取
- 构建词汇图，揭示代码库中的关系
- 使检索更快速高效，减少 LLM 所需的上下文窗口

00:19:00 - Neptune Analytics 图存储
- 存储节点和边，链接到实体、源块、源文档
- 跨文档关系全部存储在图中
- 成为强大的检索层
- 查询时，代码分析代理使用 LLM 从知识库获取上下文和实体

00:20:30 - 重排序层优化
- 在图 RAG 工作流之上添加重排序层
- 向量搜索提供基于嵌入的顶级匹配
- Cohere Rerank 模型在运行时动态评估相关性
- 模型同时读取查询和每个候选文档，理解细微差别
- 从知识库检索广泛的数据块，重排序后返回前 10 个高质量结果

00:22:00 - 重排序效果示例
- 示例查询：函数内定义了哪些日志消息
- 原本排名第 4 的源块通过重排序提升到第 1 位
- 减少 LLM 的上下文窗口占用，保留更多 token 用于生成

00:23:00 - 多智能体平台架构（Aman 讲解）
- 四个 AI 代理：编排代理、代码分析代理、日志分析代理、查询生成代理
- 用户通过 Web UI（聊天界面）提交查询
- 请求通过 Amazon API Gateway 发送到编排代理

00:24:00 - 编排代理功能
- 执行意图分类，决定调用哪个专业代理
- 可以协调多个代理的顺序或并行执行
- 综合下游代理的输出，生成统一响应
- 使用 DynamoDB 作为状态管理后端

00:25:00 - API Gateway 超时处理
- API Gateway 有 29 秒的软集成超时限制
- 编排代理收到查询后立即在 DynamoDB 创建任务条目
- 异步执行并持续更新进度消息
- 结果完成后写回 DynamoDB

00:26:00 - 代码分析代理
- 使用 Bedrock 知识库作为工具
- 利用图 RAG 应用获取代码洞察
- 能够理解代码依赖关系、XRPL 代码库和 Git 提交关系

00:27:00 - 日志分析代理
- 对 CloudWatch 日志组执行运维分析
- 生成 CloudWatch Logs Insights 查询
- 与查询生成代理紧密协作以生成语法准确的查询
- 查询生成代理使用静态 JSON 文件作为工具

00:28:00 - Amazon Cognito 与 Bedrock Agent Core
- Amazon Cognito 处理 API Gateway 身份验证
- 两个代理托管在 AWS Lambda 上
- 另外两个代理托管在 Amazon Bedrock Agent Core 上
- Agent Core 是专为 AI 代理设计的无服务器环境

00:29:00 - 架构设计选择说明
- Lambda 满足初期所有约束条件
- Agent Core 当时刚进入预览阶段
- 现在 Agent Core 已正式发布，Ripple 计划迁移 Lambda 代理到 Agent Core
- 利用专为多智能体设计的基础设施优势

00:30:00 - Secrets Manager 与 SSM Parameter Store
- Secrets Manager 存储 Agent Core 通信所需的敏感凭证
- SSM Parameter Store 存储服务的配置参数

00:31:00 - 提示工程与系统提示
- 系统提示定义代理的身份、职责和禁止行为
- Ripple 实践严格的提示卫生原则
- 每个提示都结构化，提供代理角色、任务和明确的防护栏
- 展示了从代码库直接复制的系统提示示例

00:32:30 - 各代理的系统提示特点
- 编排代理：专注于任务委派
- 日志分析代理：专家级 XRPL 日志分析，存储在 CloudWatch 中
- 代码分析代理：理解代码依赖关系、XRPL 代码库和 Git 提交关系
- 查询生成代理：精确生成供日志分析代理使用的查询

00:34:00 - 代理工具与框架
- 架构基础是 Strand SDK（AWS 构建的开源多智能体协调 SDK）
- 所有代理都使用 Strand 作为多智能体框架
- 编排代理使用 Claude Sonnet 4.5 模型

00:35:00 - 编排代理的工具
- 调用代码分析代理工具：通过 Lambda 调用
- 调用日志代理函数：通过 HTTP 与 JSON Web Token 身份验证通信

00:36:00 - 代码分析代理的工具
- XRPL 查询代码工具：由 XRPL 知识库提供支持
- 获取最近提交和提交详情：基于 Git 的同步操作

00:37:00 - 日志分析代理的工具
- 需要访问 CloudWatch API
- 执行查询、描述和检索操作

00:38:00 - Strand 框架的作用总结
- Strand 处理通信层、消息传递、上下文管理和多智能体协调
- 编排代理做决策
- 专业 AI 代理执行深度领域分析工作并反馈给编排代理

00:39:00 - 端到端查询流程演示
- 用户通过 Web UI 提问
- 请求到达 API Gateway，发送到编排代理
- 编排代理执行意图分类，决定调用代码分析代理
- 代码分析代理调用工具获取相关代码行

00:40:30 - 多代理协作流程
- 代码分析代理将问题传递给日志分析代理
- 日志分析代理使用 CloudWatch 查询生成代理获取准确查询
- 查询生成代理生成可在 CloudWatch 日志组上执行的查询

00:41:30 - 模型上下文协议（MCP）
- Anthropic 开发的开放标准
- 帮助 AI 代理通过标准化接口与外部系统（如 CloudWatch）通信
- 日志分析代理使用两个 MCP 工具：执行查询和获取查询结果

00:43:00 - 结果综合与返回
- 日志分析代理获取结果后，通过代码分析代理整合信息
- 执行代码-日志关联分析
- 将结果发送回编排代理
- 编排代理综合输出并返回给用户

00:44:00 - 模型灵活性
- 所有 AI 代理使用大语言模型（当前使用 Claude Sonnet 4.5）
- Amazon Bedrock 提供模型灵活性，可以混合搭配
- 编排代理可使用轻量级模型提高速度
- 重型代理可使用擅长代码生成的模型

00:45:00 - 完整架构总结
- 展示当前完整架构：AI 处理、日志处理管道、代码分析管道
- 过渡到演示环节

00:46:00 - 演示前的日志行说明（Hari）
- 演示将包含大量文本和日志内容
- 会暂停以便观众理解日志行

00:46:30 - 演示开始：第一个查询
- 问题：在给定时间范围内，UNL 验证节点从其他对等节点看到了多少提案
- 提案是验证节点对下一个账本的建议视图
- 要求代码分析代理从代码中获取日志行，传递给日志分析代理

00:47:30 - 编排代理日志
- 显示编排代理接收用户查询
- 决定调用代码分析代理获取代码中的日志行

00:48:00 - 代码分析代理执行
- 接收来自编排器的提示和聊天历史
- 重复使用查询 XRPL 代码工具，直到获取所有相关日志行
- 检索到主要日志行（位于 consensus.h 文件中）
- 同时获取其他相关日志行供日志分析代理进一步分析

00:49:30 - 日志分析代理执行
- 接收提示、聊天历史和代码分析代理的响应
- 调用 CloudWatch 查询生成代理获取查询

00:50:30 - 模式工具调用
- 从 S3 获取静态模式，包含日志模式和估计的模式数量
- 帮助形成 CloudWatch 查询代理的限制查询

00:51:30 - CloudWatch 查询生成
- 生成查询，执行日志模式的估计计数
- 包含执行指令：如何执行查询、是否可并行执行、时间范围等

00:52:30 - MCP 工具执行
- 根据指令多次调用 MCP 执行查询和获取结果工具
- 显示结果：总共收到 267,000 个来自其他对等节点的提案
- 包含每小时分布和发送提案的所有对等节点 ID

00:54:00 - 编排代理综合响应
- 综合代码分析代理和日志分析代理的响应
- 提供摘要视图
- 可点击"查看代理分析"按钮查看详细视图

00:55:00 - 详细视图展示
- 显示代码分析代理和日志分析代理的详细响应
- 用户可基于此提出更多问题获取更多结果

00:56:00 - Agent Core 可观测性
- 展示 Agent Core 可观测性界面
- 对改进代理性能非常有帮助
- 显示会话总数、延迟、持续时间、token 使用量和错误信息

00:57:00 - 第二个演示查询
- 更复杂的问题：需要关联多个日志行
- 涉及 XRPL 共识轮次（每 3-4 秒发生一次）
- 每个阶段都有一系列事件

00:58:00 - 共识阶段日志关联
- 在共识接受阶段，形成规范交易集
- 几个日志行之后，显示构建账本消息，包含所请求的账本哈希
- 需要关联这两个信息
- 因为系统理解共识轮次，能够正确形成日志行

00:59:30 - 第二个查询结果
- 正确提供了要查找的日志行
- 查找规范交易集消息、其下的单个交易和构建账本消息
- 代码分析代理将信息发送给日志分析代理
- 执行查询并输出账本哈希和所有中间事件

01:01:00 - 详细事件时间线
- 显示两个消息的时间戳（相隔几秒）
- 符合 XRPL 的行为方式

01:02:00 - 经验教训（Vijay）
- 上下文工程是关键
- LLM 能力强大，但如果上下文不正确会产生幻觉
- 上下文工程在设计 AI 解决方案时极其重要

01:03:00 - 可审计性的重要性
- 捕获决策、推理和工具调用
- 建立清晰可审计的工作流程
- 对于生产环境的 AI 系统至关重要

01:03:30 - 会议结束
- 总结整个解决方案的价值
- 强调从手动分析到 AI 驱动自动化的转变