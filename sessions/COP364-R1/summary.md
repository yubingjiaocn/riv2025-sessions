# AWS re:Invent 2025 - 使用移动端真实用户监控和应用程序地图实现全面可观测性

## 会议概述

本次会议由AWS高级专家架构师Sivier和首席工程师Alex Nazarov主讲,重点介绍了AWS Application Signals的全面可观测性解决方案。Application Signals是AWS自主研发的应用性能监控(APM)工具,基于OpenTelemetry开放标准,能够自动发现和监控账户中的所有服务。该解决方案采用APM领域的黄金指标(RED指标:请求数Request、错误数Error、持续时间Duration),无需用户手动配置服务依赖关系,系统会通过分布式追踪自动识别服务间的调用关系。

会议重点展示了两个最新发布的功能:应用程序地图(Application Map)和移动端真实用户监控(Mobile RUM)。应用程序地图提供了一个交互式的可视化界面,能够以瓦片形式展示所有应用程序,支持自定义分组(如按业务单元、环境、团队等),并通过颜色编码的圆环图实时显示服务健康状态。移动端RUM则是最近几周刚推出的功能,支持iOS和Android应用的实时监控,包括崩溃分析、应用性能指数、加载时间等关键指标。通过关联ID,系统能够实现从移动端到后端服务的端到端事务追踪,帮助开发者快速定位问题根源。

整个演示采用代码实战的方式,展示了如何在实际环境中使用这些工具进行故障排查。特别值得一提的是运营审计(Operational Audit)功能,它能够主动识别潜在问题并提供修复建议,甚至可以通过IDE中的MCP服务器直接在开发环境中进行根因分析。这种从被动响应到主动预防的转变,大大提升了系统可靠性和开发效率。

## 详细时间线

00:00 - 开场介绍
- 演讲者自我介绍:Sivier(AWS高级专家架构师)和Alex Nazarov(AWS首席工程师)
- 会议定位为代码实战演示,而非纯理论讲解
- 现场调查:很少有人使用或听说过Application Signals

02:30 - Application Signals概述
- 定义:AWS自主的应用性能监控(APM)解决方案
- 核心功能:服务清单、监控、故障修复
- 基于黄金指标(RED):请求数(Request)、错误数(Error)、持续时间(Duration/Latency)
- 自动依赖追踪,无需手动配置服务关系

05:00 - 技术基础
- 基于OpenTelemetry开放标准
- 支持服务级别目标(SLO)创建
- 拓扑图自动生成
- 事务搜索功能:将追踪数据存储为日志格式

07:15 - 应用程序地图(Application Map)功能介绍
- 从Trace Map → Service Map → Application Map的演进
- 瓦片式展示,每个瓦片代表一个应用程序
- 默认按相关服务分组,支持自定义分组(前端/后端、业务单元等)
- 可递归深入查看每个服务的详细信息

10:00 - 地图导航功能
- 支持自定义分组、缩放功能
- 右侧抽屉显示详细信息:健康指标、SLO状态、RED指标
- 运营审计(Operational Audit):主动识别延迟等问题
- 可点击追踪详情深入分析问题根因

12:30 - 真实用户监控(RUM)介绍
- 支持浏览器、iOS和Android移动应用
- 提供应用健康状态、JavaScript错误、崩溃分析
- 移动端特有指标:应用加载时间、应用性能指数
- Android的ANR(应用无响应)和iOS的崩溃分析
- 设备类型、操作系统版本等详细信息

16:00 - 端到端追踪
- 使用关联ID连接移动端和后端服务
- 基于OpenTelemetry标准
- 自动拓扑发现和可视化
- 每个瓦片显示性能指标的圆环图(颜色编码:红色表示需要关注)

18:30 - 架构说明
- 移动应用(iOS/Android)发送遥测数据到CloudWatch RUM
- RUM将数据转发到Application Signals
- 后端服务通过OpenTelemetry发送遥测数据
- 统一在Application Map中展示和监控

20:00 - Alex开始代码演示
- 展示复杂的"意大利面怪物"架构图
- 说明分布式系统的复杂性是真实业务需求的必然结果
- 客户需求:在一个页面上查看所有账户的所有应用

23:00 - 应用程序地图实际演示
- 展示高层次的应用瓦片视图
- 动态分组功能:自动发现API网关、负载均衡器、EKS、ECS集群、EC2等资源
- 虚线表示未插桩的服务,实线表示已插桩的服务
- 未插桩服务也能提供基本的APM功能

26:00 - Ticketing Light Service演示
- 展示未插桩的票务服务
- 发现4个服务:API Gateway和3个Lambda函数
- 显示SLO、最近部署、可用性、延迟、服务器故障等指标
- 从地图中识别出submit ticket服务存在问题

29:00 - 服务插桩演示
- 通过上下文菜单为所有Lambda启用Application Signals
- 添加OpenTelemetry层(仅SDK,不包含代理)
- 不增加Lambda冷启动时间
- 插桩过程约需5分钟

31:30 - 插桩后的效果对比
- 显示更多细节:异步通信的Lambda、SQS队列、DynamoDB表
- 更清晰的服务依赖关系图

33:00 - 运营审计(Operational Audit)功能
- 自动查找追踪和异常
- 直接显示异常信息:SQS消息过大错误
- 无需手动查看日志或进行复杂研究

35:00 - IDE集成演示(MCP服务器)
- 在IntelliJ IDEA中使用CloudWatch Application Signals MCP服务器
- 可在开发环境中直接查询生产环境状态
- 询问"哪些服务违反了SLO?"
- 询问"submit ticket有什么问题?"
- 自动执行运营审计并返回结果

38:00 - 代码级别的故障定位
- IDE自动连接堆栈追踪到代码行
- 直接显示导致问题的代码位置
- 提供修复建议

40:00 - 自定义地图分组演示
- 默认按相关服务分组
- 支持按环境分组(使用OpenTelemetry属性deployment.environment.name)
- 自定义分组:按应用程序、层级(tier)、团队所有权

43:00 - 标签和属性配置
- 使用AWS标签:application、tier、team
- 使用OpenTelemetry资源属性
- 配置后自动形成自定义分组

45:30 - 多层级分组导航演示
- 按层级(tier)分组:优先查看tier 1服务
- 进一步按应用程序分组:payment、pet clinic、ticketing
- 支持链式分组和递归深入

48:00 - Pet Clinic应用深入分析
- 4个服务显示为红色(违反SLO)
- 健康圆环图显示服务器故障、用户错误和成功请求的比例
- 点击服务查看运营审计详情

50:00 - 运营审计详细信息
- 显示多个审计卡片:依赖问题、未处理的边缘情况
- 异常值检测:识别贡献最多错误或高延迟的资源(pod、节点、EC2实例)
- 建议回收有问题的资源

52:30 - 合成监控(Synthetic Canaries)
- 持续运行API测试
- 验证响应是否符合预期结果
- 成功率96%的示例

54:00 - 真实用户监控(RUM)详解
- 网站监控:JavaScript错误、页面加载速度
- 移动端监控:最近几周刚发布的iOS和Android支持

56:00 - 移动端RUM演示
- 显示Android应用的崩溃率高
- 识别出owner details activity页面问题最多
- 实时数据:客户崩溃时立即记录

58:00 - Android Studio实际测试
- 运行模拟器测试应用
- 点击owner详情时应用崩溃
- 验证问题确实存在

59:30 - 崩溃根因分析
- 点击崩溃图表数据点
- 查看导致崩溃的会话列表
- 转到RUM控制台查看异常堆栈追踪
- 在Android Studio中分析堆栈追踪
- 直接定位到导致问题的代码行

62:00 - 移动端RUM配置方法
- 添加一个依赖:Amazon打包的OpenTelemetry SDK
- 创建App Monitor
- 在配置文件中指定App Monitor和区域
- 配置非常简单直接

64:00 - 应用程序地图总结
- 作为交互式仪表板的指导工具
- 实时或历史查看系统性能
- 支持时间范围调整,可回溯查看历史事件
- 端到端可见性:从终端用户体验到后端服务

66:00 - 遥测数据关联
- Application Signals连接指标、日志和追踪
- Lambda的日志、追踪和指标自动关联
- EKS等服务也支持类似关联
- 追踪数据报告对应的日志组

68:00 - 侧边栏功能演示
- 显示指标、对应的span和应用日志链接
- 支持自定义追踪属性指定日志位置

69:00 - 事务搜索功能演示
- 将追踪转换为日志存储
- 支持按订单ID等业务标识搜索
- 典型用例:客服人员快速查找客户订单问题
- 在海量数据中快速定位特定事务

71:00 - 事务搜索界面
- 自动建议可搜索的微服务和API
- 提示可用的搜索字段(如request ID、order ID)
- 使用日志分析能力分析应用行为

72:30 - 观众提问:X-ray用户是否需要重新插桩?
- 回答:不需要
- 说明:旧的X-ray SDK已弃用,现在统一使用OpenTelemetry
- 几年前已宣布OpenTelemetry为X-ray的支持标准

73:00 - 会议结束