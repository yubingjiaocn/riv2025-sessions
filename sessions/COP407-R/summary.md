# AWS re:Invent 2025 会议总结：使用智能代理应对关键漏洞事件

## 会议概述

本次会议由来自澳大利亚的首席解决方案架构师 Praveen B 和高级云支持工程师 Justin Thomas 主讲，重点探讨了如何利用 Agentic AI（智能代理）帮助企业更好地应对类似 Log4j 这样的关键安全漏洞事件。

演讲者通过一个虚构公司"Manual Everything Corporation"的案例，生动展示了传统漏洞响应流程中的混乱场景：当关键 CVE 公告发布时，安全总监、平台工程师、合规经理和 CTO 在紧急会议中花费大量时间寻找数据、评估影响范围、确定补丁时间窗口。这个过程往往需要数小时，且难以扩展到处理多个 CVE。

为解决这一痛点，演讲者展示了他们构建的智能补丁自动化系统"Patchy"。该系统采用多代理模式，包含一个监督代理和三个专业代理（漏洞分析、补丁管理、合规分析），能够在几十秒内完成漏洞识别、影响评估、合规检查和自动化补丁部署。系统基于开源 SDK Strands 构建，部署在 Amazon Bedrock Agent Core 平台上，使用 Claude Sonnet 4.5 作为大语言模型。演讲者还详细分享了从简单单一代理到复杂多代理系统的迭代开发过程，强调了工具设计、提示工程和架构模式的最佳实践。

## 详细时间线

### 开场与问题背景 (00:00 - 05:30)

- **00:00** - 演讲者感谢观众提前到场，进行现场互动调查
- **01:15** - 约半数观众经历过 Log4j 事件，少数人在前线处理 CISO/CIO 的询问
- **02:00** - 演讲者描述 Log4j 事件的混乱场景，引出主题：如何用 Agentic AI 帮助组织更好地应对此类事件
- **02:45** - Justin Thomas 自我介绍，分享在 Log4j 事件中同时帮助多个客户的经历
- **03:30** - 介绍虚构案例公司"Manual Everything Corporation"

### 传统漏洞响应流程的痛点 (05:30 - 09:00)

- **05:30** - 场景描述：周五下午突发关键 CVE，需要对数千个实例打补丁
- **06:00** - 紧急会议中的典型对话：安全总监询问暴露情况和影响范围
- **06:30** - 平台工程师需要时间登录实例、检查账户、测试补丁
- **07:00** - 合规经理询问是否需要紧急补丁还是等待维护窗口
- **07:30** - CTO 对"数据寻宝游戏"感到沮丧，认识到需要更好的自动化和智能化
- **08:15** - 强调单个 CVE 评估就需要数小时，无法扩展到处理每月多个 CVE

### 智能代理解决方案介绍 (09:00 - 12:30)

- **09:00** - 提出解决方案：智能代理与工程师协同工作，识别、评估漏洞并执行修复
- **09:30** - 介绍演示环境：三个环境（dev、staging、prod），每个环境有不同的补丁计划和合规要求
- **10:15** - 展示现有 AWS 服务配置：Amazon Inspector、AWS Systems Manager、AWS Config
- **10:45** - 介绍智能补丁自动化系统的多代理模式：1个监督代理 + 3个专业代理
- **11:15** - 说明系统基于 Strands 开源 SDK 构建，部署在 Amazon Bedrock Agent Core 上

### 实时演示：Patchy 系统操作 (12:30 - 25:00)

- **12:30** - 开始终端演示，展示简单的聊天客户端界面
- **13:00** - 第一个查询：要求代理总结生产环境并提供合规要求信息
- **13:45** - 系统在几秒内返回完整的生产环境信息，包括实例 ID、配置和合规框架
- **14:30** - 第二个查询：检查生产环境中的漏洞
- **15:15** - 漏洞分析代理查询 AWS Inspector，在 37.6 秒内返回 50 个高严重性漏洞
- **16:00** - 系统总结最关键的 CVE（基于 CVSS 评分）及受影响的实例和合规风险
- **17:00** - 第三个查询：询问何时应该打补丁
- **17:45** - 补丁管理代理检查维护窗口和 SLA 要求
- **18:30** - 系统建议需要紧急补丁：SLA 要求 48 小时内修复（PCI-DSS 合规），但维护窗口在 24 天后
- **19:30** - 第四个查询：要求对 dev 环境应用紧急补丁
- **20:15** - 系统确认环境选择（从 prod 切换到 dev），展示上下文感知能力
- **21:00** - 补丁管理代理生成 Systems Manager 运行命令，针对 5 个 dev 实例
- **21:45** - 系统理解这是分阶段部署，提供继续到 staging 环境的选项
- **23:00** - 第五个查询：检查过去 30 天内错过了多少次 SLA
- **23:45** - 合规分析代理从 S3 获取报告并进行分析
- **24:30** - 系统报告 6 次 SLA 违规，提供详细的违规 CVE ID 和受影响团队

### 架构深入解析 (25:00 - 32:00)

- **25:00** - 切换到架构图，解释监督代理模式
- **25:45** - 说明专业代理各自的角色、指令集和工具
- **26:30** - 介绍 Claude Sonnet 4.5 作为大语言模型，提供推理能力
- **27:15** - 展示 AWS 服务集成：Inspector（漏洞发现）、Config（资源依赖）、Systems Manager（补丁合规和应用）
- **28:00** - 强调资源依赖理解对业务关键性决策的重要性
- **29:00** - 介绍 Strands SDK 的核心优势：简化代理构建，支持 Agentic Loop（代理循环）
- **30:00** - 解释 Agentic Loop：用户请求 → LLM 理解意图 → 工具调用 → 服务响应 → LLM 推理 → 循环直到完成
- **31:00** - 介绍 Agent Core 的三个关键原语：Runtime（托管代理）、Memory（上下文感知）、Observability（追踪和调试）

### 代码演示：从简单到复杂的迭代过程 (32:00 - 50:00)

- **32:00** - 说明开发方法：从简单开始，持续迭代，收集客户反馈
- **33:00** - 第一次迭代：展示最简单的 EC2 代理代码（6-7 行）
- **33:30** - 导入 Agent 类和 use_aws 工具
- **34:00** - 定义代理：名称 + 系统提示（"你是 EC2 助手"）+ 工具
- **34:45** - 运行第一个查询：列出 prod 环境中的所有 EC2 实例及其合规状态
- **35:30** - 展示 Agentic Loop 过程：LLM 理解意图 → 工具调用 → 自动纠错（语法错误）→ 尝试不同服务
- **36:45** - 指出问题：5-7 次工具调用，性能不理想
- **37:30** - 第二次迭代：引入更丰富的提示和专用工具
- **38:00** - 展示 Bedrock 模型配置：切换到 Nova 模型，控制 temperature 参数以提高确定性
- **39:00** - 展示自定义工具：使用 @tool 装饰器将 Python 函数暴露为工具
- **40:00** - 强调 docstring 的重要性：清晰的文档帮助 LLM 理解何时以及如何使用工具
- **41:00** - 展示改进的系统提示：行为指令、输出格式、工具使用说明
- **42:00** - 添加范围控制：拒绝非 EC2 相关查询，防止提示注入
- **43:00** - 运行改进后的代理：只需 2 次工具调用，更快更准确
- **44:30** - 测试范围控制：查询 Lambda 实例被拒绝
- **45:00** - 讨论单体 vs 微服务架构：代理变得越来越重，出现混淆和幻觉
- **46:00** - 决策原则：如果代理不是执行单一专业任务，就应该拆分

### 最终架构：Patchy 代码库详解 (50:00 - 58:00)

- **50:00** - 展示项目结构：agents 文件夹包含所有代理代码
- **50:30** - 介绍 4 个代理文件：patch_manager、supervisor、vulnerability_agent、compliance_analyst
- **51:00** - 展示 tools.py 文件：外部化工具以提高可维护性
- **51:45** - 深入 get_vulnerability_findings 工具
- **52:30** - 关键点 1：清晰结构化的 docstring，包含目的、参数、示例和返回值
- **53:15** - 关键点 2：返回字典对象而非字符串，提供更丰富的上下文
- **54:00** - 关键点 3：必需参数 vs 可选参数的重要性
- **54:45** - 示例说明：如果 severity 是必需参数，LLM 会向用户确认而不是假设
- **55:30** - 强调这种设计可以控制代理行为，减少假设和错误
- **56:30** - 提到补丁管理代理具有健康检查能力，会在补丁后验证应用和基础设施
- **57:15** - 说明系统会将所有信息上传到 S3 存储桶供合规分析使用

### 总结与最佳实践 (58:00 - 结束)

- **58:00** - 回顾从简单单一代理到复杂多代理系统的演进过程
- **58:30** - 强调关键学习点：工具设计、提示工程、架构模式选择
- **59:00** - 鼓励观众应用这些实践来构建自己的智能代理系统
- **59:30** - 重申目标：帮助团队更好地应对类似 Log4j 的关键安全事件