# AWS re:Invent 2025 - DynamoDB 高级数据建模会议总结

## 会议概述

本次会议由 AWS 数据英雄 Alex DeBrie 主讲,这是他第七年在 re:Invent 上分享 DynamoDB 相关内容。会议重点介绍了 DynamoDB 的高级数据建模技术,特别强调了两周前发布的多属性复合键(multi-attribute composite keys)这一重大功能更新。

Alex 强调 DynamoDB 是一个独特的数据库,具有三大核心优势:完全托管的运维模式、基于消费的定价模型以及任意规模下的一致性能表现。与传统关系型数据库不同,DynamoDB 需要开发者转变思维方式,预先了解访问模式并针对性地设计主键和索引结构。会议内容涵盖了数据建模的基础概念、二级索引的使用策略、模式演进以及常见的反模式分析。

整个演讲节奏很快,包含大量实用的技术细节和最佳实践建议,旨在帮助开发者更高效地使用 DynamoDB,降低成本并提升应用性能。

## 详细时间线与关键要点

### 开场与背景介绍 (0:00 - 5:30)

0:00 - 会议开始,Alex DeBrie 介绍这是他第七年在 re:Invent 演讲 DynamoDB 主题

1:15 - 推荐其他相关的 DynamoDB 演讲,包括 Craig Howard 关于服务中断的分享

2:30 - 介绍今天的议程:背景知识、二级索引使用、模式演进、反模式分析

3:45 - 强调会快速讲解,会后可在 Expo Hall 的 DynamoDB 展台继续交流

### DynamoDB 独特特性 (5:30 - 10:00)

5:30 - 介绍 DynamoDB 的三大独特优势

6:00 - 完全托管:区域级多租户自愈架构,用户无法"压垮"DynamoDB

7:15 - 基于消费的定价:按读写容量单位(RCU/WCU)和存储付费,而非按实例付费
- 每 4KB 读取消耗 1 个 RCU
- 每 1KB 写入消耗 1 个 WCU

8:30 - 一致的性能表现:无论表大小是 MB 级还是 PB 级,性能保持一致

### 架构基础 (10:00 - 18:00)

10:00 - 介绍 DynamoDB 的基本概念:表(Table)、项(Item)、主键(Primary Key)

11:30 - 主键类型:
- 简单主键:仅包含分区键(Partition Key)
- 复合主键:包含分区键和排序键(Sort Key)

13:00 - 分区机制:通过对分区键进行哈希运算,将数据分布到不同分区,实现常数时间复杂度的查询

15:00 - API 操作类型:
- 单项操作:需要完整主键
- 查询操作(Query):需要完整分区键,可对排序键设置条件
- 扫描操作(Scan):全表扫描,应谨慎使用

17:00 - 核心理念:每次请求获得一次连续的磁盘操作,而非像 SQL 那样的查询规划器

### 数据建模目标与流程 (18:00 - 25:00)

18:00 - 强调保持简单的重要性,避免过度复杂的设计

19:30 - 数据建模的两大元目标:
1. 维护数据完整性
2. 便于在需要时操作正确的数据

21:00 - 在 DynamoDB 中维护数据完整性:
- 使用有效的模式验证(如 TypeScript + Zod)
- 使用条件表达式维护约束
- 处理数据重复时考虑可变性和更新策略

23:00 - 数据建模流程:
1. 了解领域模型和实体
2. 明确访问模式
3. 掌握 DynamoDB 基础知识

### 二级索引与多属性复合键 (25:00 - 40:00)

25:00 - 引入二级索引的概念:使用不同主键重新组织数据的完全托管副本

26:30 - 介绍订单管理系统示例:仓库、分配人员、订单状态

28:00 - 传统方法的问题:使用合成键(如 gsi1pk, gsi1sk)
- 项大小膨胀(示例中占 92 字节,接近有效数据的一半)
- 应用建模复杂度高
- 排序复杂性(整数需要零填充)
- 更新逻辑困难

31:00 - 多属性复合键新特性(两周前发布):
- 分区键和排序键各支持最多 4 个属性
- 直接使用表中现有属性,无需创建合成键
- 消除项大小膨胀问题

34:00 - 查询规则:
- 必须指定所有分区键属性
- 排序键遵循"从左到右,不跳过,在第一个范围条件处停止"的规则

37:00 - 限制:不适用于重载索引(overloaded indexes)模式,因为不同实体类型可能没有相同的属性名

39:00 - 建议:几乎所有场景都应使用多属性复合键,现有表也可考虑迁移以节省成本

### 二级索引成本管理 (40:00 - 45:00)

40:00 - 强调二级索引是"为读优化而付出写代价"的机制

41:00 - 写操作成本是读操作的 5-20 倍(取决于项大小)

42:00 - 成本管理建议:
- 使用稀疏索引(sparse indexes):仅在需要时写入索引属性
- 使用投影(projections)控制索引中包含的属性
- 考虑使用 DynamoDB Streams + Lambda 进行异步索引更新

### 模式演进 (时间戳未完整覆盖)

45:00+ - 讨论如何在 DynamoDB 中处理模式变更
- 应用层管理模式而非数据库层
- 使用版本控制策略
- 考虑向后兼容性

### 反模式与最佳实践 (时间戳未完整覆盖)

后续部分 - 介绍常见的 DynamoDB 反模式及替代方案
- 避免过度使用扫描操作
- 正确使用条件表达式
- 合理设计分区键以避免热分区

### 总结

会议结束 - Alex 强调使用 DynamoDB 基础功能(单项操作、查询、适量二级索引、偶尔使用事务)就能满足大多数需求,鼓励开发者保持简单,充分利用新的多属性复合键特性来简化建模并降低成本。