# AWS re:Invent 2025 - AWS Cloud WAN 路由策略会议总结

## 会议概述

本次会议重点介绍了 AWS Cloud WAN 的全新路由策略功能，这是一个 400 级别的技术深度会议。演讲者包括 AWS 的产品经理和 Airbnb 的高级网络工程师，他们分享了 Cloud WAN 的核心功能、实际应用案例以及最新发布的高级路由策略能力。

Cloud WAN 作为网络的"大脑"，提供了强大的混合云连接能力，支持动态路由、多区域连接和流量检查。新发布的路由策略功能解决了客户在大规模网络环境中面临的路由传播控制、流量路径优化和路由扩展性等关键挑战。该功能基于经典的匹配-动作（match-action）模式，提供了细粒度的路由控制能力，包括路由过滤、路由汇总和 BGP 属性修改等功能。

Airbnb 作为早期采用者分享了他们的成功经验：通过迁移到 Cloud WAN，他们每年节省数百万美元成本，将新数据中心部署时间从数周缩短至两天，并显著提升了运维效率。新的路由策略功能将进一步帮助他们优化网络架构，减少静态路由配置，简化防火墙检查设计。

## 详细时间线与关键要点

### 开场介绍 (00:00 - 02:30)
- **00:00** - 会议开始，欢迎参加 AWS re:Invent 2025
- **00:15** - 介绍演讲嘉宾：AWS Cloud WAN 团队和 Airbnb 高级网络工程师 Chiun
- **00:45** - 会议主题：AWS Cloud WAN 路由策略新功能发布
- **01:15** - 强调混合云网络连接的复杂性挑战

### Cloud WAN 核心功能快速回顾 (02:30 - 05:45)
- **02:30** - Cloud WAN 架构概述：每个区域的核心网络边缘（CNE）
- **03:00** - 支持的连接类型：Direct Connect、Site-to-Site VPN、SD-WAN Connect 附件
- **03:30** - 动态路由特性：无需配置静态路由
- **04:00** - 通过策略定义网络：三个位置自动配置三个 CNE 并完全互联
- **04:30** - 网段（Segments）概念：完全隔离的路由边界
- **05:00** - 附件策略：使用标签自动关联附件到正确的网段
- **05:30** - 网段间路由共享机制

### 服务插入功能回顾 (05:45 - 07:30)
- **05:45** - 服务插入功能介绍：在流量路径中插入网络设备
- **06:00** - 双跳模式（Dual-hop mode）：流量在每个检查区域的两个 VPC 中都被检查
- **06:30** - 单跳模式（Single-hop mode）：使用边缘覆盖确定性地发送流量到特定检查 VPC
- **07:00** - 互联网出口流量检查：为没有检查 VPC 的区域指定检查位置
- **07:30** - 推荐查看去年 re:Invent 会议以了解更多细节

### Airbnb 使用案例分享 (07:30 - 15:00)
- **07:30** - Airbnb 工程师 Chiun 开始分享
- **08:00** - 六年前的问题：为什么网络配置不能像软件开发一样简单？
- **08:30** - Airbnb 背景：全球平台，托管超过 20 亿客人，7,300 名员工
- **09:00** - 2013 年网络架构：物理数据中心作为骨干网络
- **09:30** - 2021 年转折点：物理数据中心接近生命周期终点
- **10:00** - 初始概念验证：使用 Transit Gateway 全网状连接
- **10:30** - 选择 Cloud WAN：更好的动态路由支持和自动化能力
- **11:00** - 当前架构：Cloud WAN 作为全球骨干网络
- **11:30** - Layer 7 防火墙集成：检查 VPC 用于流量控制
- **12:00** - Terraform 企业支持：通过代码部署和管理网络
- **12:30** - 迁移成功：生产网络已在 Cloud WAN 上运行近两年

### Airbnb 获得的收益 (13:00 - 14:30)
- **13:00** - 成本节省：每年节省数百万美元（取消物理数据中心和电路）
- **13:30** - 自动化：通过代码部署和管理整个网络
- **13:45** - 内置版本控制和轻松回滚能力
- **14:00** - 快速部署：在新区域部署数据中心仅需两天（以前需要数周到数月）
- **14:15** - 运维效率提升：更高的正常运行时间和集中监控
- **14:30** - AWS 处理底层基础设施，团队可专注于战略性任务

### Airbnb 面临的挑战 (14:30 - 15:30)
- **14:30** - 仍需配置一些静态路由（主要用于防火墙检查）
- **14:45** - 当前需要双重检查设计，希望改进
- **15:00** - 团队希望自主管理到 Cloud WAN 的路由
- **15:15** - 需要更简单的路由过滤功能
- **15:30** - 新的服务插入功能和高级策略路由有望解决这些挑战

### 路由策略功能介绍 (15:30 - 18:00)
- **15:30** - AWS 产品经理 Shridhar 开始介绍路由策略
- **15:45** - 感谢 Airbnb 团队作为早期采用者并提供反馈
- **16:00** - 路由策略：几周前刚发布的全新功能
- **16:15** - 提供高级路由能力以控制网络内的路由传播
- **16:30** - 帮助更好地管理路由并根据个性化需求定制网络
- **17:00** - 典型 Cloud WAN 网络示例：三个区域、三个环境（prod、dev、hybrid）
- **17:30** - BGP 能力附件：DX、VPN、SD-WAN Connect、Transit Gateway Peering
- **18:00** - 动态路由在所有附件、跨区域和跨网段传播

### 路由策略解决的挑战 (18:00 - 20:00)
- **18:00** - 挑战一：不受控制的路由传播
- **18:30** - 客户需要在所有分发点控制路由传播
- **18:45** - 最小化传播的爆炸半径
- **19:00** - 挑战二：不确定的流量模式
- **19:15** - 多路径场景需要路径偏好控制（如 SD-WAN vs Direct Connect）
- **19:30** - 挑战三：路由扩展性问题
- **19:45** - 防止向合作伙伴网络传播过多路由导致路由器限制
- **20:00** - 挑战四：故障排查需要高级可见性

### 路由策略核心功能 (20:00 - 22:30)
- **20:00** - 功能一：细粒度路由控制
- **20:15** - 在每个分发点（附件、跨区域、跨网段）提供控制
- **20:30** - 功能二：优化流量模式
- **20:45** - 修改高级 BGP 属性（local preference、path prepend）
- **21:00** - 影响入站流量路径，防止非对称路由
- **21:15** - 功能三：可见性
- **21:30** - 完全查看路由信息库（RIB）
- **21:45** - 查看所有高级 BGP 属性用于故障排查
- **22:00** - 主动确保网络按策略运行
- **22:30** - 三大特性详细说明

### 路由过滤功能 (22:30 - 24:00)
- **22:30** - 允许或丢弃路由/前缀（入站和出站方向）
- **22:45** - 支持所有 BGP 能力附件类型（VPN、DX、Transit Gateway、Connect）
- **23:00** - VPC 附件也支持（仅入站过滤）
- **23:15** - 控制跨网段的路由传播
- **23:30** - 控制 CNE 到 CNE 之间的路由传播
- **23:45** - 基于匹配-动作模式
- **24:00** - 匹配条件：前缀、AS 路径中的 ASN、BGP 社区、MED 值

### 路由汇总和 BGP 属性修改 (24:00 - 25:30)
- **24:00** - 路由汇总功能：防止扩展性问题
- **24:15** - 在出站方向通告汇总路由而非多个前缀
- **24:30** - 支持所有 BGP 能力附件
- **24:45** - BGP 属性修改功能
- **25:00** - 修改 local preference、MED 值、BGP 社区、AS 路径
- **25:15** - 支持入站和出站方向
- **25:30** - 可在所有 BGP 能力附件、跨网段和跨区域使用

### 路由策略定义步骤 (25:30 - 28:00)
- **25:30** - 两大步骤：定义路由策略、关联到分发点
- **25:45** - 步骤一：定义匹配条件
- **26:00** - 匹配条件选项：IPv4/IPv6 前缀、CIDR 范围内的前缀、前缀列表
- **26:15** - 客户更喜欢使用前缀列表（命名引用，易于管理）
- **26:30** - 可匹配 AS 路径中的 ASN、BGP 社区、MED 值
- **26:45** - 步骤二：定义动作
- **27:00** - 过滤动作：丢弃或允许匹配的前缀
- **27:15** - 汇总路由（出站方向）
- **27:30** - AS 路径操作：添加/删除/替换 ASN
- **27:45** - 社区操作：添加/删除社区
- **28:00** - 设置 MED 值或 local preference

### 策略定义示例 (28:00 - 29:30)
- **28:00** - 示例：匹配前缀 192.168.0.0/16 并丢弃
- **28:15** - 策略结构：唯一策略编号、策略名称、描述
- **28:30** - 策略方向：出站或入站
- **28:45** - 出站：从 CNE 网段路由表到远程站点的路由传播
- **29:00** - 入站：从远程站点到 CNE 网段路由表的通告
- **29:15** - 规则定义：唯一规则编号、匹配条件、动作
- **29:30** - 示例：匹配 192.168.0.0/16，动作为丢弃

### 策略关联到分发点 (29:30 - 32:00)
- **29:30** - 跨网段关联：在网段动作中引用路由策略
- **29:45** - 示例：prod 网段共享到 dev 网段时应用出站过滤
- **30:00** - 过滤掉 192.168.0.0/16 前缀
- **30:15** - 跨区域关联：新的网段动作 "associate routing policy"
- **30:30** - 指定源区域、目标区域和路由策略
- **30:45** - 示例：US East 1 到 US West 2 应用出站路由过滤
- **31:00** - 附件关联：使用路由策略标签（label）
- **31:15** - 标签是间接引用，类似 AWS 标签
- **31:30** - 将路由策略映射到标签，然后将标签关联到附件
- **31:45** - 通过附件路由策略规则创建标签映射
- **32:00** - 使用 API 将标签关联到附件

### 策略和标签关系 (32:00 - 33:00)
- **32:00** - 路由策略到标签：多对一关系
- **32:15** - 多个路由策略可映射到单个标签
- **32:30** - 标签到附件：一对多关系
- **32:45** - 同一标签可关联到多个附件
- **33:00** - 示例：同一出站路由过滤器可应用于多个附件

### 可观测性功能 (33:00 - 33:45)
- **33:00** - 完全查看路由信息库（RIB）
- **33:15** - 可查询特定网段或边缘位置的所有路由信息
- **33:30** - 显示所有高级 BGP 属性
- **33:45** - 用于故障排查和管理

### 演示环境介绍 (33:45 - 35:30)
- **33:45** - 演示环境设置：三个区域、三个网段
- **34:00** - Prod VPC 使用 10.x.x.x 范围
- **34:15** - Dev VPC 使用 172.x.x.x 范围
- **34:30** - 模拟本地环境：使用无隧道 Connect 的 SD-WAN 连接
- **34:45** - 通告 164 条路由
- **35:00** - 用例一：路由汇总
- **35:15** - 目标：将从 VPC 学习的路由在发送到本地时进行汇总
- **35:30** - 将 10.0、10.1、10.2 prod VPC 路由汇总为 10.0.0.0/14

### 路由汇总演示 - 策略创建 (35:30 - 38:00)
- **35:30** - 实施步骤一：创建路由策略匹配 VPC CIDR 并汇总
- **35:45** - 实施步骤二：将路由策略应用到相关附件
- **36:00** - 路由策略名称：summarize-prod
- **36:15** - 使用前缀列表管理 VPC CIDR（更易管理）
- **36:30** - 前缀列表：prod-VPCs
- **36:45** - 动作：汇总到 10.0.0.0/14
- **37:00** - 使用附件路由策略规则关联策略到标签
- **37:15** - 将标签关联到附件
- **37:30** - 进入 AWS 控制台开始演示
- **37:45** - 查看拓扑树：三个 AWS 区域
- **38:00** - 验证设置：US East 1 和 EU West 1 的 dev 和 prod VPC

### 路由汇总演示 - 控制台操作 (38:00 - 41:30)
- **38:00** - 查看混合附件：Connect 附件和 Connect peers
- **38:15** - 验证 BGP 状态：正常运行
- **38:30** - 返回核心网络，选择最新策略
- **38:45** - 编辑 JSON 策略
- **39:00** - 当前策略：标准配置，定义边缘位置和网段，无路由策略
- **39:15** - 添加路由策略到策略中
- **39:30** - 复制路由策略语法到策略
- **39:45** - 添加附件路由策略规则
- **40:00** - 策略进入待生成状态
- **40:15** - 查看前缀关联：prod-VPCs 前缀列表已与 Cloud WAN 关联
- **40:30** - 查看前缀列表内容：10.0、10.1、10.2 CIDR
- **40:45** - 查看 Connect 附件：路由策略标签已关联
- **41:00** - 检查 SD-WAN 设备当前接收的路由
- **41:15** - 当前接收：10.0、10.1、10.2（汇总尚未生效）
- **41:30** - 可以看到完整的 AS 路径（CNE ASN）

### 路由汇总演示 - 执行和验证 (41:30 - 43:30)
- **41:30** - 返回策略并执行
- **41:45** - 查看、应用和设置变更集
- **42:00** - 等待策略执行完成
- **42:15** - 策略执行成功
- **42:30** - 运行 show ip bgp summary 命令
- **42:45** - 验证结果：现在接收汇总路由 10.0.0.0/14
- **43:00** - 之前的路由（10.0、10.1、10.2）已消失
- **43:15** - 路由路径仅显示直接连接的 CNE
- **43:30** - 汇总功能正常工作

### 路由汇总总结 (43:30 - 44:30)
- **43:30** - 单个前缀被抑制
- **43:45** - 仅通告汇总路由
- **44:00** - 未指定的前缀（172 路由）继续正常通告
- **44:15** - 汇总路由在首次匹配时创建
- **44:30** - 动态通告（通过 BGP），所有匹配前缀删除后撤回

### 路由汇总特性说明 (44:30 - 45:00)
- **44:30** - 汇总路由被视为新路由
- **44:45** - 由 CNE 发起
- **45:00** - 演示部分结束

本次会议全面展示了 AWS Cloud WAN 路由策略的强大功能，通过实际演示证明了其在简化网络管理、提升运维效率方面的巨大价值。