# AWS re:Invent 2025 会议总结：从定点混沌测试到持续验证的转型

## 会议概述

本次闪电演讲由AWS技术客户经理Shenlao和Capital One可靠性工程负责人Troy Cos共同主持，重点介绍了Capital One如何从传统的定点混沌测试（point-in-time chaos testing）转型为持续验证（continuous verification）的实践经验。演讲强调了在当今复杂的分布式系统环境中，仅依靠季度性的游戏日（game day）测试已经无法满足快速变化的系统需求。

Capital One通过构建自动化可靠性验证框架，实现了混沌工程的规模化应用。这种转型的核心理念是：在复杂分布式系统中，熵是恒定存在的——代码每天都在变化，配置会漂移，依赖关系会更新。如果只在季度游戏日进行测试，测试之间会产生可靠性缺口，应用程序的可靠性会因新变更而逐渐降低，从而引入新的脆弱性。持续验证通过将测试速度与部署速度相匹配来弥补这一缺口，确保系统在持续变化中保持韧性。

演讲还深入探讨了实施持续混沌工程所需的文化转变、技术架构和治理机制，特别强调了在受监管的金融行业环境中如何安全地进行混沌测试，以及如何通过自动化工具赋能工程团队在不影响客户体验的前提下提升系统可靠性。

## 详细时间线与关键要点

### 开场介绍 (0:00-1:30)
- **0:00** - 会议开始，主持人欢迎参会者
- **0:30** - Shenlao自我介绍：AWS战略客户部门技术客户经理团队负责人
- **0:50** - Troy Cos自我介绍：Capital One可靠性工程负责人，主要工作是帮助团队构建更可靠的应用程序

### 会议主题与议程 (1:30-2:30)
- **1:30** - 介绍会议主题：Capital One如何从定点混沌测试转型为持续验证
- **1:45** - 议程概览：
  - 混沌工程的重要性（Why）
  - Capital One的转型之旅
  - 自动化可靠性验证框架
  - 如何规模化混沌工程并衡量成果

### 混沌工程的重要性 (2:30-5:30)
- **2:30** - 核心观点：在复杂环境中不能仅靠希望，需要确切知道系统能否正常工作
- **3:00** - 第一原则：在开发早期融入混沌测试，确保韧性不是事后考虑，而是开发流程的一部分
- **3:30** - 第二原则：设计时考虑故障，确保应用程序在故障时能够优雅降级
- **3:45** - 消除单点故障：模拟网络和系统条件（延迟、超时、丢包、断连），测试应同时包含确定性和随机性
- **4:15** - 第三原则：主动预测生产级故障，模拟虚拟机、可用区甚至整个区域的丢失
- **4:45** - 运行这些测试确保应用程序能够优雅降级并快速恢复

### 定点测试的挑战 (5:30-7:00)
- **5:30** - 核心问题：在复杂分布式系统中，熵是恒定的
- **5:45** - 代码每天变化，配置漂移，依赖关系更新
- **6:00** - 如果只在季度游戏日测试，测试之间会产生可靠性缺口
- **6:20** - 新变更会逐渐降低应用程序可靠性，引入新的脆弱性
- **6:40** - 解决方案：持续验证弥补这一缺口，将测试速度与部署速度相匹配

### Capital One面临的挑战 (7:00-9:30)
- **7:00** - Troy开始讲述Capital One的转型历程
- **7:15** - 系统不断增长：新微服务上线，所有系统互联互通，依赖关系复杂
- **7:45** - 不能做的事情：
  - 不能建立僵化系统（修复一次就不管）
  - 不能假设存在一致的正常路径
  - 不能预测所有应用程序的故障模式
- **8:30** - 监管要求：作为金融机构必须始终保持合规，客户需要随时访问银行账户

### 必须改变的文化 (9:30-11:00)
- **9:30** - 文化转变的核心：如何将学习和发现嵌入系统并持续运行
- **9:50** - 灵活性：理解系统在不同状态下会有不同的故障模式（例如主数据库不活跃时的处理）
- **10:20** - 治理：不想为了修复所有问题而停止一切工作
- **10:40** - 目标是以一致、自动化的方式进行监管和管理，让系统适应而非减慢手动变更、CAB等流程

### 自动化的必要性 (11:00-12:30)
- **11:00** - 实现这一目标必须依靠自动化
- **11:15** - Troy强调：自动化不能解决所有问题，但在这种情况下是必需的
- **11:40** - 关键在于构建自动化和工具来赋能工程团队
- **12:00** - 虽然实施曲线陡峭，但能够将团队从季度游戏日转变为始终在线的持续方法

### 四个关键维度 (12:30-18:00)

#### 维度一：受控的能力分发 (12:30-14:30)
- **12:30** - 第一维度：以受控方式向工程团队提供能力
- **12:50** - 必须内置审计、合规性，并允许控制爆炸半径
- **13:10** - 不能让每个工程师随意使用故障注入模拟器（FIS）关闭系统
- **13:30** - 特别是从低环境测试逐步推进到生产环境时，必须有这些控制和安全机制
- **13:50** - Capital One使用AWS FIS作为底层工具实现各种混沌测试
- **14:10** - 重要的是超越传统的计算层测试，跨应用程序的不同层测试假设（计算层、数据库层、网络层等）
- **14:30** - 自助服务平台还能构建FIS可能没有的自定义能力

#### 维度二：紧急停止按钮 (14:30-15:30)
- **14:30** - 第二维度：需要紧急停止按钮
- **14:45** - 没有人想让失控的列车摧毁银行
- **15:00** - 确保有遥测和数据来理解"情况正在恶化，需要停止"
- **15:15** - 当假设失败时能够中止并停止
- **15:30** - 能够回滚到之前的状态，撤销任何注入

#### 维度三：服务级别目标 (15:30-17:00)
- **15:30** - 第三维度：不能击中没有的目标——服务级别指标（SLO）的重要性
- **15:50** - 如果没有SLO，强烈建议从这里开始投资
- **16:10** - 即使没有SLO，混沌测试也是学习SLO应该是什么的好机制
- **16:30** - 需要安全边界来知道可以进行混沌测试
- **16:45** - 不要在应用程序处于混乱或最近失败、客户不满意时开始混沌测试
- **17:00** - 在两个极端之间有学习机会：例如注入延迟时，如果可用性下降，说明对截止时间或延迟的理解不正确

#### 维度四：持续运行 (17:00-18:00)
- **17:00** - 第四维度：将一切设置为运行状态
- **17:15** - 仍然鼓励进行主动混沌测试游戏日活动，它们对学习和测试非常有价值
- **17:30** - 一旦混沌运行起来，就可以定期设置它
- **17:45** - 系统有不同的行为，根据不同日期有不同的"情绪波动"
- **18:00** - 发现这些边缘情况能够在问题浮出水面并发展成更大问题之前解决

### 验证与测试的区别 (18:00-19:30)
- **18:00** - 真正验证的是：系统是否按预期行为运行
- **18:20** - 测试仍然有价值，但如果不持续运行，Shenlao之前提到的缺口就会显现
- **18:40** - 修复问题后，时间流逝，同样的事情又会发生
- **19:00** - 这会发生是因为系统的变化和这类系统中自然存在的熵
- **19:30** - 从"破坏东西"（对混沌工程的误解）转变为"我相信我的系统能够承受这种程度的延迟、拒绝或降级"

### 实施成果 (19:30-22:00)
- **19:30** - 假设四个维度都到位，最重要的成果是：**工程团队的信心**
- **19:50** - 在危机和混乱的事件情况下，总会有自然的犹豫："我应该做什么？应该故障转移吗？"
- **20:20** - 建立信心的最佳方式就是实际去做，并持续做
- **20:40** - 在工程团队中建立信心，消除系统的脆弱性（不仅在技术层面，也在人的层面）
- **21:00** - 当凌晨3点被叫醒确保系统工作时，需要有信心按下那个按钮
- **21:20** - 最终目标：更好的可靠性，对系统更多的信任，以及韧性
- **21:40** - 能够快速恢复，因为更了解系统的行为
- **22:00** - 已经有机会理解故障时会发生什么，对系统更加熟悉，知道如何应对

### 总结与关键要点 (22:00-24:30)
- **22:00** - 基础是安全：首先建立大型安全保障
- **22:15** - 确保知道自己在做什么，有审计、测试、日志，所有监控都到位
- **22:30** - 这解锁了下一级别，能够开始进行更高级的测试，将事物设置为运行状态
- **22:50** - 获取测试实际成功的证据
- **23:10** - 验证vs测试：不仅仅是破坏东西，而是说"我相信我的系统能够承受这种程度的延迟、拒绝或降级，并且会以某种方式行为"
- **23:40** - 例如：如果计算关闭会扩展，如果主数据库无响应会切换到读副本
- **24:00** - 特别是随着时间推移，要确保这些机制到位并有效
- **24:15** - 在关键时刻发现它不工作不是发现的最佳时机
- **24:30** - 整体主题：持续运行，防止可靠性缺口

### 结束与互动 (24:30-25:30)
- **24:30** - 感谢听众
- **24:45** - Capital One展位位于Expo B入口附近，欢迎参观
- **25:00** - Troy全天都会在展位
- **25:15** - 开放问答环节
- **25:30** - 会议结束

## 核心要点总结

1. 持续验证的必要性：在快速变化的分布式系统中，定点测试无法跟上变化速度
2. 四大支柱：受控分发、紧急停止、SLO指标、持续运行
3. 文化转变：从被动响应到主动验证，从季度测试到持续运行
4. 工程师信心：通过持续实践建立团队在危机时刻的决策信心
5. 安全第一：在受监管环境中，必须有完善的审计、合规和控制机制