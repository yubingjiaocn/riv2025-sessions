# AWS re:Invent 2025 - COP350: 构建和验证云控制

## 会议概述

本次会议由AWS高级解决方案架构师Pal Patel和首席解决方案架构师Rudolfo Brennis主讲,重点探讨如何在AWS环境中构建和验证云治理控制。会议的核心主题是如何利用生成式AI加速云治理流程,使治理从"守门人"转变为"赋能者"。演讲者通过虚构角色Neeta(云服务工程师)和Bob(AI工程师)的实际场景,展示了如何使用Amazon Q Developer(Kiro CLI)结合AWS治理服务(CloudTrail、Config、Control Tower)来自动化和简化治理任务。

会议强调了现代云环境面临的核心挑战:企业需要快速创新,但治理和合规性检查往往拖慢部署速度。传统上,团队可以在几分钟内启动价值数十万美元的云资源,但跟踪所有权、维护治理和确保合规性却需要大量时间。演讲者提出的解决方案是通过生成式AI工具自动化这些流程,包括自动生成Config规则、实施"左移"(Shift Left)安全策略、以及通过自然语言交互完成复杂的多账户治理任务。整个会议通过三个实际演示展示了如何使用Kiro CLI和MCP服务器来实现这些目标。

## 详细时间线

### 开场与背景介绍
- **00:00:00** - 会议开始,Pal Patel自我介绍,担任AWS云治理专业高级解决方案架构师
- **00:01:00** - 通过Amazon购物车的类比引入治理护栏概念,说明需要智能护栏来防止过度支出
- **00:03:30** - 介绍会议议程:探讨创新压力、AWS治理服务基础、最新发布功能、以及生成式AI如何加速治理

### 治理挑战与机遇
- **00:04:45** - 阐述核心问题:企业期望速度,但治理需要保证,两者运行速度不同
- **00:05:30** - 提出生成式AI如何帮助加速治理:从手动审查到自动化合规检查,从耗时数天到自然语言描述即可生成Config规则
- **00:06:15** - 介绍虚构角色Neeta,负责管理300多个AWS账户的合规性

### Neeta面临的挑战
- **00:07:00** - 挑战一:随着环境和账户增长,保持一致的控制规模化困难
- **00:07:30** - 挑战二:治理主要是被动的,缺乏预防非合规操作的能力
- **00:08:00** - 挑战三:虽然使用Control Tower账户工厂,但应用账户自定义需要大量时间和精力

### AWS治理服务基础(Bob讲解)
- **00:08:45** - 介绍Bob的角色,与运营团队合作构建治理策略
- **00:09:15** - CloudTrail服务:捕获控制台登录、控制平面事件、数据事件、网络活动等
- **00:10:30** - CloudTrail新功能:数据事件洞察(Data Events Insights),可识别异常活动,提供5分钟窗口聚合
- **00:11:45** - CloudTrail Lake:托管数据存储,可聚合整个组织的数据,事件大小限制从256KB增加到1MB

### AWS Config服务
- **00:13:00** - Config服务介绍:聚合CloudTrail数据,提供资源配置历史和元数据
- **00:13:45** - Config允许评估资源配置是否符合特定标准,提供审计能力
- **00:14:30** - Config新功能:服务链接记录器(Service Link Recorder),允许AWS服务代表用户采取行动
- **00:15:15** - CloudWatch现在使用Config数据审计遥测数据,Security Hub也集成了此功能
- **00:16:00** - Config覆盖范围扩展:新增50多个服务和50多个托管规则

### Control Tower服务
- **00:17:00** - Control Tower介绍:部署Landing Zone,遵循最佳实践进行账户配置和供应
- **00:17:45** - 提供控制目录,可部署检测和预防机制,包括服务控制策略(SCP)和资源控制策略
- **00:18:30** - Control Tower新功能:独立访问的综合控制目录,无需先建立Landing Zone
- **00:19:00** - 账户注册功能,允许将现有账户迁移到Control Tower
- **00:19:30** - 服务链接Config规则,确保成员账户中的规则不被篡改

### 生成式AI与Amazon Q Developer
- **00:20:15** - 介绍如何通过生成式AI保持服务更新的步伐
- **00:20:45** - Amazon Q Developer介绍:AI驱动的编程助手,帮助开发者编写代码、运行测试、访问AWS API
- **00:21:30** - 可在AWS CLI和CloudShell中安装,支持MCP(Model Context Protocol)服务
- **00:22:15** - 支持自然语言对话来制定策略,AWS提供托管MCP服务器
- **00:23:00** - CloudTrail MCP服务器示例:无需了解查询语法即可运行调查

### 演示一:创建组织Config规则
- **00:24:00** - 展示测试环境:标准Control Tower Landing Zone,包含5个组织单元和18个账户
- **00:25:00** - 启动Kiro CLI聊天,加载AWS MCP Core Server
- **00:25:45** - 展示MCP配置文件:定义Solutions Architect和Foundation两个角色
- **00:26:30** - Solutions Architect角色提供知识、AWS API、定价、成本浏览器等访问
- **00:27:15** - 介绍"better_understand"工具,帮助将自然语言意图转换为AWS术语
- **00:28:00** - 加载自定义Config规则知识库,使用向量索引进行语义搜索
- **00:29:00** - 请求创建检测具有公共IP地址的EC2实例的Config规则
- **00:30:00** - Agent搜索知识库和AWS文档,检查现有规则以避免重复
- **00:31:00** - Agent找到托管Config规则"ec2-instance-no-public-ip"
- **00:32:00** - 创建CloudFormation模板和部署脚本
- **00:33:00** - 首次部署失败:资源类型不支持规则ARN,仅返回规则名称
- **00:34:00** - Agent自动识别问题并修复模板,删除失败的堆栈
- **00:35:00** - 第二次部署失败:频率参数对于变更触发的规则无效
- **00:36:00** - Agent再次自动修复并重新部署
- **00:37:00** - 第三次部署成功,提供所有步骤和解决方案的摘要
- **00:38:00** - 查询Config聚合器,发现3个跨2个账户的非合规实例

### 演示二:实施左移策略
- **00:39:30** - 介绍左移策略:在开发生命周期早期检测问题
- **00:40:15** - 两种控制类型:预防性控制(SCP)和主动控制(CloudFormation Guard Hooks)
- **00:41:00** - 创建专门的"Shift Left Specialist" Agent
- **00:41:45** - Agent定义为安全架构师,专门创建左移等效控制
- **00:42:30** - 加载知识和API MCP服务器,添加左移最佳实践指南作为上下文
- **00:43:15** - 查询前两个具有最多非合规资源的Config规则
- **00:44:00** - 识别出两个规则:KMS标签密钥和Lambda X-Ray追踪
- **00:45:00** - 使用编辑器命令输入详细提示,要求通过CFCT管道部署
- **00:46:00** - 对于KMS规则创建SCP,仅针对带有成本和环境标签的密钥
- **00:47:00** - 对于Lambda规则创建CloudFormation Guard Hook,仅部署到特定OU
- **00:48:00** - Agent访问CFCT清单文件并创建/更新文件
- **00:49:00** - 展示Git摘要,显示所做的更改
- **00:50:00** - 解释遇到的挑战:CloudFormation Guard Hook评估整个堆栈的鸡生蛋问题
- **00:51:00** - Agent通过搜索AWS文档找到跳过标签参数的解决方案
- **00:52:00** - 推送提交,触发CFCT Code Pipeline
- **00:53:00** - 检查Code Pipeline状态,显示正在进行中
- **00:54:00** - 等待后再次检查,管道成功完成所有6个阶段
- **00:55:00** - 验证Lambda Guard Hook控制,仅部署到Labs OU
- **00:56:00** - Agent识别需要访问成员账户,假定Control Tower执行角色
- **00:57:00** - 打印验证测试结果:合规Lambda成功部署,非合规Lambda被阻止

### 演示三:创建AWS账户并部署SRA解决方案
- **00:58:30** - 介绍SRA(安全参考架构):AWS提供的实施安全服务的整体指南
- **00:59:15** - 展示SRA对齐补丁解决方案架构:使用Systems Manager Patch Manager和维护窗口
- **01:00:00** - 创建"Create AWS Account" Agent,专门负责账户供应和自定义
- **01:00:45** - 加载整个SRA GitHub存储库到知识库,使用向量索引
- **01:01:30** - 添加账户自定义最佳实践到上下文文件
- **01:02:00** - 使用编辑器提供创建AWS账户所需的参数:邮箱、OU、账户名称等
- **01:03:00** - Agent识别使用Control Tower的Service Catalog产品创建账户
- **01:03:45** - 搜索可用产品和供应参数,验证所有必需参数已提供
- **01:04:30** - Agent识别这是"重大变更",根据上下文定义请求确认
- **01:05:00** - 确认后创建Service Catalog产品,供应AWS账户
- **01:06:00** - 检查最新创建的账户状态,账户创建成功
- **01:06:30** - 准备应用SRA对齐补丁解决方案自定义(演示在此处结束)

### 总结
- **01:07:00** - 会议展示了如何使用生成式AI工具(Kiro CLI)结合AWS治理服务自动化复杂的治理任务
- **01:07:30** - 强调了从被动治理转向主动和预防性治理的重要性
- **01:08:00** - 演示了如何通过自然语言交互大幅减少治理任务的时间和复杂性