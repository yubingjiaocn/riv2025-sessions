# AWS re:Invent 2025 Karpenter 成本优化会议总结

## 会议概述

本次会议由 Zesti 公司联合创始人兼 CTO Alexi 主讲，重点介绍了如何利用 Karpenter 实现 Kubernetes 集群的成本效率和规模化自适应管理。会议时长约 15 分钟，面向已在生产环境中使用 Karpenter 的用户，特别是那些利用 Spot 实例进行成本优化的团队。

演讲者强调了在云环境中平衡稳定性、性能和成本的重要性。通过合理配置 Karpenter，可以避免资源过度配置或配置不足的问题。会议详细介绍了多个实用的最佳实践，包括整合策略、实例选择、Spot 实例管理、Graviton 架构应用等。最后，Alexi 介绍了 Zesti 平台如何通过自动化优化帮助企业实现至少 70% 的集群成本节省。

整个会议内容实用性强，提供了可直接应用于生产环境的配置示例和策略建议，旨在帮助 DevOps 和平台工程师在保证服务质量的前提下显著降低云基础设施成本。

## 详细时间线

00:00 - 00:45 - 开场与观众互动
- 欢迎参会者，介绍会议主题：Karpenter 的成本效率和规模化特性
- 调查观众使用 Karpenter 的情况，特别是 Spot 实例管理
- 演讲者自我介绍：Alexi，Zesti 联合创始人兼 CTO

00:45 - 01:30 - 云成本优化的挑战
- 讨论稳定性、性能与成本之间的平衡问题
- 说明过度配置和配置不足的风险
- 强调 DevOps 和平台工程师需要找到"最佳平衡点"

01:30 - 03:00 - Karpenter 整合策略（Consolidation Policies）
- 介绍整合策略的工作原理：监控节点利用率并安全终止未充分利用的节点
- **最佳实践 1**：使用 PDB（Pod Disruption Budgets）控制同时整合的副本数量
- **最佳实践 2**：配置整合延迟（Consolidation Delays）避免短期流量下降时的过度反应
- 提供配置示例，展示如何在高峰流量时段避免整合

03:00 - 05:00 - 实例选择策略
- 强调为 Karpenter 提供合适的实例类型选择范围
- **多样化原则**：跨不同实例家族、代数和规格提供更多选择
- **避免极端**：排除过小的实例（增加网络开销和调度复杂性）和过大的实例（降低整合效率）
- 建议持续监控集群行为，根据实际情况定义"过小"和"过大"的标准

05:00 - 05:45 - DaemonSets 的影响
- 说明 DaemonSets（监控、日志、遥测等系统服务）在每个节点上运行
- 大节点的 DaemonSet 开销占比小，小节点的开销占比大
- 警告：按节点授权的软件可能会悄悄增加成本

05:45 - 08:00 - Spot 实例管理
- 强调 Spot 实例在成本节省中的重要性
- Karpenter 简化了 Spot 实例管理：自动识别最佳价格和可用性，处理中断
- **适用场景**：负载均衡器后的 Web 服务器、无状态微服务、批处理作业、开发/测试环境
- **最佳实践**：配置 Spot 实例并设置 On-Demand 作为故障转移
- 提供配置示例：优先使用 Spot，无容量时自动切换到 On-Demand
- 建议创建独立的 Spot 和 On-Demand 节点池，使用节点亲和性控制分配比例
- 监控故障转移频率，必要时扩大实例选择范围

08:00 - 09:00 - Graviton 实例策略
- 介绍 Graviton 提供相同或更好的性能，价格更低
- 大多数现代应用可在 ARM 架构上运行，无需代码更改
- 唯一投资：在 CI 流程中为 ARM 和 x86 构建 Docker 镜像
- Kubernetes 会根据节点自动选择正确的容器版本

09:00 - 10:00 - 跨可用区流量优化（谨慎使用）
- 警告：跨可用区流量成本高昂
- **非生产环境建议**：将节点池限制在单个可用区以强制数据本地性
- 不推荐在生产环境使用此策略
- 提供配置示例：使用权重和亲和性规则设置可用区故障转移

10:00 - 11:30 - 持续优化的挑战
- 指出即使应用了最佳实践，仍存在挑战：
  - 难以将 Kubernetes 指标与成本关联以识别低效
  - 多集群大规模环境的运维复杂性
  - Karpenter 决策快速，但基础设施启动需要数分钟
  - 需要持续调整配置以保持效率
- 提出问题：团队是否有资源持续投入优化工作？

11:30 - 14:00 - Zesti 平台介绍
- 介绍 Zesti Kubernetes 优化平台的功能：
  - **深度可见性**：从使用率和利用率角度查看所有集群和容器
  - **预测模型**：提高扩展决策效率
  - **自动优化**：代表用户自动执行优化操作
  - **资源优化层**：自动垂直和水平调整工作负载（包括 CPU、内存和持久卷）
  - **财务优化层**：在 Spot 实例和 Savings Plans 之间分配工作负载
  - **快速扩展技术**：维护预缓存的休眠节点池，30 秒内启动，实现 Spot 实例故障的即时恢复
- 强调 Zesti 是唯一结合资源优化和云财务优化的平台
- 承诺至少实现 70% 的集群成本节省

14:00 - 14:30 - 结束语
- 邀请参会者访问展位了解更多信息
- 感谢参会者并祝愿大会顺利