# AWS re:Invent 2025 - Amazon S3 安全与访问控制最佳实践

## 会议概述

本次会议由 AWS S3 团队的首席工程师 Bryant 和产品经理 Ashot 主讲,重点介绍了 Amazon S3 的安全和访问控制最佳实践。两位演讲者拥有合计 22 年的 AWS 经验(其中 Bryant 贡献了 17 年),分享了 S3 团队在安全方面的核心理念和实践经验。

会议强调了 AWS 对安全的整体思考方式:安全不是孤立存在的,而是与持久性、可用性和性能共同构成完整产品价值的一部分。S3 团队认为安全是每个人的职责,从设计师、产品经理到运维人员,都需要将安全融入日常工作中。同时,安全不仅仅是"说不",而是要帮助客户安全地访问和使用数据,实现业务价值。

演讲者介绍了三大核心原则和八项最佳实践,涵盖了从基础安全设置到大规模权限管理的各个方面。特别值得注意的是,S3 团队持续通过简化和改进来提升安全性,例如默认启用公共访问阻止、默认加密所有对象、启用校验和验证等。会议还宣布了 S3 对基于属性的访问控制(ABAC)的支持,这是一个酝酿多年的重要功能。

## 详细时间线

### 开场介绍 (0:00-2:30)
- **0:00** - 会议开始,欢迎参会者参加 Amazon S3 安全与访问控制最佳实践会议
- **0:15** - 介绍演讲者:产品经理 Ashot(擅长在日式铁板烧餐厅接虾)和首席工程师 Bryant(喜欢极致流畅的爵士乐)
- **0:45** - 说明两人合计拥有 22 年 AWS 经验,其中 Bryant 贡献了 17 年
- **1:15** - 会议议程预告:三大核心原则、八项最佳实践,总共"到 11"(3+8=11)
- **1:45** - 承诺在会议结束时提供可操作的后续步骤

### AWS 安全思维方式 (2:30-7:00)
- **2:30** - 核心理念:安全是整体的一部分,不是孤立存在
- **3:00** - 安全与其他三大支柱协同工作:持久性、可用性和性能
- **3:30** - 从客户需求出发:确保业务持续访问数据、降低业务风险、高效交付业务价值
- **4:00** - 安全是每个人的职责:遵循 AWS 共享责任模型
- **4:30** - 在 S3,设计师和产品经理在设计功能时必须考虑安全性
- **5:00** - 运维团队拥有自己的安全模型,并与中央安全团队合作
- **5:30** - 客户的职责:AWS 提供工具,客户需要正确使用这些工具
- **6:00** - 持续迭代改进是必须的:通过客户反馈推出新功能,简化安全性
- **6:30** - 近年改进示例:默认启用公共访问阻止、默认禁用 ACL、默认加密、默认启用校验和、SOAP 接口生命周期结束、SECC 加密即将默认禁用

### 核心原则:安全不仅仅是说"不" (7:00-9:00)
- **7:00** - 安全不仅仅是拒绝访问
- **7:15** - 类比:港口中的船只是安全的,但这不是造船的目的
- **7:30** - S3 最初作为面向互联网的存储推出,目的是让数据被使用
- **8:00** - 安全的真正目标:为正确的用户构建访问正确数据的路径
- **8:30** - 安全应该是交付新功能和提供新能力的推动者,而不是障碍

### 最佳实践 1:阻止公共访问 (9:00-12:00)
- **9:00** - 第一项最佳实践:阻止公共访问是基本要求
- **9:30** - S3 公共访问阻止功能已推出五年多
- **10:00** - 使用自动推理库分析策略,防止意外配置错误
- **10:30** - 几年前,所有新创建的通用存储桶默认启用公共访问阻止
- **11:00** - 新的 S3 资源(表、表存储桶、向量)内置启用公共访问阻止,无法关闭
- **11:30** - 对于 Web 托管用例,强烈建议使用 CloudFront 配合 OAC(源访问控制)
- **11:45** - CloudFront 提供 TLS 支持、任意域名、更好的缓存和性能

### 最佳实践 2:启用存储桶级密钥 (12:00-14:30)
- **12:00** - 第二项最佳实践:启用存储桶级密钥以节省成本
- **12:30** - 使用 KMS 自有密钥时,每次 PUT/GET 操作都需要调用 KMS
- **13:00** - 存储桶级密钥允许使用中间密钥,减少 KMS 调用
- **13:30** - 中间密钥通过 KMS 解密后安全地临时缓存
- **14:00** - 自推出以来,客户已节省 4 亿美元的 KMS 成本
- **14:15** - S3 表自动启用存储桶级密钥

### 最佳实践 3:分而治之 - 规模化管理 (14:30-16:00)
- **14:30** - 第三项最佳实践:通过分而治之来扩展
- **15:00** - 面对数百万用户、数千个应用或数十亿最终用户时的挑战
- **15:30** - 在架构上分离应用和生产阶段
- **15:45** - 在组织上分离管理职责:中央安全团队执行防护栏,开发团队快速交付

### 最佳实践 3a:S3 访问点 (16:00-18:30)
- **16:00** - 分而治之的第一个选项:S3 访问点
- **16:30** - 访问点是针对特定用例的端点,可以为同一个存储桶配置多个访问点
- **17:00** - 每个访问点有自己的访问控制策略,叠加在存储桶策略之上
- **17:30** - 在存储桶策略中设置防护栏(如仅允许 VPC 内访问)
- **18:00** - 为不同应用创建独立的访问点:只读访问点、审计访问点、开发访问点等
- **18:15** - 客户可以在单个存储桶前放置数万个访问点
- **18:30** - 每个账户每个区域支持最多 10 万个访问点(软限制)

### 最佳实践 3b:S3 访问授权 (18:30-21:00)
- **18:30** - 访问点不适合管理数百万用户访问单个文件的场景
- **19:00** - S3 访问授权允许使用 IAM 用户或企业目录联合用户
- **19:30** - 授权存储在列表中,易于编程方式添加和删除
- **20:00** - 应用向访问授权请求访问,获得由 STS 颁发的临时凭证
- **20:30** - AWS SDK 自动处理凭证管理,对应用透明
- **20:45** - 支持企业目录集成:用户加入财务团队自动获得访问权限,离开团队自动失去权限

### 最佳实践 3c:令牌自动售货机模式 (21:00-23:00)
- **21:00** - 访问授权是令牌自动售货机模式的特例
- **21:30** - 令牌自动售货机按需分发临时凭证,精确限定到特定 S3 资源
- **22:00** - 通过 STS 和作用域策略获取凭证
- **22:30** - 可以基于任意授权逻辑:目录、企业数据库、策略文件等
- **22:45** - 示例:仅在特定时间、特定条件下授予访问权限

### 最佳实践 3d:基于属性的访问控制(ABAC) (23:00-26:30)
- **23:00** - 第四种分而治之的方式:基于属性的访问控制(也称为基于标签的访问控制)
- **23:30** - 使用与主体和资源关联的标签或元数据做出访问控制决策
- **24:00** - 示例:会计团队的用户可以访问标记为"会计"的存储桶
- **24:30** - 策略更具语义意义,一次编写后无需再修改
- **25:00** - 重要公告:几天前 S3 新增了 ABAC 支持,这是多年努力的成果
- **25:30** - 支持标准化的 AWS 标签资源 API,提供细粒度的标签和取消标签权限
- **26:00** - 表和向量也支持 ABAC
- **26:15** - 跨 AWS 服务工作,简化整体资源管理

### 最佳实践 3 总结:选择合适的工具 (26:30-28:30)
- **26:30** - 四种分而治之的方法:访问点、访问授权、令牌自动售货机、ABAC
- **27:00** - 看起来很复杂,但"简单存储服务"应该简单
- **27:30** - 正确的工具随规模变化:从车库创业到企业级部署
- **28:00** - 类比:S3 既有镐头也有挖土机,根据需要选择合适的工具

### 最佳实践 4:在模型上测试安全变更 (28:30-32:00)
- **28:30** - 第四项最佳实践:始终在模型上测试安全变更
- **29:00** - 常见问题:修改存储桶策略后应用无法工作,用户失去访问权限
- **29:30** - 强烈建议建立生产系统的模型环境
- **30:00** - 使用基础设施即代码工具(如 CloudFormation)更容易实现
- **30:30** - 复制所有生产环境结构:存储桶、复制规则、生命周期规则、EC2 部署等
- **31:00** - 不需要复制生产数据,只需相同的结构和控制
- **31:30** - 在测试环境中修改策略,运行生产工作负载,测试正面和负面用例
- **31:45** - 保留测试用例,每次变更时重新运行所有测试

### 最佳实践 4 补充说明 (32:00-33:30)
- **32:00** - S3 团队内部也是这样做的:开发人员编写数万个测试用例
- **32:30** - 每次代码变更必须通过所有测试用例才能部署
- **33:00** - 使用内部构建的自动推理工具持续测试
- **33:15** - 测试不是成本,而是加速因素,让安全团队有信心批准变更

### 最佳实践 5:使用 AWS Organizations (33:30-37:00)
- **33:30** - 第五项最佳实践:使用 AWS Organizations
- **34:00** - Organizations 用于建模多账户部署,包含组织单元(OU)和组织
- **34:30** - 组织单元可以嵌套,每个包含一个或多个账户
- **35:00** - 管理员账户具有特殊权限,位于任何 OU 之外
- **35:30** - 每个层级有资源控制策略(RCP)和服务控制策略(SCP)
- **36:00** - 将企业级防护栏放入资源控制策略:禁止未加密访问、禁止组织外访问等
- **36:30** - 开发人员可以自由构建,但始终符合组织级防护栏
- **36:45** - 简化管理:无需为每个存储桶应用相同策略,在组织级别设置一次即可

### 最佳实践 6:使用 S3 存储镜头 (37:00-40:00)
- **37:00** - 第六项最佳实践:使用 S3 存储镜头(S3 Storage Lens)
- **37:30** - Storage Lens 提供组织范围的可见性和洞察
- **38:00** - 可以查看所有存储桶的指标:存储使用情况、请求模式、数据保护状态
- **38:30** - 识别安全风险:未加密的存储桶、公开访问的存储桶、缺少版本控制的存储桶
- **39:00** - 提供建议和最佳实践指导
- **39:30** - 支持自定义仪表板和导出到 S3 进行进一步分析

### 最佳实践 7:启用 S3 版本控制和对象锁定 (40:00-43:00)
- **40:00** - 第七项最佳实践:启用版本控制和对象锁定
- **40:30** - 版本控制保护数据免受意外删除和覆盖
- **41:00** - 对象锁定提供 WORM(一次写入,多次读取)功能
- **41:30** - 两种模式:治理模式(特权用户可以修改)和合规模式(任何人都不能修改)
- **42:00** - 适用于监管合规要求:金融、医疗保健等行业
- **42:30** - 与 S3 复制结合使用,提供额外的数据保护层

### 最佳实践 8:使用 IAM Access Analyzer (43:00-45:30)
- **43:00** - 第八项最佳实践:使用 IAM Access Analyzer
- **43:30** - Access Analyzer 帮助识别意外的外部访问
- **44:00** - 分析资源策略,识别授予组织外部访问的策略
- **44:30** - 提供持续监控和警报
- **45:00** - 支持策略验证:在部署前检查策略是否符合安全最佳实践
- **45:15** - 与 Organizations 集成,提供组织范围的可见性

### 可操作的后续步骤 (45:30-47:00)
- **45:30** - 总结:三大原则和八项最佳实践
- **46:00** - 立即可以采取的行动:
  - 启用公共访问阻止
  - 启用存储桶级密钥
  - 根据规模选择合适的访问控制方法
  - 建立测试环境
  - 配置 AWS Organizations
  - 使用 Storage Lens 获得可见性
  - 启用版本控制和对象锁定
  - 使用 IAM Access Analyzer
- **46:30** - 作为领导者或开发人员,今天就可以让 S3 中的数据更安全

### 结束语 (47:00-48:00)
- **47:00** - 感谢参会者
- **47:15** - 演讲者将在会场外回答问题
- **47:30** - 鼓励参会者应用这些最佳实践
- **47:45** - 会议结束