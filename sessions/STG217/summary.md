# AWS re:Invent 2025 - STG217 会话总结

## 会话概述

本次会话介绍了 Amazon FSX for NetApp ONTAP 的 S3 访问点（S3 Access Points）这一新功能。主讲人 Luke Miller（FSX 产品经理）和 Jacob Strauss（AWS 文件存储首席工程师）详细展示了如何通过 S3 API 访问存储在 ONTAP 文件系统中的数据，从而将传统文件存储与现代云原生分析和 AI 服务无缝集成。

这项创新功能解决了企业面临的核心挑战：全球数百 EB 的文件系统数据（其中 80% 是非结构化数据）大多处于闲置状态，无法被充分利用。通过 S3 访问点，企业可以将存储在 ONTAP 文件系统中的数据直接连接到 AWS 的分析服务（如 Athena、Glue、EMR）、AI/ML 服务（如 SageMaker、Bedrock）以及商业智能平台（如 QuickSight），而无需复制或迁移数据。

该功能的核心价值在于：数据保持在 ONTAP 文件系统中，同时可通过传统文件协议（NFS/SMB）和 S3 API 双重访问，实现了传统应用与云原生应用的并行支持，为企业的数字化转型和应用现代化提供了渐进式路径。

## 详细时间线

### **开场与背景介绍 (0:00 - 5:30)**

0:00 - 0:45
- 会话开始，Luke Miller 和 Jacob Strauss 介绍自己
- 会话主题：STG 217 - 介绍 Amazon S3 访问点用于 FSX for NetApp ONTAP
- 概述会话议程：FSX ONTAP 概览、S3 访问点功能、用例、架构原理和实际演示

0:45 - 2:30
- 强调数据是现代创新的基础
- 关键数据点：
  - 全球企业文件系统中存储着数百 EB 的数据
  - 这些数据量超过几年前整个互联网的数据总量
  - 80% 的数据是非结构化的（文档、视频、图像等）
  - 大部分数据处于闲置状态，未被充分利用

2:30 - 5:30
- 提出核心问题：如何解锁这些数据的价值？
- 介绍 Amazon FSX for NetApp ONTAP：
  - 首个也是唯一提供完全托管的 NetApp ONTAP 文件系统的云服务
  - 保留所有 NetApp ONTAP 的企业级功能（快照、克隆、勒索软件保护、多协议支持）
  - 结合 AWS 云原生优势（弹性扩展、按需付费、全球可用性）
  - 消除自管理存储的繁重工作

### **FSX ONTAP 使用场景 (5:30 - 8:00)**

5:30 - 6:30
- 企业 IT 应用场景：
  - 企业文件服务、员工主目录
  - 部门共享和协作工作区
  - 可动态扩展的工作空间

6:30 - 7:30
- 行业特定应用：
  - 金融服务：交易平台和风险管理系统
  - 半导体行业：EDA 工作负载和芯片设计
  - 医疗和生命科学：基因组数据、医学影像、临床研究数据集

7:30 - 8:00
- 数据保护用例：
  - 备份存储库
  - 灾难恢复的二级数据副本
  - 利用 ONTAP 内置的复制和快照技术

### **客户需求与新功能发布 (8:00 - 12:00)**

8:00 - 10:00
- 客户希望将 ONTAP 数据与 AWS AI/ML 和分析服务集成：
  - Amazon SageMaker（构建、训练和部署 ML 模型）
  - AWS Glue（数据处理和编目）
  - Amazon Athena（就地查询数据）
  - Amazon QuickSight（数据可视化）
  - Amazon Bedrock（生成式 AI 应用）
  - Amazon Q Business（AI 驱动的商业智能平台）

10:00 - 12:00
- **正式发布公告**：S3 访问点用于 FSX for NetApp ONTAP
- 核心功能：使 FSX ONTAP 数据可通过 S3 API 访问，就像存储在 S3 存储桶中一样
- 关键优势：
  - 数据无需移出 ONTAP 文件系统
  - 同时支持文件协议（NFS/SMB）和 S3 API 访问
  - 可与广泛的 S3 集成 AWS 服务无缝连接

### **核心用例详解 (12:00 - 20:00)**

12:00 - 15:00
- **用例 1：AI 和商业智能集成**
  - 挑战：数十年的企业文件数据（研究报告、临床试验数据、工程文档、法律合同）与现代 AI 应用断开连接
  - 解决方案：通过 S3 访问点，QuickSight 可以索引文件数据，Bedrock 知识库可用于 RAG 工作流，Q Business 可以回答关于机构知识的问题
  - 实际案例：灾难恢复场景
    - 客户在本地管理主 ONTAP 环境
    - 使用 FSX ONTAP 作为 AWS 上的二级副本
    - 通过 SnapMirror 复制数据
    - 现在可以通过 S3 访问点使二级副本数据发挥价值

15:00 - 17:30
- **用例 2：分析工作负载**
  - 场景：基因组测序、地震勘探、制造业遥测数据存储在文件系统中
  - 传统方法：需要将数据复制到 S3，管理同步，支付重复存储费用
  - 新方法：
    - Athena 可以直接通过访问点查询 FSX 数据
    - Glue 可以爬取和编目文件数据
    - EMR 可以对数据运行 Spark 作业
  - 制造业示例：
    - 本地 ONTAP 存储多年的工艺数据
    - 通过 SnapMirror 复制到 FSX ONTAP
    - 使用 Athena 或 Redshift 进行实时分析，无需维护单独的 S3 数据湖

17:30 - 20:00
- **用例 3：应用现代化**
  - 挑战：现有应用依赖文件协议（SAP、电子健康记录、交易应用），无法快速重写
  - 目标：构建使用 Lambda 的云原生无服务器应用
  - 解决方案：同一数据同时服务于传统文件应用和新的对象/云原生应用
  - 媒体公司示例：
    - 编辑通过 SMB 在 Windows 工作站访问 FSX 中的视频文件
    - Lambda 函数通过 S3 API 自动处理新内容
    - 功能包括：生成缩略图、提取元数据、运行合规性检查、AI 驱动的内容分析
    - 实现渐进式现代化，无需大规模迁移或重新架构

### **技术架构讲解 (20:00 - 30:00)**

20:00 - 22:00
- Jacob Strauss 接手讲解技术实现
- 当前架构：
  - FSX 文件系统位于特定 AWS 区域
  - EC2 实例或其他计算平台上的客户端
  - 通过传统文件系统协议（NFS/SMB）访问

22:00 - 25:00
- 添加 S3 访问点后的新架构：
  - 创建 S3 访问点时会生成一个别名（alias）
  - 别名可以在任何需要 S3 存储桶名称的地方使用
  - 支持通过 S3 SDK/CLI 进行 PUT、GET、LIST、HEAD 等操作
  - 请求通过访问点转发到 FSX 文件系统
  - 可以从 VPC 内部、EC2 或互联网访问（取决于配置）
  - 可以将访问点别名传递给其他 AWS 服务（Athena、EMR、Glue 等）

25:00 - 28:00
- **身份验证和授权机制**（双层模型）：
  - 第一层：S3 身份验证模型
    - 访问点检查为该访问点定义的策略
    - 验证特定用户是否允许对特定前缀执行操作
  - 第二层：传统文件系统模型
    - FSX 文件系统根据 Unix 或 Windows 用户和组配置进行权限检查
    - 验证对特定文件的操作权限
  - 两层验证都必须通过

28:00 - 30:00
- **性能特性**：
  - 不创建数据的多个副本，只有一份数据存储在 FSX 文件系统中
  - 吞吐量和 IOPS 与底层文件系统相同
  - 通过文件系统接口或 S3 访问点访问的性能配额相同
  - 数据一致性：通过 S3 API 创建或更新的数据立即对文件协议可见，反之亦然

### **常见部署模式 (30:00 - 32:00)**

30:00 - 32:00
- 本地到云的复制场景：
  - 本地数据中心的大型现有数据集
  - 在 AWS 中设置 FSX 文件系统
  - 配置复制（通常用于灾难恢复）
  - 在 FSX 文件系统上添加 S3 访问点
  - 灾难恢复副本现在可以作为只读数据集用于分析服务
  - 从之前闲置的 DR 数据中获取新价值

### **实际演示 - 第一部分：创建访问点 (32:00 - 42:00)**

32:00 - 33:00
- 演示场景设定：
  - 扮演金融机构角色
  - 拥有信用卡交易数据
  - 两个角色：存储管理员（设置访问点）和数据科学家（使用分析服务）

33:00 - 35:00
- 在 AWS 管理控制台中操作：
  - 现有 FSX ONTAP 文件系统：10TB 容量，384 MB/s 吞吐量
  - ONTAP 卷是数据的逻辑容器
  - 访问点附加到卷
  - 单个卷最多支持 10,000 个访问点

35:00 - 38:00
- 创建访问点步骤：
  - 导航到卷详情页面的新 S3 选项卡
  - 点击创建访问点
  - 命名访问点（例如：my-ec2-user-s3-ap）
  - **配置文件系统身份**：
    - Unix 安全样式卷选择 Unix 用户
    - Windows 安全样式卷选择 Windows 用户
    - 示例使用 EC2-user（Amazon Linux 实例的默认本地 Unix 用户）
    - 所有通过访问点的访问都将以该用户身份进行授权

38:00 - 40:00
- **网络配置**：
  - 选项 1：互联网访问（演示中选择此项，用于从本地笔记本上传/下载）
  - 选项 2：限制在 VPC 内访问
- **访问点策略**：
  - 可选配置，类似于 S3 存储桶策略
  - 没有策略时，授权方式与没有存储桶策略的存储桶相同
- **S3 Block Public Access**：
  - 默认启用且无法更改
  - 确保没有匿名访问

40:00 - 42:00
- 访问点创建完成（10-20 秒）
- 查看访问点详情：
  - 具有 S3 访问点的 Amazon 资源名称（ARN）
  - 可以从 S3 控制台查看
  - 可以添加标签和访问点策略
  - 显示配置的文件系统身份和权限
  - **访问点别名**：自动生成，可在任何需要存储桶名称的地方使用

### **实际演示 - 第二部分：数据访问 (42:00 - 52:00)**

42:00 - 44:00
- 演示环境设置：
  - 左侧终端：本地笔记本
  - 右侧终端：SSH 到客户端 VPC 中的 EC2 实例，已挂载卷

44:00 - 46:00
- 通过 NFS 查看数据：
  - 卷已挂载
  - 信用卡数据集包含：cards、customers、fraud_alerts、merchants、transactions
  - transactions 按年、月、日分区

46:00 - 48:00
- 通过 S3 API 访问数据：
  - 从本地笔记本执行 aws s3 ls 命令
  - 列出 credit_card 目录，返回所有目录
  - 执行 list-objects-v2 查看 transactions 前缀
  - **存储类**：显示为 FSX_ONTAP 存储类
  - 执行 head-object 查看 customer.csv 元数据
  - **服务器端加密**：显示为 AWS:FSX，表示使用 FSX ONTAP 的标准静态数据加密（使用创建文件系统时指定的 AWS KMS 密钥）

48:00 - 50:00
- 下载对象：
  - 使用 get-object 下载 customer.csv
  - 查看下载文件内容
  - 与 NFS 挂载点的文件内容相同

50:00 - 52:00
- 上传数据（写操作）：
  - 使用 put-object 上传 customer_rewards 数据
  - 在 NFS 挂载点立即可见新上传的文件
  - 使用 stat 命令检查文件所有权
  - 文件所有者是与访问点关联的 Unix 用户（EC2-user）
  - 证明文件是通过访问点上传的

### **实际演示 - 第三部分：Athena 集成 (52:00 - 65:00)**

52:00 - 54:00
- 场景：作为金融机构的数据科学家，使用 Amazon Athena 进行 SQL 查询分析
- 在 Athena 中创建表来表示底层数据

54:00 - 57:00
- 创建 customers 表：
  - 查询 S3 端点（通过访问点）
  - 表属性中的 location 是包含访问点别名的 S3 URI
  - 快速创建其他表：cards、merchants、fraud_alerts、rewards

57:00 - 59:00
- 创建 transactions 表（分区表）：
  - 按年、月、日分区
  - 运行分区发现命令
  - Athena 自动发现所有分区

59:00 - 61:00
- **AWS Glue 集成**：
  - 可以使用 Glue 自动爬取和发现数据模式
  - 在 Glue 中查看 transactions 表
  - 显示模式表示，指向 S3 访问点别名的特定前缀
  - 强调：数据存储在 ONTAP 文件系统中，甚至可能主副本在本地，这只是 DR 的只读副本

61:00 - 63:00
- 在 Athena 查询编辑器中执行查询：
  - 基本查询：SELECT * FROM customers LIMIT 10
  - 高级查询：客户细分分析，连接两个表
  - 查询成功返回结果

63:00 - 65:00
- **CTAS（Create Table As Select）操作**：
  - 从查询结果创建新表
  - 用例：日末、周末、季末、年末报告，填充仪表板
  - 创建 customer_summary 表
  - 写入不同的访问点别名和前缀（同一卷内）
  - 使用不同格式：写入 Parquet 文件（之前读取的是 CSV）
  - 数据仍存储在 ONTAP 中

### **演示验证和总结 (65:00 - 68:00)**

65:00 - 66:30
- 验证 CTAS 结果：
  - 在本地终端查看新创建的 Parquet 文件
  - 文件位于 credit_card_data_analytics/customer_summary 目录
  - 在 Athena 中查询新的 customer_summary 表
  - 成功返回汇总数据

66:30 - 68:00
- 提及 Amazon QuickSight：
  - AWS 最近发布的 AI 辅助商业智能平台
  - 可以将企业数据集成为知识库
  - 进行 AI 辅助的分析
  - 演示因时间限制未完整展示此部分

### **会话结束 (68:00+)**

- 演示展示了从创建访问点、基本数据访问到与 AWS 分析服务集成的完整流程
- 强调了 S3 访问点如何使 ONTAP 文件数据无缝集成到 AWS 云原生服务生态系统
- 数据始终保持在 ONTAP 文件系统中，同时支持传统文件协议和现代 S3 API 访问