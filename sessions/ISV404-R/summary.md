# AWS re:Invent 2025 - ISV 404 会话总结

## 会话概述

本次会议主题为"构建弹性：多账户弹性测试模式"（ISV 404），由来自AWS英国ISV团队的高级解决方案架构师Kane Vijay独自主讲。会议深入探讨了如何利用AWS故障注入服务（AWS Fault Injection Service, FIS）对多租户SaaS架构进行弹性测试，以确保在不影响关键工作负载的情况下验证系统的可靠性。

演讲者首先介绍了成功的SaaS解决方案必须遵循的六大核心支柱：租户隔离、嘈杂邻居缓解、身份和访问管理、租户感知可观测性、战略分层和成本跟踪机制。随后详细阐述了AWS弹性生命周期框架的五个关键阶段：设定目标、设计与实施、评估与测试、运营、响应与学习。这个框架为构建和管理弹性SaaS架构提供了系统化的方法论。

会议的核心内容是通过实际的AWS参考架构演示多账户弹性测试模式。演讲者搭建了包含控制平面和应用平面的多租户架构，涵盖电子商务解决方案和检索增强生成（RAG）应用两个场景。通过AWS FIS在多个AWS账户间注入受控故障，验证了租户隔离、节流限制等SaaS基本原则的有效性。整个演示强调了通过假设驱动的实验方法，在生产环境前主动发现和修复系统弱点的重要性。

## 详细时间线

### 开场与背景介绍 (0:00-5:00)
- **0:00** - 演讲者Kane Vijay介绍因个人原因缺席的联合演讲者Fernel，独自主持本次ISV 404会话
- **0:30** - 提出核心问题：有多少人经历过凌晨3点接到多租户SaaS注册失败的紧急电话
- **1:15** - 介绍会话目标：探索领先ISV如何使用AWS故障注入服务验证SaaS架构设计
- **2:00** - Kane Vijay自我介绍：AWS英国ISV团队高级解决方案架构师，在AWS工作超过5年，常驻都柏林

### SaaS架构核心原则 (5:00-12:00)
- **5:00** - 介绍会话议程：SaaS架构核心原则、弹性框架、真实用户旅程、多种弹性测试模式和关键学习要点
- **6:30** - 阐述构建真正弹性SaaS架构的六大关键支柱：
  - 强大的租户隔离防止安全和数据泄露
  - 嘈杂邻居缓解以维持一致的用户体验
  - 全面的身份和访问管理确保安全的租户边界
  - 租户感知可观测性监控资源使用和服务限制
  - 战略分层服务多样化客户群
  - 成本感知跟踪机制实现向最终客户的费用回收
- **8:45** - 介绍AWS良好架构可靠性支柱中的故障管理和测试可靠性最佳实践
- **10:00** - 强调可靠性测试的目标：通过受控实验验证工作负载能够承受部分故障或灰色故障

### AWS弹性生命周期框架 (12:00-20:00)
- **12:00** - 介绍AWS弹性生命周期框架的五个关键阶段
- **12:30** - 第一阶段：设定目标 - 确定工作负载所需的弹性级别，包括RTO、RPO、高可用性和SLA承诺
- **13:30** - 第二阶段：设计与实施 - 预测各种故障模式，采用正确的技术架构和工具
- **14:30** - 第三阶段：评估与测试 - 执行弹性测试，包括部署前和部署后活动，使用AWS FIS进行受控实验
- **16:00** - 第四阶段：运营 - 利用可观测性工具、日志和指标监控系统中断
- **17:00** - 第五阶段：响应与学习 - 基于运营事件制定缓解策略，包括运行手册和事件管理最佳实践
- **18:30** - 强调这是一个持续迭代的飞轮过程，可应用于现有和新工作负载

### 弹性实验阶段 (20:00-25:00)
- **20:00** - 介绍弹性实验的四个阶段
- **20:30** - 稳态 - 测量工作负载的正常行为基线，基于用户流量模式和服务特性
- **21:30** - 假设 - 定义要验证的场景，将未知的系统弱点转化为已知因素
- **22:30** - 运行实验 - 使用AWS FIS在多账户设置中注入故障
- **23:30** - 验证 - 评估系统行为并验证结果
- **24:00** - 改进 - 根据学习结果改进架构、运行手册或操作程序

### AWS故障注入服务介绍 (25:00-32:00)
- **25:00** - 提出问题：如何在拥有数十或数百个AWS账户的SaaS工作负载中开始故障注入
- **26:00** - 介绍AWS FIS作为完全托管服务，消除构建自定义脚本的繁重工作
- **27:00** - 解释FIS与IAM集成，通过编排角色在多个账户间注入故障
- **28:00** - 介绍实验模板的三个关键组件：
  - **操作（Action）** - 要执行的故障活动，可以是顺序或并行
  - **目标（Target）** - AWS资源，如无服务器或EC2部署模型
  - **保护措施（Safeguard）** - 停止条件和告警阈值，减少爆炸半径
- **30:00** - 介绍场景库提供AWS推荐的预构建实验模板
- **31:00** - 展示FIS与Amazon EventBridge集成，支持第三方可观测性工具
- **31:30** - 分享BMW集团案例研究，展示如何利用FIS识别关键组件的弱点

### SaaS工作负载架构场景 (32:00-42:00)
- **32:00** - 介绍真实世界SaaS工作负载架构场景
- **33:00** - 定义两个关键角色：
  - **SaaS提供商** - 设计、构建、部署和管理SaaS产品的软件公司
  - **租户** - SaaS应用的消费者
- **34:30** - 推荐AWS最佳实践：将SaaS工作负载分为控制平面和应用平面
- **35:00** - 控制平面包括：租户管理、管理员管理、计费、指标和身份验证等全局服务
- **36:00** - 介绍两个演示解决方案：
  - **SaaS电子商务解决方案** - 提供租户特定的产品目录和订单管理
  - **SaaS检索增强生成（RAG）** - 租户可以上传组织数据，通过向量存储索引并使用生成式LLM响应查询
- **38:00** - 强调租户隔离和嘈杂邻居缓解对两个解决方案都至关重要

### AWS SaaS参考架构详解 (42:00-50:00)
- **42:00** - 展示AWS SaaS参考架构的详细技术实现
- **43:00** - 用户访问层 - 租户通过Amazon Cognito进行身份验证和授权，访问SaaS应用和RAG应用
- **44:00** - 控制平面 - 管理租户上线流程和其他集成元素
- **45:00** - EKS应用平面 - 池化模型部署，提供租户特定命名空间的订单和产品微服务，使用DynamoDB作为数据存储
- **46:00** - 无服务器应用平面 - 孤岛部署模型，租户采用无服务器架构处理订单工作流
- **47:00** - 生成式AI应用 - 共享服务模型的RAG实现，租户共享基础设施但数据和交互隔离
- **48:00** - 控制平面通过Amazon EventBridge以事件驱动模式与应用平面通信

### 多账户结构设置 (50:00-55:00)
- **50:00** - 介绍演示的多账户结构，选择US East 1和US West 2两个区域
- **51:00** - 定义三个关键角色：FIS管理员、租户和SaaS提供商
- **52:00** - AWS Organizations根下设置测试OU，包含四个账户：
  - **账户1** - AWS FIS实验编排的单一控制台
  - **账户2** - 控制平面和电子商务应用平面，使用Systems Manager注入自定义故障
  - **账户3** - RAG解决方案
  - **账户4** - 使用Amazon CloudWatch进行跨账户可观测性
- **54:00** - 强调账户2和3可以根据业务复杂性扩展到数十或数百个账户

### 模式一：多租户嘈杂邻居 (55:00-1:15:00)
- **55:00** - 介绍模式一：多租户嘈杂邻居场景
- **55:30** - 询问观众是否经历过嘈杂邻居场景
- **56:00** - 定义嘈杂邻居：一个租户的活动对整体服务性能或其他租户产生不利影响
- **57:00** - 介绍缓解策略：工作负载管理和资源分配，通过节流机制确保租户在配额限制内
- **58:00** - 展示AWS参考架构，从Amazon CloudWatch观察稳态开始
- **59:00** - 介绍两个租户：
  - **租户1** - 安全ISV，处理威胁数据
  - **租户2** - HR技术ISV，处理员工奖励数据
- **1:00:00** - 两个租户通过API Gateway执行RAG查询，配置使用计划限制每个租户请求：10,000个令牌，500个输入令牌，500个输出令牌，每天100个请求
- **1:01:30** - API Gateway附加Lambda授权器，提取JWT令牌，验证租户特定令牌限制和角色，动态生成租户范围凭证
- **1:03:00** - Lambda授权器检查DynamoDB确保租户在限制内
- **1:04:00** - Lambda RAG服务调用Amazon Bedrock知识库，从Amazon OpenSearch向量存储检索租户上下文
- **1:05:00** - 用户查询和上下文传递给Amazon Bedrock LLM生成响应
- **1:06:00** - Amazon EventBridge规则每分钟调用Lambda令牌使用函数，分析CloudWatch日志并更新DynamoDB表
- **1:07:00** - 假设定义：注入两个故障 - 禁用EventBridge规则和删除CloudWatch日志流，验证租户是否能绕过节流限制

### 实际演示：模式一 (1:15:00-1:35:00)
- **1:15:00** - 切换到AWS控制台进行实际演示
- **1:15:30** - 展示四个配置的AWS账户
- **1:16:00** - 展示代码设置：CDK项目结构，包含Python模块和TypeScript CDK
- **1:17:30** - 解释代码组织：Python模块与TypeScript CDK的关联，Lambda函数部署流程
- **1:19:00** - 展示租户配置：两个租户的注册ID、电子邮件地址和令牌配置
- **1:20:00** - 执行稳态测试：租户1发送13个请求，前7个成功（HTTP 200），第8个开始失败（HTTP 403访问拒绝）
- **1:21:30** - 租户2发送4个请求，全部成功，验证节流策略有效
- **1:22:00** - 展示CloudWatch仪表板：DynamoDB延迟和节流、令牌使用表操作、Bedrock调用指标
- **1:23:00** - 显示403错误原因：租户令牌限制超出
- **1:24:00** - 导航到AWS FIS服务，展示实验模板配置
- **1:25:00** - 启动实验："嘈杂邻居故障禁用EventBridge规则"
- **1:26:00** - 实验状态显示为运行中，多账户目标，配置IAM角色
- **1:27:00** - 展示两个操作：使用AWS SSM发送命令中断EventBridge规则和删除CloudWatch日志流
- **1:28:30** - 解释使用Systems Manager文档注入自定义故障的原因
- **1:29:00** - 实验完成，展示目标EC2实例和目标账户
- **1:30:00** - 检查CloudWatch告警，确认故障已注入
- **1:31:00** - 询问观众：如果再次发送请求会发生什么？答案：仍会失败，因为Lambda授权器已从DynamoDB读取限制
- **1:32:00** - 为演示目的重置DynamoDB表（强调生产环境不应这样做）
- **1:33:00** - 重新发送请求：租户1发送13个请求，租户2发送13个请求
- **1:34:00** - 等待请求完成，验证故障注入后的系统行为

### 实验模板详解 (1:35:00-1:40:00)
- **1:35:00** - 在等待请求完成期间，展示实验模板的JSON配置
- **1:36:00** - 解释可以通过AWS控制台或导入JSON配置创建实验模板
- **1:37:00** - 展示实验模板的详细配置，包括操作、目标和保护措施
- **1:38:00** - 强调FIS与第三方可观测性工具通过EventBridge的集成能力

### 实验结果验证 (1:40:00-继续)
- **1:40:00** - 返回查看请求执行结果
- **后续** - 验证故障注入后租户行为，分析系统响应
- **后续** - 讨论改进措施和从实验中获得的学习要点

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注：由于字幕在演示过程中被截断，完整的实验结果验证和后续模式的详细内容未包含在此总结中。