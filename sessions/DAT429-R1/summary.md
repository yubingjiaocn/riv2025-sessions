# AWS re:Invent 2025 - 编写Amazon Aurora MCP服务器代码演示

## 会议概述

本次技术会议是一场代码演示（Code Talk），由Jim和Vlad两位讲师主持，主题为"为Amazon Aurora编写MCP服务器"。会议采用现场编程的形式，展示如何使用模型上下文协议（MCP）构建连接Aurora PostgreSQL数据库的服务器。

讲师们使用Kiro AI助手进行实时编程，构建了一个娱乐中心应用，该应用通过MCP服务器从Aurora PostgreSQL数据库中查询电影角色和演员信息。会议重点强调了数据库安全实践，特别是如何使用行级安全（RLS）来保护数据访问。整个演示过程中，讲师们与观众保持互动，解答技术问题并分享最佳实践。

## 详细时间线与关键要点

### 0:00-5:00 会议介绍与背景
- Jim和Vlad介绍会议形式：现场编程演示
- 说明将使用Kiro AI助手协助编程，避免打字错误
- 鼓励观众参与，指出错误和提问
- 介绍MCP（模型上下文协议）：用于向LLM暴露后端数据的通用框架

### 5:00-10:00 技术架构概述
- MCP规范已发布一年，最新版本刚发布
- 将使用AWS MCP服务器，特别是Aurora PostgreSQL MCP服务器
- 构建目标：娱乐中心应用，包含两个工具：获取电影角色和获取演员角色
- 使用Bedrock托管LLM模型
- 数据模型基于IMDB数据集，采用传统规范化设计

### 10:00-15:00 应用演示与数据模型
- 展示基础Streamlit应用：登录页面和电影列表
- 演示时间MCP服务器功能
- 介绍数据库表结构，重点是titles表
- 强调在PostgreSQL中使用COMMENT命令为表和列添加描述的重要性
- 这些描述帮助LLM理解数据结构和使用方法

### 15:00-25:00 使用Kiro构建查询
- 演示Kiro的MCP功能：天气查询和数据库表查询
- 构建第一个查询：返回指定电影的所有角色和演员
- 使用全文搜索功能，处理多个匹配结果
- 优化查询性能，避免重复全文搜索
- 保存查询到文件以便后续使用

### 25:00-35:00 构建第二个查询与MCP服务器
- 编写第二个查询：返回指定演员的所有角色和电影
- 开始构建MCP服务器，使用天气MCP服务器作为模板
- 生成Python代码，包含数据库连接和两个工具函数
- 修改数据库连接配置，使用独立的用户名和密码参数

### 35:00-45:00 测试与调试
- 测试MCP服务器功能
- 演示查询《星球大战》角色信息
- 创建自定义电影数据进行测试
- 添加新电影"DAT429 Coding an MCP Server"和角色
- 验证MCP服务器能够查询本地数据库中的自定义数据

### 45:00-55:00 数据库安全实现
- 讨论数据安全的重要性：向LLM开放数据库访问的风险
- 实现行级安全（RLS）策略
- 使用PostgreSQL的set_config函数设置环境变量
- 创建基于title_type的访问控制策略
- 演示不同用户的数据访问权限：Jim只能访问电影，Vlad可以访问所有类型
- 强调确定性安全控制的重要性，不能依赖LLM的非确定性行为

### 55:00-55:42 总结与资源分享
- 会议结束时遇到一些技术问题，但主要概念已经演示完成
- 承诺将完整代码上传到GitHub仓库
- 强调在生产环境中考虑成本和性能的重要性
- 鼓励观众填写会议反馈调查
- 感谢观众参与