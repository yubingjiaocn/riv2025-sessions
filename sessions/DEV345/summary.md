# AWS re:Invent 2025 技术会议总结

## 会议概述

本次会议由 Anstack 的解决方案架构师 Sundep 主讲，分享了一个关于使用 AWS 服务构建 AI 驱动的游戏团队选择系统的失败案例。项目起源于一个 Valorant（瓦罗兰特）游戏黑客松比赛，目标是利用大规模游戏数据和 AI 技术来选择最佳的五人战队组合。Valorant 是一款在线多人游戏，拥有 28 个不同能力的角色和 12 张地图，团队需要赢得 13 轮才能获胜。

团队面临的主要挑战是处理和分析来自 Valorant 官方提供的海量游戏数据——7,500 个游戏文件，总大小达 100GB（解压后 800GB）。这些 JSON 文件记录了玩家在游戏中的每一个动作，包括弹药数量、移动速度、坐标、击杀数、死亡数和特殊能力使用等详细信息。团队尝试了多种 AWS 技术方案，包括向量数据库、Amazon Bedrock 知识库、函数调用（Agentic AI）和多阶段工作流，但都遇到了各种技术障碍。最终在提交截止前 10 分钟放弃了比赛，但在准备演讲时重新审视问题，发现了一个简单却关键的解决方案：不要教 LLM 它已经知道的东西，简化提示词让模型利用其预训练知识。

## 详细时间线

0:00 - 2:30 | 开场介绍
- 演讲者 Sundep 自我介绍，来自 Anstack，专注于无服务器和 AI 应用开发
- 项目起源：同事在 Slack 频道分享了一个游戏黑客松机会

2:30 - 4:45 | Valorant 游戏背景
- 介绍 Valorant 游戏机制：五人团队、13 轮制胜
- 28 个特殊角色（agents），每个角色拥有不同能力
- 12 张地图，每张地图有不同的地形、潜行点和战术要求
- 团队组合和地图选择是获胜的关键因素

4:45 - 7:15 | 数据获取挑战
- Valorant 团队提供了数据提取脚本，但运行时导致所有笔记本电脑崩溃
- 数据存储在 S3 存储桶中，使用 S3 sync 命令同步数据
- 数据规模：7,500 个游戏文件，跨越三个联赛/锦标赛，三年的游戏数据
- 压缩后总大小 100GB

7:15 - 9:30 | 使用 Amazon Lightsail 处理数据
- 单个文件大小在 200MB 到 800MB 之间，纯 JSON 格式
- 本地 VS Code 无法处理，频繁崩溃
- 采用 Amazon Lightsail（易用的 EC2 实例）解压和处理数据
- 通过 VS Code 远程 SSH 连接，获得良好的开发体验
- 解压后数据总大小达到 800GB

9:30 - 12:00 | 数据分析与处理
- 将 JSON 文件按键值拆分，发现记录了玩家的所有游戏行为
- 数据包含：弹药量、移动速度、跳跃坐标、击杀/死亡统计、特殊能力使用等
- 关键发现：数据量不等于有效数据，800GB 中包含大量无用信息
- 提取并创建了 6-10 个专门的数据集，包括角色统计、地图统计和玩家统计

12:00 - 16:30 | 第一次尝试：向量数据库方案
- 使用 Amazon Bedrock 知识库进行向量化
- 知识库提供了简单的向量数据库创建和内置聊天机器人测试功能
- 后端使用 OpenSearch 作为向量数据库
- **默认分块策略失败**：将 JSON 文件分割成 300 个 token 的块，导致玩家信息重叠混乱
- **无分块策略**：每个玩家一个文件，作为单独的向量记录，结果有所改善

16:30 - 19:45 | 向量化方案的问题
- 使用 Claude 3.5 测试查询结果
- 问题 1：即使指定按战斗分数排序，返回的玩家并非最高分，结果随机
- 问题 2：通用查询（如"创建五人团队"）无法返回有价值的结果
- **根本原因分析**：
  - 多维度数据（助攻、伤害、击杀、胜场等）在向量空间中失去了上下文关联
  - 向量化无法保留数据特征之间的语义关系
  - **数字问题**：向量数据库无法理解数字的数学关系（如 5、10、15 的倍数关系）

19:45 - 24:00 | 第二次尝试：函数调用（Agentic AI）
- 决定不使用简单的 Python 脚本，而是让 AI 理解并使用所有指标
- 使用 Amazon Bedrock Agents（代理构建器）
- **两步配置**：
  1. 提供详细指令：为每张地图选择最佳角色，为每个角色选择最佳玩家，组建五人团队，分配地图和角色，制定策略
  2. 创建 Action Group（ESquery）：通过 Lambda 函数查询 OpenSearch 数据库
- 工作流程：Bedrock 生成 ES 查询 → Lambda 执行查询 → 返回数据给 Bedrock

24:00 - 27:30 | 函数调用方案的成功与失败
- **成功案例**：系统综合考虑了战斗分数、道具使用效率、进攻积极性等多个指标，生成了全面的分析报告
- **问题**：这种成功只在 20-30 次尝试中出现过一次
- **五大技术障碍**：
  1. **认知过载**：单个提示词要求 LLM 完成太多任务
  2. **Lambda 响应限制**：返回数据不能超过 25KB，超出则执行失败
  3. **函数调用过多**：有时会产生 30 次以上的执行，无法有效筛选玩家
  4. **ES 查询依赖性**：聚合查询必须与数据集结构严格匹配
  5. **LLM 冻结**：执行超时，无函数调用，无日志追踪，完全停止响应

27:30 - 30:00 | 第三次尝试：多阶段工作流
- 距离提交截止仅剩 2 天
- 采用 AWS Step Functions 编排多个 LLM
- 架构：将任务拆分给不同的 LLM，使用 Lambda 缓存响应，存储到 DynamoDB
- 目的：构建聊天机器人，能够回答"为什么选择这个玩家"或"策略是什么"等问题
- **结果**：各个组件单独运行良好，但最终的汇总和五人选择从未成功

30:00 - 32:15 | 最终失败与意外发现
- 在截止前 10 分钟放弃提交
- 准备演讲时重新运行系统以获取失败截图
- **意外**：系统完美运行，没有任何失败

32:15 - 33:45 | 关键发现：简化提示词
- **核心教训**：不要教 LLM 它已经知道的东西
- **提示词对比**：
  - 之前：详细说明如何思考、如何按地图选择玩家、如何按角色选择等
  - 现在：仅说"为 Valorant 创建一个团队"，提供 OpenSearch 架构
- LLM 从预训练中已经知道：
  - Valorant 是一款游戏
  - 需要五名玩家
  - 不同地图需要不同的进攻风格和角色特征
- 过度指导反而干扰了 LLM 的固有知识

33:45 - 34:30 | 总结与反思
- 最初认为这是一个简单的周末项目，实际上远比想象复杂
- 演讲者感谢听众参与，开放问答环节