# AWS re:Invent 2025 多云环境节点管理与可观测性会议总结

## 会议概述

本次会议由AWS首席技术专家Clark Richie和高级解决方案架构师Eric Weber主讲,重点探讨了在多云环境中进行集中化节点管理和可观测性的实践方法。会议针对在多云场景下开发和运维人员面临的复杂性挑战,提供了基于AWS Systems Manager的实用解决方案。

演讲者首先通过现场互动了解到大多数与会者正在多云环境中开发,但很少有人喜欢处理由此带来的各种新工具和复杂性。会议的核心目标是帮助简化多云管理工作,减少手动操作,提高自动化水平。通过实际的控制台演示和客户案例(如Rackspace),展示了如何使用AWS服务在AWS、Azure、GCP以及本地环境中实现统一的资源管理、补丁合规性检查、安全远程访问和大规模自动化操作。

整个会议强调了实用性和可操作性,所有展示的技术和方法都可以立即应用到实际工作中,帮助团队节省时间并获得投资回报。

## 详细时间线与关键要点

### 开场与背景介绍 (00:00 - 03:30)
- **00:00** - 会议开始,演讲者进行现场互动调查,了解有多少人在多云环境中开发
- **00:30** - 询问开发者是否喜欢处理多云环境中的新工具和复杂性,得到的回应很少
- **01:00** - Clark Richie自我介绍为AWS首席技术专家,Eric Weber为高级解决方案架构师
- **01:30** - 说明会议目标:帮助解决多云环境中的工具和压力问题
- **02:00** - 概述会议议程:集中化节点管理、可观测性、客户案例和后续资源
- **03:00** - 强调会议将提供可操作的实用工具和技术,包括实时演示和客户ROI案例

### 多云定义与挑战 (03:30 - 06:00)
- **03:30** - 定义AWS对多云的理解:在不同云平台运行一个或多个应用程序和工作负载
- **04:00** - 区分多云与使用SaaS服务(如Office 365)的区别
- **04:30** - 讨论多云的两种情况:主动选择(业务驱动)和被动接受(并购导致)
- **05:00** - 列举多云带来的挑战:新技能、新培训、新工具、新运行手册、新流程
- **05:30** - 承诺提供技术和技巧来简化多云管理

### 集中化节点管理挑战 (06:00 - 08:30)
- **06:00** - Eric Weber开始讲解集中化节点管理部分
- **06:30** - 第一个挑战:了解当前资源清单,包括EC2、Azure VM、GCP VM、本地环境和边缘设备
- **07:00** - 第二个挑战:补丁合规性管理,满足监管和内部安全要求
- **07:30** - 第三个挑战:消除从互联网直接RDP或SSH访问,移除端口22和3389
- **08:00** - 第四个挑战:提高自动化水平,避免手动登录节点执行命令

### AWS Systems Manager介绍 (08:30 - 11:00)
- **08:30** - 介绍AWS Systems Manager作为管理任何位置资源的服务
- **09:00** - 说明基于SSM Agent(Systems Manager Agent)工作原理
- **09:30** - 可以安装在AWS资源、本地、边缘或其他云提供商的资源上
- **10:00** - AWS AMI中许多已预装SSM Agent
- **10:30** - 安装Agent后可执行节点管理任务、补丁和收集清单数据

### 建立集中化清单 (11:00 - 15:00)
- **11:00** - 详细讲解建立集中化清单的过程
- **11:30** - 从安装Systems Manager Agent开始
- **12:00** - 创建混合激活码(Hybrid Activation Code),类似IAM访问密钥
- **12:30** - 激活码确定注册到哪个账户、区域以及授予哪个IAM角色权限
- **13:00** - 可通过VPC端点私密连接,无需通过公网
- **13:30** - IAM角色生成临时STS令牌,持续轮换
- **14:00** - 应用程序可使用相同的临时凭证访问AWS资源(如S3、DynamoDB、RDS)
- **14:30** - 避免使用长期硬编码密钥

### 自动化注册流程 (15:00 - 19:00)
- **15:00** - 讲解如何自动化SSM Agent安装和注册过程
- **15:30** - 新节点启动时通过用户数据或启动脚本查询API Gateway端点
- **16:00** - API Gateway后端由Lambda支持,执行快速评估
- **16:30** - Lambda查询Systems Manager Parameter Store获取激活码
- **17:00** - 解释为何需要API Gateway:在没有AWS凭证前访问Parameter Store
- **17:30** - Lambda验证后将激活码返回给服务器/VM
- **18:00** - 节点随后完成注册过程

### Rackspace客户案例 (19:00 - 21:00)
- **19:00** - 展示Rackspace如何使用该方法
- **19:30** - Rackspace在GCP、Azure、VMware环境中运行引导脚本
- **20:00** - 通过API Gateway和Lambda返回混合激活码
- **20:30** - Rackspace自动化管理超过数十万个VM的任务
- **21:00** - 减少手动工作量,实现引导、配置维护、补丁、会话管理和脚本执行

### 控制台演示:Systems Manager统一控制台 (21:00 - 25:00)
- **21:00** - 切换到AWS控制台进行实际演示
- **21:30** - 展示Systems Manager统一控制台(去年发布)
- **22:00** - 从委托管理员账户聚合所有托管节点数据到单一位置
- **22:30** - 仪表板显示托管节点数量、未托管EC2实例
- **23:00** - 显示节点分类:11个EC2实例和18个混合节点
- **23:30** - 展示SSM Agent版本信息
- **24:00** - 按操作系统分类显示(Windows/Linux及具体版本)
- **24:30** - 可从单一位置浏览跨账户和区域的节点

### Azure VM创建演示 (25:00 - 30:00)
- **25:00** - 切换到Azure控制台演示创建新VM
- **25:30** - 创建Ubuntu节点,使用现有密钥
- **26:00** - 配置网络信息,Azure虚拟网络与AWS VPC之间有私有连接
- **26:30** - 移除端口22的入站规则,提高安全性
- **27:00** - 展示引导脚本,包含API Gateway端点
- **27:30** - 强调需要API Gateway来在没有凭证前获取激活码
- **28:00** - 启动VM,预计2-4分钟完成注册
- **28:30** - 等待部署完成

### 混合激活码详解 (30:00 - 33:00)
- **30:00** - 在控制台的激活部分查看混合激活码
- **30:30** - 展示已创建的几个不同激活码
- **31:00** - 激活码指定资源应注册到哪个账户和区域
- **31:30** - 可通过CLI或SDK添加自动标签
- **32:00** - 重点介绍IAM角色部分,可附加CloudWatch权限
- **32:30** - CloudWatch Agent可使用这些凭证发送日志和指标
- **33:00** - 激活码最长有效期30天,因此需要自动化

### 节点注册验证 (33:00 - 36:00)
- **33:00** - 返回探索节点部分检查是否注册成功
- **33:30** - 托管资源从29个增加到30个
- **34:00** - 检查Azure中新VM的IP地址(07)
- **34:30** - 在Systems Manager中找到新注册的Azure VM4资源
- **35:00** - 节点将执行多项评估
- **35:30** - 现在可以对注册设备运行各种工具

### 节点管理工具演示 (36:00 - 40:00)
- **36:00** - 展示开箱即用的各种工具
- **36:30** - 可授予日常操作员访问权限而无需OS级别访问
- **37:00** - 可从AWS控制台、CLI、API和SDK运行命令
- **37:30** - 展示性能计数器工具,获取按需指标
- **38:00** - 可查看CPU利用率、磁盘I/O、内存使用、网络流量
- **38:30** - 对刚启动几分钟的节点进行快速检查
- **39:00** - 切换到另一个之前部署的资源进行演示

### 进程管理演示 (40:00 - 43:00)
- **40:00** - 选择进程工具,与SSM Agent建立连接
- **40:30** - SSM Agent使用出站443端口,通过反向连接工作
- **41:00** - 如果部署了VPC端点,节点甚至不需要互联网访问
- **41:30** - 启动与混合资源的会话
- **42:00** - 查看节点上运行的实时进程
- **42:30** - 演示终止stress-ng进程(之前用于压测服务器)
- **43:00** - 节点CPU利用率恢复到正常的1-2%

### 补丁管理 (43:00 - 48:00)
- **43:00** - 回顾集中化清单建立和可用工具
- **43:30** - 进入补丁合规性挑战部分
- **44:00** - 切换到控制台的Patch Manager部分
- **44:30** - 显示托管与未托管资源的快速概览
- **45:00** - 约10个节点不符合补丁要求
- **45:30** - 显示缺少更新、安装失败、待重启的节点数量
- **46:00** - 显示资源不合规或从未报告补丁状态的时长
- **46:30** - 新启动的VM被识别为未知补丁合规状态
- **47:00** - 环境配置为每天凌晨2点扫描
- **47:30** - 其他资源有相对新鲜的数据(7天内)

### 补丁扫描演示 (48:00 - 51:00)
- **48:00** - 查看针对资源采取的所有操作历史
- **48:30** - 对新Ubuntu节点执行手动补丁扫描
- **49:00** - 选择"Patch now"并配置扫描选项
- **49:30** - 手动选择要扫描的节点
- **50:00** - 选择Ubuntu资源并启动补丁扫描
- **50:30** - 扫描预计需要30秒到1分钟
- **51:00** - 等待扫描完成期间继续讲解其他内容

### 资源数据同步 (51:00 - 52:30)
- **51:00** - 提到可以聚合补丁合规数据
- **51:30** - 介绍资源数据同步功能,将数据发送到S3存储桶
- **52:00** - 创建跨AWS、Azure等环境的集中化补丁合规数据源
- **52:30** - 进入下一个挑战:安全远程连接

### 安全远程访问 (52:30 - 56:00)
- **52:30** - 讨论在事件或值班情况下需要远程连接的场景
- **53:00** - 如何以安全方式连接而不允许入站访问
- **53:30** - 返回探索节点部分,找到新配置的VM
- **54:00** - 可以像EC2实例一样远程连接
- **54:30** - 无需允许入站端口22或3389
- **55:00** - 使用Systems Manager作为网络隧道
- **55:30** - 可从AWS控制台或CLI启动交互式会话

### Session Manager演示 (56:00 - 60:00)
- **56:00** - 启动与Azure VM的会话
- **56:30** - 会话建立后可运行所需命令
- **57:00** - 演示运行"echo hello reinvent"命令
- **57:30** - Session Manager的关键功能:可记录执行的命令
- **58:00** - 可将日志发送到CloudWatch Logs或S3存储桶
- **58:30** - 会话终止后可回顾执行的命令
- **59:00** - 切换到CloudWatch控制台查看日志
- **59:30** - 进入日志管理部分

### CloudWatch日志查看 (60:00 - 63:00)
- **60:00** - 查看名为"session-manager"的CloudWatch日志组
- **60:30** - 显示所有已建立会话的不同流
- **61:00** - 查看具体日志流内容
- **61:30** - 可以看到执行的"whoami"命令和时间戳
- **62:00** - 滚动到底部看到"hello reinvent"命令
- **62:30** - 强调这是回顾操作员操作的好方法
- **63:00** - 可以基于特定命令构建告警

### 补丁扫描结果 (63:00 - 66:00)
- **63:00** - 检查补丁扫描进度
- **63:30** - 扫描已完成
- **64:00** - 返回Patch Manager查看合规性报告
- **64:30** - 查看有多少资源缺少更新
- **65:00** - 显示EC2实例和混合资源的不合规情况
- **65:30** - 可深入查看标记为缺失的具体更新
- **66:00** - 为应用程序所有者准备即将安装的更新信息

### 大规模自动化挑战 (66:00 - 69:00)
- **66:00** - 回顾已讨论的挑战:集中化清单、补丁合规、安全连接
- **66:30** - 强调手动登录执行命令在超过5-10个节点时效率低下
- **67:00** - 介绍Systems Manager Automation用于大规模执行操作
- **67:30** - 切换到控制台展示自动化运行手册
- **68:00** - 介绍Automation和Run Command作为编排一系列步骤的方法
- **68:30** - 可执行AWS API调用或与托管节点操作系统交互

### Automation Runbook演示 (69:00 - 74:00)
- **69:00** - 提到有400多个开箱即用的AWS运行手册
- **69:30** - 强调这是建立权限委派的好方法
- **70:00** - 示例:授予用户通过Automation重启EC2的权限,而非直接EC2权限
- **70:30** - 确保以明确定义和预期的方式执行操作
- **71:00** - 展示收藏的简单运行手册
- **71:30** - 场景:对资源队列运行通用脚本
- **72:00** - 无论资源在AWS、本地还是其他云
- **72:30** - 查看Automation的创作体验
- **73:00** - 展示可视化设计器,可拖放添加步骤
- **73:30** - 演示运行手册步骤流程

### Runbook步骤详解 (74:00 - 78:00)
- **74:00** - 第一步:描述账户区域中所有节点列表
- **74:30** - 第二步:循环遍历节点列表
- **75:00** - 第三步:判断资源是Windows还是Linux节点
- **75:30** - 根据判断运行相应脚本
- **76:00** - 可包含额外的验证或分支逻辑
- **76:30** - 展示示例规则:检查是否为Linux且节点在线
- **77:00** - 如果节点离线则跳过,无需等待
- **77:30** - 满足条件后运行简单shell脚本

### DynamoDB集成演示 (78:00 - 82:00)
- **78:00** - 脚本检查syslog或messages文件是否存在
- **78:30** - 将信息存储到DynamoDB
- **79:00** - 记录文件是否存在(true/false)
- **79:30** - 返回执行自动化界面
- **80:00** - 展示DynamoDB表,验证当前为空
- **80:30** - 查看"manage-node-log-compliance"表
- **81:00** - 探索项目,确认当前为空
- **81:30** - 返回Automation准备执行

### 自动化执行 (82:00 - 86:00)
- **82:00** - 所有参数都有默认值,但可以动态配置
- **82:30** - 可以传递脚本的远程位置
- **83:00** - 不必将所有内容放在一起,可使用CI/CD最佳实践
- **83:30** - 开始遍历环境中的30个节点
- **84:00** - 运行简单脚本并将结果发送到DynamoDB
- **84:30** - 记录文件是否存在
- **85:00** - 不等待所有完成,查看已填充的结果
- **85:30** - 已有几个节点报告信息

### State Manager介绍 (86:00 - 88:00)
- **86:00** - 强调使用Automation和Run Command组合可大规模执行操作
- **86:30** - 介绍State Manager Association
- **87:00** - 将其视为资源的配置定义
- **87:30** - 用于引导资源并保持配置状态
- **88:00** - 继续遍历节点,已达到36个步骤

### 可观测性部分开始 (88:00 - 92:00)
- **88:00** - 再次运行,已有7个节点报告合规状态
- **88:30** - 总结已讨论的大规模任务执行
- **89:00** - 通过Automation运行手册和Run Command任务
- **89:30** - 现在有了良好的节点管理基础
- **90:00** - 了解资源位置、补丁合规状态、安全连接和大规模操作
- **90:30** - 进入第二部分:可观测性
- **91:00** - 需要监控资源,确保健康状态
- **91:30** - 收集日志信息,检查应用程序运行状态

### 可观测性挑战 (92:00 - 95:00)
- **92:00** - 列举多云场景中的可观测性挑战
- **92:30** - 第一个挑战:资源未被监控
- **93:00** - 资源启动时可能没有适当的引导配置
- **93:30** - 应用程序所有者可能不熟悉可观测性
- **94:00** - 可能没有在构建应用时考虑可观测性
- **94:30** - Systems Manager可帮助建立初始监控配置

### 日志管理挑战 (95:00 - 98:00)
- **95:00** - 除了指标、跨度和追踪,还需考虑日志
- **95:30** - 远程资源和一般日志可能分散在多个账户和区域
- **96:00** - 客户从少数AWS账户到数百个账户不等
- **96:30** - 如何将日志集中到一个位置以便查询
- **97:00** - 帮助减少平均解决时间(MTTR)
- **97:30** - 最后一个挑战:如何在AWS控制台外公开运营指标

### 公开运营指标 (98:00 - 100:00)
- **98:00** - 客户希望向业务领导或高层报告者公开运营指标
- **98:30** - 这些人可能不熟悉AWS控制台
- **99:00** - 或者不希望他们登录控制台
- **99:30** - 考虑他们可能执行的其他操作
- **100:00** - 如何以更简单的方式公开运营指标

### 未监控资源解决方案 (100:00 - 104:00)
- **100:00** - 回到Systems Manager Agent和临时凭证
- **100:30** - 演示如何引导节点自动安装CloudWatch Agent
- **101:00** - 自动报告指标和日志
- **101:30** - 仍从混合激活码过程开始
- **102:00** - 注册到Systems Manager
- **102:30** - 节点首次签入时查询State Manager的关联
- **103:00** - 关联作为配置工具
- **103:30** - 定义要在节点上执行的脚本或操作

### 会议内容截断说明
104:00+ - 字幕在此处截断,会议可能还包含更多关于CloudWatch Agent配置、日志聚合、指标公开和其他可观测性最佳实践的内容

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注意: 本总结基于提供的字幕文本,字幕在约104分钟处截断,完整会议可能包含更多内容。