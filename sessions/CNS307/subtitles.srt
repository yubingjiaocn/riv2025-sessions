1
00:00:01,497 --> 00:00:02,873
- How y'all doing?

2
00:00:02,873 --> 00:00:03,706
(audience responds)

3
00:00:03,706 --> 00:00:05,310
All right, I'm glad three of you're good.

4
00:00:05,310 --> 00:00:06,990
That makes me happy.

5
00:00:06,990 --> 00:00:08,417
How y'all doing?

6
00:00:08,417 --> 00:00:09,250
(audience responds)

7
00:00:09,250 --> 00:00:10,440
All right, there we go. There we go.

8
00:00:10,440 --> 00:00:12,720
I'm so excited here, we started early.

9
00:00:12,720 --> 00:00:14,040
It's not even time yet,

10
00:00:14,040 --> 00:00:16,140
but we did it 'cause we're excited.

11
00:00:16,140 --> 00:00:19,440
My name is Eric Johnson, and
I'm super happy to be here.

12
00:00:19,440 --> 00:00:22,740
I'm a principal developer advocate at AWS.

13
00:00:22,740 --> 00:00:23,573
And let's get our,

14
00:00:23,573 --> 00:00:25,730
we're gonna slip our
slide on here real quick.

15
00:00:27,450 --> 00:00:28,560
There we go.

16
00:00:28,560 --> 00:00:30,870
All right, now we're
seeing what we should see.

17
00:00:30,870 --> 00:00:32,760
And Matt, introduce yourself.

18
00:00:32,760 --> 00:00:34,110
- Hey, everybody, my name's Matt.

19
00:00:34,110 --> 00:00:36,240
I'm part of the specialist
team here at AWS.

20
00:00:36,240 --> 00:00:37,800
I'm a container specialist.

21
00:00:37,800 --> 00:00:41,250
I spend most of my time
helping customers build cool,

22
00:00:41,250 --> 00:00:45,870
exciting, interesting
architectures with ECS and Lambda

23
00:00:45,870 --> 00:00:48,000
and all of our cool
auto mode technologies.

24
00:00:48,000 --> 00:00:50,280
- I have to be honest, I'm super
thrilled to talk with Matt.

25
00:00:50,280 --> 00:00:52,080
Matt and I have got to
travel a lot together.

26
00:00:52,080 --> 00:00:54,540
I have now learned to say
his last name properly.

27
00:00:54,540 --> 00:00:58,080
It's Meckes, not Meeks.

28
00:00:58,080 --> 00:00:59,550
At least that's what he tells me.

29
00:00:59,550 --> 00:01:00,383
- Almost, almost.

30
00:01:00,383 --> 00:01:01,530
- I nailed it, didn't I? Yeah.

31
00:01:01,530 --> 00:01:04,800
So how many of y'all have
heard me speak before?

32
00:01:04,800 --> 00:01:06,210
Oh, ooh, a good room.

33
00:01:06,210 --> 00:01:07,610
Okay, do you know the rules?

34
00:01:08,820 --> 00:01:10,020
All right, a couple of you know the rules.

35
00:01:10,020 --> 00:01:11,820
Mark out here knows the rules, all right.

36
00:01:11,820 --> 00:01:13,530
Well, for those of you
who don't know the rules,

37
00:01:13,530 --> 00:01:15,085
do you know the rules?

38
00:01:15,085 --> 00:01:15,918
- I don't know the rules, Eric.

39
00:01:15,918 --> 00:01:16,800
- Okay, well, here's the rules.

40
00:01:16,800 --> 00:01:19,290
So when I'm speaking, rules
is probably a strong word,

41
00:01:19,290 --> 00:01:22,470
but you know, it'll
really help you kind of,

42
00:01:22,470 --> 00:01:25,050
as we go through today, because
I like to have a lot of fun.

43
00:01:25,050 --> 00:01:26,250
But these are the rules, all right?

44
00:01:26,250 --> 00:01:27,300
There's three of them.

45
00:01:27,300 --> 00:01:29,040
Okay, the first is,

46
00:01:29,040 --> 00:01:33,030
this is any number I want it to be, okay?

47
00:01:33,030 --> 00:01:34,507
Now, I'm gonna hold this
up and I'm gonna say,

48
00:01:34,507 --> 00:01:36,270
"There's three rules," okay?

49
00:01:36,270 --> 00:01:37,777
And someone who comes in
late is gonna be like,

50
00:01:37,777 --> 00:01:39,360
"That's not a three."

51
00:01:39,360 --> 00:01:41,610
Well, it is because
that's the rule, right?

52
00:01:41,610 --> 00:01:44,370
Okay, the second is, these
are quotes, not apostrophes.

53
00:01:44,370 --> 00:01:45,737
And I know that, okay?

54
00:01:45,737 --> 00:01:48,330
'Cause this looks dumb, okay?

55
00:01:48,330 --> 00:01:49,830
So I do this, right?

56
00:01:49,830 --> 00:01:51,810
And finally, these are thumbs

57
00:01:51,810 --> 00:01:54,660
'cause this will get
you beat up, all right?

58
00:01:54,660 --> 00:01:57,030
So those are the three
rules, and that helps a lot.

59
00:01:57,030 --> 00:01:58,920
I do like to make a lot
of one-fingered jokes.

60
00:01:58,920 --> 00:02:01,140
I will make jokes as
we're going through today.

61
00:02:01,140 --> 00:02:03,420
I'm very comfortable. I was born this way.

62
00:02:03,420 --> 00:02:05,520
I didn't wake up this way for
the first time this morning.

63
00:02:05,520 --> 00:02:06,480
I did wake up this way,

64
00:02:06,480 --> 00:02:09,090
but not for the first time this morning.

65
00:02:09,090 --> 00:02:10,920
But again, I'm very comfortable with that.

66
00:02:10,920 --> 00:02:15,060
However, if that makes you uncomfortable,

67
00:02:15,060 --> 00:02:16,650
I'm also comfortable with that.

68
00:02:16,650 --> 00:02:18,300
So I'm good.

69
00:02:18,300 --> 00:02:19,890
And we'll have a good time today.

70
00:02:19,890 --> 00:02:22,110
Super happy you're here.

71
00:02:22,110 --> 00:02:24,150
Matt and I have been working through this,

72
00:02:24,150 --> 00:02:25,500
excited about this deck.

73
00:02:25,500 --> 00:02:27,780
How many of y'all are using,

74
00:02:27,780 --> 00:02:29,670
by the way, if you're
not familiar with y'all,

75
00:02:29,670 --> 00:02:30,990
that's everybody in the room.

76
00:02:30,990 --> 00:02:32,970
So that's a Texas thing. So there you go.

77
00:02:32,970 --> 00:02:34,080
There's all y'all too.

78
00:02:34,080 --> 00:02:38,640
So how many of you all are using ECS now?

79
00:02:38,640 --> 00:02:41,040
Oh, okay, all righty, good.

80
00:02:41,040 --> 00:02:44,280
How many of y'all are doing
event-driven architectures

81
00:02:44,280 --> 00:02:45,870
with ECS?

82
00:02:45,870 --> 00:02:47,859
Well, why are you here?

83
00:02:47,859 --> 00:02:48,780
(audience laughing)

84
00:02:48,780 --> 00:02:50,880
All right, so you wanna
learn how to do it better?

85
00:02:50,880 --> 00:02:53,040
Okay, we really gotta,
we gotta meet the bar.

86
00:02:53,040 --> 00:02:53,873
- Gave my-

87
00:02:53,873 --> 00:02:54,706
- Yeah, exactly, all right.

88
00:02:54,706 --> 00:02:56,730
Just a lot of pressure on us to hit this.

89
00:02:56,730 --> 00:02:58,560
So that's what we're gonna
be talking about today,

90
00:02:58,560 --> 00:03:01,470
is event-driven architectures,

91
00:03:01,470 --> 00:03:04,680
but using Amazon ECS with AWS Fargate.

92
00:03:04,680 --> 00:03:06,570
And that may not be the
first thing you think about.

93
00:03:06,570 --> 00:03:08,970
You may not go, "Ah, yeah,
EDA, we think Fargate,

94
00:03:08,970 --> 00:03:10,170
we think ECS."

95
00:03:10,170 --> 00:03:12,450
But it's a very viable solution today.

96
00:03:12,450 --> 00:03:14,430
We're gonna talk through that.

97
00:03:14,430 --> 00:03:15,390
All right, you ready?

98
00:03:15,390 --> 00:03:16,590
- Let's go.

99
00:03:16,590 --> 00:03:17,423
- Here we go.

100
00:03:17,423 --> 00:03:19,020
All right, we wanna introduce
you to a buddy of ours.

101
00:03:19,020 --> 00:03:21,630
This is Sarah.

102
00:03:21,630 --> 00:03:24,630
Now, I know we've all been,
how many, let me ask you this.

103
00:03:24,630 --> 00:03:26,670
How many of y'all are developers?

104
00:03:26,670 --> 00:03:28,440
Okay, how many of y'all dabble with code

105
00:03:28,440 --> 00:03:30,000
but don't claim to be a developer?

106
00:03:30,000 --> 00:03:31,560
All right, so you're a developer.

107
00:03:31,560 --> 00:03:32,820
Stop hinging on that, all right?

108
00:03:32,820 --> 00:03:35,310
So if you dabble with code,
you're developer, right?

109
00:03:35,310 --> 00:03:36,180
This is Sarah.

110
00:03:36,180 --> 00:03:38,730
Sarah runs a midsize
development team, right?

111
00:03:38,730 --> 00:03:40,470
And they use ECS.

112
00:03:40,470 --> 00:03:42,000
They primarily use ECS,

113
00:03:42,000 --> 00:03:45,420
and they love ECS and
they love Sarah, right?

114
00:03:45,420 --> 00:03:48,600
And here we are, and we've all been there.

115
00:03:48,600 --> 00:03:51,000
This time, it's November 27th.

116
00:03:51,000 --> 00:03:52,530
Do we have the dates
right? That might be wrong.

117
00:03:52,530 --> 00:03:53,910
Do I change that? We'll see.

118
00:03:53,910 --> 00:03:55,320
Anyway, it's Black Friday.

119
00:03:55,320 --> 00:03:57,150
Maybe I have the dates
wrong. We'll see on that.

120
00:03:57,150 --> 00:03:59,820
But it's Black Friday.
It's late in the evening.

121
00:03:59,820 --> 00:04:01,890
Anybody been watching their architecture

122
00:04:01,890 --> 00:04:03,960
right before Black Friday?

123
00:04:03,960 --> 00:04:06,510
If you haven't, you haven't
been a developer long, right?

124
00:04:06,510 --> 00:04:08,070
I've been that developer
in the middle of the night,

125
00:04:08,070 --> 00:04:10,200
and you're watching,
you're good, you're solid,

126
00:04:10,200 --> 00:04:11,700
things are looking okay,

127
00:04:11,700 --> 00:04:14,520
maybe there's a little
hiccup, but we're okay.

128
00:04:14,520 --> 00:04:16,560
And then all of a
sudden, 10 minutes later,

129
00:04:16,560 --> 00:04:18,930
everything falls apart, right?

130
00:04:18,930 --> 00:04:21,570
10 minutes after you drop a brand new SKU,

131
00:04:21,570 --> 00:04:23,550
something exciting is coming out.

132
00:04:23,550 --> 00:04:27,300
Your system can't handle it.

133
00:04:27,300 --> 00:04:29,205
And this is where Sarah's at,

134
00:04:29,205 --> 00:04:31,605
and we've all been there
at 3:30 in the morning.

135
00:04:32,850 --> 00:04:35,370
If you haven't had your
head on a desk crying,

136
00:04:35,370 --> 00:04:37,860
you're not a developer, right?

137
00:04:37,860 --> 00:04:39,510
Or put your head through a wall, right?

138
00:04:39,510 --> 00:04:41,070
So we've all been there.

139
00:04:41,070 --> 00:04:43,080
But here's the truth, okay?

140
00:04:43,080 --> 00:04:45,600
This isn't an ECS problem,

141
00:04:45,600 --> 00:04:47,970
it's an architectural problem, right?

142
00:04:47,970 --> 00:04:49,830
If you don't know who that is, that's me.

143
00:04:49,830 --> 00:04:53,310
So I don't, or Matt, it
really could be Matt too.

144
00:04:53,310 --> 00:04:56,130
Really, it's just a beard that
makes a difference, right?

145
00:04:56,130 --> 00:04:57,810
So what went wrong?

146
00:04:57,810 --> 00:05:00,120
If you think about this, what went wrong?

147
00:05:00,120 --> 00:05:02,940
Well, like so many people,

148
00:05:02,940 --> 00:05:05,250
when Sarah built her architecture,

149
00:05:05,250 --> 00:05:08,923
she built it using
synchronous microservices.

150
00:05:08,923 --> 00:05:11,600
Now, microservices are
a good thing, right?

151
00:05:11,600 --> 00:05:13,380
We hear that all the time.

152
00:05:13,380 --> 00:05:14,940
Microservices, small, you know,

153
00:05:14,940 --> 00:05:16,470
independent services
that are run together.

154
00:05:16,470 --> 00:05:17,730
We love that.

155
00:05:17,730 --> 00:05:20,760
But the synchronous part can
kind of get us into trouble.

156
00:05:20,760 --> 00:05:22,050
And why is that?

157
00:05:22,050 --> 00:05:25,140
Well, when we make that
order and we hit the discount

158
00:05:25,140 --> 00:05:25,973
and everything's good,

159
00:05:25,973 --> 00:05:26,806
the next thing we're gonna do

160
00:05:26,806 --> 00:05:28,260
is we're gonna check our loyalty.

161
00:05:28,260 --> 00:05:31,050
And, oh no, our loyalty blew up.

162
00:05:31,050 --> 00:05:34,710
So what happens is the
whole thing kind of fizzles

163
00:05:34,710 --> 00:05:36,540
and falls apart

164
00:05:36,540 --> 00:05:39,600
because we've tightly
coupled this architecture,

165
00:05:39,600 --> 00:05:41,610
and it's all kind of
dependent on each other.

166
00:05:41,610 --> 00:05:44,610
And this probably isn't
news to a lot of you, right?

167
00:05:44,610 --> 00:05:45,960
You're like, "Oh, yeah,
yeah, I've seen this before."

168
00:05:45,960 --> 00:05:48,330
But you might have some
architecture this way.

169
00:05:48,330 --> 00:05:51,060
Anybody responsible for that old 1988 code

170
00:05:51,060 --> 00:05:52,980
that's built like this, right?

171
00:05:52,980 --> 00:05:54,420
I've been there, right?

172
00:05:54,420 --> 00:05:57,630
And so it's like, "Well,
how do we fix this?" Right?

173
00:05:57,630 --> 00:06:01,323
So in reality, Sarah
needs a different way.

174
00:06:02,190 --> 00:06:04,680
So when we say a different way,

175
00:06:04,680 --> 00:06:07,170
you know, let's look at
the synchronous model

176
00:06:07,170 --> 00:06:09,630
and see kind of why we wanna change that.

177
00:06:09,630 --> 00:06:12,030
So you think about synchronous
response and request models,

178
00:06:12,030 --> 00:06:13,687
or request response models, you think,

179
00:06:13,687 --> 00:06:15,030
"Well, these are good," right?

180
00:06:15,030 --> 00:06:15,990
They've got some advantages,

181
00:06:15,990 --> 00:06:18,060
they're low latency,
they're very fast, right?

182
00:06:18,060 --> 00:06:19,140
It's simple.

183
00:06:19,140 --> 00:06:22,620
Yeah, anybody can build a
synchronous microservice, right?

184
00:06:22,620 --> 00:06:24,480
And it fails fast.

185
00:06:24,480 --> 00:06:25,313
It's very often,

186
00:06:25,313 --> 00:06:27,150
or it's not very often
that we like to fail,

187
00:06:27,150 --> 00:06:28,650
but when we're gonna fail,

188
00:06:28,650 --> 00:06:29,550
we want it to fail fast

189
00:06:29,550 --> 00:06:31,320
and we want it to fail
in development, right?

190
00:06:31,320 --> 00:06:32,370
So that's a good thing.

191
00:06:32,370 --> 00:06:35,700
But there are some pretty big
disadvantages to this as well,

192
00:06:35,700 --> 00:06:37,590
ones that are worth probably looking

193
00:06:37,590 --> 00:06:39,047
at getting out of it, right?

194
00:06:39,047 --> 00:06:40,947
'Cause the first is we
can get throttling, right?

195
00:06:40,947 --> 00:06:42,300
And so when you build these out,

196
00:06:42,300 --> 00:06:44,820
your producer, it needs to
know about your consumers.

197
00:06:44,820 --> 00:06:48,030
And as it's going
through, it gets complex.

198
00:06:48,030 --> 00:06:50,640
It can get throttled because
it can't send everything.

199
00:06:50,640 --> 00:06:51,767
Or maybe your consumer gets throttled

200
00:06:51,767 --> 00:06:54,450
'cause it can't handle everything.

201
00:06:54,450 --> 00:06:56,621
And then you get resiliency issues,

202
00:06:56,621 --> 00:06:59,610
and you have problems on Black Friday

203
00:06:59,610 --> 00:07:02,880
at 3:30 in the morning,
and that's where you're at.

204
00:07:02,880 --> 00:07:04,710
So how do you fix that?

205
00:07:04,710 --> 00:07:06,390
Well, that's what we're
gonna talk about today,

206
00:07:06,390 --> 00:07:08,220
and we're gonna talk about
that in relation to, you know,

207
00:07:08,220 --> 00:07:11,310
running microservices and
running things on ECS.

208
00:07:11,310 --> 00:07:14,379
Now, how do we think you should do this?

209
00:07:14,379 --> 00:07:15,720
But really, and that
this is gonna be a little

210
00:07:15,720 --> 00:07:19,650
oversimplified, but it really
comes down to not using,

211
00:07:19,650 --> 00:07:21,210
or synchronous microservices, right?

212
00:07:21,210 --> 00:07:22,440
It comes down to,

213
00:07:22,440 --> 00:07:25,920
what we like to do is insert
a broker of subtype, right?

214
00:07:25,920 --> 00:07:26,753
Where we wanna say,

215
00:07:26,753 --> 00:07:28,530
rather than in that previous model

216
00:07:28,530 --> 00:07:30,330
where the producer talks to the consumer

217
00:07:30,330 --> 00:07:32,040
and the consumer responds to the producer,

218
00:07:32,040 --> 00:07:34,140
instead, we're gonna put a broker in.

219
00:07:34,140 --> 00:07:37,770
Now, this broker is a very kind
of just a term we're using.

220
00:07:37,770 --> 00:07:39,210
I'm not picking a specific one.

221
00:07:39,210 --> 00:07:40,830
We'll actually get into
that in a little bit.

222
00:07:40,830 --> 00:07:43,590
But this is the idea of
something's in the middle

223
00:07:43,590 --> 00:07:45,367
and their entire job's to go,

224
00:07:45,367 --> 00:07:49,290
"Hey, I got your request.
Have a good day."

225
00:07:49,290 --> 00:07:52,770
And then the consumer either
through polling, pulling,

226
00:07:52,770 --> 00:07:56,137
or pushing or any different
kind of models will say,

227
00:07:56,137 --> 00:07:57,570
"Hey, give me that."

228
00:07:57,570 --> 00:07:59,130
Or, "Hey, thank you for that."

229
00:07:59,130 --> 00:08:00,360
And I'll acknowledge.

230
00:08:00,360 --> 00:08:01,890
And maybe they acknowledge to the broker,

231
00:08:01,890 --> 00:08:03,480
maybe they acknowledge back to the client.

232
00:08:03,480 --> 00:08:05,700
There's different patterns,
we'll look at that.

233
00:08:05,700 --> 00:08:07,710
But this idea of having
something in the middle

234
00:08:07,710 --> 00:08:11,070
to help break these apart
and decouple the producer

235
00:08:11,070 --> 00:08:13,080
from the consumer is where we get

236
00:08:13,080 --> 00:08:17,430
into a lot more flexibility
and reliability, right?

237
00:08:17,430 --> 00:08:20,490
So we're talking about this idea

238
00:08:20,490 --> 00:08:24,270
in what we call event-driven architecture.

239
00:08:24,270 --> 00:08:27,900
Now, let's look at what does
event-driven architecture mean.

240
00:08:27,900 --> 00:08:29,430
I'm gonna read this to you.

241
00:08:29,430 --> 00:08:30,840
Event-driven architecture,

242
00:08:30,840 --> 00:08:33,900
EDA is a distributed computing
paradigm implementing

243
00:08:33,900 --> 00:08:35,520
asynchronous message-passing semantics

244
00:08:35,520 --> 00:08:37,290
through intermediary message brokers,

245
00:08:37,290 --> 00:08:39,000
enabling temporal and spatial decoupling

246
00:08:39,000 --> 00:08:41,400
of system components via
non-blocking I/O operations

247
00:08:41,400 --> 00:08:43,320
and persistent event storage.

248
00:08:43,320 --> 00:08:44,580
You can go.

249
00:08:44,580 --> 00:08:47,190
I've given you all you need to know.

250
00:08:47,190 --> 00:08:48,753
Anybody understand that?

251
00:08:50,280 --> 00:08:54,210
I intentionally had Claude
give me a complex explanation

252
00:08:54,210 --> 00:08:57,240
because sometimes DA is a mystery to us.

253
00:08:57,240 --> 00:09:00,300
We look at it and go,
"Oh, that's scary stuff."

254
00:09:00,300 --> 00:09:02,160
But in reality,

255
00:09:02,160 --> 00:09:05,520
I'm gonna give you a more
technical definition of EDA.

256
00:09:05,520 --> 00:09:07,410
And if you were ever
gonna write something down

257
00:09:07,410 --> 00:09:09,090
or take a picture, this is the time,

258
00:09:09,090 --> 00:09:11,340
because this is gonna get super technical.

259
00:09:11,340 --> 00:09:12,810
I might have to do it a couple times.

260
00:09:12,810 --> 00:09:14,520
So let me explain EDA to you.

261
00:09:14,520 --> 00:09:15,780
You ready?

262
00:09:15,780 --> 00:09:17,040
Matt still doesn't understand this,

263
00:09:17,040 --> 00:09:18,414
but I'll give it to you, all right?

264
00:09:18,414 --> 00:09:19,247
- [Matt] I'm getting that later.

265
00:09:19,247 --> 00:09:20,080
- Okay, yeah, all right.

266
00:09:20,080 --> 00:09:21,330
So here's a less technical,

267
00:09:21,330 --> 00:09:23,480
but it's still technical
definition of EDA.

268
00:09:25,500 --> 00:09:26,710
Something happens

269
00:09:28,950 --> 00:09:29,853
and we respond.

270
00:09:31,260 --> 00:09:32,760
We react, I got it wrong.

271
00:09:32,760 --> 00:09:33,593
We're gonna do it again.

272
00:09:33,593 --> 00:09:35,070
Did everybody get that?

273
00:09:35,070 --> 00:09:35,903
Let's try it again.

274
00:09:35,903 --> 00:09:36,910
Something happens

275
00:09:37,980 --> 00:09:39,870
and we react.

276
00:09:39,870 --> 00:09:41,220
That's EDA.

277
00:09:41,220 --> 00:09:43,050
Yes, that's oversimplified.

278
00:09:43,050 --> 00:09:44,370
And yes, it's a little tongue in cheek,

279
00:09:44,370 --> 00:09:46,140
but it's the idea of,

280
00:09:46,140 --> 00:09:48,390
rather than our consumers
going, "What are you doing?

281
00:09:48,390 --> 00:09:49,320
What are you doing? What are you doing?

282
00:09:49,320 --> 00:09:50,850
What are you doing? What are you doing?"

283
00:09:50,850 --> 00:09:51,683
Or our producer's going,

284
00:09:51,683 --> 00:09:52,650
"Here's what I'm doing.
Here's what I'm doing.

285
00:09:52,650 --> 00:09:53,610
Here's what I'm doing.
Here's what I'm doing.

286
00:09:53,610 --> 00:09:54,443
Here's what I'm doing."

287
00:09:54,443 --> 00:09:57,517
And the logic getting very
coupled, we're able to say,

288
00:09:57,517 --> 00:10:00,303
"Let's break that apart
and make them kind of,

289
00:10:01,680 --> 00:10:03,030
you know, decoupled from each other."

290
00:10:03,030 --> 00:10:04,710
So what does that look like?

291
00:10:04,710 --> 00:10:06,360
Well, here in the, before EDA,

292
00:10:06,360 --> 00:10:08,790
we have this producer, is
talking to the consumers,

293
00:10:08,790 --> 00:10:09,960
and the producer needs to know

294
00:10:09,960 --> 00:10:11,257
about each of these
consumers, needs to know,

295
00:10:11,257 --> 00:10:13,590
"Hey, who's consuming my data?

296
00:10:13,590 --> 00:10:15,630
And, you know, and so it
needs to send to each one.

297
00:10:15,630 --> 00:10:16,950
So if something happens,

298
00:10:16,950 --> 00:10:18,990
it's gonna send to the consumer one,

299
00:10:18,990 --> 00:10:20,970
send to consumer two,
send to consumer three.

300
00:10:20,970 --> 00:10:22,440
We kind of saw this pattern already.

301
00:10:22,440 --> 00:10:25,530
So let's throw in a broker,
some kind of broker.

302
00:10:25,530 --> 00:10:26,707
And we break this down and we say,

303
00:10:26,707 --> 00:10:30,720
"Okay, now instead, I'm
gonna just send out an event.

304
00:10:30,720 --> 00:10:33,930
And I don't care what happens after that."

305
00:10:33,930 --> 00:10:36,060
I mean, overall, and,
you know, metaphorically

306
00:10:36,060 --> 00:10:39,720
and allegorically, I don't
even know the right words.

307
00:10:39,720 --> 00:10:43,200
We care, but the producer doesn't care.

308
00:10:43,200 --> 00:10:45,750
It just says, "Hey, I did
my job. Here's an event.

309
00:10:45,750 --> 00:10:46,583
Whoever consumes it, do it."

310
00:10:46,583 --> 00:10:49,230
And so these consumers go,
"Okay, yeah, I want that.

311
00:10:49,230 --> 00:10:50,847
I want that. I want that."

312
00:10:50,847 --> 00:10:53,580
And so there's some benefits to this.

313
00:10:53,580 --> 00:10:55,537
When we build this out and we say,

314
00:10:55,537 --> 00:10:57,240
"Okay, we're gonna break these apart,"

315
00:10:57,240 --> 00:10:58,320
it gives us the ability

316
00:10:58,320 --> 00:11:01,077
to build very scalable
applications, right?

317
00:11:01,077 --> 00:11:03,480
And so we're able to build bigger

318
00:11:03,480 --> 00:11:05,370
because we're not so tightly coupled.

319
00:11:05,370 --> 00:11:07,680
It also gives us resilience, right?

320
00:11:07,680 --> 00:11:09,180
So if consumer A goes down,

321
00:11:09,180 --> 00:11:11,160
consumer B is still chugging along.

322
00:11:11,160 --> 00:11:13,230
If there's some dependency on each other,

323
00:11:13,230 --> 00:11:14,490
we can handle that.

324
00:11:14,490 --> 00:11:16,590
But they can handle that gracefully.

325
00:11:16,590 --> 00:11:18,630
We can degrade gracefully, right?

326
00:11:18,630 --> 00:11:21,210
And finally, it gives us a lot of agility.

327
00:11:21,210 --> 00:11:22,470
When you build this way,

328
00:11:22,470 --> 00:11:24,540
rather than constantly
updating that producer

329
00:11:24,540 --> 00:11:26,820
to send it to, "Hey, you
need to know more logic

330
00:11:26,820 --> 00:11:28,260
to talk to these consumers."

331
00:11:28,260 --> 00:11:32,040
We need to then, all we do
is we add another consumer

332
00:11:32,040 --> 00:11:34,320
and say, "I'll consume that as well."

333
00:11:34,320 --> 00:11:37,440
So we can do that unbeknownst,
that was a big word.

334
00:11:37,440 --> 00:11:38,970
That was almost a
British word right there.

335
00:11:38,970 --> 00:11:43,053
Unbeknownst to the producer,
we can do that, right?

336
00:11:44,160 --> 00:11:45,510
This is a really cool pattern.

337
00:11:45,510 --> 00:11:48,120
However, here's the catch.

338
00:11:48,120 --> 00:11:51,157
Like so many of you,
Sarah's asking the question,

339
00:11:51,157 --> 00:11:55,470
"How do we go from
synchronous microservices

340
00:11:55,470 --> 00:11:58,467
to event-driven architecture?"

341
00:11:59,580 --> 00:12:01,530
And that's why we're here today, right?

342
00:12:01,530 --> 00:12:03,420
So I'm gonna turn it
over to my buddy, Matt,

343
00:12:03,420 --> 00:12:05,130
and Matt's gonna walk
you through some of this,

344
00:12:05,130 --> 00:12:07,170
and we'll be talking about some things.

345
00:12:07,170 --> 00:12:08,250
- So I think this is often

346
00:12:08,250 --> 00:12:09,840
when someone like me gets involved.

347
00:12:09,840 --> 00:12:13,260
So you've got a customer
who's had a major problem,

348
00:12:13,260 --> 00:12:15,510
they want to make some
sort of transformation

349
00:12:15,510 --> 00:12:16,980
or modernization.

350
00:12:16,980 --> 00:12:18,870
And we've gotta think about, you know,

351
00:12:18,870 --> 00:12:21,180
what's the kind of mental
model we're gonna use

352
00:12:21,180 --> 00:12:22,200
to go through this journey

353
00:12:22,200 --> 00:12:25,140
from kind of monolithic
synchronous services to EDA?

354
00:12:25,140 --> 00:12:28,260
I like to think of three real buckets

355
00:12:28,260 --> 00:12:33,000
of kind of categories of
questions we wanna think about.

356
00:12:33,000 --> 00:12:34,590
First, we've got our business logic.

357
00:12:34,590 --> 00:12:36,810
So the actual stuff that we
care about as developers,

358
00:12:36,810 --> 00:12:38,490
the stuff we've wrote, we've
gotta run that somewhere.

359
00:12:38,490 --> 00:12:40,640
So we gotta think about
what's our compute.

360
00:12:42,060 --> 00:12:43,680
Eric talked about event routers,

361
00:12:43,680 --> 00:12:46,740
and he just, you know, put a
kind of a nice green circle

362
00:12:46,740 --> 00:12:49,980
in his diagram and said,
"Hey, we've now decoupled."

363
00:12:49,980 --> 00:12:51,750
There's a lot more subtlety to that.

364
00:12:51,750 --> 00:12:53,220
So we've really gotta think about

365
00:12:53,220 --> 00:12:55,230
what event routers are we going to use?

366
00:12:55,230 --> 00:12:56,310
What are the trade-offs?

367
00:12:56,310 --> 00:12:58,753
What are the patterns that we can apply?

368
00:12:58,753 --> 00:13:01,080
And then we've gotta take those components

369
00:13:01,080 --> 00:13:02,100
and we've gotta combine them

370
00:13:02,100 --> 00:13:05,370
into all of these architectural
patterns and blueprints

371
00:13:05,370 --> 00:13:06,210
that we wanna do at scale.

372
00:13:06,210 --> 00:13:09,453
Because whilst something
happens, we react to it.

373
00:13:09,453 --> 00:13:11,880
It's really, really simple on that side.

374
00:13:11,880 --> 00:13:13,860
Actually, there's a lot of subtlety

375
00:13:13,860 --> 00:13:15,420
that actually within the category

376
00:13:15,420 --> 00:13:16,830
of event-driven architectures,

377
00:13:16,830 --> 00:13:21,830
there's a whole bunch of quite
precise subpatterns we can

378
00:13:21,900 --> 00:13:24,390
use that have their own
trade offs and complexities.

379
00:13:24,390 --> 00:13:25,740
And we wanna kind of codify those

380
00:13:25,740 --> 00:13:27,990
so we can use them at
scale across organization,

381
00:13:27,990 --> 00:13:30,450
baking best practice into what we do.

382
00:13:30,450 --> 00:13:34,313
So first off, we've got
some options around compute.

383
00:13:34,313 --> 00:13:35,850
And I think that one of
the really common things

384
00:13:35,850 --> 00:13:39,060
that I see customers do when
they come out of a big outage

385
00:13:39,060 --> 00:13:41,470
and your CTO is, you know,

386
00:13:41,470 --> 00:13:43,530
"Hey, we built this modern
microservices thing,

387
00:13:43,530 --> 00:13:46,527
we're running on ECS,
and we still went down."

388
00:13:47,700 --> 00:13:49,920
They kind of throw the
baby out with a bath water.

389
00:13:49,920 --> 00:13:51,210
We're gonna throw this away

390
00:13:51,210 --> 00:13:52,620
and we're gonna refactor to Lambda

391
00:13:52,620 --> 00:13:54,840
because we've seen that
Lambda is scalable.

392
00:13:54,840 --> 00:13:56,577
And Lambda always, you
know, AWS takes care of it.

393
00:13:56,577 --> 00:13:58,290
And we don't have to think about it.

394
00:13:58,290 --> 00:13:59,280
You know, that's, you know,

395
00:13:59,280 --> 00:14:00,660
Lambda's great at scaling,

396
00:14:00,660 --> 00:14:02,550
but yeah, you can still, with
bad architectural patterns,

397
00:14:02,550 --> 00:14:06,330
get yourself caught into some dead ends.

398
00:14:06,330 --> 00:14:08,550
Or let's throw away this ECS thing.

399
00:14:08,550 --> 00:14:10,547
What we, if we move to Kubernetes

400
00:14:10,547 --> 00:14:12,180
and the Kubernetes ecosystem,

401
00:14:12,180 --> 00:14:13,650
maybe we can solve all of our problems

402
00:14:13,650 --> 00:14:15,120
with this technology change

403
00:14:15,120 --> 00:14:18,870
and, you know, that's gonna be
more scalable, more powerful.

404
00:14:18,870 --> 00:14:20,730
Look at all this cool open
source things that we can buy

405
00:14:20,730 --> 00:14:23,100
and we can use this whole ISV ecosystem.

406
00:14:23,100 --> 00:14:24,810
Well, actually, you
know, I'd like to propose

407
00:14:24,810 --> 00:14:27,930
that when you are going through
a big architectural change,

408
00:14:27,930 --> 00:14:31,500
you wanna really focus on the
bits where you can add value,

409
00:14:31,500 --> 00:14:33,540
and you probably don't wanna
change everything at once.

410
00:14:33,540 --> 00:14:35,040
If you're changing programming language,

411
00:14:35,040 --> 00:14:35,900
don't change architectural pattern.

412
00:14:35,900 --> 00:14:37,350
If you're changing architectural pattern,

413
00:14:37,350 --> 00:14:39,092
maybe don't change your compute.

414
00:14:39,092 --> 00:14:41,563
You know, so limit
yourself to the sort of a,

415
00:14:41,563 --> 00:14:42,870
a set of things that you can change.

416
00:14:42,870 --> 00:14:45,780
And also, we want to go
on an incremental journey.

417
00:14:45,780 --> 00:14:46,747
We don't wanna say,

418
00:14:46,747 --> 00:14:49,440
"Hey, we're gonna spend the
next year building a brand new

419
00:14:49,440 --> 00:14:52,140
platform that's gonna be
ready in early November.

420
00:14:52,140 --> 00:14:53,400
So when Black Friday comes around,

421
00:14:53,400 --> 00:14:55,050
we can throw a big
switching underneath them.

422
00:14:55,050 --> 00:14:57,120
We want to make a series of changes.

423
00:14:57,120 --> 00:14:59,430
Every week, we're
iterating towards this path

424
00:14:59,430 --> 00:15:00,263
over the next year.

425
00:15:00,263 --> 00:15:02,730
So when our next big sale
comes on, we're ready.

426
00:15:02,730 --> 00:15:05,160
So my hypothesis, let's go and do this.

427
00:15:05,160 --> 00:15:06,630
Let's stay on ECS

428
00:15:06,630 --> 00:15:09,330
and let's see how we
can build this with ECS

429
00:15:09,330 --> 00:15:10,650
'cause we're gonna make a whole bunch

430
00:15:10,650 --> 00:15:12,100
of other interesting changes.

431
00:15:13,260 --> 00:15:16,980
A little bit of info about what ECS is,

432
00:15:16,980 --> 00:15:18,990
I think we got a lot of
hands raised in the room,

433
00:15:18,990 --> 00:15:21,510
so I won't belabor the point too much,

434
00:15:21,510 --> 00:15:25,443
but I think it's a pretty
cool service run by AWS

435
00:15:25,443 --> 00:15:29,640
that allows you to deploy, run,
launch containers at scale,

436
00:15:29,640 --> 00:15:31,770
does a whole bunch of optimizations

437
00:15:31,770 --> 00:15:32,760
behind the scenes for you

438
00:15:32,760 --> 00:15:35,430
so you can focus on
delivering business value.

439
00:15:35,430 --> 00:15:37,710
And customers tend to agree.

440
00:15:37,710 --> 00:15:41,310
So something like three
billion Amazon ECS tasks

441
00:15:41,310 --> 00:15:42,870
are launched every week,

442
00:15:42,870 --> 00:15:45,183
which is just like a
completely wild number.

443
00:15:46,079 --> 00:15:47,320
A really interesting one

444
00:15:48,180 --> 00:15:50,430
that I really like is that
when people start building

445
00:15:50,430 --> 00:15:51,431
with containers,

446
00:15:51,431 --> 00:15:55,080
the majority of them
start building with ECS.

447
00:15:55,080 --> 00:15:57,093
So it's a really, really common pattern.

448
00:15:59,790 --> 00:16:02,880
When you're using the ECS control plane,

449
00:16:02,880 --> 00:16:05,340
there's a couple of options
with your data plane.

450
00:16:05,340 --> 00:16:06,477
You could use Fargate,

451
00:16:06,477 --> 00:16:08,670
our kind of serverless data plane

452
00:16:08,670 --> 00:16:12,180
where you just define your
tasks and your services,

453
00:16:12,180 --> 00:16:15,330
and we'll manage that compute for you.

454
00:16:15,330 --> 00:16:18,840
We have a isolated workload model

455
00:16:18,840 --> 00:16:20,940
where you get kind of strong tenancy,

456
00:16:20,940 --> 00:16:24,030
and you only can pay for the
compute that you're using.

457
00:16:24,030 --> 00:16:26,250
However, you know, we
are making some choices,

458
00:16:26,250 --> 00:16:29,520
and on your behalf, we think
they're sensible choices,

459
00:16:29,520 --> 00:16:31,710
but they're not the right
choices in every case.

460
00:16:31,710 --> 00:16:33,270
You can also bring your own data plane.

461
00:16:33,270 --> 00:16:35,670
So you can say, "I want
these specific instance types

462
00:16:35,670 --> 00:16:38,130
in this size and I'm gonna
manage scaling them out."

463
00:16:38,130 --> 00:16:43,130
And Fargate is gonna go and run
them on those EC2 instances.

464
00:16:43,260 --> 00:16:46,470
One of the big re:Invent
releases a couple of weeks ago

465
00:16:46,470 --> 00:16:48,753
was ECS Managed Instances.

466
00:16:50,100 --> 00:16:51,450
I'll do another little poll in the room.

467
00:16:51,450 --> 00:16:53,910
Who's seen the ECS
Managed Instances release

468
00:16:53,910 --> 00:16:54,840
in the last few weeks?

469
00:16:54,840 --> 00:16:56,490
Has anyone heard of it?

470
00:16:56,490 --> 00:16:57,323
A few hands,

471
00:16:57,323 --> 00:17:00,641
but it's pretty early still.

472
00:17:00,641 --> 00:17:04,710
ECS Managed Instances and
the Lambda Managed Instances

473
00:17:04,710 --> 00:17:06,017
that was launched last night are really,

474
00:17:06,017 --> 00:17:07,800
really interesting models

475
00:17:07,800 --> 00:17:12,660
where you can bring your own
data plane of EC2 instances,

476
00:17:12,660 --> 00:17:14,760
but AWS does all the management

477
00:17:14,760 --> 00:17:16,500
of those instances on your behalf.

478
00:17:16,500 --> 00:17:20,970
So we'll do all the patching, OS patching,

479
00:17:20,970 --> 00:17:21,960
management of those instances.

480
00:17:21,960 --> 00:17:25,530
You can just define what
instance types you want to use.

481
00:17:25,530 --> 00:17:27,960
And so you get a lot of the benefits

482
00:17:27,960 --> 00:17:31,950
of using that kind of flexibility

483
00:17:31,950 --> 00:17:34,890
that I want a specific
Graviton instance in my fleet

484
00:17:34,890 --> 00:17:36,990
because I've worked at
my Java code runs best

485
00:17:36,990 --> 00:17:38,763
on those instances.

486
00:17:40,410 --> 00:17:42,330
But you don't have all of that overhead.

487
00:17:42,330 --> 00:17:46,350
It's also got a really
interesting modification

488
00:17:46,350 --> 00:17:47,460
to the capacity provider.

489
00:17:47,460 --> 00:17:48,900
That means it scales faster

490
00:17:48,900 --> 00:17:50,610
than your own EC2 instance fleet,

491
00:17:50,610 --> 00:17:52,043
which is really, really cool.

492
00:17:52,890 --> 00:17:56,280
So that moves the shared
responsibility a little bit.

493
00:17:56,280 --> 00:17:58,500
So instead of having to think
about your own auto-scaling

494
00:17:58,500 --> 00:18:02,547
and launch templates and
availability distribution

495
00:18:02,547 --> 00:18:06,090
and instance selection, you
can hand it over to AWS,

496
00:18:06,090 --> 00:18:07,680
you can define the instances that you want

497
00:18:07,680 --> 00:18:10,463
in your task templates
and we'll take care of it,

498
00:18:10,463 --> 00:18:14,850
and you can get all the
benefits of your savings plans

499
00:18:14,850 --> 00:18:17,760
and all the kind of capacity
planning, et cetera.

500
00:18:17,760 --> 00:18:21,420
However, it doesn't mean that
Fargate isn't still the kind

501
00:18:21,420 --> 00:18:24,027
of default way that people
are building on ECS,

502
00:18:24,027 --> 00:18:25,980
and I think that most
people should probably start

503
00:18:25,980 --> 00:18:27,540
with the most serverless option,

504
00:18:27,540 --> 00:18:29,490
which is Fargate and only breakout

505
00:18:29,490 --> 00:18:33,303
if they've got more complex requirements.

506
00:18:34,350 --> 00:18:36,690
So we've chosen ECS.

507
00:18:36,690 --> 00:18:38,220
We're gonna continue running on Fargate.

508
00:18:38,220 --> 00:18:40,050
We think that's still a sensible option.

509
00:18:40,050 --> 00:18:41,850
There are a couple of different models

510
00:18:41,850 --> 00:18:44,520
when you are running with ECS.

511
00:18:44,520 --> 00:18:47,493
The first thing is running
with a standalone task.

512
00:18:48,366 --> 00:18:51,270
So with a standalone
task, something happens.

513
00:18:51,270 --> 00:18:52,803
We get to run a task event.

514
00:18:53,910 --> 00:18:54,847
And the Fargate service goes,

515
00:18:54,847 --> 00:18:57,900
"Okay, great, something's
happened, let's react."

516
00:18:57,900 --> 00:19:00,870
So we're gonna go and
provision some compute

517
00:19:00,870 --> 00:19:02,628
to deal with that event.

518
00:19:02,628 --> 00:19:05,340
And we're gonna take
some time provisioning.

519
00:19:05,340 --> 00:19:06,690
So we'll go through provisioning state.

520
00:19:06,690 --> 00:19:09,030
We're then gonna go and run that task.

521
00:19:09,030 --> 00:19:09,900
So we're gonna do some running.

522
00:19:09,900 --> 00:19:11,805
And then afterwards, we're
gonna get that container

523
00:19:11,805 --> 00:19:14,910
and we're gonna throw it away,
stop it, and not reuse it.

524
00:19:14,910 --> 00:19:18,450
Now, that's a really, really
good pattern, really powerful,

525
00:19:18,450 --> 00:19:22,530
but it is newing up a container
to run each of your events.

526
00:19:22,530 --> 00:19:24,000
So it's not really appropriate

527
00:19:24,000 --> 00:19:26,310
if you are sending thousands of events.

528
00:19:26,310 --> 00:19:27,690
We're trying to do our Black Friday sale.

529
00:19:27,690 --> 00:19:31,320
We've got thousand orders a second coming

530
00:19:31,320 --> 00:19:32,153
into our eCommerce store.

531
00:19:32,153 --> 00:19:33,420
We don't wanna be using
this model for that.

532
00:19:33,420 --> 00:19:35,220
It's gonna get us into some trouble.

533
00:19:36,390 --> 00:19:40,290
We also have this other model
where we can run as a service.

534
00:19:40,290 --> 00:19:43,470
So this is, we can define some compute.

535
00:19:43,470 --> 00:19:45,333
So we're gonna say we want a vCPU,

536
00:19:45,333 --> 00:19:46,680
we want a couple of gigs of ram.

537
00:19:46,680 --> 00:19:48,960
We want to have at least four copies,

538
00:19:48,960 --> 00:19:52,350
and we wanna scale that out
with some scale parameters.

539
00:19:52,350 --> 00:19:53,790
And Eric's gonna talk about some

540
00:19:53,790 --> 00:19:56,090
of the metrics you can
use to scale out later.

541
00:19:57,346 --> 00:19:59,220
And so we're gonna go
and build a target group

542
00:19:59,220 --> 00:20:00,060
that that's gonna be running.

543
00:20:00,060 --> 00:20:02,550
And actually, we can think
about how we can send events

544
00:20:02,550 --> 00:20:04,530
to that kind of statically stable compute

545
00:20:04,530 --> 00:20:05,490
and how it's gonna scale out.

546
00:20:05,490 --> 00:20:08,160
And Eric will go into some
more details around that.

547
00:20:08,160 --> 00:20:10,590
So we've got these kind of big patterns.

548
00:20:10,590 --> 00:20:14,370
And, you know, my hypothesis
is these are really powerful,

549
00:20:14,370 --> 00:20:17,040
really useful characteristics to use

550
00:20:17,040 --> 00:20:18,450
when we're building EDA.

551
00:20:18,450 --> 00:20:19,890
We've got scalability.

552
00:20:19,890 --> 00:20:21,540
We can have kind of target tracking.

553
00:20:21,540 --> 00:20:23,610
We can build all sorts of
interesting target tracking

554
00:20:23,610 --> 00:20:24,903
with custom metrics.

555
00:20:26,130 --> 00:20:27,840
Containers and microservices

556
00:20:27,840 --> 00:20:32,840
and these kind of patterns
are very comfortable together.

557
00:20:33,120 --> 00:20:34,670
And because it's an AWS managed service,

558
00:20:34,670 --> 00:20:36,510
it has native integrations

559
00:20:36,510 --> 00:20:38,190
with all of the building blocks we use

560
00:20:38,190 --> 00:20:39,360
to build event-driven architectures.

561
00:20:39,360 --> 00:20:42,540
Things like step functions, EventBridge,

562
00:20:42,540 --> 00:20:45,150
even SQS and SNS all
play very, very nicely

563
00:20:45,150 --> 00:20:46,740
with EventBridge.

564
00:20:46,740 --> 00:20:49,920
And you can use all of those
things like managed instances

565
00:20:49,920 --> 00:20:51,450
and Savings Plans and Spot

566
00:20:51,450 --> 00:20:55,860
to make sure that you're
getting the best price

567
00:20:55,860 --> 00:20:59,070
for your compute and the
best total cost of ownership.

568
00:20:59,070 --> 00:21:01,680
So settled on some compute.

569
00:21:01,680 --> 00:21:04,270
Our next big category of questions is

570
00:21:05,220 --> 00:21:07,680
what event brokers are we going to use?

571
00:21:07,680 --> 00:21:09,213
What routers are we gonna use?

572
00:21:10,380 --> 00:21:13,473
And so our first category
of brokers are routers.

573
00:21:14,700 --> 00:21:16,650
Routers are a pattern

574
00:21:16,650 --> 00:21:20,010
where the router processes
one event at a time.

575
00:21:20,010 --> 00:21:23,640
You can point that event at
multiple targets and protocols.

576
00:21:23,640 --> 00:21:26,793
So it's a one to many pattern.

577
00:21:28,050 --> 00:21:29,730
You're building logic at the router,

578
00:21:29,730 --> 00:21:33,900
so you can build rules and filtering rules

579
00:21:33,900 --> 00:21:35,280
and targets at the router.

580
00:21:35,280 --> 00:21:37,800
So you've got quite a
smart, sophisticated router

581
00:21:37,800 --> 00:21:39,870
that's doing a whole
bunch of work for you.

582
00:21:39,870 --> 00:21:42,390
And that means that the router
can handle things like retry,

583
00:21:42,390 --> 00:21:44,220
dead-letter queues, error handling,

584
00:21:44,220 --> 00:21:47,010
even things like throttling
and rate limiting.

585
00:21:47,010 --> 00:21:50,010
So it's a pretty smart router,

586
00:21:50,010 --> 00:21:51,420
which means that it's really simple

587
00:21:51,420 --> 00:21:55,620
to have simple logic at your
receiver and your sender.

588
00:21:55,620 --> 00:21:58,650
So for your receiver, single SDK call,

589
00:21:58,650 --> 00:22:01,980
your receiver just has
to either pull an event

590
00:22:01,980 --> 00:22:05,253
for the native integration
or a simple API call.

591
00:22:06,240 --> 00:22:07,740
So you don't have to build
a lot of error handling

592
00:22:07,740 --> 00:22:10,390
and additional logic in your
producers and consumers.

593
00:22:11,340 --> 00:22:12,360
And so that allows you to really,

594
00:22:12,360 --> 00:22:14,820
really efficiently produce coupling.

595
00:22:14,820 --> 00:22:16,260
In the Amazon world,

596
00:22:16,260 --> 00:22:17,940
we're usually talking about EventBridge

597
00:22:17,940 --> 00:22:19,470
when we're talking about this pattern.

598
00:22:19,470 --> 00:22:20,970
So it's a serverless service,

599
00:22:20,970 --> 00:22:23,207
has native integrations with
most of the things on AWS,

600
00:22:23,207 --> 00:22:25,330
allows you to build global architectures

601
00:22:26,460 --> 00:22:27,573
with global endpoints.

602
00:22:28,920 --> 00:22:30,990
And so the EventBridge architecture starts

603
00:22:30,990 --> 00:22:33,000
with defining some event sources.

604
00:22:33,000 --> 00:22:35,430
So that could be an AWS
service, your customer events.

605
00:22:35,430 --> 00:22:37,803
In our case, a lot of customer events.

606
00:22:39,390 --> 00:22:41,400
Those then go to a number of buses.

607
00:22:41,400 --> 00:22:43,710
So a default event bus,
a customer event bus,

608
00:22:43,710 --> 00:22:46,560
depending on whether it's an
AWS event or your own event.

609
00:22:47,458 --> 00:22:48,900
And then we have these rules.

610
00:22:48,900 --> 00:22:52,020
So a rule is the way that
we then map those events

611
00:22:52,020 --> 00:22:53,613
into the downstream services.

612
00:22:57,060 --> 00:23:01,980
So the first thing I'm gonna
do is define what is an event.

613
00:23:01,980 --> 00:23:04,200
So this is one of the things that we have

614
00:23:04,200 --> 00:23:05,250
to be really deliberate about

615
00:23:05,250 --> 00:23:07,140
when we're building
event-driven architectures.

616
00:23:07,140 --> 00:23:08,580
So we go sort of one step deeper

617
00:23:08,580 --> 00:23:11,520
than something happens and we react.

618
00:23:11,520 --> 00:23:13,563
Something happens in the past.

619
00:23:14,580 --> 00:23:17,910
So we emit a signal
that state has changed.

620
00:23:17,910 --> 00:23:20,340
So an order has been
created, an order was created

621
00:23:20,340 --> 00:23:23,103
or a channel was created
or the lights switched off.

622
00:23:24,660 --> 00:23:25,493
We can't change it.

623
00:23:25,493 --> 00:23:26,880
So we can't unswitch off the lights.

624
00:23:26,880 --> 00:23:29,197
We have to submit a new event that says,

625
00:23:29,197 --> 00:23:31,110
"Hey, lights are switched on."

626
00:23:31,110 --> 00:23:32,670
And these events act as this contract

627
00:23:32,670 --> 00:23:34,830
between our producers and our consumers.

628
00:23:34,830 --> 00:23:37,080
In EventBridge world,
that's a piece of JSON.

629
00:23:39,038 --> 00:23:41,160
And an EventBridge rule is pretty simple.

630
00:23:41,160 --> 00:23:43,020
So we've got a bit of
JSON, which is our event.

631
00:23:43,020 --> 00:23:45,753
That's our, our producer
has admitted that event.

632
00:23:46,800 --> 00:23:49,117
And our rule has another
bit of JSON which says,

633
00:23:49,117 --> 00:23:51,570
"Hey, our source is com.flix.

634
00:23:51,570 --> 00:23:53,820
Our region is Australia and New Zealand."

635
00:23:53,820 --> 00:23:55,320
And we wanna get all of those events

636
00:23:55,320 --> 00:23:57,780
and pass them to a particular consumer.

637
00:23:57,780 --> 00:23:59,280
They've matched. That's great.

638
00:24:00,360 --> 00:24:03,300
And so those consumers
can be a whole bunch

639
00:24:03,300 --> 00:24:04,133
of different patterns.

640
00:24:04,133 --> 00:24:05,880
So we can point to Lambda

641
00:24:05,880 --> 00:24:07,590
and lots of event-driven
architectures are built

642
00:24:07,590 --> 00:24:08,423
with Lambda.

643
00:24:08,423 --> 00:24:09,980
But we can also send that to Amazon ECS

644
00:24:09,980 --> 00:24:11,640
as we discussed earlier.

645
00:24:11,640 --> 00:24:14,070
You can also talk to API destinations,

646
00:24:14,070 --> 00:24:16,740
and that's a really, really
powerful feature of EventBridge,

647
00:24:16,740 --> 00:24:17,820
and Eric is gonna go into some detail

648
00:24:17,820 --> 00:24:20,100
around the nuances of that shortly,

649
00:24:20,100 --> 00:24:21,900
and a whole bunch of other services.

650
00:24:22,920 --> 00:24:25,380
However, this is not the
only pattern we've got

651
00:24:25,380 --> 00:24:26,213
for event routers.

652
00:24:26,213 --> 00:24:27,300
We've also got topics.

653
00:24:27,300 --> 00:24:30,600
Topics are a subtly different
form of event router.

654
00:24:30,600 --> 00:24:33,240
Here, we can broadcast
to multiple consumers.

655
00:24:33,240 --> 00:24:36,123
We still can filter
consumers at the topic.

656
00:24:37,500 --> 00:24:39,690
However, this is really
powerful for scaling out

657
00:24:39,690 --> 00:24:42,540
to lots and lots of consumers.

658
00:24:42,540 --> 00:24:44,100
We can support multiple protocols,

659
00:24:44,100 --> 00:24:48,270
things like SNS, SMS, push certifications.

660
00:24:48,270 --> 00:24:50,190
We also have options to maintain order

661
00:24:50,190 --> 00:24:52,653
with first in, first out topics.

662
00:24:54,300 --> 00:24:59,300
And so fully managed service
for doing this in AWS is SNS,

663
00:24:59,970 --> 00:25:04,970
allows you to send nearly
unlimited messages per second.

664
00:25:04,980 --> 00:25:07,260
And it says that in our
documentation nearly unlimited.

665
00:25:07,260 --> 00:25:09,600
And so we're kind of serious about it.

666
00:25:09,600 --> 00:25:11,550
You can, it's very, very difficult

667
00:25:11,550 --> 00:25:13,650
to put any strain on the SNS service.

668
00:25:13,650 --> 00:25:17,580
And you can send out to
12.5 million subscriptions

669
00:25:17,580 --> 00:25:18,540
on each individual topic.

670
00:25:18,540 --> 00:25:20,760
So if you've got a fan out
and you wanna send codes

671
00:25:20,760 --> 00:25:24,093
or messages to everybody,
that's really, really powerful.

672
00:25:25,500 --> 00:25:26,430
So it talks about routers.

673
00:25:26,430 --> 00:25:29,790
Our next kind of category
of things are event stores.

674
00:25:29,790 --> 00:25:32,490
So an event store allows our receiver

675
00:25:32,490 --> 00:25:33,870
to process events in batches

676
00:25:33,870 --> 00:25:35,913
and control how it's doing processing.

677
00:25:36,780 --> 00:25:41,780
So it can control its order,
it can configure its own retry,

678
00:25:41,820 --> 00:25:45,483
it can configure its
own dead letter queue.

679
00:25:47,100 --> 00:25:50,402
Now, one of the important
things about a queue is only one

680
00:25:50,402 --> 00:25:52,260
receiver can process a message.

681
00:25:52,260 --> 00:25:54,240
That's a one-to-one integration

682
00:25:54,240 --> 00:25:56,163
rather than a one to many integration.

683
00:25:57,300 --> 00:25:58,770
You can manage that ordering,

684
00:25:58,770 --> 00:26:00,660
but it's typically not
used as the backbone

685
00:26:00,660 --> 00:26:01,800
of our event-driven architecture

686
00:26:01,800 --> 00:26:03,090
because of that one-to-one pattern.

687
00:26:03,090 --> 00:26:04,290
It's used more as just kind of some

688
00:26:04,290 --> 00:26:06,663
of the sub patterns
we're gonna think about.

689
00:26:08,010 --> 00:26:11,850
In AWS, the main service
we're doing that is SQS.

690
00:26:11,850 --> 00:26:13,740
It's another one where
they docs say we scale

691
00:26:13,740 --> 00:26:16,800
nearly infinitely, super easy to use.

692
00:26:16,800 --> 00:26:18,690
Simple API, dead-letter queues,

693
00:26:18,690 --> 00:26:21,810
first in, first out, all the
kind of features we expect.

694
00:26:21,810 --> 00:26:25,080
We also support some of
the open source services.

695
00:26:25,080 --> 00:26:27,030
So things like Amazon MQ,

696
00:26:27,030 --> 00:26:29,790
which supports RabbitMQ or ActiveMQ.

697
00:26:29,790 --> 00:26:31,920
So if you are using
some kind of integration

698
00:26:31,920 --> 00:26:33,330
with existing open source stuff,

699
00:26:33,330 --> 00:26:34,950
definitely a sensible option

700
00:26:34,950 --> 00:26:38,730
and supports many of the same
patterns that you'd be using.

701
00:26:38,730 --> 00:26:42,270
And then the third and final big bucket

702
00:26:42,270 --> 00:26:45,573
of brokers we can think about are streams.

703
00:26:46,710 --> 00:26:49,230
So streams are subtly different.

704
00:26:49,230 --> 00:26:51,810
Again, here, we can do one for many.

705
00:26:51,810 --> 00:26:55,650
So we can send messages
to multiple consumers.

706
00:26:55,650 --> 00:26:57,780
However, all the consumers on,

707
00:26:57,780 --> 00:26:59,880
that are reading a stream are
gonna get all the messages.

708
00:26:59,880 --> 00:27:02,703
So the consumer itself has
to manage the filtering.

709
00:27:05,340 --> 00:27:08,280
You've got ordering
enforced in the stream.

710
00:27:08,280 --> 00:27:11,370
But again, the consumers
have to manage their own kind

711
00:27:11,370 --> 00:27:13,890
of error handling and processing

712
00:27:13,890 --> 00:27:16,353
to ensure that that ordering is enforced.

713
00:27:18,000 --> 00:27:19,440
Really, really powerful service,

714
00:27:19,440 --> 00:27:22,200
particularly if you're
doing really, really large

715
00:27:22,200 --> 00:27:24,390
throughput of messages.

716
00:27:24,390 --> 00:27:28,620
And so we've got Amazon Kinesis
as an AWS native version

717
00:27:28,620 --> 00:27:30,360
of dealing with streams.

718
00:27:30,360 --> 00:27:33,000
You could do gigabits
per second of streaming,

719
00:27:33,000 --> 00:27:34,710
all the kind of integrations
that we talked about

720
00:27:34,710 --> 00:27:36,390
with native integrations.

721
00:27:36,390 --> 00:27:39,660
And the big player in the
open source space here is MSK

722
00:27:39,660 --> 00:27:41,370
or is Kafka.

723
00:27:41,370 --> 00:27:42,960
So Apache Kafka, absolute huge project,

724
00:27:42,960 --> 00:27:46,590
really, really powerful streaming solution

725
00:27:46,590 --> 00:27:48,600
which has loads of open
source integrations

726
00:27:48,600 --> 00:27:50,993
and used for lots of venture
driven architectures.

727
00:27:52,560 --> 00:27:55,110
Our managed service for that is MSK.

728
00:27:55,110 --> 00:27:57,270
So you can use all the
kind of Kafka goodness

729
00:27:57,270 --> 00:28:00,810
and get lots of the
management done by AWS.

730
00:28:00,810 --> 00:28:02,520
So we've now got this
kind of box of toolkits,

731
00:28:02,520 --> 00:28:05,114
we've got some compute,
we've got some routers,

732
00:28:05,114 --> 00:28:06,510
and we've got all these kind of services.

733
00:28:06,510 --> 00:28:09,030
And, you know, really, really easy

734
00:28:09,030 --> 00:28:11,880
to start putting some of those
services into our diagrams

735
00:28:11,880 --> 00:28:14,400
and starting building
things with these things,

736
00:28:14,400 --> 00:28:18,157
particularly where you to
set up a EventBridge bus,

737
00:28:18,157 --> 00:28:19,950
you know, a few lines of code,

738
00:28:19,950 --> 00:28:23,640
a few lines of SAM or CDK or Terraform,

739
00:28:23,640 --> 00:28:25,143
and you can be up and running.

740
00:28:26,880 --> 00:28:28,800
But they're actually, you know,
they're very, very powerful.

741
00:28:28,800 --> 00:28:30,360
There's a lot of places you can go wrong.

742
00:28:30,360 --> 00:28:32,880
So the kind of, the meat
of what we wanna do is

743
00:28:32,880 --> 00:28:34,620
how do we turn all these Lego bricks,

744
00:28:34,620 --> 00:28:38,040
all of these different building
blocks into useful things

745
00:28:38,040 --> 00:28:39,450
that we can build.

746
00:28:39,450 --> 00:28:41,220
So Eric, I think you're gonna talk to us

747
00:28:41,220 --> 00:28:43,890
about some of the patterns we can apply.

748
00:28:43,890 --> 00:28:45,240
- All right.

749
00:28:45,240 --> 00:28:46,800
So we've talked to you about, you know,

750
00:28:46,800 --> 00:28:51,450
what is EDA, what are
the, obviously, all the,

751
00:28:51,450 --> 00:28:54,390
and for those of you here in
America, routers is routers.

752
00:28:54,390 --> 00:28:56,250
So just throw that out there.

753
00:28:56,250 --> 00:28:57,083
I know some of you're like,

754
00:28:57,083 --> 00:28:58,530
"Well, I don't even
know what a router is."

755
00:28:58,530 --> 00:29:01,020
But it's a router, so I got you.

756
00:29:01,020 --> 00:29:01,980
Yeah, I got you.

757
00:29:01,980 --> 00:29:03,840
So, all right.

758
00:29:03,840 --> 00:29:06,000
So we're gonna talk about
what are these patterns?

759
00:29:06,000 --> 00:29:07,590
How do we apply this to ECS?

760
00:29:07,590 --> 00:29:09,420
How do we make that work, right?

761
00:29:09,420 --> 00:29:10,530
So let's jump in.

762
00:29:10,530 --> 00:29:12,930
And we're gonna talk about
long running containers, right?

763
00:29:12,930 --> 00:29:14,190
And this is kinda those services

764
00:29:14,190 --> 00:29:16,290
that Matt was talking about earlier.

765
00:29:16,290 --> 00:29:18,090
And so this is like, it's a push or pull.

766
00:29:18,090 --> 00:29:19,560
It's kind of an end to end, right?

767
00:29:19,560 --> 00:29:21,390
It is, "How many do you wanna send,

768
00:29:21,390 --> 00:29:23,760
how many do you wanna process?" Okay?

769
00:29:23,760 --> 00:29:26,970
So a traditional long
running container looks

770
00:29:26,970 --> 00:29:27,930
something like this, right?

771
00:29:27,930 --> 00:29:30,870
You have an ECS, you get
many different type of tasks

772
00:29:30,870 --> 00:29:32,467
with different containers running in that.

773
00:29:32,467 --> 00:29:34,800
You know, a lot of ECS users in there.

774
00:29:34,800 --> 00:29:36,840
I don't really need to
probably teach you about that.

775
00:29:36,840 --> 00:29:38,760
And of course, you have
your capacity providers

776
00:29:38,760 --> 00:29:41,490
with our new, again, the managed instance,

777
00:29:41,490 --> 00:29:42,720
which is super cool.

778
00:29:42,720 --> 00:29:44,340
You could do a lot with that.

779
00:29:44,340 --> 00:29:45,420
So I wanna show you,

780
00:29:45,420 --> 00:29:46,980
we're gonna go through
some different patterns,

781
00:29:46,980 --> 00:29:49,530
and the first pattern is
probably the most simple, right?

782
00:29:49,530 --> 00:29:51,540
And this is a very common pattern.

783
00:29:51,540 --> 00:29:54,720
Pattern number one is the public API.

784
00:29:54,720 --> 00:29:57,210
Now, what this usually is, is
you're gonna have some type

785
00:29:57,210 --> 00:30:00,330
of consumer or producer,

786
00:30:00,330 --> 00:30:04,470
I'm sorry, producer pushing
data to a consumer, right?

787
00:30:04,470 --> 00:30:05,700
And it's gonna go through an API.

788
00:30:05,700 --> 00:30:07,410
So it's somewhere another machine,

789
00:30:07,410 --> 00:30:09,400
they've got a signed, you know, URL

790
00:30:11,070 --> 00:30:11,910
or they've got something,

791
00:30:11,910 --> 00:30:14,640
and they're pushing to this data.

792
00:30:14,640 --> 00:30:16,590
But your consumer,

793
00:30:16,590 --> 00:30:18,600
even though you're running this
container, maybe it doesn't,

794
00:30:18,600 --> 00:30:20,820
you know, again, we have that 1988 code

795
00:30:20,820 --> 00:30:22,440
and it's not ready to handle all that.

796
00:30:22,440 --> 00:30:27,440
So how do we put a broker
in something like this?

797
00:30:27,930 --> 00:30:32,930
Well, EventBridge is
where I generally start.

798
00:30:32,940 --> 00:30:34,897
This is a really good way to say,

799
00:30:34,897 --> 00:30:37,650
"Events coming in and I'm gonna send those

800
00:30:37,650 --> 00:30:39,540
and then I'll push them
on to the container

801
00:30:39,540 --> 00:30:40,380
through the API."

802
00:30:40,380 --> 00:30:42,930
And how that works is the
producer's gonna send directly

803
00:30:42,930 --> 00:30:47,580
into the EventBridge using
IAM, IAM, that's a hard one,

804
00:30:47,580 --> 00:30:50,293
IAM role, it has permissions to do that.

805
00:30:50,293 --> 00:30:51,897
It's gonna push data into the EventBridge.

806
00:30:51,897 --> 00:30:55,950
And EventBridge is gonna
to use this API destination

807
00:30:55,950 --> 00:31:00,000
to make a secure connection
to the API and drop data into,

808
00:31:00,000 --> 00:31:03,210
or drop events into that, the consumer

809
00:31:03,210 --> 00:31:04,917
and it can run however many we need to.

810
00:31:04,917 --> 00:31:08,760
And we can kind of control
that through EventBridge

811
00:31:08,760 --> 00:31:11,130
on how many are we sending
different things, like that.

812
00:31:11,130 --> 00:31:12,720
Now, you may say, "Eric, that's great,

813
00:31:12,720 --> 00:31:15,630
but not all of us are doing
machine to machine, right?

814
00:31:15,630 --> 00:31:17,100
What if it's clients?"

815
00:31:17,100 --> 00:31:18,750
It's all right, I got you.

816
00:31:18,750 --> 00:31:20,520
So you can actually do something like this

817
00:31:20,520 --> 00:31:21,353
where you can say,

818
00:31:21,353 --> 00:31:25,440
"Okay, I'm gonna have an
authenticated user send data

819
00:31:25,440 --> 00:31:26,273
to API gateway."

820
00:31:26,273 --> 00:31:27,180
Let's say they're sending,

821
00:31:27,180 --> 00:31:29,190
I don't know, analytics
or something like that.

822
00:31:29,190 --> 00:31:32,733
And then I'm gonna use,
anybody familiar with a VTL?

823
00:31:33,780 --> 00:31:35,760
Okay. Do you love it?

824
00:31:35,760 --> 00:31:36,660
Yeah, I know exactly.

825
00:31:36,660 --> 00:31:39,090
He's like, "I want to
tackle you for saying it."

826
00:31:39,090 --> 00:31:41,580
So VTL is Apache Velocity
Template Language,

827
00:31:41,580 --> 00:31:43,080
and it runs at API gateway.

828
00:31:43,080 --> 00:31:46,320
And you can actually transform
a request come from a user

829
00:31:46,320 --> 00:31:48,510
and put it right onto EventBridge.

830
00:31:48,510 --> 00:31:50,040
And I've got some examples out in the wild

831
00:31:50,040 --> 00:31:50,880
of how to do that.

832
00:31:50,880 --> 00:31:53,190
But this allows you a secure access

833
00:31:53,190 --> 00:31:55,350
where they can continue to push that,

834
00:31:55,350 --> 00:31:58,110
and I don't have to run a
Lambda function in between,

835
00:31:58,110 --> 00:32:00,570
and I can still get data to the container.

836
00:32:00,570 --> 00:32:01,950
So this is pattern number one.

837
00:32:01,950 --> 00:32:04,590
- [Matt] And writing a
VTL is is no fun at all,

838
00:32:04,590 --> 00:32:05,460
if anyone's tried it.

839
00:32:05,460 --> 00:32:08,220
But Kiro is really good
at writing VTL code.

840
00:32:08,220 --> 00:32:09,053
- Oh yeah, yeah, yeah.

841
00:32:09,053 --> 00:32:09,886
- [Matt] A couple of prompts

842
00:32:09,886 --> 00:32:11,280
and you'll have something
working really, really quickly.

843
00:32:11,280 --> 00:32:13,920
- Yeah, VTL is back because of Kiro,

844
00:32:13,920 --> 00:32:16,590
and it's Velocity Templating
Language by the way.

845
00:32:16,590 --> 00:32:17,610
I'm just proud I know that.

846
00:32:17,610 --> 00:32:18,480
So there you go.

847
00:32:18,480 --> 00:32:21,180
All right, so the second
pattern looks a whole lot

848
00:32:21,180 --> 00:32:24,240
like the first because
it really is, right?

849
00:32:24,240 --> 00:32:26,580
And so what we're doing
here is we have this ability

850
00:32:26,580 --> 00:32:28,230
in EventBridge with the,

851
00:32:28,230 --> 00:32:29,430
and we announced this last year

852
00:32:29,430 --> 00:32:31,710
with PrivateLink and VPC Lattice,

853
00:32:31,710 --> 00:32:36,030
you can actually connect to
private endpoints, right?

854
00:32:36,030 --> 00:32:38,827
So this is super helpful if you have to,

855
00:32:38,827 --> 00:32:41,670
"Look, I need to throttle how
much is getting in there."

856
00:32:41,670 --> 00:32:44,640
So let's go ahead and drop
event data into EventBridge

857
00:32:44,640 --> 00:32:47,220
and then we'll use the
private endpoint connection.

858
00:32:47,220 --> 00:32:48,900
And now, we've done that.

859
00:32:48,900 --> 00:32:50,790
So those are the first two patterns,

860
00:32:50,790 --> 00:32:52,890
again, kind of starting easy

861
00:32:52,890 --> 00:32:55,470
and we'll climb up there, right?

862
00:32:55,470 --> 00:32:57,960
So the next pattern we're
gonna do is what we call point

863
00:32:57,960 --> 00:32:59,417
to point, right?

864
00:32:59,417 --> 00:33:01,620
And so this looks pretty simple,

865
00:33:01,620 --> 00:33:03,720
but what we're doing here
is we have ECS containers

866
00:33:03,720 --> 00:33:04,920
that poll for events.

867
00:33:04,920 --> 00:33:07,290
So instead of things getting
pushed to ECS container,

868
00:33:07,290 --> 00:33:09,810
it's gonna actually
pull data off the queue.

869
00:33:09,810 --> 00:33:13,140
And so you manage the
rate limit in the code.

870
00:33:13,140 --> 00:33:14,880
You can say, "Grab 10, grab 20."

871
00:33:14,880 --> 00:33:16,830
But you can also do some of
that, you know, the window

872
00:33:16,830 --> 00:33:19,230
and control on SQS as well.

873
00:33:19,230 --> 00:33:21,840
And your retry and failure are
managed at the queue as well.

874
00:33:21,840 --> 00:33:25,650
So if something doesn't happen,
you get a retry out of that.

875
00:33:25,650 --> 00:33:27,690
And so this gives you a lot of control

876
00:33:27,690 --> 00:33:30,420
and downstream protection, right?

877
00:33:30,420 --> 00:33:32,940
Now, when you're running queues,

878
00:33:32,940 --> 00:33:35,250
the polling patterns, it
looks kinda like this.

879
00:33:35,250 --> 00:33:37,980
It'll basically take,
let's say you have six.

880
00:33:37,980 --> 00:33:39,720
So I'll grab six off there

881
00:33:39,720 --> 00:33:42,060
and my different tasks will handle that,

882
00:33:42,060 --> 00:33:44,640
kinda like Matt was showing
how the queues work on that.

883
00:33:44,640 --> 00:33:47,850
And then, so how SQS works,
if you're not familiar,

884
00:33:47,850 --> 00:33:49,680
is when a task is grabbed,

885
00:33:49,680 --> 00:33:51,150
it doesn't actually
disappear out of queue.

886
00:33:51,150 --> 00:33:52,830
It's made invisible.

887
00:33:52,830 --> 00:33:53,663
It's magic.

888
00:33:53,663 --> 00:33:56,160
It's the invisible queue
or the invisible event.

889
00:33:56,160 --> 00:33:57,930
And after a certain amount of time,

890
00:33:57,930 --> 00:34:01,320
if the consumer hasn't said,
"Yep, I took care of it,"

891
00:34:01,320 --> 00:34:04,860
then it's made visible again
and it can be redone, right?

892
00:34:04,860 --> 00:34:07,980
So this works really well
when you have, you know,

893
00:34:07,980 --> 00:34:10,020
your traffic's metered
and you can do that.

894
00:34:10,020 --> 00:34:15,020
However, what if your traffic
is unpredictable, right?

895
00:34:15,630 --> 00:34:16,860
It's like, "Oh, I'm starting,

896
00:34:16,860 --> 00:34:18,462
I get a lot of traffic

897
00:34:18,462 --> 00:34:19,376
and then I get a little bit of traffic.

898
00:34:19,376 --> 00:34:20,370
and then I get a lot of traffic."

899
00:34:20,370 --> 00:34:22,260
And it goes up and down like that.

900
00:34:22,260 --> 00:34:23,400
Well, that's all right.

901
00:34:23,400 --> 00:34:25,020
We can handle things like that

902
00:34:25,020 --> 00:34:27,120
through what we call predefined metrics

903
00:34:27,120 --> 00:34:29,340
or through autoscaling, right?

904
00:34:29,340 --> 00:34:31,860
So with autoscaling, we're actually able

905
00:34:31,860 --> 00:34:35,850
to do step scaling on SQS
using the message count.

906
00:34:35,850 --> 00:34:36,900
So we look at the message count

907
00:34:36,900 --> 00:34:39,150
and how do we step that up
to handle the autoscaling

908
00:34:39,150 --> 00:34:40,950
and how to bring it back down.

909
00:34:40,950 --> 00:34:42,240
In this particular example,

910
00:34:42,240 --> 00:34:46,080
I'm doing plus one task at
five messages, plus two at 15.

911
00:34:46,080 --> 00:34:47,760
So it's watching that

912
00:34:47,760 --> 00:34:50,580
and it's going up as need
be and it's coming down.

913
00:34:50,580 --> 00:34:53,820
And then we put in a
cool down of 300 seconds.

914
00:34:53,820 --> 00:34:54,653
So we don't,

915
00:34:54,653 --> 00:34:57,900
what you don't want is your
autoscaling doing this, right?

916
00:34:57,900 --> 00:34:59,373
You want it doing this.

917
00:35:01,590 --> 00:35:03,110
How relaxing was that?

918
00:35:03,110 --> 00:35:03,990
That was cool, all right.

919
00:35:03,990 --> 00:35:05,280
I feel good, all right.

920
00:35:05,280 --> 00:35:06,980
So you wanna do that.

921
00:35:06,980 --> 00:35:09,090
So that's why we put in that cool down.

922
00:35:09,090 --> 00:35:10,740
And then you get multi-period evaluation.

923
00:35:10,740 --> 00:35:11,910
So we're looking over,

924
00:35:11,910 --> 00:35:13,500
we're not just looking
at one and reacting one

925
00:35:13,500 --> 00:35:14,610
and reacting one and reacting.

926
00:35:14,610 --> 00:35:17,250
It's looking, "Okay, how's
the scope look?" Right?

927
00:35:17,250 --> 00:35:19,770
So this works really well
for a lot of your traffic.

928
00:35:19,770 --> 00:35:24,240
So you use these predefined
metrics, and there you go.

929
00:35:24,240 --> 00:35:29,240
However, not all traffic is
the same size, the same shape.

930
00:35:31,170 --> 00:35:33,240
Traffic looks very different, right?

931
00:35:33,240 --> 00:35:35,587
I don't know about y'all,
but you never know,

932
00:35:35,587 --> 00:35:37,260
"Am I processing a two-minute video?

933
00:35:37,260 --> 00:35:40,440
Am I processing a two-day video?"

934
00:35:40,440 --> 00:35:41,790
You know, those kinds of things.

935
00:35:41,790 --> 00:35:44,370
So what if this looks really big

936
00:35:44,370 --> 00:35:48,120
and your size is not consistent?

937
00:35:48,120 --> 00:35:49,020
How do you do that?

938
00:35:49,020 --> 00:35:51,060
Are these predefined metrics gonna work?

939
00:35:51,060 --> 00:35:52,590
Probably not.

940
00:35:52,590 --> 00:35:55,800
So then we get into custom metric math.

941
00:35:55,800 --> 00:35:57,450
Now, I've never been great at math.

942
00:35:57,450 --> 00:35:58,283
I'm not gonna lie.

943
00:35:58,283 --> 00:35:59,493
I can only count to two.

944
00:36:00,930 --> 00:36:02,280
All right, some of you're awake.

945
00:36:02,280 --> 00:36:03,780
I can actually, here's the truth,

946
00:36:03,780 --> 00:36:05,430
I can get to four if I take my shoes off,

947
00:36:05,430 --> 00:36:06,780
but that gets weird for everybody.

948
00:36:06,780 --> 00:36:09,090
So we'll go with two, right?

949
00:36:09,090 --> 00:36:11,250
So the idea here is we're
gonna use custom metric math

950
00:36:11,250 --> 00:36:13,710
and we're gonna combine
some metrics, right?

951
00:36:13,710 --> 00:36:15,660
So we're gonna do metric messages divided

952
00:36:15,660 --> 00:36:17,070
by the running tasks.

953
00:36:17,070 --> 00:36:18,780
We looked at the pack log per task.

954
00:36:18,780 --> 00:36:20,400
And we're gonna go for target value

955
00:36:20,400 --> 00:36:24,000
of acceptable latency divided
by processing time, right?

956
00:36:24,000 --> 00:36:25,950
So we're looking at some different things.

957
00:36:25,950 --> 00:36:28,380
And then we set this up,
we still do our cool down.

958
00:36:28,380 --> 00:36:30,900
So we're not, you know,
reacting really fast.

959
00:36:30,900 --> 00:36:32,220
And we prevent division.

960
00:36:32,220 --> 00:36:33,780
You can see I've got some code in there

961
00:36:33,780 --> 00:36:35,760
by doing a max function.

962
00:36:35,760 --> 00:36:37,470
So you prevent division by zero.

963
00:36:37,470 --> 00:36:41,910
And so this allows us to do
some mathematical equations.

964
00:36:41,910 --> 00:36:43,080
I'm saying all kinds of big words.

965
00:36:43,080 --> 00:36:45,000
Some math to figure out
how we're gonna do it.

966
00:36:45,000 --> 00:36:45,990
But not just one metric.

967
00:36:45,990 --> 00:36:48,798
You're using multiple metrics to do this.

968
00:36:48,798 --> 00:36:50,880
And so this is an idea of
how that policy would look

969
00:36:50,880 --> 00:36:51,900
and how you set that up.

970
00:36:51,900 --> 00:36:53,239
- [Matt] Well, well done Eric.

971
00:36:53,239 --> 00:36:54,072
- Thank you.

972
00:36:54,072 --> 00:36:54,905
- [Matt] I've been
watching Eric rehearse that

973
00:36:54,905 --> 00:36:56,580
for the last two weeks and
trying to get his maths out, so.

974
00:36:56,580 --> 00:36:58,530
- I can't do math to save my life.

975
00:36:58,530 --> 00:36:59,363
- Make it for it.

976
00:36:59,363 --> 00:37:00,540
- Like, okay, I don't know how to do this.

977
00:37:00,540 --> 00:37:03,060
So, Matt's been tense
up till that moment, so.

978
00:37:03,060 --> 00:37:04,470
All right, thanks, buddy.

979
00:37:04,470 --> 00:37:05,730
All right, so that's how you do that.

980
00:37:05,730 --> 00:37:07,080
So when you're gonna do metrics,

981
00:37:07,080 --> 00:37:09,247
don't just let your system run and go,

982
00:37:09,247 --> 00:37:11,520
"Ah, I sure hope it makes it," right?

983
00:37:11,520 --> 00:37:14,137
You have the story, you have
the observability to go,

984
00:37:14,137 --> 00:37:15,630
"Okay, we can follow that."

985
00:37:15,630 --> 00:37:16,530
That's really important.

986
00:37:16,530 --> 00:37:19,500
Anytime you're doing anything
but really specific in EDA

987
00:37:19,500 --> 00:37:23,626
'cause you can build really
optimized systems that work,

988
00:37:23,626 --> 00:37:26,677
that run with your load
rather than just saying,

989
00:37:26,677 --> 00:37:28,530
"All right, provision till, you know,

990
00:37:28,530 --> 00:37:31,740
we can handle anything
and pay for that," right?

991
00:37:31,740 --> 00:37:32,573
Okay.

992
00:37:34,560 --> 00:37:36,668
So the next thing we're gonna get into

993
00:37:36,668 --> 00:37:39,300
are what I call event-based containers.

994
00:37:39,300 --> 00:37:42,600
Now, I haven't made
that a popular term yet,

995
00:37:42,600 --> 00:37:45,420
but every re:Invent for
the last two re:Invents,

996
00:37:45,420 --> 00:37:47,310
I've said this, "Someday
it's gonna stick."

997
00:37:47,310 --> 00:37:48,143
I'm coining this.

998
00:37:48,143 --> 00:37:49,590
Mark, I wanna see it in a blog.

999
00:37:49,590 --> 00:37:50,490
So, all right.

1000
00:37:50,490 --> 00:37:52,620
So event based containers,

1001
00:37:52,620 --> 00:37:53,700
what I mean by this,

1002
00:37:53,700 --> 00:37:55,530
it's kinda like event-driven containers

1003
00:37:55,530 --> 00:37:57,000
but a little different.

1004
00:37:57,000 --> 00:37:59,070
And maybe I'll explain
that and maybe I'll forget.

1005
00:37:59,070 --> 00:38:01,830
But it's this idea of a one-to-one, right?

1006
00:38:01,830 --> 00:38:04,320
So one, and Matt explained it earlier

1007
00:38:04,320 --> 00:38:08,400
when we wanna run one
container for an event.

1008
00:38:08,400 --> 00:38:10,290
So what does that look like?

1009
00:38:10,290 --> 00:38:12,360
Well, so we got a producer

1010
00:38:12,360 --> 00:38:15,240
and we're gonna kick an
event into EventBridge.

1011
00:38:15,240 --> 00:38:18,090
Now, normally if I'm running
a container on Fargate,

1012
00:38:18,090 --> 00:38:19,050
I will have a service,

1013
00:38:19,050 --> 00:38:20,700
and that service will
have a task definition.

1014
00:38:20,700 --> 00:38:23,940
This will all be at the container level.

1015
00:38:23,940 --> 00:38:28,437
But now with this, I can
actually do the task definition

1016
00:38:29,430 --> 00:38:33,000
at EventBridge that actually
will come with the event.

1017
00:38:33,000 --> 00:38:36,630
I can say, "Hey, here's a
definition, here's an event.

1018
00:38:36,630 --> 00:38:38,310
Do your thing," right?

1019
00:38:38,310 --> 00:38:40,290
Now, I'm not gonna get any data back.

1020
00:38:40,290 --> 00:38:41,820
I'm just gonna get a simple,

1021
00:38:41,820 --> 00:38:43,650
it's basically a fire and forget.

1022
00:38:43,650 --> 00:38:45,990
But that works for a lot
of what we're doing, right?

1023
00:38:45,990 --> 00:38:48,390
So your producer's gonna
kick a single event out

1024
00:38:48,390 --> 00:38:50,310
that EventBridge is gonna take that,

1025
00:38:50,310 --> 00:38:54,030
it's gonna send the task
to, calls the RunTask API,

1026
00:38:54,030 --> 00:38:55,920
and it's going to run that.

1027
00:38:55,920 --> 00:38:59,190
And you get one task versus to one event.

1028
00:38:59,190 --> 00:39:02,070
And actually, it's not
necessarily one container.

1029
00:39:02,070 --> 00:39:04,500
You wanna look at it, it
could be multiple containers

1030
00:39:04,500 --> 00:39:05,940
'cause you might have multiple tasks,

1031
00:39:05,940 --> 00:39:08,310
sidecars, things like that, all right?

1032
00:39:08,310 --> 00:39:09,540
So this is the pattern four,

1033
00:39:09,540 --> 00:39:11,400
this is the EventBridge pattern.

1034
00:39:11,400 --> 00:39:13,080
This is very popular.

1035
00:39:13,080 --> 00:39:15,750
And this is really, you
don't wanna use this

1036
00:39:15,750 --> 00:39:18,300
for dump a million events into EventBridge

1037
00:39:18,300 --> 00:39:21,330
and bring up a million containers.

1038
00:39:21,330 --> 00:39:23,880
That's not how, the RunTask
API will get overrun.

1039
00:39:23,880 --> 00:39:25,020
It's not designed for that.

1040
00:39:25,020 --> 00:39:25,950
You wanna do this.

1041
00:39:25,950 --> 00:39:29,100
We actually built this
exact example here a couple

1042
00:39:29,100 --> 00:39:29,933
of years ago,

1043
00:39:29,933 --> 00:39:31,712
we were doing video
processing and serverless

1044
00:39:31,712 --> 00:39:32,700
'cause it can be done.

1045
00:39:32,700 --> 00:39:34,800
And we were running video processing

1046
00:39:34,800 --> 00:39:38,910
and we would say, "Okay,
if the video has these,"

1047
00:39:38,910 --> 00:39:42,510
maybe file size or time limit
'cause we had the metadata.

1048
00:39:42,510 --> 00:39:43,980
If it's under two minutes,

1049
00:39:43,980 --> 00:39:47,190
process it in a Lambda file
because that's all we need.

1050
00:39:47,190 --> 00:39:50,820
If it's over two minutes,
spin up a container.

1051
00:39:50,820 --> 00:39:52,620
Most of our videos were under two minutes,

1052
00:39:52,620 --> 00:39:54,990
but every once in a while,
we had those one-offs, right?

1053
00:39:54,990 --> 00:39:57,690
So this is a really good
example on doing that.

1054
00:39:57,690 --> 00:39:59,943
We could do rules for that to set it up.

1055
00:40:01,085 --> 00:40:04,200
All right, so the second one
looks somewhat like this.

1056
00:40:04,200 --> 00:40:06,450
Pattern five is step functions.

1057
00:40:06,450 --> 00:40:08,760
Who uses step functions today?

1058
00:40:08,760 --> 00:40:10,830
Oh, do I love step functions.

1059
00:40:10,830 --> 00:40:12,720
I'm a step functions nerd.

1060
00:40:12,720 --> 00:40:14,730
I believe step functions first

1061
00:40:14,730 --> 00:40:16,290
and I'm super excited about it.

1062
00:40:16,290 --> 00:40:20,100
So step functions can
work much like EventBridge

1063
00:40:20,100 --> 00:40:23,580
in that it can actually
have the task definition

1064
00:40:23,580 --> 00:40:25,800
and you send that to EventBridge,

1065
00:40:25,800 --> 00:40:28,290
but it gives you a little
bit more flexibility.

1066
00:40:28,290 --> 00:40:31,751
It gives you synchronous, synchronous,

1067
00:40:31,751 --> 00:40:34,470
synchronous and asynchronous options.

1068
00:40:34,470 --> 00:40:37,260
Now, that means blocking
and non-blocking, right?

1069
00:40:37,260 --> 00:40:40,860
So let me show you how
this can work, okay?

1070
00:40:40,860 --> 00:40:43,016
So the async pattern,

1071
00:40:43,016 --> 00:40:43,849
this is the first one we're gonna do.

1072
00:40:43,849 --> 00:40:46,290
And this is kind of a fire and
forget just like EventBridge.

1073
00:40:46,290 --> 00:40:49,290
So what we do is we use a run task.

1074
00:40:49,290 --> 00:40:52,080
And so we do, it's an async,
it's a fire and forget.

1075
00:40:52,080 --> 00:40:54,517
And it returns of
acknowledgement of the request.

1076
00:40:54,517 --> 00:40:58,920
"Yes, I got your request,
I'm working on it."

1077
00:40:58,920 --> 00:40:59,753
Move on.

1078
00:40:59,753 --> 00:41:02,040
And the task, the step
function will actually move on

1079
00:41:02,040 --> 00:41:02,873
from this point.

1080
00:41:02,873 --> 00:41:03,706
It won't wait.

1081
00:41:03,706 --> 00:41:06,690
You don't get any data back, off you go.

1082
00:41:06,690 --> 00:41:09,360
However, sometimes there are times

1083
00:41:09,360 --> 00:41:12,360
when you need to stop and wait.

1084
00:41:12,360 --> 00:41:17,220
You need to know that that
was successful or failed.

1085
00:41:17,220 --> 00:41:20,460
So we also offer what we
call the dot sync pattern.

1086
00:41:20,460 --> 00:41:21,930
This is kind of cool.

1087
00:41:21,930 --> 00:41:23,490
Not kind of, it's really cool

1088
00:41:23,490 --> 00:41:26,640
because it handles the
polling for you, right?

1089
00:41:26,640 --> 00:41:28,740
So what happens is when it sends,

1090
00:41:28,740 --> 00:41:30,600
it sends to the RunTask API

1091
00:41:30,600 --> 00:41:35,520
and then it pulls the describe
ECS task for a status.

1092
00:41:35,520 --> 00:41:38,010
If it worked, then you get a 200 back.

1093
00:41:38,010 --> 00:41:40,650
If it failed, then you get a 400 or a 500

1094
00:41:40,650 --> 00:41:42,300
or whatever going on, right?

1095
00:41:42,300 --> 00:41:45,570
And so, however, you still don't
get data back from the ECS,

1096
00:41:45,570 --> 00:41:47,100
and a lot of times this is okay.

1097
00:41:47,100 --> 00:41:49,650
But this is an, if I
need to poll services,

1098
00:41:49,650 --> 00:41:52,680
and this happens a lot, okay?

1099
00:41:52,680 --> 00:41:55,770
But you may say, "Eric,
yeah, we need data back.

1100
00:41:55,770 --> 00:41:56,907
How do I do that?"

1101
00:41:57,810 --> 00:41:59,070
Well, let me show you.

1102
00:41:59,070 --> 00:42:01,500
So next pattern we're
gonna talk about this

1103
00:42:01,500 --> 00:42:03,450
is the callback pattern using the token

1104
00:42:03,450 --> 00:42:05,493
and send task completion.

1105
00:42:06,390 --> 00:42:07,743
Anybody use this now?

1106
00:42:08,610 --> 00:42:10,200
All right, a couple of you, okay.

1107
00:42:10,200 --> 00:42:11,940
Anybody like, "Wow."

1108
00:42:11,940 --> 00:42:12,810
Well, I haven't explained it yet.

1109
00:42:12,810 --> 00:42:13,740
Let's wait on that question.

1110
00:42:13,740 --> 00:42:15,753
All right, I will get a wow out of here.

1111
00:42:15,753 --> 00:42:18,240
All right, so the way this
works is when you come

1112
00:42:18,240 --> 00:42:21,090
to this task, it's gonna generate a token

1113
00:42:21,090 --> 00:42:23,940
and it's gonna send
that token with the data

1114
00:42:23,940 --> 00:42:27,630
and the task definition to the RunTask API

1115
00:42:27,630 --> 00:42:30,120
and it's going to bring
the task up, right?

1116
00:42:30,120 --> 00:42:32,400
And then it's gonna give all
that data to the container

1117
00:42:32,400 --> 00:42:35,220
and the container will turn
on, and it'll sit and wait.

1118
00:42:35,220 --> 00:42:38,880
And it'll wait for that task to be done.

1119
00:42:38,880 --> 00:42:42,930
So in the container,
when the job's all done,

1120
00:42:42,930 --> 00:42:45,630
you actually call the service.

1121
00:42:45,630 --> 00:42:49,920
There's an API endpoint
send success or send fail.

1122
00:42:49,920 --> 00:42:53,460
And you call it with the callback token

1123
00:42:53,460 --> 00:42:54,607
and step functions goes,

1124
00:42:54,607 --> 00:42:57,450
"Oh, I know which workflow
that is based on your token.

1125
00:42:57,450 --> 00:42:59,970
Here you go, success or fail.

1126
00:42:59,970 --> 00:43:03,120
And here's the return data."

1127
00:43:03,120 --> 00:43:06,120
Okay, so you're able to get
data back to the step function

1128
00:43:06,120 --> 00:43:08,760
and modify and work on that later.

1129
00:43:08,760 --> 00:43:12,960
So this is a very, very
powerful event-driven model

1130
00:43:12,960 --> 00:43:16,140
that you can do in step functions, right?

1131
00:43:16,140 --> 00:43:18,510
Okay, so then the task needs
to invoke step functions.

1132
00:43:18,510 --> 00:43:21,630
And the API goes to
complete, and off you go.

1133
00:43:21,630 --> 00:43:25,290
Now, there's one more
pattern I wanna show you

1134
00:43:25,290 --> 00:43:27,270
that I'm gonna be really honest.

1135
00:43:27,270 --> 00:43:32,100
I just learned about last year,
and I think is super cool.

1136
00:43:32,100 --> 00:43:34,140
And I think you're fairly,
you just learned about.

1137
00:43:34,140 --> 00:43:37,110
- [Matt] I learned about
this in practicing,

1138
00:43:37,110 --> 00:43:39,960
when you talked about it a
few months ago, Eric, so.

1139
00:43:39,960 --> 00:43:42,543
- Is anybody using
activities in step functions?

1140
00:43:44,220 --> 00:43:46,893
Okay, anybody heard of
activities step functions?

1141
00:43:47,880 --> 00:43:50,906
Okay, one person, but
he knows VTL too, so.

1142
00:43:50,906 --> 00:43:52,314
(audience laughing)

1143
00:43:52,314 --> 00:43:53,610
He's kind of a nerd.

1144
00:43:53,610 --> 00:43:56,850
All right, so let me tell
you about activities.

1145
00:43:56,850 --> 00:43:58,683
So here's how activities work.

1146
00:43:59,730 --> 00:44:01,860
When you create, you go into the console,

1147
00:44:01,860 --> 00:44:03,298
you can do it through the API,

1148
00:44:03,298 --> 00:44:04,200
but you actually create an activity

1149
00:44:04,200 --> 00:44:05,850
outside your step function.

1150
00:44:05,850 --> 00:44:06,990
It sits on its own.

1151
00:44:06,990 --> 00:44:08,190
So you create this activity.

1152
00:44:08,190 --> 00:44:12,930
What happens is step functions
creates a managed SQS queue,

1153
00:44:12,930 --> 00:44:14,280
and it's gonna manage it for you

1154
00:44:14,280 --> 00:44:16,380
and handle all that stuff, right?

1155
00:44:16,380 --> 00:44:20,130
So then what you do is
from your step functions,

1156
00:44:20,130 --> 00:44:21,450
and not just one of them,

1157
00:44:21,450 --> 00:44:25,350
but any of them, you
can pump data into the,

1158
00:44:25,350 --> 00:44:28,590
or pump events into this activity queue.

1159
00:44:28,590 --> 00:44:32,610
And then you have a pool of ECS workers.

1160
00:44:32,610 --> 00:44:34,950
Eh, we're tying ECS in here.

1161
00:44:34,950 --> 00:44:36,450
This pool of workers then,

1162
00:44:36,450 --> 00:44:38,100
much like any other pattern we've seen,

1163
00:44:38,100 --> 00:44:41,250
polls for this data, does the work.

1164
00:44:41,250 --> 00:44:43,380
It's got the same kind
of interaction as SQS

1165
00:44:43,380 --> 00:44:44,880
'cause it's an SQS queue

1166
00:44:44,880 --> 00:44:47,520
and then sends back to step functions

1167
00:44:47,520 --> 00:44:51,360
with the task token and the data.

1168
00:44:51,360 --> 00:44:55,650
And now, you've sent,
you're handling tons.

1169
00:44:55,650 --> 00:44:56,767
This is when you have,

1170
00:44:56,767 --> 00:45:00,150
"I have thousands upon thousands
upon thousands of events

1171
00:45:00,150 --> 00:45:03,750
and I need them to be processed
from multiple workflows."

1172
00:45:03,750 --> 00:45:05,700
This is the pattern for this.

1173
00:45:05,700 --> 00:45:07,710
Now, we talked about this last year

1174
00:45:07,710 --> 00:45:10,470
in this very session actually.

1175
00:45:10,470 --> 00:45:12,930
And I will tell you
this stuff really works.

1176
00:45:12,930 --> 00:45:14,010
Don't just take my word for it.

1177
00:45:14,010 --> 00:45:15,270
This tweet came out in September.

1178
00:45:15,270 --> 00:45:16,200
It says, "A few months back,

1179
00:45:16,200 --> 00:45:18,870
inspired by a great session by @edjgeek."

1180
00:45:18,870 --> 00:45:20,190
That's all I wanted to read.

1181
00:45:20,190 --> 00:45:21,337
No, I'm just kidding. Let's go on.

1182
00:45:21,337 --> 00:45:24,960
"We made changes to an AWS step
functions reducing its costs

1183
00:45:24,960 --> 00:45:29,960
from $450 per invocation to $1.

1184
00:45:32,370 --> 00:45:33,570
If you're intrigued, check it out

1185
00:45:33,570 --> 00:45:35,610
and I'll post that in the resources."

1186
00:45:35,610 --> 00:45:38,040
But, and you can find it.

1187
00:45:38,040 --> 00:45:39,397
Now, the first question is,

1188
00:45:39,397 --> 00:45:41,070
"Oh my gosh, what are they doing

1189
00:45:41,070 --> 00:45:43,437
that costs $450 per invocation?"

1190
00:45:44,670 --> 00:45:45,503
Right?

1191
00:45:45,503 --> 00:45:47,580
But they were doing a lot of
work, a lot of transitions,

1192
00:45:47,580 --> 00:45:49,110
hundreds and hundreds
and hundreds and hundreds

1193
00:45:49,110 --> 00:45:51,810
of like minuscule micro transitions

1194
00:45:51,810 --> 00:45:53,520
that probably made more sense to run

1195
00:45:53,520 --> 00:45:55,710
in an ECS cluster, right?

1196
00:45:55,710 --> 00:45:58,530
So this activities
pattern handled that form.

1197
00:45:58,530 --> 00:46:01,560
All right, so activities
gives you several benefits.

1198
00:46:01,560 --> 00:46:03,150
First of all, managed queue.

1199
00:46:03,150 --> 00:46:04,920
You get one year retention in that.

1200
00:46:04,920 --> 00:46:07,053
Second connects on-premise.

1201
00:46:08,250 --> 00:46:10,500
This is where, "Oh, hey,
I need to process this

1202
00:46:10,500 --> 00:46:11,333
with on-premise stuff."

1203
00:46:11,333 --> 00:46:12,360
You can do that from there.

1204
00:46:12,360 --> 00:46:15,000
And finally, loosely coupled architecture,

1205
00:46:15,000 --> 00:46:16,890
and flexibility to use Spot,

1206
00:46:16,890 --> 00:46:18,240
which is a lot of people
don't think about this.

1207
00:46:18,240 --> 00:46:21,447
But if I'm using clustered
ECS, I can use Spot for that.

1208
00:46:21,447 --> 00:46:24,900
All right, so let's talk about
how does this help Sarah?

1209
00:46:24,900 --> 00:46:26,853
Sarah was in trouble. Let's show her.

1210
00:46:29,640 --> 00:46:32,670
- So now, we've got a whole set of tools

1211
00:46:32,670 --> 00:46:36,090
that we can combine with
our recess architecture.

1212
00:46:36,090 --> 00:46:40,020
We've got all of our different
brokers that we can apply.

1213
00:46:40,020 --> 00:46:43,140
We've got all of these different patterns

1214
00:46:43,140 --> 00:46:45,450
that we can apply to our architecture.

1215
00:46:45,450 --> 00:46:47,300
So what does that actually look like?

1216
00:46:48,210 --> 00:46:51,630
We talked before we are
relatively sensibly designed

1217
00:46:51,630 --> 00:46:54,653
microservices architecture, containerized.

1218
00:46:56,310 --> 00:46:59,790
The first thing we can do is
start publishing some events.

1219
00:46:59,790 --> 00:47:02,493
So we've got our order service.

1220
00:47:05,310 --> 00:47:06,570
Every time an order is created,

1221
00:47:06,570 --> 00:47:08,550
we can go into create
an order created event.

1222
00:47:08,550 --> 00:47:10,050
We can make a single STK call.

1223
00:47:10,050 --> 00:47:13,380
That's gonna publish it to EventBridge.

1224
00:47:13,380 --> 00:47:15,510
We now want to go and do
something with that event.

1225
00:47:15,510 --> 00:47:18,360
So maybe we want to take
out our payment service

1226
00:47:18,360 --> 00:47:23,360
that is currently happening synchronously,

1227
00:47:23,820 --> 00:47:25,831
but depends on some third party APIs.

1228
00:47:25,831 --> 00:47:26,760
We wanna go and make that asynchronous.

1229
00:47:26,760 --> 00:47:28,680
So we accept the transaction.

1230
00:47:28,680 --> 00:47:31,350
We use some validation
on the payment details.

1231
00:47:31,350 --> 00:47:34,890
We assume that our payment
process is gonna process it.

1232
00:47:34,890 --> 00:47:36,150
And if there's a problem down the road,

1233
00:47:36,150 --> 00:47:37,957
we can actually go and send
the customer a message and say,

1234
00:47:37,957 --> 00:47:41,787
"Hey, can you come and retry
with some new payment details?"

1235
00:47:43,170 --> 00:47:45,420
We can do that with our existing service

1236
00:47:45,420 --> 00:47:48,060
by having a rule that's
got that API integration.

1237
00:47:48,060 --> 00:47:50,250
We can do a private API integration

1238
00:47:50,250 --> 00:47:53,100
into our VPC using all the
stuff that Eric showed.

1239
00:47:53,100 --> 00:47:57,120
So pretty quickly, we can
take two synchronous services

1240
00:47:57,120 --> 00:47:59,010
and break them up using a
really, really simple pattern

1241
00:47:59,010 --> 00:48:00,453
and make them asynchronous.

1242
00:48:02,520 --> 00:48:04,500
We also want to go and
send a bunch of messages

1243
00:48:04,500 --> 00:48:05,340
to our customers.

1244
00:48:05,340 --> 00:48:07,740
So instead of having a direct SDK call

1245
00:48:07,740 --> 00:48:11,043
to one of the messaging
services inside our code,

1246
00:48:12,330 --> 00:48:14,400
maybe doing it synchronously,
we can break that out.

1247
00:48:14,400 --> 00:48:16,440
So we'll have a separate rule
that's looking at those orders

1248
00:48:16,440 --> 00:48:18,097
and sending you an SMS message saying,

1249
00:48:18,097 --> 00:48:19,290
"Hey, your order has been confirmed."

1250
00:48:19,290 --> 00:48:20,430
Or, "Actually, you need to go

1251
00:48:20,430 --> 00:48:22,257
and update your payment details."

1252
00:48:24,270 --> 00:48:25,320
We've got our loyalty service.

1253
00:48:25,320 --> 00:48:27,630
So a year ago, this is
the service that blew up.

1254
00:48:27,630 --> 00:48:28,830
We've got a third party service

1255
00:48:28,830 --> 00:48:31,920
that we were expecting
to respond immediately.

1256
00:48:31,920 --> 00:48:34,170
Now, it's important that our
customers receive loyalty

1257
00:48:34,170 --> 00:48:36,420
points when they make a purchase,

1258
00:48:36,420 --> 00:48:38,490
but it probably doesn't
have to happen immediately

1259
00:48:38,490 --> 00:48:39,323
as part of that flow.

1260
00:48:39,323 --> 00:48:40,200
In fact, we'll probably happy

1261
00:48:40,200 --> 00:48:42,850
if it happens some point
before the end of the month.

1262
00:48:43,710 --> 00:48:46,890
Here, we can send all of those
orders of the order details

1263
00:48:46,890 --> 00:48:48,000
into a queue,

1264
00:48:48,000 --> 00:48:51,150
and that loyalty service can
process them on their own time.

1265
00:48:51,150 --> 00:48:52,530
We don't need to scale out that service.

1266
00:48:52,530 --> 00:48:54,300
It can just tug away

1267
00:48:54,300 --> 00:48:57,050
and make sure it's kind of
catching up with that queue.

1268
00:48:58,320 --> 00:48:59,250
And then finally,

1269
00:48:59,250 --> 00:49:01,590
we've got this really
cool activity pattern

1270
00:49:01,590 --> 00:49:03,570
that Eric taught us about.

1271
00:49:03,570 --> 00:49:05,837
Once a month, we want
to go and run a process

1272
00:49:05,837 --> 00:49:09,120
that's gonna look at all
of our customers sales

1273
00:49:09,120 --> 00:49:11,370
and loyalty points and tier changes

1274
00:49:11,370 --> 00:49:13,290
and do a whole bunch of processing

1275
00:49:13,290 --> 00:49:17,010
and go and send them some
personalized discounts

1276
00:49:17,010 --> 00:49:18,600
to help them, encourage them to come back

1277
00:49:18,600 --> 00:49:19,830
and buy some more stuff.

1278
00:49:19,830 --> 00:49:22,620
So here, we can use step
functions and activity pattern

1279
00:49:22,620 --> 00:49:24,567
and we can actually do
that batch processing

1280
00:49:24,567 --> 00:49:27,480
in a really, really
efficient event-driven way.

1281
00:49:27,480 --> 00:49:29,730
So we can keep applying these patterns

1282
00:49:29,730 --> 00:49:32,220
in different ways to our architecture.

1283
00:49:32,220 --> 00:49:35,820
EventBridge at the heart of
it, using ECS for our compute.

1284
00:49:35,820 --> 00:49:39,090
And quite quickly get to a new solution.

1285
00:49:39,090 --> 00:49:43,680
So next year in November
when things ramp up,

1286
00:49:43,680 --> 00:49:46,110
Sarah sits at her desk
and nothing happens,

1287
00:49:46,110 --> 00:49:48,810
and boss is happy.

1288
00:49:48,810 --> 00:49:49,830
Everyone gets to celebrate.

1289
00:49:49,830 --> 00:49:51,990
Go, Sarah, we're happy for you.

1290
00:49:51,990 --> 00:49:53,400
- That's right.

1291
00:49:53,400 --> 00:49:55,290
So Sarah's happy.

1292
00:49:55,290 --> 00:49:58,680
She's now EDA partially
and she's moved part of it.

1293
00:49:58,680 --> 00:50:02,160
She's a good part of it
and she can do a lot more.

1294
00:50:02,160 --> 00:50:03,540
So here's what we wanna help you with

1295
00:50:03,540 --> 00:50:05,130
when you walk away from here.

1296
00:50:05,130 --> 00:50:06,570
If you're not doing EDA now,

1297
00:50:06,570 --> 00:50:09,295
it's not a flip of a switch, right?

1298
00:50:09,295 --> 00:50:11,048
I love this statement.

1299
00:50:11,048 --> 00:50:14,437
Werner Vogels, VP and CTO at Amazon says,

1300
00:50:14,437 --> 00:50:17,940
"Systems that don't evolve will die."

1301
00:50:17,940 --> 00:50:18,817
He's also the one that says,

1302
00:50:18,817 --> 00:50:21,270
"Everything breaks all the time," right?

1303
00:50:21,270 --> 00:50:23,370
Two very known quotes.

1304
00:50:23,370 --> 00:50:25,350
So it's important that we evolve.

1305
00:50:25,350 --> 00:50:29,730
If your system is good enough,
it probably won't be soon.

1306
00:50:29,730 --> 00:50:30,840
You always wanna be watching.

1307
00:50:30,840 --> 00:50:32,700
Even if it's working, is
it working efficiently?

1308
00:50:32,700 --> 00:50:34,320
Is it saving you money?

1309
00:50:34,320 --> 00:50:35,970
So one thing we encourage
when you're looking

1310
00:50:35,970 --> 00:50:37,980
on your EDA journey is where do you start?

1311
00:50:37,980 --> 00:50:40,290
Well, you may not have full understanding.

1312
00:50:40,290 --> 00:50:43,380
EDA, like anything else,
you learn as you go.

1313
00:50:43,380 --> 00:50:45,690
So I encourage you start small,

1314
00:50:45,690 --> 00:50:47,820
start with, you know, an implementation

1315
00:50:47,820 --> 00:50:49,320
that you can start working on,

1316
00:50:49,320 --> 00:50:51,720
and your understanding
will grow with that.

1317
00:50:51,720 --> 00:50:54,120
Obviously, don't start in production,

1318
00:50:54,120 --> 00:50:56,580
just hopefully you know that
already, but there it is.

1319
00:50:56,580 --> 00:50:59,880
And, but as you grow with that,

1320
00:50:59,880 --> 00:51:02,670
you know, you can, you
learn more and you go.

1321
00:51:02,670 --> 00:51:05,280
So here's some key
takeaways I would give you.

1322
00:51:05,280 --> 00:51:07,680
Synchronous microservices
crack under pressure,

1323
00:51:07,680 --> 00:51:08,513
you learn that.

1324
00:51:08,513 --> 00:51:09,540
Sarah didn't fail because of ECS.

1325
00:51:09,540 --> 00:51:12,210
She failed because the tight
coupling, things like that.

1326
00:51:12,210 --> 00:51:15,030
EDA is the ultimate decoupling
superpower. It really is.

1327
00:51:15,030 --> 00:51:18,840
It allows you to really build
that scale and reliability.

1328
00:51:18,840 --> 00:51:21,390
ECS plus Fargate brings the muscle.

1329
00:51:21,390 --> 00:51:23,610
Service containers,
zero servers to manage,

1330
00:51:23,610 --> 00:51:26,100
instance scale, things like that.

1331
00:51:26,100 --> 00:51:28,740
And you've got routing options for days.

1332
00:51:28,740 --> 00:51:31,263
This can give you a lot
of flexibility to do that.

1333
00:51:32,340 --> 00:51:35,220
ECS runs every EDA pattern
like a champ, right?

1334
00:51:35,220 --> 00:51:38,850
So we just talked about push,
pull, sync, async, callbacks.

1335
00:51:38,850 --> 00:51:41,550
Autoscaling becomes your superpower.

1336
00:51:41,550 --> 00:51:43,560
ECS Managed Instances equals less hops.

1337
00:51:43,560 --> 00:51:44,790
So you're gonna be able to,

1338
00:51:44,790 --> 00:51:46,230
obviously, we talked about
the managed instances,

1339
00:51:46,230 --> 00:51:47,520
how those are gonna help.

1340
00:51:47,520 --> 00:51:49,980
And step functions unlock
next level orchestration.

1341
00:51:49,980 --> 00:51:52,290
So you're able to do a lot
of orchestration on that.

1342
00:51:52,290 --> 00:51:55,440
And finally, loosely coupled systems.

1343
00:51:55,440 --> 00:51:59,460
And yes, Sarah does win
by running this route.

1344
00:51:59,460 --> 00:52:01,350
We promised you some resources.

1345
00:52:01,350 --> 00:52:04,993
I encourage you to check
these out, s12d.com/CNS307-25.

1346
00:52:09,150 --> 00:52:10,920
All right, here's a couple
other resources I'm gonna give

1347
00:52:10,920 --> 00:52:11,753
you here.

1348
00:52:11,753 --> 00:52:12,634
Let me go back.

1349
00:52:12,634 --> 00:52:13,467
I saw some of you still
trying to get that,

1350
00:52:13,467 --> 00:52:15,300
so let me throw that up here for a moment.

1351
00:52:17,040 --> 00:52:18,180
All right.

1352
00:52:18,180 --> 00:52:20,250
And then the next thing I'll tell you

1353
00:52:20,250 --> 00:52:22,470
is we've got a couple other
resources I would encourage you

1354
00:52:22,470 --> 00:52:23,370
to check out.

1355
00:52:23,370 --> 00:52:25,590
I tried to get ones after this,

1356
00:52:25,590 --> 00:52:28,560
but the best practices
for service developers,

1357
00:52:28,560 --> 00:52:30,450
super strong session.

1358
00:52:30,450 --> 00:52:31,283
This is a great one.

1359
00:52:31,283 --> 00:52:33,420
API207: Using event-driven architectures

1360
00:52:33,420 --> 00:52:35,820
to modernize legacy, more EDA.

1361
00:52:35,820 --> 00:52:38,370
And then serverless
espresso is a great example

1362
00:52:38,370 --> 00:52:40,050
of event-driven application at scale.

1363
00:52:40,050 --> 00:52:42,360
You get the coffee in the expo hall

1364
00:52:42,360 --> 00:52:43,650
or the certification lounge,

1365
00:52:43,650 --> 00:52:45,060
and then go see how it was built.

1366
00:52:45,060 --> 00:52:47,010
I really encourage you to do that.

1367
00:52:47,010 --> 00:52:48,630
If you wanna learn more about serverless

1368
00:52:48,630 --> 00:52:51,294
and application integration resources,

1369
00:52:51,294 --> 00:52:53,910
we have a lot out there.

1370
00:52:53,910 --> 00:52:56,550
On behalf of Matt and myself,
I really wanna tell you.

1371
00:52:56,550 --> 00:52:57,383
Thank you, Matt.

1372
00:52:57,383 --> 00:53:00,210
You have anything else you wanna
throw out, shameless plugs?

1373
00:53:00,210 --> 00:53:02,220
- If you can make it to
the Mandalay Bay at 5:30,

1374
00:53:02,220 --> 00:53:03,480
we'll be doing a chalk talk,

1375
00:53:03,480 --> 00:53:06,690
diving into a lot of these
patterns in more detail

1376
00:53:06,690 --> 00:53:08,580
and really helping unpick
them with the audience.

1377
00:53:08,580 --> 00:53:09,720
I think that's the last one.

1378
00:53:09,720 --> 00:53:10,553
- All right.

1379
00:53:10,553 --> 00:53:12,420
And for my shameless plug is on Wednesday,

1380
00:53:12,420 --> 00:53:16,563
I'll be discussing at 10:30,

1381
00:53:17,400 --> 00:53:19,470
and I can't mention
what that is right now,

1382
00:53:19,470 --> 00:53:23,220
but I encourage you to keep
10:30, Mandalay Bay open.

1383
00:53:23,220 --> 00:53:25,500
If you love serverless,
you'll love me for this.

1384
00:53:25,500 --> 00:53:26,730
So that's all I can say.

1385
00:53:26,730 --> 00:53:28,890
I wish I could say more, but
I encourage you to do that.

1386
00:53:28,890 --> 00:53:30,780
With that, I wanna say
thank you very much.

1387
00:53:30,780 --> 00:53:33,240
Please fill out the survey, let us know.

1388
00:53:33,240 --> 00:53:35,610
We always like to know
how we can do better.

1389
00:53:35,610 --> 00:53:36,443
Enjoy re:Invent.

1390
00:53:36,443 --> 00:53:37,641
Thank you very much.

1391
00:53:37,641 --> 00:53:38,884
(audience applauding)

