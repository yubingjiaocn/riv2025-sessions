# AWS re:Invent 2025 分布式应用运维卓越实践

## 会议概述

本次AWS re:Invent 2025分组会议聚焦于现代分布式应用的运维卓越实践。两位AWS可观测性解决方案架构师Anna和Helen分享了如何通过正确的工具和技术来应对分布式应用的可观测性挑战。

会议从一个真实的生产事故案例引入——由于过期的客户端证书导致的登录故障，说明了在复杂的分布式系统中快速定位问题根因的困难性。讲师强调，虽然现代微服务架构带来了敏捷性和灵活性，但也增加了可观测性的复杂度。与单体应用相比，分布式应用的遥测数据分散在各处，缺乏统一视图，这使得故障排查变得更加困难。

会议系统地介绍了实现运维卓越的必备要素，包括指标监控、分布式追踪、开放遥测标准(OpenTelemetry)的应用，以及如何填补遥测数据的盲区。通过实际的控制台演示，展示了AWS CloudWatch Application Signals如何帮助团队快速发现和解决问题，大幅缩短故障检测和解决时间。

## 详细时间线与关键要点

### **开场与问题引入 (0:00-3:30)**
- **0:00** - 会议开始，讲师请观众戴上耳机确认音频
- **0:45** - 互动提问：有多少人经历过在海量日志中寻找分布式应用故障根因的痛苦经历
- **1:15** - 分享真实案例：金融应用无法新建登录会话的故障，最终发现是过期的客户端证书导致
- **2:30** - 强调核心观点：使用正确的工具和技术可以让故障排查变得更容易
- **3:00** - 介绍会议议程：现代应用挑战、运维卓越必备要素、分布式追踪、OpenTelemetry、演示、填补遥测盲区

### **现代应用的挑战 (3:30-6:00)**
- **3:30** - 回顾单体应用的问题：难以扩展、紧耦合依赖、部署困难、团队协作受限
- **4:15** - 现代应用的优势：基于微服务、无服务器技术、短生命周期资源，提供敏捷性和灵活性
- **4:45** - 讨论单体应用的"优点"：使用KVM可以在一个地方查看所有数据，可观测性更简单
- **5:30** - 现代应用的可观测性挑战：遥测数据分散、服务依赖关系不清晰

### **运维卓越的必备要素 (6:00-15:00)**
- **6:00** - Helen开始讲解运维卓越的关键要素
- **6:15** - 第一要素：从指标开始 - 强调指标是最佳起点，AWS首席工程师对指标极度重视
- **6:45** - 业务指标优先 - 业务指标应该告诉你工作负载是否满足业务需求
- **7:30** - 技术指标需要追问"为什么" - 例如负载均衡器延迟的变化对业务的实际影响是什么
- **8:15** - 标准化指标命名 - 介绍"黄金指标"或"RED指标"：可用性(Availability)、请求(Requests)、错误(Errors)、持续时间(Duration)
- **9:00** - 共享仪表板 - 与同事共享服务信息，让他们能够独立了解服务状态
- **9:45** - 自定义指标与维度 - 在CloudWatch中使用维度(dimensions)添加元数据，在Prometheus中称为标签(labels)
- **10:30** - 利用资源标签 - 通过Metric Insights查询使用资源标签的供应商指标
- **11:45** - 持续改进流程 - 介绍Amazon的"纠错"(Correction of Errors)流程
- **12:30** - 关键问题1：如何缩短检测时间 - 需要多久才能发现问题？是否需要额外数据或调整告警？
- **13:00** - 关键问题2：如何缩短解决时间 - 什么额外的上下文信息能帮助更快理解和解决问题？
- **13:45** - Metric Insights告警 - 演示如何使用一个告警监控多个指标，通过标签和维度控制查询范围
- **14:30** - 告警通知控制：可以选择聚合通知或独立通知，group by信息会包含在告警事件中

### **分布式追踪的重要性 (15:00-20:00)**
- **15:00** - Anna接手讲解分布式追踪
- **15:15** - 强调观点：对于分布式应用，追踪是不可避免的
- **15:45** - 追踪的价值：提供应用"地图"、加速问题解决、改善可观测性
- **16:30** - 消除顾虑：追踪不一定需要复杂的代码更改
- **17:00** - 推荐OpenTelemetry - 供应商中立的开放标准，提供统一的遥测数据收集方法
- **17:45** - 自动插桩(Auto-instrumentation) - 无需代码更改，自动监听HTTP调用、数据库请求等
- **18:30** - Python应用示例：只需安装和配置OpenTelemetry库，无需修改代码
- **19:15** - 手动插桩的场景 - 添加业务特定数据，如用户层级、订单号等

### **关联与上下文 (20:00-25:00)**
- **20:00** - 强调关联和上下文的重要性
- **20:30** - 业务上下文 - 记录对故障排查有价值的业务数据
- **21:00** - 遥测关联 - 指标到追踪的关联、追踪到日志的关联
- **21:30** - Python日志插桩示例：自动将trace ID和span ID添加到日志数据中
- **22:15** - 技术上下文 - 了解遥测数据来源：实例ID、主机、服务器地址等
- **22:45** - 语义约定(Semantic Conventions) - OpenTelemetry提供标准化的命名结构和数据含义
- **23:30** - Baggage传播上下文 - 设置一次属性后在所有地方可用，用于遥测数据而非业务逻辑

### **采样策略 (25:00-29:00)**
- **25:00** - 讨论如何控制遥测数据量和成本
- **25:15** - 头部采样(Head Sampling) - 在源头设置采样率，例如10%的追踪
- **25:45** - 注意事项：采样率过低可能遗漏重要数据
- **26:15** - 尾部采样(Tail Sampling) - 更精细的控制，先发送所有追踪到收集器，然后根据规则采样
- **26:45** - 尾部采样示例：100%采样有错误的追踪、100%采样超过1秒的追踪、5%采样其他追踪
- **27:30** - 尾部采样的运维考虑：收集器需要高可用和足够内存
- **28:00** - X-Ray采样规则 - 在AWS X-Ray端设置采样规则
- **28:30** - 自适应采样 - X-Ray支持在特定条件下额外采样，如500错误、异常追踪捕获

### **Transaction Search (29:00-30:30)**
- **29:00** - 介绍Transaction Search：分析100%的span数据
- **29:30** - 可以选择在X-Ray中索引部分追踪(1%、10%等)
- **30:00** - Span数据保存到AWS/Spans日志组，可进行进一步分析和长期保留

### **CloudWatch Application Signals介绍 (30:30-32:00)**
- **30:30** - 介绍Application Signals作为实现RED指标和追踪的方案
- **31:00** - 功能概览：自动插桩、自动发现依赖关系、关联的指标和追踪
- **31:30** - SLO管理、燃尽率指标、应用地图、Transaction Search、CloudWatch集成

### **实际演示开始 (32:00-50:00)**
- **32:00** - 切换到CloudWatch控制台演示
- **32:15** - 展示Application Signals应用地图，发现一个服务有SLI违规(红色标记)
- **32:45** - 注意到三个未插桩的服务(虚线框)，提示遥测盲区
- **33:15** - 双击Pet Clinic前端服务，展示复杂的依赖关系图
- **34:00** - 快捷方式1：地图上半红的圆圈显示45%故障率
- **34:30** - 查看payment-service.net的详细信息
- **35:00** - 展示RED指标：请求、可用性、延迟及百分位数
- **35:30** - 进入服务操作视图，发现支付操作有100%故障率
- **36:15** - 指标到追踪关联：点击故障指标点，显示相关追踪
- **37:00** - 展示业务上下文：手动插桩的owner ID，可以看到所有客户都受影响
- **37:45** - 展示.NET代码中的手动插桩示例：使用CurrentActivity.SetTag添加owner ID
- **38:30** - 分析追踪详情：发现"指定的队列不存在"错误
- **39:15** - 展示span中的关联日志，trace ID和span ID已自动记录
- **39:45** - 查看资源标签：显示使用OpenTelemetry for Java自动插桩
- **40:15** - 展示元数据中的语义约定：host.image、host.id和手动添加的owner ID
- **41:00** - 快捷方式2：Transaction Search - 按owner ID和服务搜索特定客户的问题
- **42:00** - 返回SLO控制台，查看appointment service的SLI违规
- **42:30** - 发现可用性仅74.9%，远低于95%目标，错误预算已耗尽
- **43:00** - 快捷方式3：按版本查看贡献者 - 发现版本2有29%故障率和32.6%可用性
- **43:45** - 分析追踪发现空指针异常，元数据显示faas.version为2
- **44:30** - 展示billing-service-python，显示托管在EKS上
- **45:00** - 深度链接到Container Insights查看基础设施指标
- **45:30** - 展示数据库依赖：Aurora PostgreSQL的插入、查询、更新操作
- **46:00** - 深度链接到Database Insights - 查看数据库集群健康状况
- **46:45** - 展示调用服务列表、数据库负载、阻塞SQL
- **47:30** - 查看具体SQL代码、执行计划、调用服务和操作统计

### **Lambda快速插桩演示 (48:00-50:00)**
- **48:00** - 演示如何快速为Lambda函数启用追踪
- **48:30** - 进入Lambda配置 → 监控和操作工具 → 编辑
- **49:00** - 勾选两个选项：Application Signals和Lambda Insights追踪
- **49:15** - 保存后自动添加环境变量和OpenTelemetry Lambda层
- **49:45** - 展示已插桩的photo-processing服务：自动发现依赖、RED指标可用

### **填补遥测盲区 (50:00-53:00)**
- **50:00** - Helen继续讲解如何填补遥测盲区
- **50:30** - 强调有时追踪、指标和日志仍不能提供完整画面，需要专业工具
- **51:00** - Synthetic Canaries - Helen的最爱，无需代码更改即可从客户端获得可见性
- **51:30** - Container Insights - 提供开箱即用的仪表板，收集ECS、EKS、Fargate的CPU、内存、磁盘、网络指标
- **52:00** - 可在集群、节点、Pod、容器等多个层级探索数据
- **52:30** - Network Flow Monitor - 推出约一年但很多客户不了解
- **52:45** - 提供EC2、EKS和AWS服务之间的近实时网络性能可观测性

### **会议总结 (53:00-结束)**
- 会议强调了分布式追踪对现代应用运维卓越的重要性
- OpenTelemetry提供了标准化、供应商中立的可观测性实现方案
- CloudWatch Application Signals大幅简化了追踪和监控的实施
- 通过正确的工具和技术，可以显著缩短故障检测和解决时间
- 会议最后分享QR码，提供交互式演示和更多资源