# AWS re:Invent 2025 技术分享会总结

## 会议概述

本次技术分享会由Roland Barcia（AWS全球专家技术总监）和Carlos Santana（平台工程师和Kubernetes专家）共同主持，主题聚焦于如何将现有的容器化微服务应用通过MCP（Model Context Protocol）协议暴露给AI代理系统。演讲者通过一个生动的家庭保险公司场景（Carlos在跳舞时不小心弄坏了冰箱需要报修）引入主题，展示了如何构建一个智能代理来处理预约、理赔等业务流程。

核心技术架构包括：使用Amazon EKS托管现有的微服务应用，通过Agent Core Gateway将这些服务转换为MCP工具，利用Agent Core Runtime运行代理，并通过Agent Core Identity确保安全访问。这种架构的关键优势在于，代理开发者无需深入了解Kubernetes或现有微服务的实现细节，平台工程师只需提供OpenAPI规范文档即可快速将遗留系统集成到智能代理生态中。

演讲重点强调了AWS在简化企业AI应用开发方面的努力，特别是如何让拥有大量确定性业务逻辑的传统企业快速拥抱非确定性的AI能力，而无需重写现有系统。通过Agent Core Gateway的自动转换能力，企业可以避免为每个微服务编写独立的MCP服务器，大幅降低了AI化改造的工作量。

## 详细时间轴

### 开场与场景介绍 (00:00 - 03:30)
- **00:00** - Roland Barcia和Carlos Santana登场，介绍自己的角色
- **00:45** - Carlos被要求清理厨房，开始播放音乐跳舞
- **01:20** - Carlos跳舞时踢到冰箱，导致冰箱漏水的场景演示
- **02:15** - 引出需求：构建一个AI代理来处理家庭保险理赔和维修预约
- **03:00** - 说明现有业务逻辑被锁定在容器化应用中，需要通过MCP暴露

### 技术架构介绍 (03:30 - 08:00)
- **03:30** - 展示代理预览界面，显示可用的工具（理赔、预约、账户信息等）
- **04:45** - 讨论确定性逻辑与非确定性逻辑的结合挑战
- **05:30** - 介绍Agent Core组件：Runtime、Identity、Gateway、Memory
- **06:20** - Carlos介绍EKS的重要性和新功能
- **07:00** - 宣布EKS Capabilities新功能：完全托管的Argo CD、Crossplane和ACK
- **07:30** - 介绍预配置控制平面和大规模集群支持

### 架构设计详解 (08:00 - 11:00)
- **08:00** - 展示完整架构图：Chat UI → Agent Core Runtime → Gateway → EKS微服务
- **08:45** - 说明使用Agent Core Identity进行安全访问控制
- **09:20** - 强调通过Bedrock进行模型推理
- **10:00** - Carlos承诺通过MCP Gateway暴露现有系统，让代理开发者无需学习Kubernetes
- **10:40** - 讨论如何避免为数百个微服务编写MCP服务器包装器

### 角色分工说明 (11:00 - 12:30)
- **11:00** - Roland定位为代理开发者，专注于Python和代理编写
- **11:20** - Carlos定位为平台工程师，负责Kubernetes和基础设施
- **11:45** - 说明将展示实际代码和运行演示
- **12:15** - 开始切换到演示环境

### EKS集群配置展示 (12:30 - 18:00)
- **12:30** - 在AWS控制台中展示EKS集群
- **13:00** - 显示集群运行Kubernetes 1.33版本
- **13:30** - 介绍EKS Insights功能，用于升级建议
- **14:00** - 展示EKS Auto Mode已启用
- **14:30** - 解释Karpenter自动扩展功能，观众举手表示使用过
- **15:15** - 展示External DNS等EKS社区插件
- **16:00** - 讨论从自管理Helm charts迁移到EKS插件API的优势
- **17:00** - 展示EKS Capabilities选项：Argo CD、ACK、Crossplane
- **17:45** - 演示升级洞察功能，检查升级阻塞因素

### 微服务部署结构 (18:00 - 23:00)
- **18:00** - 切换到代码编辑器，展示项目结构
- **18:30** - 说明代码分为agent和infrastructure两个文件夹
- **19:00** - 展示Kubernetes manifest使用Kustomize部署
- **19:45** - 展示appointments、customer、technician三个微服务的配置
- **20:30** - 解释Deployment、Service和Ingress的配置
- **21:15** - 说明Ingress如何创建负载均衡器并配置域名
- **22:00** - 展示External DNS如何自动添加Route 53记录
- **22:45** - 讨论注解（annotations）在配置中的作用

### Kubectl命令演示 (23:00 - 28:00)
- **23:00** - 开始使用kubectl命令行工具
- **23:20** - 讨论kubectl vs "cube control"的发音，观众互动
- **23:45** - Carlos承认使用"k"作为kubectl的别名
- **24:15** - 展示节点列表，说明由Karpenter管理
- **25:00** - 解释Auto Mode中Karpenter由EKS服务托管
- **25:45** - 展示NodePools和NodeClaims资源
- **26:30** - 说明Bottlerocket操作系统的安全优势
- **27:15** - 展示所有命名空间的Pods，注意没有CoreDNS等系统组件
- **27:50** - 解释Auto Mode将系统组件移到节点层面

### Kubernetes资源详解 (28:00 - 32:00)
- **28:00** - 展示External DNS和Metrics Server pods
- **28:45** - 解释HPA（Horizontal Pod Autoscaler）如何使用Metrics Server
- **29:30** - 说明基于CPU、内存或自定义指标的自动扩展
- **30:15** - 提到guestbook应用用于测试Argo CD跨区域部署
- **30:45** - 展示development命名空间中的三个微服务部署
- **31:30** - 讨论管理层要求创建MCP服务器的挑战
- **32:00** - 强调Agent Core Gateway可以避免重复编码

### OpenAPI规范展示 (32:00 - 37:00)
- **32:00** - 使用kubectl获取Ingress列表
- **32:45** - 展示appointments、customer、technician的域名
- **33:30** - 在浏览器中打开appointments服务的/docs端点
- **34:00** - 询问观众是否认识Swagger UI，大量观众举手
- **34:30** - 说明现在称为OpenAPI Spec UI
- **35:00** - 展示appointments微服务的REST API端点
- **35:45** - 解释家庭保险公司的业务流程：客户、理赔、预约
- **36:15** - 演示列出预约的API调用
- **36:45** - 展示返回的JSON数据

### OpenAPI JSON结构 (37:00 - 40:00)
- **37:00** - 切换到JSON视图查看OpenAPI规范
- **37:30** - 说明这是描述REST API的标准方式
- **38:00** - 列举常见框架：Spring Boot、ExpressJS、FastAPI
- **38:30** - 提到可以使用Kiro AI工具从源代码生成OpenAPI规范
- **39:00** - 搜索"server"字段，这是MCP Gateway的关键要求
- **39:45** - 解释server URL字段指定API的访问地址

### MCP Gateway配置需求 (40:00 - 43:00)
- **40:00** - 说明需要将URL注入到OpenAPI规范中
- **40:30** - 解释开发环境和生产环境可能有不同的域名
- **41:00** - 讨论基于路径的路由配置
- **41:30** - 承诺展示如何通过代码注入URL
- **42:00** - 总结到目前为止的进展：微服务运行中，需要Swagger文件和URL注入
- **42:45** - 准备展示如何通过MCP Gateway暴露服务

### 项目代码结构 (43:00 - 47:00)
- **43:00** - 切换到Kiro IDE展示代码
- **43:30** - 说明几乎所有代码都是与Kiro AI协作完成的
- **44:00** - 展示项目包含大量测试文件
- **44:30** - 解释使用规范驱动开发（Spec-driven development）
- **45:00** - 导航到MCP Gateway Python文件夹
- **45:30** - 展示setup.py和pyproject.toml配置
- **46:00** - 说明可以使用其他基础设施即代码工具（ACK、CloudFormation、Terraform）
- **46:45** - 本演示使用Boto3 Python SDK

### Python脚本入口点 (47:00 - 50:00)
- **47:00** - 展示pyproject.toml中的入口点配置
- **47:30** - 入口点指向setup.py的main函数
- **48:00** - 切换到终端，调整窗口大小
- **48:30** - 导航到正确的目录
- **49:00** - 使用ls命令查看source目录内容
- **49:30** - 展示各种测试文件和setup.py主文件

### Main函数代码解析 (50:00 - 54:00)
- **50:00** - 在编辑器中查找main函数
- **50:30** - 说明有辅助函数来加速开发
- **51:00** - 展示main函数接受两个参数：REST API域名和环境
- **51:45** - 域名示例：cloudnativestart.com
- **52:15** - 环境参数用于区分development和production命名空间
- **52:45** - 说明大型企业通常使用独立的EKS集群
- **53:30** - 演示中使用命名空间来区分环境
- **54:00** - 开始使用boto3库创建资源

### IAM角色创建 (54:00 - 56:00)
- **54:00** - 第一步：为MCP Gateway创建IAM角色
- **54:30** - 说明Gateway服务实例需要身份标识
- **55:00** - 展示创建IAM角色的辅助函数
- **55:30** - 函数创建具有正确策略的IAM角色并返回
- **56:00** - 准备创建Cognito用户池

### Cognito配置 (56:00 - 60:00)
- **56:00** - 下一步：获取或创建Cognito用户池
- **56:30** - 解释Cognito用于保护MCP Gateway访问
- **57:00** - 说明这是从Agent到Gateway的入站保护
- **57:30** - 展示创建Cognito的函数定义
- **58:00** - 函数检查是否已存在，不存在则创建
- **58:30** - 配置资源服务器ID和名称
- **59:00** - 定义读写作用域（scopes）
- **59:45** - 返回用户池ID、客户端ID、客户端密钥等信息

### Cognito返回值详解 (60:00 - 62:00)
- **60:00** - 列出Cognito发现URL
- **60:30** - 说明令牌URL用于获取访问令牌
- **61:00** - 资源服务器ID用于作用域匹配
- **61:30** - 返回到main函数继续执行
- **62:00** - 准备创建Gateway实例

### Gateway创建 (62:00 - 65:00)
- **62:00** - 调用创建Gateway的API
- **62:30** - 说明需要先创建Gateway，然后添加Target
- **63:00** - 一个Gateway可以有多个Target（微服务端点）
- **63:30** - 本例中将添加三个Target对应三个微服务
- **64:00** - 传入Cognito配置信息
- **64:30** - 传入Gateway实例使用的IAM角色
- **65:00** - 准备配置Identity Provider

### Identity Provider配置 (65:00 - 69:00)
- **65:00** - 介绍Agent Core Identity服务
- **65:30** - Identity作为代理的辅助服务处理令牌交换
- **66:00** - 避免在代码或环境变量中硬编码客户端密钥
- **66:45** - Identity服务执行机器对机器令牌交换
- **67:15** - 展示SDK装饰器如何注入令牌
- **67:45** - 创建Identity Provider实例
- **68:15** - 配置授权端点和令牌端点
- **68:45** - Identity服务调用Cognito获取令牌

### 传递给代理开发者的信息 (69:00 - 72:00)
- **69:00** - 说明需要传递给Roland团队的关键信息
- **69:30** - Gateway URL：即使没有Target也可以使用
- **70:00** - Roland需要此URL来连接MCP SDK
- **70:30** - Identity Provider名称：用于选择正确的提供者
- **71:00** - 资源服务器ID：用于Cognito作用域请求
- **71:30** - 令牌包含正确的JWT声明
- **72:00** - 准备运行脚本创建Gateway

### 运行Gateway创建脚本 (72:00 - 76:00)
- **72:00** - 使用uv run命令执行脚本
- **72:30** - 展示项目中的多个脚本选项
- **73:00** - 选择创建Gateway的脚本
- **73:30** - 脚本开始执行，创建Cognito、Identity和Gateway
- **74:00** - 信息存储在SSM Parameter Store供Roland使用
- **74:30** - Kiro AI添加了表情符号状态输出
- **75:00** - 显示详细的文本输出说明
- **75:30** - 成功获取Gateway URL
- **76:00** - 准备在控制台中验证

### 控制台验证Gateway (76:00 - 79:00)
- **76:00** - 切换到Agent Core控制台
- **76:30** - 导航到Gateways页面
- **77:00** - 展示刚创建的reinvent-app-gateway
- **77:30** - 显示MCP URL
- **78:00** - 展示入站身份配置使用Cognito
- **78:30** - 显示发现URL配置
- **79:00** - 确认Gateway创建成功，准备创建Target

### Target创建代码 (79:00 - 83:00)
- **79:00** - 返回代码编辑器
- **79:30** - 说明接下来创建三个Target：appointments、customer、technician
- **80:00** - 注释掉Gateway创建代码
- **80:30** - 展示Target创建部分的代码
- **81:00** - 脚本将处理三个微服务
- **81:30** - 为每个服务构建URL
- **82:00** - 获取JSON文件并注入URL
- **82:30** - 上传到S3存储桶
- **83:00** - 准备展示上传函数

### S3上传和Target创建 (83:00 - 87:00)
- **83:00** - 展示上传到S3的函数
- **83:30** - MCP Gateway要求JSON文件存储在S3中
- **84:00** - 提供S3位置给Gateway创建Target
- **84:30** - 配置API URL路径
- **85:00** - 设置存储桶名称
- **85:30** - 调用创建Target的API
- **86:00** - 配置凭证提供者（用于保护REST API）
- **86:45** - 说明可以使用参数或授权头保护API

### Target创建参数 (87:00 - 90:00)
- **87:00** - 传入授权头配置
- **87:30** - 指定S3存储桶URL
- **88:00** - 设置Target名称和描述
- **88:30** - 指定要附加的Gateway ID
- **89:00** - 代码运行三次创建三个Target
- **89:30** - 展示执行输出：获取JSON、插入服务器、上传S3、创建Gateway
- **90:00** - 准备在控制台验证S3存储桶

### S3存储桶验证 (90:00 - 93:00)
- **90:00** - 切换到S3控制台
- **90:30** - 找到agent-core-gateway存储桶
- **91:00** - 展示三个JSON文件：appointment.json、customer.json、technician.json
- **91:30** - 说明这些是脚本自动生成并上传的
- **92:00** - 这些文件位置被传递给Target创建API
- **92:30** - Gateway抓取这些文件并暴露为工具
- **93:00** - 返回Agent Core控制台验证Target

### 控制台验证Target (93:00 - 96:00)
- **93:00** - 在Gateway详情页面底部查看Target
- **93:30** - 展示technician、customer、appointment三个Target
- **94:00** - 显示Target状态（创建需要约一分钟）
- **94:30** - 展示S3 JSON文件位置和Target ID
- **95:00** - 查看出站认证详细信息
- **95:30** - 说明如何配置REST API认证
- **96:00** - 返回代码继续演示

### 时间检查和继续 (96:00 - 97:00)
- **96:00** - Roland询问时间进度
- **96:15** - 确认时间充足
- **96:30** - 准备继续展示更多功能
- **97:00** - 会话继续进行（字幕在此处截断）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注： 本总结基于提供的字幕文本，会话在97分钟左右处截断，可能还有后续内容未包含在此总结中。