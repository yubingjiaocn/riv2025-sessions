# AWS re:Invent 2025 - COP333 会议总结

## 会议概述

本次会议主题为"扩展开源可观测性堆栈"，由AWS解决方案架构师Vikram Manga Raman、AWS产品经理Abi Khana以及华纳兄弟探索频道(Warner Brothers Discovery)总监Hans Robert共同主讲。会议重点探讨了在大规模环境下如何通过现代可观测性工具来识别和解决运营问题，而不仅仅是收集指标、日志和追踪数据。

华纳兄弟探索频道作为案例分享了他们的实践经验。作为一家拥有CNN、Food Network、HBO、TNT等知名品牌的媒体公司，他们运营着HBO Max和Discovery Plus流媒体平台，服务于100多个市场的1.28亿订阅者。面对每日产生的海量日志和指标数据，他们通过采用AWS托管的开源可观测性服务，成功构建了可扩展的平台架构，显著降低了平均故障识别和修复时间(MTTR)。

会议强调了可观测性的四层方法论：从基础监控告警开始，深入到日志分析，再结合追踪信息识别依赖服务问题，最后通过元数据关联实现跨信号的根因分析。这种分层方法配合AI能力，能够帮助企业在复杂的微服务架构中快速定位问题根源。

## 详细时间线

### 开场与背景介绍 (00:00 - 05:30)

00:00 - 会议开始，主持人请求观众佩戴耳机并确认准备就绪

00:30 - Vikram Manga Raman自我介绍，介绍团队成员和会议主题COP333

01:15 - 通过流媒体平台场景引入问题：季终集播放时数百万用户同时点击播放按钮，遇到加载问题

02:00 - 阐述大规模系统运营的挑战：在数百个微服务环境中，问题不在于收集数据，而在于从数据中获取洞察

03:00 - 强调现代可观测性的价值：识别问题位置、根本原因和修复方法

03:30 - 介绍会议议程：可观测性演进、AWS托管开源服务、华纳兄弟探索频道案例、最佳实践

04:00 - 现场调查：询问观众运营的监控仪表板数量（50+、100+、500+）

04:45 - 展示真实案例：电商平台、医疗服务提供商、商业银行因缺乏良好可观测性而遭受巨大财务损失

### 可观测性基础概念 (05:30 - 10:00)

05:30 - 引用AWS CTO名言："一切都会失败"，但通过正确的工程设计可以应对失败

06:00 - 解释可观测性三大支柱：
- 日志(Logs)：记录事件的时间戳和详细描述
- 指标(Metrics)：应用程序的脉搏，显示性能和错误率
- 追踪(Traces)：捕获请求在微服务架构中的完整流程

07:30 - 提出分层故障排查方法：
1. 第一层：从基础监控告警开始（CPU利用率、服务宕机）
2. 第二层：深入日志分析特定应用的5xx错误
3. 第三层：使用追踪信息识别依赖服务问题
4. 第四层：通过元数据关联实现跨信号分析，AI辅助根因分析

### AWS托管开源服务介绍 (10:00 - 18:00)

10:00 - Abi Khana接手演讲，介绍AWS开源可观测性工具生态

10:30 - 展示AWS可观测性工具栈：
- 收集层：OpenTelemetry、Prometheus采集器
- 存储分析层：Amazon Managed Service for Prometheus (AMP)、OpenSearch Service
- 可视化层：Amazon Managed Grafana、OpenSearch Dashboards

11:30 - 解释客户选择开源的原因：
- 开放标准支持，避免供应商锁定
- 获得社区最佳实践
- 透明度和控制权
- 成本效率优化能力

12:30 - 指出自建开源工具的挑战：扩展性、可靠性、资源管理、容量规划、高可用性、租户隔离、服务器维护

13:30 - 介绍AWS托管方案的优势：端到端集成、内置关联能力、成本可见性和控制、AWS级别的安全保障、与AWS生态深度集成

14:30 - Amazon Managed Service for Prometheus详解：无服务器、完全兼容Prometheus、支持每个工作空间10亿活跃时间序列

15:30 - Amazon Managed Grafana和OpenSearch Service介绍

16:30 - 展示完整架构：使用OpenTelemetry收集数据，存储到AMP和OpenSearch，通过Grafana和OpenSearch Dashboards可视化

17:00 - 介绍两种部署模式：
- 集中式：跨所有区域和账户汇总到中央位置
- 地理分布式：每个区域一个堆栈，通过统一可视化层整合

### 华纳兄弟探索频道案例分享 (18:00 - 45:00)

18:00 - Hans Robert开始分享华纳兄弟探索频道的可观测性之旅

18:30 - 公司背景介绍：拥有CNN、Food Network、HBO、TNT等品牌，运营HBO Max和Discovery Plus平台

19:00 - 规模数据：1.28亿订阅者，100多个市场，单一多租户平台，每日产生海量日志和指标

20:00 - 合并前的挑战：
- 多个不同的可观测性解决方案
- 缺乏数据标准化
- 数据格式和分类不一致
- 扩展性问题

21:30 - 选择开源的三大原因：
1. 避免"单向门"决策（难以逆转的技术选择）
2. 构建开放平台，内置防护栏和黄金路径
3. 完全控制数据和管道，优化成本

23:00 - 策略一：数据组织

23:30 - 建立运营元数据(OMD)层级结构：
- 业务服务(Business Service)：高层业务能力（如视频播放）
- OMD服务：逻辑功能（如Markers标记服务）
- OMD组件：具体微服务实现

25:00 - 元数据管理方案：工程师在GitHub中与代码一起维护标准格式文件，自动化检查确保数据质量，数据存储在Amazon Aurora

26:00 - 构建服务目录(Service Catalog)：Grafana仪表板展示整个系统拓扑

27:00 - 自动标记实现：在Kubernetes集群中，Fluentd收集日志，附加组件自动在节点级别标记业务服务和组件信息

28:30 - 统一事件模式(OWLS - Organization-Wide Logging Schema)：
- 核心日志模式：强制字段（时间戳、严重性、消息、OMD字段）
- 业务服务特定模式：如支付服务添加支付方式、视频播放添加视频ID

30:00 - 模式强制执行：不符合模式的事件被拒绝或存储到S3供审查，通知日志作者修复

31:00 - 数据组织带来的成果：
- 加速MTTR（平均修复时间）
- 有意识的数据消费（工程师更谨慎地记录日志）
- 为扩展奠定基础

32:00 - 策略二：分片(Sharding)

32:30 - 地理分片：在9个全球区域部署应用，每个区域独立的可观测性堆栈

33:30 - 日志收集：Fluentd从EKS Pod收集日志，转发到同区域的OpenSearch

34:00 - 指标收集：Grafana Agent抓取指标发送到同区域的AMP工作空间

34:30 - CloudWatch集成：使用YACE(Yet Another CloudWatch Exporter)将CloudWatch数据导出到AMP

35:30 - 逻辑分片：解决单区域内数据量过大问题（如超过10亿指标）

36:30 - 基于OMD标签的路由决策：Grafana Agent根据业务服务/组件标签将数据写入不同后端

37:30 - 隔离高风险组件：将流量波动大的组件隔离到专用分片，避免"嘈杂邻居"问题

38:30 - 分片带来的挑战：Grafana需要知道后端拓扑，查询需要指定正确的AMP工作空间或OpenSearch集群

39:30 - 抽象层解决方案：

40:00 - Promxy介绍：开源聚合代理，位于数据前端，对Grafana表现为单一Prometheus实例

41:00 - Promxy工作原理：将查询分发到所有工作空间，聚合结果返回给Grafana

41:30 - OpenSearch跨集群搜索：类似Promxy，分发请求到多个OpenSearch集群并聚合结果

42:30 - 抽象层优势：
- 简化查询和仪表板构建
- 解耦后端生命周期和前端消费
- 无需影响用户即可调整分片架构

43:30 - 策略三：成本计量

44:00 - 引入《继承之战》角色类比CFO/CEO关注成本而非技术细节

44:30 - 共享环境成本归属挑战：多个服务共享同一OpenSearch或AMP实例，AWS原生标签只能标记实例级别

### 成本计量框架 (45:00 - 50:00)

45:00 - 定制成本计量框架，整合三类数据：
1. AWS成本数据
2. 使用量指标（日志GB数、追踪数量、时间序列数）
3. 团队定义的分配规则

46:30 - 使用Lambda进行成本调和：根据使用量按比例分配成本

47:30 - 生成新的时间序列存储成本归属数据，在Grafana中可视化

48:00 - 成本计量带来的文化转变：团队更有意识地控制可观测性数据量

48:30 - 展示成本仪表板：按业务服务、组件、区域细分成本

### 总结与最佳实践 (50:00 - 结束)

50:00 - 回顾三大扩展策略：数据组织、分片、成本计量

50:30 - 强调运营元数据(OMD)的基础性作用

51:00 - 地理和逻辑分片结合的重要性

51:30 - 抽象层实现灵活扩展的关键价值

52:00 - 成本可见性推动负责任的数据消费

52:30 - 最终成果：构建了可扩展、成本可控、易于维护的企业级可观测性平台

53:00 - 会议结束，开放问答环节