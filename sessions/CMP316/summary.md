# AWS re:Invent 2025 Nitro 系统深度解析

## 会议概述

本次技术分享由 AWS 杰出工程师 Ali Sidi 和高级首席工程师 Filipo Cerrone 主讲，深入探讨了 AWS Nitro 系统的架构设计、技术创新和安全特性。Nitro 系统是 AWS 对传统虚拟化技术的根本性重新思考，通过将传统 hypervisor 的功能转移到专用硬件芯片上，实现了性能、安全性和灵活性的显著提升。

演讲首先介绍了 AWS 在定制芯片领域的三大投资方向：Nitro 系统（数据中心 IO）、Graviton（主机 CPU）和 Trainium（机器学习加速器）。Nitro 系统的核心理念是通过硬件专业化、加快执行速度、跨领域创新和增强安全性来为客户提供更优的性价比。从 2013 年开始与 Annapurna Labs 合作，到 2017 年正式推出基于 Nitro 的 C5 实例，AWS 已经发布了六代 Nitro 芯片。自 2017 年以来，所有新推出的 EC2 实例都基于 Nitro 系统构建。

Nitro 系统的技术优势体现在多个方面：网络性能从最初的 1 Gbps 提升到现在最高 6.4 Tbps（P6 实例）；存储性能达到 150 Gbps EBS 带宽和 720,000 IOPS；通过 ENA Express 和 SRD 协议实现多路径传输，单流带宽从 5 Gbps 提升到 25 Gbps，尾延迟降低 85%。在安全方面，Nitro 系统实现了"无秘密 hypervisor"设计，hypervisor 无法访问客户数据，所有数据传输均采用 256 位 AES 加密。系统还提供了 Nitro Enclaves、UFI 安全启动、Nitro TPM 和 EC2 实例认证等多层安全功能。Nitro 系统的灵活性使 AWS 在 2017 年后推出了超过 800 种实例类型，目前总数已超过 1000 种。

## 详细时间线

### 开场与背景介绍
[00:00 - 02:30] - 演讲者介绍与 AWS 定制芯片战略概述
- Ali Sidi（AWS 杰出工程师）和 Filipo Cerrone（高级首席工程师）介绍
- AWS 在三个领域投资定制芯片：Nitro 系统、Graviton 处理器、Trainium 机器学习加速器
- 宣布 Trainium 3 实例可用性

[02:30 - 04:00] - 为什么构建自有硬件
- 通过专业化提供更好的性价比
- 加快执行速度，缩短从概念到交付的时间
- 跨传统孤岛进行创新
- 增强安全性

### Nitro 系统架构
[04:00 - 06:30] - Nitro 系统基础架构
- Nitro 系统的三层结构：Nitro 卡、Nitro hypervisor、虚拟机
- Nitro 卡提供网络、存储和安全功能
- 2013 年开始研发，2017 年随 C5 实例正式推出
- 已发布六代 Nitro 芯片

[06:30 - 08:00] - 传统架构 vs Nitro 架构
- 传统 Xen hypervisor 承担的功能：CPU 调度、设备模拟、网络限制、安全组执行、数据包封装等
- 这些功能消耗大量主机 CPU 资源
- Nitro 将这些功能转移到专用硬件卡上

### 网络功能详解
[08:00 - 12:00] - Nitro 网络卡功能
- VPC 数据平面卸载：ENI 连接、安全组执行、流日志、路由、数据包封装、DHCP/DNS
- 第三代起支持 256 位 AES 透明加密，无性能损耗
- 弹性网络适配器（ENA）：从 10 Gbps 扩展到 600+ Gbps
- 弹性网络适配器（EFA）：为 HPC 和机器学习工作负载提供低延迟和高带宽

[12:00 - 16:00] - SRD 协议与多路径传输
- 可扩展可靠数据报（SRD）协议
- 利用数据中心网络的多条路径同时传输数据
- 快速检测和规避网络拥塞
- 显著降低尾延迟（P99）
- EFA 应用案例：HPC 工作负载扩展性从 400 核心突破到更高规模

[16:00 - 19:00] - ENA Express
- 解决 TCP 单路径传输的限制
- 在 Nitro 卡上处理乱序数据包重组
- 单流带宽从 5 Gbps 提升到 25 Gbps
- 尾延迟降低 85%
- 简单配置即可启用，对 TCP/UDP 透明

[19:00 - 21:00] - 网络带宽演进
- EC2 初期：1 Gbps 网络持续近十年
- 当前核心实例：CMR8i 实例提供 100 Gbps
- 网络优化实例：C/R HGN 实例提供 2×300 Gbps（600 Gbps）
- 机器学习实例：P5 实例 400 Gbps，P6 实例 6.4 Tbps

### 存储功能详解
[21:00 - 24:00] - EBS 存储
- Nitro 卡提供 NVMe 接口，转换为 EBS 数据平面命令
- 硬件加密引擎实现传输中数据加密
- 使用 SRD 协议降低尾延迟
- 性能演进：从十年前的 2 Gbps 到现在的 150 Gbps EBS 带宽
- 最高支持 720,000 IOPS

[24:00 - 28:00] - Nitro SSD 本地存储
- SSD 工作原理：NAND 闪存特性、闪存转换层（FTL）
- 传统 FTL 的不可预测行为影响性能一致性
- AWS 将 FTL 集成到 Nitro 卡中
- 延迟降低高达 60%
- 提高可靠性
- 使用临时密钥加密所有数据，密钥不离开服务器

### Nitro Hypervisor
[28:00 - 32:00] - Hypervisor 简化设计
- Filipo Cerrone 接手讲解
- 专注于 CPU、内存和设备分配的最小功能集
- 移除网络栈、存储栈、文件系统支持
- 移除 SSH 服务器等管理工具
- 静默 hypervisor：仅在客户实例请求时执行代码
- 虚拟机性能接近裸金属性能

[32:00 - 37:00] - 无秘密 Hypervisor（Secret Hiding）
- 最小权限原则：hypervisor 不应访问客户数据
- 传统 hypervisor：拥有整个服务器地址空间
- Nitro hypervisor：地址空间仅数百 MB
- 客户实例的 CPU 上下文和内存在 hypervisor 地址空间之外
- 每个虚拟机拥有独立地址空间
- 仅在必要时临时映射最小内存量
- 也称为"机密计算"或"无秘密 hypervisor"

[37:00 - 40:00] - L1TF Reloaded 安全研究案例
- 欧洲研究团队发布的瞬态执行攻击
- 结合 L1TF 和 Spectre 漏洞
- 在传统 KVM 和其他云提供商上成功窃取私钥
- 在 Nitro hypervisor 上攻击失败
- 证明无秘密 hypervisor 设计的有效性

### Nitro 安全芯片
[40:00 - 43:00] - 硬件信任根
- Nitro 安全芯片集成在主板上
- 持续监控主板上的非易失性闪存（BIOS、UEFI、BMC）
- 两个目的：带外更新固件、验证运行的软件/固件
- 监控辅助总线（I²C、SPI）

### 系统优势总结
[43:00 - 46:00] - Nitro 系统带来的优势
- 更高性能：更多资源分配给客户
- 灵活性：可组合的 Nitro 卡架构
- 快速创新：2006-2017 年推出 70 种实例类型，2017 年后推出 800+ 种
- 当前总计超过 1000 种实例类型

### 安全责任模型
[46:00 - 48:00] - 共同责任模型
- AWS 负责云的安全：设施、硬件、固件、软件
- 客户负责云中的安全：操作系统更新、应用程序库、VPC 安全组配置

### 机密计算
[48:00 - 52:00] - 机密计算的两个维度
- 保护客户数据免受云提供商访问
- Nitro 系统实现：移除操作员访问、加密所有通信通道、安全启动和度量启动、定期固件/软件部署、无 Shell/SSH 访问
- 多团队全球分布式开发和代码审查

[52:00 - 56:00] - Nitro Enclaves
- 保护客户组织内部的代码和数据
- 父实例捐赠 CPU 和内存资源创建侧车实例
- Enclave 无持久存储、无网络接口
- 仅通过窄管道与父实例通信
- 与 AWS KMS 集成，通过认证文档解锁内容
- 常见用例：存储签名密钥

[56:00 - 60:00] - UEFI 安全启动和 Nitro TPM
- UEFI 安全启动：加密验证 bootloader、内核和操作系统
- 防止跨重启持久化的恶意软件
- Nitro TPM：符合 TPM 2.0 标准
- 度量软件并扩展到 TPM
- 用于解锁本地存储（LUKS、BitLocker）

[60:00 - 64:00] - EC2 实例认证
- 基于 UEFI 安全启动和 Nitro TPM
- 可认证 AMI：可重复构建，产生相同的位
- 生成认证文档，与 AWS KMS 集成解锁秘密
- 用例：机密推理（保护模型权重和客户数据）
- 支持 Trainium 和 Nvidia GPU 的机器学习实例
- 支持 Amazon Linux 2023、NixOS，适用于 Graviton、AMD、Intel 实例

### 安全审计与白皮书
[64:00 - 66:00] - 第三方安全审计
- AWS 发布 Nitro 系统安全设计白皮书
- NCC Group 独立审查
- 结论：云操作员无机制访问主机或客户数据（实例内存、实例存储、EBS 卷）

### Graviton 4 服务器架构
[66:00 - 70:00] - Graviton 4 加密特性
- 支持多虚拟机或 1-2 个裸金属实例
- 双 CPU 生命周期解耦
- 所有高速连接加密：DRAM 加密（第六代起）
- PCIe IDE 加密 CPU 到 Nitro 卡连接（第八代起）
- Graviton 4 首次支持多插槽，CPU 间一致性链路加密

### 认证与启动流程
[70:00 - 结束] - 大规模认证挑战
- 在 AWS 规模上实现加密确定性的挑战
- 服务器启动流程：从 ROM 加载代码开始
- （演讲在此处字幕截断）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


注： 本总结基于提供的字幕文本，字幕在启动流程部分突然结束，可能存在内容不完整的情况。