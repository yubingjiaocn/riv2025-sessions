# AWS re:Invent 2025 会议总结：使用 AI Agent 桥接结构化和非结构化数据

## 会议概述

本次技术会议主要介绍了如何使用 AI Agent 来桥接企业中的结构化数据和非结构化数据。演讲者 Anil Murari 和 Rafia Tapia（均为 AWS 高级解决方案架构师）通过实际代码演示，展示了如何构建一个智能慈善聊天助手应用。

该应用的核心价值在于解决企业面临的数据孤岛问题。企业通常在关系型数据库中存储了过去 15-20 年的结构化数据，同时也积累了大量非结构化数据（如文档、日志等）。通过 AI Agent 技术，可以让智能系统自动判断应该从哪个数据源获取信息，并提供统一的查询接口。

技术实现方面，演讲者使用了 Strand SDK 构建 Agent，Amazon Bedrock Knowledge Base 处理非结构化数据（通过 RAG 技术），以及 Aurora PostgreSQL 数据库存储结构化数据。整个应用使用 Python 开发，UI 采用 Streamlit 框架。演示中特别强调了如何创建自定义工具（Custom Tool）来查询关系型数据库，以及如何让 Agent 智能地选择合适的数据源来回答用户问题。

## 详细时间线

### **开场介绍 (00:00 - 02:30)**
- 00:00 - 演讲者欢迎参会者，确认这是 2025 re:Invent 的首场会议
- 00:30 - 介绍会议主题：使用 AI Agent 桥接结构化和非结构化数据
- 01:00 - 现场调查：询问有多少人正在构建或运行 AI Agent
- 01:30 - 了解参会者使用的数据类型（非结构化数据如 S3 文件，结构化数据如关系型数据库）
- 02:00 - 演讲者自我介绍：Anil Murari 和 Rafia Tapia，均为 AWS 高级解决方案架构师

### **架构概览 (02:30 - 05:00)**
- 02:30 - 展示应用架构图：UI 应用使用 Streamlit 构建
- 03:00 - 说明数据源：顶部黄色区域为非结构化数据（Bedrock Knowledge Base），底部为结构化数据（Aurora 数据库）
- 03:30 - 介绍 Aurora 作为 AWS 托管关系型数据库服务，支持 MySQL 和 PostgreSQL
- 04:00 - 强调本次演示将使用 PostgreSQL 作为结构化数据源
- 04:30 - 说明这是一个代码演示会议，将实际构建应用

### **技术栈介绍 (05:00 - 08:00)**
- 05:00 - 介绍 Strand SDK：用于构建单个或多个 Agent
- 05:30 - 询问现场有多少人使用过 Strand
- 06:00 - 说明 Strand 支持 MCP 和 A2A 协议
- 06:30 - 展示简单 Agent 模型：接收 prompt，使用工具，提供服务
- 07:00 - 介绍 Bedrock Knowledge Base：用于访问非结构化数据
- 07:30 - 询问有多少人编写过 RAG 应用

### **RAG 和 Knowledge Base (08:00 - 10:00)**
- 08:00 - 解释 RAG 工作原理：将非结构化数据转换为向量
- 08:30 - 说明 Bedrock Knowledge Base 简化了 RAG 基础设施的构建
- 09:00 - 演示将使用 Word 文档内容放入 Knowledge Base
- 09:30 - 说明由于时间限制，Knowledge Base 已预先创建好

### **应用演示 (10:00 - 12:00)**
- 10:00 - 播放完整应用演示视频
- 10:30 - 介绍用例：慈善聊天助手，查询活动和捐赠信息
- 11:00 - 展示应用如何自动选择正确的数据源（关系型数据库或 Knowledge Base）
- 11:30 - 说明 Agent 会根据问题类型智能路由到相应数据源

### **开始编码 - UI 框架 (12:00 - 15:00)**
- 12:00 - 切换到 IDE（Kiro）开始编码
- 12:30 - 介绍 Kiro IDE：Amazon 支持的新 IDE
- 13:00 - 展示项目文件：Python 3.12 虚拟环境、requirements.txt
- 13:30 - 说明需要的包：strand-agent 和 strand-agent-tools
- 14:00 - 展示 run.sh 脚本：设置环境并启动 Streamlit 应用
- 14:30 - 创建 app.py 文件

### **构建 UI 代码 (15:00 - 18:00)**
- 15:00 - 使用 VS Code snippets 快速插入代码
- 15:30 - 添加导入语句和常量定义
- 16:00 - 设置示例问题列表
- 16:30 - 配置应用主题（深色主题）
- 17:00 - 添加聊天界面代码
- 17:30 - 注释掉 Agent 功能代码（稍后启用）

### **运行基础 UI (18:00 - 20:00)**
- 18:00 - 运行应用查看基础 UI
- 18:30 - 尝试提问，预期会出现错误
- 19:00 - 确认错误出现（因为还没有 Agent 功能）
- 19:30 - 准备添加 Agent 核心逻辑

### **创建 Agent 文件 (20:00 - 23:00)**
- 20:00 - 创建 agent.py 文件
- 20:30 - 添加导入语句（Strand 包、boto3 等）
- 21:00 - 定义模型 ID（使用 Claude 模型）
- 21:30 - 说明 Strand SDK 可以使用任何 LLM，不限于 Bedrock
- 22:00 - 设置推理参数（最大 token、温度等）
- 22:30 - 创建基础模型对象

### **构建基础 Agent (23:00 - 26:00)**
- 23:00 - 使用 Strand Agent 创建基础 Agent（仅需两行代码）
- 23:30 - 传入模型对象和系统 prompt
- 24:00 - 系统 prompt 指示："不要编造答案，不知道就说不知道"
- 24:30 - 在 app.py 中取消注释 Agent 调用代码
- 25:00 - 解释代码：检查 session state 中是否已有 Agent 对象
- 25:30 - 如果没有则创建新的 Agent

### **测试基础 Agent (26:00 - 28:00)**
- 26:00 - 运行应用测试基础 Agent
- 26:30 - 提问："我们有多少会员？"
- 27:00 - Agent 回答："我无法访问您组织的当前会员数据"
- 27:30 - 确认 Agent 正常工作，但还没有智能功能

### **添加 Knowledge Base 工具 (28:00 - 32:00)**
- 28:00 - 开始添加从 Knowledge Base 检索数据的代码
- 28:30 - 介绍 Strand 的工具概念：自定义工具和现成工具
- 29:00 - 添加 retrieve 工具（Strand SDK 提供的现成工具）
- 29:30 - 设置环境变量：Knowledge Base ID
- 30:00 - 解释 retrieve 工具：无需编写自定义代码即可查询 Bedrock Knowledge Base
- 30:30 - 说明需要 Knowledge Base 的唯一 ID
- 31:00 - 硬编码 Knowledge Base ID（演示目的，生产环境应使用参数存储）

### **Knowledge Base 详细说明 (32:00 - 35:00)**
- 32:00 - 现场问答：Knowledge Base 创建流程
- 32:30 - 解释：识别数据源（Word、PDF 等文档）
- 33:00 - 指定向量数据库存储位置
- 33:30 - Knowledge Base 自动处理所有繁重工作
- 34:00 - 设置环境变量：Knowledge Base ID 和区域
- 34:30 - retrieve 工具从环境变量读取配置

### **测试 Knowledge Base 集成 (35:00 - 37:00)**
- 35:00 - 再次运行应用
- 35:30 - 提问相同问题："我们有多少会员？"
- 36:00 - Agent 从 Knowledge Base 返回答案
- 36:30 - 注意到答案来自非结构化数据，可能不够准确
- 37:00 - 说明需要添加结构化数据库查询功能

### **创建自定义数据库工具 (37:00 - 40:00)**
- 37:00 - 在 Agent 定义中添加 query_sql_db 工具
- 37:30 - 创建新文件：query_sql_db.py
- 38:00 - 添加导入语句（strand.agent、strand.tool、boto3）
- 38:30 - 说明将构建自定义工具来查询关系型数据库
- 39:00 - 工具将把用户 prompt 转换为 SQL 查询
- 39:30 - 从数据库检索数据并返回结果

### **定义常量和配置 (40:00 - 43:00)**
- 40:00 - 定义 Aurora 数据库 ARN
- 40:30 - 定义 Secrets Manager ARN（存储数据库凭证）
- 41:00 - 强调最佳实践：不要在代码中硬编码凭证
- 41:30 - 定义数据库名称：npo_membership
- 42:00 - 选择 Nova 模型（不同于 Agent 使用的 Claude）
- 42:30 - 解释为何使用不同模型：演示可以为不同组件使用不同 LLM

### **模型选择讨论 (43:00 - 46:00)**
- 43:00 - 说明 Agent 使用 Claude，工具使用 Nova
- 43:30 - 强调模型评估是 AI 应用的重要组成部分
- 44:00 - 现场问答：工具是否仅用于 RAG？
- 44:30 - 澄清：retrieve 工具用于非结构化数据，新工具用于结构化数据
- 45:00 - 问答：是保留两个工具还是切换？
- 45:30 - 回答：LLM 会智能决定使用哪个工具

### **创建工具注解 (46:00 - 49:00)**
- 46:00 - 使用 @tool 注解创建自定义工具
- 46:30 - 解释：只需在函数上添加 @tool 注解
- 47:00 - Strand 会识别该函数为工具
- 47:30 - 当需要使用工具时，Strand 会执行该函数
- 48:00 - 创建辅助类来组织逻辑
- 48:30 - 工具函数将调用辅助类的方法

### **构建辅助类 (49:00 - 52:00)**
- 49:00 - 创建 StructuredDataAgent 类
- 49:30 - 定义构造函数，接收四个参数
- 50:00 - 参数包括：数据库 ARN、Secrets Manager ARN、数据库名称、模型 ID
- 50:30 - 增大字体以便后排观众查看
- 51:00 - 现场问答：工具是否仅用于从 Aurora 提取数据？
- 51:30 - 确认：工具查询 Aurora 并将结果返回给 Claude Agent

### **获取数据库 Schema (52:00 - 55:00)**
- 52:00 - 创建 get_table_schema 函数
- 52:30 - 定义 SQL 查询以获取 PostgreSQL schema
- 53:00 - 说明不同数据库有不同的 schema 查询语法
- 53:30 - 查询返回表结构、列名、数据类型等信息
- 54:00 - 将 schema 存储为 JSON 格式
- 54:30 - 现场问答：schema 是否足够，还是需要示例数据？

### **Schema 和关系讨论 (55:00 - 58:00)**
- 55:00 - 回答：schema 通常足够，但示例数据可能有帮助
- 55:30 - 问答：如何处理外键关系和多表查询？
- 56:00 - 回答：可以在 schema 中包含关系信息
- 56:30 - 或在系统 prompt 中提供关系说明
- 57:00 - SQL 生成时会包含必要的 JOIN 语句
- 57:30 - 强调 prompt 工程的重要性

### **生成系统 Prompt (58:00 - 01:01:00)**
- 58:00 - 创建 generate_system_prompt 函数
- 58:30 - 系统 prompt 提供 LLM 所需的智能
- 59:00 - 可以在 prompt 中添加转换规则和关系信息
- 59:30 - 开始逐行解释系统 prompt 内容
- 01:00:00 - Prompt 包含数据库 schema 信息
- 01:00:30 - 指导 LLM 如何生成正确的 SQL 查询

### **系统 Prompt 详细内容 (01:01:00 - 01:04:00)**
- 01:01:00 - Prompt 指示 LLM 作为 SQL 专家
- 01:01:30 - 提供完整的数据库 schema
- 01:02:00 - 要求生成有效的 PostgreSQL 查询
- 01:02:30 - 强调只返回 SQL，不要额外解释
- 01:03:00 - 添加安全约束：只允许 SELECT 语句
- 01:03:30 - 禁止 INSERT、UPDATE、DELETE 等修改操作

### **执行 SQL 查询 (01:04:00 - 01:07:00)**
- 01:04:00 - 创建 execute_query 函数
- 01:04:30 - 使用 boto3 连接 Aurora 数据库
- 01:05:00 - 从 Secrets Manager 获取数据库凭证
- 01:05:30 - 执行 LLM 生成的 SQL 查询
- 01:06:00 - 处理查询结果并格式化
- 01:06:30 - 返回结果给 Agent

### **完整工具流程 (01:07:00 - 01:10:00)**
- 01:07:00 - 整合所有组件：schema 获取、prompt 生成、SQL 执行
- 01:07:30 - 在主工具函数中调用辅助方法
- 01:08:00 - 工具接收用户问题
- 01:08:30 - 获取数据库 schema
- 01:09:00 - 生成系统 prompt
- 01:09:30 - 让 LLM 生成 SQL 查询

### **LLM SQL 生成 (01:10:00 - 01:13:00)**
- 01:10:00 - 调用 Nova 模型生成 SQL
- 01:10:30 - 传入系统 prompt 和用户问题
- 01:11:00 - LLM 理解 schema 并生成查询
- 01:11:30 - 现场问答：Nova 模型用于理解结构化数据
- 01:12:00 - 确认：Nova 用于生成 SQL 查询
- 01:12:30 - 执行生成的 SQL 并返回结果

### **测试完整应用 (01:13:00 - 01:16:00)**
- 01:13:00 - 运行完整应用进行测试
- 01:13:30 - 提问："我们有多少会员？"
- 01:14:00 - Agent 自动选择查询数据库
- 01:14:30 - 从 Aurora 返回准确的会员数量
- 01:15:00 - 展示答案比之前从 Knowledge Base 获取的更准确
- 01:15:30 - 演示 Agent 智能路由功能

### **测试不同类型问题 (01:16:00 - 01:19:00)**
- 01:16:00 - 提问关于活动详情的问题
- 01:16:30 - Agent 选择从 Knowledge Base 检索
- 01:17:00 - 返回非结构化文档中的活动信息
- 01:17:30 - 提问需要数据库查询的问题
- 01:18:00 - Agent 切换到 SQL 工具
- 01:18:30 - 展示 Agent 的智能决策能力

### **代码回顾和最佳实践 (01:19:00 - 01:22:00)**
- 01:19:00 - 回顾整体架构
- 01:19:30 - 强调 Strand SDK 的简洁性
- 01:20:00 - 讨论生产环境注意事项
- 01:20:30 - 不要硬编码敏感信息
- 01:21:00 - 使用 Secrets Manager 和 Parameter Store
- 01:21:30 - 考虑错误处理和日志记录

### **安全性讨论 (01:22:00 - 01:25:00)**
- 01:22:00 - 强调只允许 SELECT 查询的重要性
- 01:22:30 - 防止 SQL 注入攻击
- 01:23:00 - 使用参数化查询
- 01:23:30 - 限制数据库用户权限
- 01:24:00 - 监控和审计数据库访问
- 01:24:30 - 现场问答：其他安全最佳实践

### **性能优化 (01:25:00 - 01:28:00)**
- 01:25:00 - 讨论查询性能优化
- 01:25:30 - 考虑添加缓存层
- 01:26:00 - 优化数据库索引
- 01:26:30 - 限制返回结果数量
- 01:27:00 - 使用连接池
- 01:27:30 - 监控 LLM API 调用成本

### **扩展可能性 (01:28:00 - 01:31:00)**
- 01:28:00 - 讨论添加更多数据源
- 01:28:30 - 集成其他 AWS 服务
- 01:29:00 - 支持多种数据库类型
- 01:29:30 - 添加数据可视化功能
- 01:30:00 - 实现多 Agent 协作
- 01:30:30 - 现场问答：与其他向量存储集成

### **Strand 工具生态 (01:31:00 - 01:34:00)**
- 01:31:00 - 介绍 Strand 工具是社区驱动的
- 01:31:30 - 新工具不断涌现
- 01:32:00 - 可以找到针对不同数据源的工具
- 01:32:30 - 鼓励贡献自定义工具
- 01:33:00 - 分享工具开发资源
- 01:33:30 - 现场问答：retrieve 工具的局限性

### **总结和要点 (01:34:00 - 01:37:00)**
- 01:34:00 - 总结关键学习点
- 01:34:30 - 强调 AI Agent 桥接数据孤岛的价值
- 01:35:00 - Strand SDK 简化 Agent 开发
- 01:35:30 - Bedrock Knowledge Base 处理非结构化数据
- 01:36:00 - 自定义工具访问结构化数据
- 01:36:30 - Agent 智能路由到正确数据源

### **问答环节 (01:37:00 - 01:45:00)**
- 01:37:00 - 开放问答环节
- 01:37:30 - 问题：chunking 策略最佳实践
- 01:38:00 - 问题：支持的嵌入模型
- 01:38:30 - 问题：多表关系处理
- 01:39:00 - 问题：生产环境部署建议
- 01:39:30 - 问题：成本优化策略
- 01:40:00 - 问题：与现有系统集成
- 01:40:30 - 提供会后交流机会
- 01:41:00 - 分享代码仓库链接
- 01:41:30 - 推荐相关 AWS 资源和文档

### **结束语 (01:45:00 - 01:47:00)**
- 01:45:00 - 感谢参会者
- 01:45:30 - 邀请会后继续讨论
- 01:46:00 - 提醒填写会议反馈
- 01:46:30 - 推荐其他相关会议
- 01:47:00 - 会议结束